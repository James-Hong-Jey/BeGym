/*! For license information please see main.43bc250a.js.LICENSE.txt */
!function(){var e={2509:function(e,t,n){(function(){"use strict";var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var a=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var n=a;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in n))break e;n=n[o]}(t=t(i=n[e=e[e.length-1]]))!=i&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}function u(e){if(!(e instanceof Array)){e=s(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}i("Symbol",(function(e){function t(e,t){this.h=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.h};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",a=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+a++,r)}})),i("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<n.length;i++){var s=a[n[i]];"function"===typeof s&&"function"!=typeof s.prototype[e]&&r(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e}));var c="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};i("Object.assign",(function(e){return e||c}));var l,h="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var p;e:{var d={};try{d.__proto__={a:!0},p=d.a;break e}catch(xn){}p=!1}l=p?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var f=l;function m(e,t){if(e.prototype=h(t.prototype),e.prototype.constructor=e,f)f(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,n);r&&Object.defineProperty(e,n,r)}else e[n]=t[n];e.za=t.prototype}function v(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function g(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function y(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}function b(e,t,n){return e.h=n,{value:t}}function x(e){this.h=new v,this.i=e}function k(e,t,n,r){try{var a=t.call(e.h.j,n);if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");if(!a.done)return e.h.m=!1,a;var i=a.value}catch(o){return e.h.j=null,y(e.h,o),w(e)}return e.h.j=null,r.call(e.h,i),w(e)}function w(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(n){e.h.i=void 0,y(e.h,n)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function S(e){this.next=function(t){return g(e.h),e.h.j?t=k(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=w(e)),t},this.throw=function(t){return g(e.h),e.h.j?t=k(e,e.h.j.throw,t,e.h.u):(y(e.h,t),t=w(e)),t},this.return=function(t){return function(e,t){g(e.h);var n=e.h.j;return n?k(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.h.return):(e.h.return(t),w(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function I(e){return function(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise((function(r,a){!function e(i){i.done?r(i.value):Promise.resolve(i.value).then(t,n).then(e,a)}(e.next())}))}(new S(new x(e)))}function C(e){return e||Array.prototype.fill}v.prototype.u=function(e){this.i=e},v.prototype.return=function(e){this.l={return:e},this.h=this.v},i("Promise",(function(e){function t(e){this.i=0,this.j=void 0,this.h=[],this.u=!1;var t=this.l();try{e(t.resolve,t.reject)}catch(n){t.reject(n)}}function n(){this.h=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.i=function(e){if(null==this.h){this.h=[];var t=this;this.j((function(){t.m()}))}this.h.push(e)};var i=a.setTimeout;n.prototype.j=function(e){i(e,0)},n.prototype.m=function(){for(;this.h&&this.h.length;){var e=this.h;this.h=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(r){this.l(r)}}}this.h=null},n.prototype.l=function(e){this.j((function(){throw e}))},t.prototype.l=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.I),reject:e(this.m)}},t.prototype.I=function(e){if(e===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.L(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.F(e):this.s(e)}},t.prototype.F=function(e){var t=void 0;try{t=e.then}catch(n){return void this.m(n)}"function"==typeof t?this.M(t,e):this.s(e)},t.prototype.m=function(e){this.v(2,e)},t.prototype.s=function(e){this.v(1,e)},t.prototype.v=function(e,t){if(0!=this.i)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.i);this.i=e,this.j=t,2===this.i&&this.K(),this.H()},t.prototype.K=function(){var e=this;i((function(){if(e.D()){var t=a.console;"undefined"!==typeof t&&t.error(e.j)}}),1)},t.prototype.D=function(){if(this.u)return!1;var e=a.CustomEvent,t=a.Event,n=a.dispatchEvent;return"undefined"===typeof n||("function"===typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"===typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=a.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.j,n(e))},t.prototype.H=function(){if(null!=this.h){for(var e=0;e<this.h.length;++e)o.i(this.h[e]);this.h=null}};var o=new n;return t.prototype.L=function(e){var t=this.l();e.T(t.resolve,t.reject)},t.prototype.M=function(e,t){var n=this.l();try{e.call(t,n.resolve,n.reject)}catch(r){n.reject(r)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{a(e(t))}catch(n){i(n)}}:t}var a,i,o=new t((function(e,t){a=e,i=t}));return this.T(r(e,a),r(n,i)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.T=function(e,t){function n(){switch(r.i){case 1:e(r.j);break;case 2:t(r.j);break;default:throw Error("Unexpected state: "+r.i)}}var r=this;null==this.h?o.i(n):this.h.push(n),this.u=!0},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var a=s(e),i=a.next();!i.done;i=a.next())r(i.value).T(t,n)}))},t.all=function(e){var n=s(e),a=n.next();return a.done?r([]):new t((function(e,t){function i(t){return function(n){o[t]=n,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,r(a.value).T(i(o.length-1),t),a=n.next()}while(!a.done)}))},t})),i("Array.prototype.keys",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,a={next:function(){if(!r&&n<e.length){var a=n++;return{value:t(a,e[a]),done:!1}}return r=!0,{done:!0,value:void 0}}};return a[Symbol.iterator]=function(){return a},a}(this,(function(e){return e}))}})),i("Array.prototype.fill",(function(e){return e||function(e,t,n){var r=this.length||0;for(0>t&&(t=Math.max(0,r+t)),(null==n||n>r)&&(n=r),0>(n=Number(n))&&(n=Math.max(0,r+n)),t=Number(t||0);t<n;t++)this[t]=e;return this}})),i("Int8Array.prototype.fill",C),i("Uint8Array.prototype.fill",C),i("Uint8ClampedArray.prototype.fill",C),i("Int16Array.prototype.fill",C),i("Uint16Array.prototype.fill",C),i("Int32Array.prototype.fill",C),i("Uint32Array.prototype.fill",C),i("Float32Array.prototype.fill",C),i("Float64Array.prototype.fill",C),i("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}})),i("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(t=t||0)&&(t=Math.max(t+r,0));t<r;t++){var a=n[t];if(a===e||Object.is(a,e))return!0}return!1}})),i("String.prototype.includes",(function(e){return e||function(e,t){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(e,t||0)}}));var T=this||self;function N(e,t){e=e.split(".");var n,r=T;e[0]in r||"undefined"==typeof r.execScript||r.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}function E(e){var t;return(t=T.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}var R=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=Array(n),a="string"===typeof e?e.split(""):e,i=0;i<n;i++)i in a&&(r[i]=t.call(void 0,a[i],i,e));return r},A={},_=null;function O(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);var r=new Uint8Array(n),a=0;return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),a=_[n];if(null!=a)return a;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}F();for(var r=0;;){var a=n(-1),i=n(0),o=n(64),s=n(64);if(64===s&&-1===a)break;t(a<<2|i>>4),64!=o&&(t(i<<4&240|o>>2),64!=s&&t(o<<6&192|s))}}(e,(function(e){r[a++]=e})),a!==n?r.subarray(0,a):r}function F(){if(!_){_={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=e.concat(t[n].split(""));A[n]=r;for(var a=0;a<r.length;a++){var i=r[a];void 0===_[i]&&(_[i]=a)}}}}var D="undefined"!==typeof Uint8Array,M=!(E("Trident")||E("MSIE"))&&"function"===typeof T.btoa;function P(e){if(!M){var t;void 0===t&&(t=0),F(),t=A[t];for(var n=Array(Math.floor(e.length/3)),r=t[64]||"",a=0,i=0;a<e.length-2;a+=3){var o=e[a],s=e[a+1],u=e[a+2],c=t[o>>2];o=t[(3&o)<<4|s>>4],s=t[(15&s)<<2|u>>6],u=t[63&u],n[i++]=c+o+s+u}switch(c=0,u=r,e.length-a){case 2:u=t[(15&(c=e[a+1]))<<2]||r;case 1:e=e[a],n[i]=t[e>>2]+t[(3&e)<<4|c>>4]+u+r}return n.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var L,z=RegExp("[-_.]","g");function B(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function U(e){if(!M)return O(e);z.test(e)&&(e=e.replace(z,B)),e=atob(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function W(){return L||(L=new Uint8Array(0))}var V={},G="function"===typeof Uint8Array.prototype.slice,j=0,H=0;function Z(e){var t=0>e,n=(e=Math.abs(e))>>>0;e=Math.floor((e-n)/4294967296),t&&(t=(n=s(X(n,e))).next().value,e=n.next().value,n=t),j=n>>>0,H=e>>>0}var K,q="function"===typeof BigInt;function X(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function Y(e,t){this.i=e>>>0,this.h=t>>>0}function Q(e){if(!e)return K||(K=new Y(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)Z(Number(e));else if(q)e=BigInt(e),j=Number(e&BigInt(4294967295))>>>0,H=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+("-"===e[0]);H=j=0;for(var n=e.length,r=t,a=(n-t)%6+t;a<=n;r=a,a+=6)r=Number(e.slice(r,a)),H*=1e6,4294967296<=(j=1e6*j+r)&&(H+=j/4294967296|0,j%=4294967296);t&&(e=(t=s(X(j,H))).next().value,t=t.next().value,j=e,H=t)}return new Y(j,H)}function J(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function $(){return Error("Failed to read varint, encoding is invalid.")}function ee(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function te(){throw Error("Invalid UTF8")}function ne(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}var re,ae,ie,oe=void 0,se="undefined"!==typeof TextDecoder,ue="undefined"!==typeof TextEncoder;function ce(e){if(e!==V)throw Error("illegal external caller")}function le(e,t){if(ce(t),this.V=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}function he(){return ie||(ie=new le(null,V))}function pe(e){ce(V);var t=e.V;return null==(t=null==t||D&&null!=t&&t instanceof Uint8Array?t:"string"===typeof t?U(t):null)?t:e.V=t}function de(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,fe(this,e,t)}function fe(e,t,n){n=void 0===n?{}:n,e.S=void 0!==n.S&&n.S,t&&(t=function(e){if("string"===typeof e)return{buffer:U(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===le)return{buffer:pe(e)||W(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}function me(e,t){if(e.h=t,t>e.j)throw ee(e.j,t)}function ve(e){var t=e.i,n=e.h,r=t[n++],a=127&r;if(128&r&&(a|=(127&(r=t[n++]))<<7,128&r&&(a|=(127&(r=t[n++]))<<14,128&r&&(a|=(127&(r=t[n++]))<<21,128&r&&(a|=(r=t[n++])<<28,128&r&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++])))))throw $();return me(e,n),a}function ge(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var n=e.h,r=n+t;if(r>e.j)throw ee(t,e.j-n);return e.h=r,n}de.prototype.reset=function(){this.h=this.l};var ye=[];function be(){this.h=[]}function xe(e,t,n){for(;0<n||127<t;)e.h.push(127&t|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.h.push(t)}function ke(e,t){for(;127<t;)e.h.push(127&t|128),t>>>=7;e.h.push(t)}function we(e,t){if(ye.length){var n=ye.pop();fe(n,e,t),e=n}else e=new de(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}function Se(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var n=ve(e.h)>>>0;if(t=n>>>3,!(0<=(n&=7)&&5>=n))throw J(n,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=n,!0}function Ie(e){switch(e.i){case 0:if(0!=e.i)Ie(e);else e:{for(var t=(e=e.h).h,n=t+10,r=e.i;t<n;)if(0===(128&r[t++])){me(e,t);break e}throw $()}break;case 1:me(e=e.h,e.h+8);break;case 2:2!=e.i?Ie(e):(t=ve(e.h)>>>0,me(e=e.h,e.h+t));break;case 5:me(e=e.h,e.h+4);break;case 3:for(t=e.l;;){if(!Se(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.i){if(e.l!=t)throw Error("Unmatched end-group tag");break}Ie(e)}break;default:throw J(e.i,e.j)}}be.prototype.length=function(){return this.h.length},be.prototype.end=function(){var e=this.h;return this.h=[],e},we.prototype.setOptions=function(e){e=void 0===e?{}:e,this.ca=void 0!==e.ca&&e.ca},we.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};var Ce=[];function Te(){this.j=[],this.i=0,this.h=new be}function Ne(e,t){0!==t.length&&(e.j.push(t),e.i+=t.length)}var Ee="function"===typeof Symbol&&"symbol"===typeof Symbol()?Symbol():void 0;function Re(e,t){return Ee?e[Ee]|=t:void 0!==e.A?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function Ae(e,t){Ee?e[Ee]&&(e[Ee]&=~t):void 0!==e.A&&(e.A&=~t)}function _e(e){var t;return null==(t=Ee?e[Ee]:e.A)?0:t}function Oe(e,t){Ee?e[Ee]=t:void 0!==e.A?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function Fe(e){return Re(e,1),e}function De(e,t){Oe(t,-51&(0|e))}function Me(e,t){Oe(t,-41&(18|e))}var Pe={};function Le(e){return null!==e&&"object"===typeof e&&!Array.isArray(e)&&e.constructor===Object}var ze,Be,Ue=[];function We(e){if(2&_e(e.o))throw Error("Cannot mutate an immutable Message")}function Ve(e){var t=e.length;(t=t?e[t-1]:void 0)&&Le(t)?t.g=1:(t={},e.push((t.g=1,t)))}function Ge(e){var t=e.i+e.G;return e.B||(e.B=e.o[t]={})}function je(e,t){return-1===t?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function He(e,t,n,r){We(e),Ze(e,t,n,r)}function Ze(e,t,n,r){e.j&&(e.j=void 0),t>=e.i||r?Ge(e)[t]=n:(e.o[t+e.G]=n,(e=e.B)&&t in e&&delete e[t])}function Ke(e,t,n,r){var a=je(e,t);Array.isArray(a)||(a=ze);var i=_e(a);if(1&i||Fe(a),r)2&i||Re(a,2),1&n||Object.freeze(a);else{r=!(2&n);var o=2&i;1&n||!o?r&&16&i&&!o&&Ae(a,16):Ze(e,t,a=Fe(Array.prototype.slice.call(a)))}return a}function qe(e,t){var n=je(e,t),r=null==n?n:"number"===typeof n||"NaN"===n||"Infinity"===n||"-Infinity"===n?Number(n):void 0;return null!=r&&r!==n&&Ze(e,t,r),r}function Xe(e,t,n,r,a){e.h||(e.h={});var i=e.h[n],o=Ke(e,n,3,a);if(!i){var s=o;i=[];var u=!!(16&_e(e.o));o=!!(2&_e(s));var c=s;!a&&o&&(s=Array.prototype.slice.call(s));for(var l=o,h=0;h<s.length;h++){var p=s[h],d=t,f=!1;if(f=void 0!==f&&f,void 0!==(p=Array.isArray(p)?new d(p):f?new d:void 0)){var m=f=_e(d=p.o);o&&(m|=2),u&&(m|=16),m!=f&&Oe(d,m),d=m,l=l||!!(2&d),i.push(p)}}return e.h[n]=i,t=33|(u=_e(s)),u!=(t=l?-9&t:8|t)&&(l=s,Object.isFrozen(l)&&(l=Array.prototype.slice.call(l)),Oe(l,t),s=l),c!==s&&Ze(e,n,s),(a||r&&o)&&Re(i,2),r&&Object.freeze(i),i}return a||(a=Object.isFrozen(i),r&&!a?Object.freeze(i):!r&&a&&(i=Array.prototype.slice.call(i),e.h[n]=i)),i}function Ye(e,t,n){var r=!!(2&_e(e.o));if(t=Xe(e,t,n,r,r),e=Ke(e,n,3,r),!(r||8&_e(e))){for(r=0;r<t.length;r++){if(2&_e((n=t[r]).o)){var a=ut(n,!1);a.j=n}else a=n;n!==a&&(t[r]=a,e[r]=a.o)}Re(e,8)}return t}function Qe(e,t,n){if(null!=n&&"number"!==typeof n)throw Error("Value of float/double field must be a number|null|undefined, found "+typeof n+": "+n);He(e,t,n)}function Je(e,t,n,r,a){We(e);var i=Xe(e,n,t,!1,!1);return n=null!=r?r:new n,e=Ke(e,t,2,!1),void 0!=a?(i.splice(a,0,n),e.splice(a,0,n.o)):(i.push(n),e.push(n.o)),n.C()&&Ae(e,8),n}function $e(e,t){return null==e?t:e}function et(e,t,n){return n=void 0===n?0:n,$e(qe(e,t),n)}function tt(e,t,n,r){if(null!=e){if(Array.isArray(e))e=nt(e,t,n,void 0!==r);else if(Le(e)){var a,i={};for(a in e)i[a]=tt(e[a],t,n,r);e=i}else e=t(e,r);return e}}function nt(e,t,n,r){var a=_e(e);r=r?!!(16&a):void 0,e=Array.prototype.slice.call(e);for(var i=0;i<e.length;i++)e[i]=tt(e[i],t,n,r);return n(a,e),e}function rt(e){return e.ja===Pe?e.toJSON():function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if(0!==(128&_e(e)))return Ve(e=Array.prototype.slice.call(e)),e}else{if(D&&null!=e&&e instanceof Uint8Array)return P(e);if(e instanceof le){var t=e.V;return null==t?"":"string"===typeof t?t:e.V=P(t)}}}return e}(e)}function at(e,t){128&e&&Ve(t)}function it(e,t,n){if(n=void 0===n?Me:n,null!=e){if(D&&e instanceof Uint8Array)return e.length?new le(new Uint8Array(e),V):he();if(Array.isArray(e)){var r=_e(e);return 2&r?e:!t||32&r||!(16&r||0===r)?(4&(t=_e(e=nt(e,it,4&r?Me:n,!0)))&&2&t&&Object.freeze(e),e):(Oe(e,2|r),e)}return e.ja===Pe?st(e):e}}function ot(e,t,n,r,a,i,o){if(e=e.h&&e.h[n]){if(2&(r=_e(e))?r=e:(Me(r,i=R(e,st)),Object.freeze(i),r=i),We(t),o=null==r?ze:Fe([]),null!=r){for(i=!!r.length,e=0;e<r.length;e++){var s=r[e];i=i&&!(2&_e(s.o)),o[e]=s.o}i=1|(i?8:0),((e=_e(o))&i)!==i&&(Object.isFrozen(o)&&(o=Array.prototype.slice.call(o)),Oe(o,e|i)),t.h||(t.h={}),t.h[n]=r}else t.h&&(t.h[n]=void 0);Ze(t,n,o,a)}else He(t,n,it(r,i,o),a)}function st(e){return 2&_e(e.o)||Re((e=ut(e,!0)).o,2),e}function ut(e,t){var n=e.o,r=[];Re(r,16);var a=e.constructor.h;if(a&&r.push(a),a=e.B){r.length=n.length,r.fill(void 0,r.length,n.length);var i={};r[r.length-1]=i}0!==(128&_e(n))&&Ve(r),t=t||e.C()?Me:De,i=e.constructor,Be=r,r=new i(r),Be=void 0,e.R&&(r.R=e.R.slice()),i=!!(16&_e(n));for(var o=a?n.length-1:n.length,s=0;s<o;s++)ot(e,r,s-e.G,n[s],!1,i,t);if(a)for(var u in a)ot(e,r,+u,a[u],!0,i,t);return r}function ct(e,t,n){null==e&&(e=Be),Be=void 0;var r,a=this.constructor.i||0,i=0<a,o=this.constructor.h,s=!1;if(null==e){var u=48,c=!0;i&&(a=0,u|=128),Oe(e=o?[o]:[],u)}else{if(!Array.isArray(e))throw Error();if(o&&o!==e[0])throw Error();var l=u=Re(e,0);if((c=0!==(16&l))&&((s=0!==(32&l))||(l|=32)),i){if(128&l)a=0;else if(0<e.length){var h=e[e.length-1];if(Le(h)&&"g"in h){a=0,l|=128,delete h.g;var p,d=!0;for(p in h){d=!1;break}d&&e.pop()}}}else if(128&l)throw Error();u!==l&&Oe(e,l)}if(this.G=(o?0:-1)-a,this.h=void 0,this.o=e,a=(o=this.o.length)-1,o&&Le(o=this.o[a])?(this.B=o,this.i=a-this.G):void 0!==t&&-1<t?(this.i=Math.max(t,a+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE,!i&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(n)for(t=c&&!s&&!0,i=this.i,c=0;c<n.length;c++)(s=n[c])<i?(a=e[s+=this.G])?lt(a,t):e[s]=ze:(r||(r=Ge(this)),(a=r[s])?lt(a,t):r[s]=ze)}function lt(e,t){if(Array.isArray(e)){var n=_e(e),r=1;!t||2&n||(r|=16),(n&r)!==r&&Oe(e,n|r)}}function ht(e,t,n){if(n){var r,a={};for(r in n){var i=n[r],o=i.ra;o||(a.J=i.xa||i.oa.W,i.ia?(a.aa=bt(i.ia),o=function(e){return function(t,n,r){return e.J(t,n,r,e.aa)}}(a)):i.ka?(a.Z=xt(i.da.P,i.ka),o=function(e){return function(t,n,r){return e.J(t,n,r,e.Z)}}(a)):o=a.J,i.ra=o),o(t,e,i.da),a={J:a.J,aa:a.aa,Z:a.Z}}}!function(e,t){if(t=t.R){Ne(e,e.h.end());for(var n=0;n<t.length;n++)Ne(e,pe(t[n])||W())}}(t,e)}Oe(Ue,23),ze=Object.freeze(Ue),ct.prototype.toJSON=function(){return nt(this.o,rt,at)},ct.prototype.C=function(){return!!(2&_e(this.o))},ct.prototype.ja=Pe,ct.prototype.toString=function(){return this.o.toString()};var pt=Symbol();function dt(e,t,n){return e[pt]||(e[pt]=function(e,r){return t(e,r,n)})}function ft(e){var t=e[pt];if(!t){var n=Ot(e);t=function(e,t){return Ft(e,t,n)},e[pt]=t}return t}function mt(e){var t=function(e){var t=e.ia;return t?ft(t):(t=e.wa)?dt(e.da.P,t,e.ka):void 0}(e),n=e.da,r=e.oa.U;return t?function(e,a){return r(e,a,n,t)}:function(e,t){return r(e,t,n)}}function vt(e,t){var n=e[t];return"function"==typeof n&&0===n.length&&(n=n(),e[t]=n),Array.isArray(n)&&(Nt in n||kt in n||0<n.length&&"function"==typeof n[0])?n:void 0}function gt(e,t,n,r,a,i){t.P=e[0];var o=1;if(e.length>o&&"number"!==typeof e[o]){var s=e[o++];n(t,s)}for(;o<e.length;){n=e[o++];for(var u=o+1;u<e.length&&"number"!==typeof e[u];)u++;switch(s=e[o++],u-=o){case 0:r(t,n,s);break;case 1:(u=vt(e,o))?(o++,a(t,n,s,u)):r(t,n,s,e[o++]);break;case 2:a(t,n,s,u=vt(e,u=o++),e[o++]);break;case 3:i(t,n,s,e[o++],e[o++],e[o++]);break;case 4:i(t,n,s,e[o++],e[o++],e[o++],e[o++]);break;default:throw Error("unexpected number of binary field arguments: "+u)}}return t}var yt=Symbol();function bt(e){var t=e[yt];if(!t){var n=Tt(e);t=function(e,t){return Dt(e,t,n)},e[yt]=t}return t}function xt(e,t){var n=e[yt];return n||(n=function(e,n){return ht(e,n,t)},e[yt]=n),n}var kt=Symbol();function wt(e,t){e.push(t)}function St(e,t,n){e.push(t,n.W)}function It(e,t,n,r){var a=bt(r),i=Tt(r).P,o=n.W;e.push(t,(function(e,t,n){return o(e,t,n,i,a)}))}function Ct(e,t,n,r,a,i){var o=xt(r,i),s=n.W;e.push(t,(function(e,t,n){return s(e,t,n,r,o)}))}function Tt(e){var t=e[kt];return t||(t=gt(e,e[kt]=[],wt,St,It,Ct),Nt in e&&kt in e&&(e.length=0),t)}var Nt=Symbol();function Et(e,t){e[0]=t}function Rt(e,t,n,r){var a=n.U;e[t]=r?function(e,t,n){return a(e,t,n,r)}:a}function At(e,t,n,r,a){var i=n.U,o=ft(r),s=Ot(r).P;e[t]=function(e,t,n){return i(e,t,n,s,o,a)}}function _t(e,t,n,r,a,i,o){var s=n.U,u=dt(r,a,i);e[t]=function(e,t,n){return s(e,t,n,r,u,o)}}function Ot(e){var t=e[Nt];return t||(t=gt(e,e[Nt]={},Et,Rt,At,_t),Nt in e&&kt in e&&(e.length=0),t)}function Ft(e,t,n){for(;Se(t)&&4!=t.i;){var r=t.l,a=n[r];if(!a){var i=n[0];i&&(i=i[r])&&(a=n[r]=mt(i))}if(!a||!a(t,e,r)){r=e,i=(a=t).j,Ie(a);var o=a;if(!o.ca){if(a=o.h.h-i,o.h.h=i,o=o.h,0==a)a=he();else{if(i=ge(o,a),o.S&&o.m)a=o.i.subarray(i,i+a);else{o=o.i;var s=i;a=s===(a=i+a)?W():G?o.slice(s,a):new Uint8Array(o.subarray(s,a))}a=0==a.length?he():new le(a,V)}(i=r.R)?i.push(a):r.R=[a]}}}return e}function Dt(e,t,n){for(var r=n.length,a=1==r%2,i=a?1:0;i<r;i+=2)(0,n[i+1])(t,e,n[i]);ht(e,t,a?n[0]:void 0)}function Mt(e,t){return{U:e,W:t}}var Pt=Mt((function(e,t,n){if(5!==e.i)return!1;var r=(e=e.h).i,a=e.h,i=r[a],o=r[a+1],s=r[a+2];return r=r[a+3],me(e,e.h+4),e=2*((o=(i<<0|o<<8|s<<16|r<<24)>>>0)>>31)+1,i=o>>>23&255,o&=8388607,He(t,n,255==i?o?NaN:1/0*e:0==i?e*Math.pow(2,-149)*o:e*Math.pow(2,i-150)*(o+Math.pow(2,23))),!0}),(function(e,t,n){if(null!=(t=qe(t,n))){ke(e.h,8*n+5),e=e.h;var r=+t;0===r?0<1/r?j=H=0:(H=0,j=2147483648):isNaN(r)?(H=0,j=2147483647):34028234663852886e22<(r=(n=0>r?-2147483648:0)?-r:r)?(H=0,j=(2139095040|n)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),H=0,j=(n|r)>>>0):(t=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-t),16777216<=(r=Math.round(8388608*r))&&++t,H=0,j=(n|t+127<<23|8388607&r)>>>0),n=j,e.h.push(n>>>0&255),e.h.push(n>>>8&255),e.h.push(n>>>16&255),e.h.push(n>>>24&255)}})),Lt=Mt((function(e,t,n){if(0!==e.i)return!1;var r=e.h,a=0,i=e=0,o=r.i,s=r.h;do{var u=o[s++];a|=(127&u)<<i,i+=7}while(32>i&&128&u);for(32<i&&(e|=(127&u)>>4),i=3;32>i&&128&u;i+=7)e|=(127&(u=o[s++]))<<i;if(me(r,s),!(128>u))throw $();return r=a>>>0,(e=2147483648&(u=e>>>0))&&(u=~u>>>0,0==(r=1+~r>>>0)&&(u=u+1>>>0)),r=4294967296*u+(r>>>0),He(t,n,e?-r:r),!0}),(function(e,t,n){null!=(t=je(t,n))&&("string"===typeof t&&Q(t),null!=t&&(ke(e.h,8*n),"number"===typeof t?(e=e.h,Z(t),xe(e,j,H)):(n=Q(t),xe(e.h,n.i,n.h))))})),zt=Mt((function(e,t,n){return 0===e.i&&(He(t,n,ve(e.h)),!0)}),(function(e,t,n){if(null!=(t=je(t,n))&&null!=t)if(ke(e.h,8*n),e=e.h,0<=(n=t))ke(e,n);else{for(t=0;9>t;t++)e.h.push(127&n|128),n>>=7;e.h.push(1)}})),Bt=Mt((function(e,t,n){if(2!==e.i)return!1;var r=ve(e.h)>>>0,a=ge(e=e.h,r);if(e=e.i,se){var i,o=e;(i=re)||(i=re=new TextDecoder("utf-8",{fatal:!0})),e=a+r,o=0===a&&e===o.length?o:o.subarray(a,e);try{var s=i.decode(o)}catch(h){if(void 0===oe){try{i.decode(new Uint8Array([128]))}catch(p){}try{i.decode(new Uint8Array([97])),oe=!0}catch(p){oe=!1}}throw!oe&&(re=void 0),h}}else{r=(s=a)+r,a=[];for(var u,c,l=null;s<r;)128>(u=e[s++])?a.push(u):224>u?s>=r?te():(c=e[s++],194>u||128!==(192&c)?(s--,te()):a.push((31&u)<<6|63&c)):240>u?s>=r-1?te():128!==(192&(c=e[s++]))||224===u&&160>c||237===u&&160<=c||128!==(192&(o=e[s++]))?(s--,te()):a.push((15&u)<<12|(63&c)<<6|63&o):244>=u?s>=r-2?te():128!==(192&(c=e[s++]))||0!==c-144+(u<<28)>>30||128!==(192&(o=e[s++]))||128!==(192&(i=e[s++]))?(s--,te()):(u=(7&u)<<18|(63&c)<<12|(63&o)<<6|63&i,u-=65536,a.push(55296+(u>>10&1023),56320+(1023&u))):te(),8192<=a.length&&(l=ne(l,a),a.length=0);s=ne(l,a)}return He(t,n,s),!0}),(function(e,t,n){if(null!=(t=je(t,n))){var r=!1;if(r=void 0!==r&&r,ue){if(r&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(ae||(ae=new TextEncoder)).encode(t)}else{for(var a=0,i=new Uint8Array(3*t.length),o=0;o<t.length;o++){var s=t.charCodeAt(o);if(128>s)i[a++]=s;else{if(2048>s)i[a++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&o<t.length){var u=t.charCodeAt(++o);if(56320<=u&&57343>=u){s=1024*(s-55296)+u-56320+65536,i[a++]=s>>18|240,i[a++]=s>>12&63|128,i[a++]=s>>6&63|128,i[a++]=63&s|128;continue}o--}if(r)throw Error("Found an unpaired surrogate");s=65533}i[a++]=s>>12|224,i[a++]=s>>6&63|128}i[a++]=63&s|128}}t=a===i.length?i:i.subarray(0,a)}ke(e.h,8*n+2),ke(e.h,t.length),Ne(e,e.h.end()),Ne(e,t)}})),Ut=Mt((function(e,t,n,r,a){if(2!==e.i)return!1;t=Je(t,n,r),n=e.h.j,r=ve(e.h)>>>0;var i=e.h.h+r,o=i-n;if(0>=o&&(e.h.j=i,a(t,e,void 0,void 0,void 0),o=i-e.h.h),o)throw Error("Message parsing ended unexpectedly. Expected to read "+r+" bytes, instead read "+(r-o)+" bytes, either the data ended unexpectedly or the message misreported its own length");return e.h.h=i,e.h.j=n,!0}),(function(e,t,n,r,a){if(null!=(t=Ye(t,r,n)))for(r=0;r<t.length;r++){var i=e;ke(i.h,8*n+2);var o=i.h.end();Ne(i,o),o.push(i.i),i=o,a(t[r],e),o=e;var s=i.pop();for(s=o.i+o.h.length()-s;127<s;)i.push(127&s|128),s>>>=7,o.i++;i.push(s),o.i++}}));function Wt(e){return function(t,n){e:{if(Ce.length){var r=Ce.pop();r.setOptions(n),fe(r.h,t,n),t=r}else t=new we(t,n);try{var a=Ot(e),i=Ft(new a.P,t,a);break e}finally{(a=t.h).i=null,a.m=!1,a.l=0,a.j=0,a.h=0,a.S=!1,t.l=-1,t.i=-1,100>Ce.length&&Ce.push(t)}i=void 0}return i}}function Vt(e){return function(){var t=new Te;Dt(this,t,Tt(e)),Ne(t,t.h.end());for(var n=new Uint8Array(t.i),r=t.j,a=r.length,i=0,o=0;o<a;o++){var s=r[o];n.set(s,i),i+=s.length}return t.j=[n],n}}function Gt(e){ct.call(this,e)}m(Gt,ct);var jt=[Gt,1,zt,2,Pt,3,Bt,4,Bt];function Ht(e){ct.call(this,e,-1,Zt)}Gt.prototype.l=Vt(jt),m(Ht,ct),Ht.prototype.addClassification=function(e,t){return Je(this,1,Gt,e,t),this};var Zt=[1],Kt=Wt([Ht,1,Ut,jt]);function qt(e){ct.call(this,e)}m(qt,ct);var Xt=[qt,1,Pt,2,Pt,3,Pt,4,Pt,5,Pt];function Yt(e){ct.call(this,e,-1,Qt)}qt.prototype.l=Vt(Xt),m(Yt,ct);var Qt=[1],Jt=Wt([Yt,1,Ut,Xt]);function $t(e){ct.call(this,e)}m($t,ct);var en=[$t,1,Pt,2,Pt,3,Pt,4,Pt,5,Pt,6,Lt],tn=Wt(en);function nn(e,t,n){if(n=e.createShader(0===n?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+e.getShaderInfoLog(n));return n}function rn(e){return Ye(e,Gt,1).map((function(e){var t=je(e,1);return{index:null==t?0:t,qa:et(e,2),label:null!=je(e,3)?$e(je(e,3),""):void 0,displayName:null!=je(e,4)?$e(je(e,4),""):void 0}}))}function an(e){return{x:et(e,1),y:et(e,2),z:et(e,3),visibility:null!=qe(e,4)?et(e,4):void 0}}function on(e){return Ye(Jt(e),qt,1).map(an)}function sn(e,t){this.i=e,this.h=t,this.m=0}function un(e,t,n){return function(e,t){var n=e.h;if(void 0===e.s){var r=nn(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),a=nn(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),i=n.createProgram();if(n.attachShader(i,r),n.attachShader(i,a),n.linkProgram(i),!n.getProgramParameter(i,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(i));r=e.s=i,n.useProgram(r),a=n.getUniformLocation(r,"sampler0"),e.l={O:n.getAttribLocation(r,"aVertex"),N:n.getAttribLocation(r,"aTex"),ya:a},e.v=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.enableVertexAttribArray(e.l.O),n.vertexAttribPointer(e.l.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),e.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.enableVertexAttribArray(e.l.N),n.vertexAttribPointer(e.l.N,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(a,0)}r=e.l,n.useProgram(e.s),n.canvas.width=t.width,n.canvas.height=t.height,n.viewport(0,0,t.width,t.height),n.activeTexture(n.TEXTURE0),e.i.bindTexture2d(t.glName),n.enableVertexAttribArray(r.O),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.vertexAttribPointer(r.O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.N),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.vertexAttribPointer(r.N,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.O),n.disableVertexAttribArray(r.N),n.bindBuffer(n.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}(e,t),"function"===typeof e.h.canvas.transferToImageBitmap?Promise.resolve(e.h.canvas.transferToImageBitmap()):n?Promise.resolve(e.h.canvas):"function"===typeof createImageBitmap?createImageBitmap(e.h.canvas):(void 0===e.j&&(e.j=document.createElement("canvas")),new Promise((function(t){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),t(e.j)})))}function cn(e){this.h=e}$t.prototype.l=Vt(en);var ln=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function hn(e,t){return t+e}function pn(e,t){window[e]=t}function dn(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||hn,"object"===typeof window)var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"===typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.ha=t,e.options)for(var n=(t=s(Object.keys(e.options))).next();!n.done;n=t.next()){n=n.value;var r=e.options[n].default;void 0!==r&&(this.l[n]="function"===typeof r?r():r)}}function fn(e){var t,n,r,a,i,o,s,c,l,h,p;return I((function(d){switch(d.h){case 1:return e.ga?(t=void 0===e.h.files?[]:"function"===typeof e.h.files?e.h.files(e.l):e.h.files,b(d,I((function(e){switch(e.h){case 1:return e.s=2,b(e,WebAssembly.instantiate(ln),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}})),2)):d.return();case 2:if(n=d.i,"object"===typeof window)return pn("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),pn("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),o=t.filter((function(e){return void 0!==e.data})),s=t.filter((function(e){return void 0===e.data})),c=Promise.all(o.map((function(t){var n=mn(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),l=Promise.all(s.map((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n?function(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise((function(e){t.addEventListener("load",(function(){e()}),!1),t.addEventListener("error",(function(){e()}),!1),document.body.appendChild(t)}))}(e.locateFile(t.url,e.ha)):Promise.resolve()}))).then((function(){var t,n,r;return I((function(a){if(1==a.h)return t=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,r=e,b(a,t(n),2);r.i=a.i,a.h=0}))})),h=I((function(t){return e.h.graph&&e.h.graph.url?t=b(t,mn(e,e.h.graph.url),0):(t.h=0,t=void 0),t})),b(d,Promise.all([l,c,h]),7);if("function"!==typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=t.filter((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n})).map((function(t){return e.locateFile(t.url,e.ha)})),importScripts.apply(null,u(r)),a=e,b(d,createMediapipeSolutionsWasm(Module),6);case 6:a.i=d.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,i=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,va:"undefined"!==typeof WebGL2RenderingContext?2:1}),e.i.GL.makeContextCurrent(i),d.h=4;break;case 7:if(e.m=document.createElement("canvas"),!(p=e.m.getContext("webgl2",{}))&&!(p=e.m.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),d.return();e.K=p,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,d.h=0}}))}function mn(e,t){var n,r;return I((function(a){return t in e.L?a.return(e.L[t]):(n=e.locateFile(t,""),r=fetch(n).then((function(e){return e.arrayBuffer()})),e.L[t]=r,a.return(r))}))}function vn(e,t,n){var r,a,i,o,u,c,l,h,p,d,f,m,v,g;return I((function(y){switch(y.h){case 1:if(!n)return y.return(t);for(r={},a=0,i=s(Object.keys(n)),o=i.next();!o.done;o=i.next())u=o.value,"string"!==typeof(c=n[u])&&"texture"===c.type&&void 0!==t[c.stream]&&++a;1<a&&(e.M=!1),l=s(Object.keys(n)),o=l.next();case 2:if(o.done){y.h=4;break}if(h=o.value,"string"===typeof(p=n[h]))return v=r,g=h,b(y,function(e,t,n){var r;return I((function(a){return"number"===typeof n||n instanceof Uint8Array||n instanceof e.i.Uint8BlobList?a.return(n):n instanceof e.i.Texture2dDataOut?((r=e.v[t])||(r=new sn(e.i,e.K),e.v[t]=r),a.return(un(r,n,e.M))):a.return(void 0)}))}(e,h,t[p]),14);if(d=t[p.stream],"detection_list"===p.type){if(d){for(var x=d.getRectList(),k=d.getLandmarksList(),w=d.getClassificationsList(),S=[],C=0;C<x.size();++C){var T=tn(x.get(C)),N=void 0;N=void 0===N?0:N,T={la:{sa:et(T,1),ta:et(T,2),height:et(T,3),width:et(T,4),rotation:et(T,5,0),pa:$e(je(T,6),N)},ea:on(k.get(C)),ba:rn(Kt(w.get(C)))},S.push(T)}x=S}else x=[];r[h]=x,y.h=7;break}if("proto_list"===p.type){if(d){for(x=Array(d.size()),k=0;k<d.size();k++)x[k]=d.get(k);d.delete()}else x=[];r[h]=x,y.h=7;break}if(void 0===d){y.h=3;break}if("float_list"===p.type){r[h]=d,y.h=7;break}if("proto"===p.type){r[h]=d,y.h=7;break}if("texture"!==p.type)throw Error("Unknown output config type: '"+p.type+"'");return(f=e.v[h])||(f=new sn(e.i,e.K),e.v[h]=f),b(y,un(f,d,e.M),13);case 13:m=y.i,r[h]=m;case 7:p.transform&&r[h]&&(r[h]=p.transform(r[h])),y.h=3;break;case 14:v[g]=y.i;case 3:o=l.next(),y.h=2;break;case 4:return y.return(r)}}))}function gn(e,t){for(var n=t.name||"$",r=[].concat(u(t.wants)),a=new e.i.StringList,i=s(t.wants),o=i.next();!o.done;o=i.next())a.push_back(o.value);i=e.i.PacketListener.implement({onResults:function(a){for(var i={},o=0;o<t.wants.length;++o)i[r[o]]=a.get(o);var s=e.listeners[n];s&&(e.I=vn(e,i,t.outs).then((function(n){n=s(n);for(var a=0;a<t.wants.length;++a){var o=i[r[a]];"object"===typeof o&&o.hasOwnProperty&&o.hasOwnProperty("delete")&&o.delete()}n&&(e.I=n)})))}}),e.j.attachMultiListener(a,i),a.delete()}function yn(e){switch(void 0===e&&(e=0),e){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function bn(e){var t=this;e=e||{},this.h=new dn({locateFile:e.locateFile,files:function(e){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:yn(e.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:on},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:on},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"===typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(e){var n,r,a;return I((function(i){return 1==i.h?(n=yn(e),r="third_party/mediapipe/modules/pose_landmark/"+n,b(i,mn(t.h,n),2)):(a=i.i,t.h.overrideFile(r,a),i.return(!0))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(e=dn.prototype).close=function(){return this.j&&this.j.delete(),Promise.resolve()},e.reset=function(){var e=this;return I((function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0}))},e.setOptions=function(e,t){var n=this;if(t=t||this.h.options){for(var r=[],a=[],i={},o=s(Object.keys(e)),u=o.next();!u.done;i={X:i.X,Y:i.Y},u=o.next())if(!((u=u.value)in this.l)||this.l[u]!==e[u]){this.l[u]=e[u];var c=t[u];void 0!==c&&(c.onChange&&(i.X=c.onChange,i.Y=e[u],r.push(function(e){return function(){return I((function(t){if(1==t.h)return b(t,e.X(e.Y),2);!0===t.i&&(n.u=!0),t.h=0}))}}(i))),c.graphOptionXref&&(u=Object.assign({},{calculatorName:"",calculatorIndex:0},c.graphOptionXref,{valueNumber:1===c.type?e[u]:0,valueBoolean:0===c.type&&e[u],valueString:2===c.type?e[u]:""}),a.push(u)))}0===r.length&&0===a.length||(this.u=!0,this.H=(void 0===this.H?[]:this.H).concat(a),this.F=(void 0===this.F?[]:this.F).concat(r))}},e.initialize=function(){var e=this;return I((function(t){return 1==t.h?b(t,fn(e),2):3!=t.h?b(t,function(e){var t,n,r,a,i,o,u,c;return I((function(l){if(1==l.h)return e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url?l.return():(e.u=!0,e.h.graph&&e.h.graph.url?(e.fa=e.h.graph.url,b(l,mn(e,e.h.graph.url),3)):void(l.h=2));for(2!=l.h&&(t=l.i,e.j.loadGraph(t)),n=s(Object.keys(e.D)),r=n.next();!r.done;r=n.next())a=r.value,e.j.overrideFile(a,e.D[a]);if(e.D={},e.h.listeners)for(i=s(e.h.listeners),o=i.next();!o.done;o=i.next())u=o.value,gn(e,u);c=e.l,e.l={},e.setOptions(c),l.h=0}))}(e),3):b(t,function(e){var t,n,r,a,i,o;return I((function(u){switch(u.h){case 1:if(!e.u)return u.return();if(!e.F){u.h=2;break}t=s(e.F),n=t.next();case 3:if(n.done){u.h=5;break}return b(u,(0,n.value)(),4);case 4:n=t.next(),u.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(r=new e.i.GraphOptionChangeRequestList,a=s(e.H),i=a.next();!i.done;i=a.next())o=i.value,r.push_back(o);e.j.changeOptions(r),r.delete(),e.H=void 0}e.u=!1,u.h=0}}))}(e),0)}))},e.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},e.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},e.send=function(e,t){var n,r,a,i,o,u,c,l,h,p=this;return I((function(d){switch(d.h){case 1:return p.h.inputs?(n=1e3*(void 0===t||null===t?performance.now():t),b(d,p.I,2)):d.return();case 2:return b(d,p.initialize(),3);case 3:for(r=new p.i.PacketDataList,a=s(Object.keys(e)),i=a.next();!i.done;i=a.next())if(o=i.value,u=p.h.inputs[o]){e:{var f=e[o];switch(u.type){case"video":var m=p.s[u.stream];if(m||(m=new sn(p.i,p.K),p.s[u.stream]=m),0===m.m&&(m.m=m.i.createTexture()),"undefined"!==typeof HTMLVideoElement&&f instanceof HTMLVideoElement)var v=f.videoWidth,g=f.videoHeight;else"undefined"!==typeof HTMLImageElement&&f instanceof HTMLImageElement?(v=f.naturalWidth,g=f.naturalHeight):(v=f.width,g=f.height);g={glName:m.m,width:v,height:g},(v=m.h).canvas.width=g.width,v.canvas.height=g.height,v.activeTexture(v.TEXTURE0),m.i.bindTexture2d(m.m),v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,f),m.i.bindTexture2d(0),m=g;break e;case"detections":for((m=p.s[u.stream])||(m=new cn(p.i),p.s[u.stream]=m),m.data||(m.data=new m.h.DetectionListData),m.data.reset(f.length),g=0;g<f.length;++g){v=f[g];var y=m.data,x=y.setBoundingBox,k=g,w=v.la,S=new $t;if(Qe(S,1,w.sa),Qe(S,2,w.ta),Qe(S,3,w.height),Qe(S,4,w.width),Qe(S,5,w.rotation),He(S,6,w.pa),w=S.l(),x.call(y,k,w),v.ea)for(y=0;y<v.ea.length;++y){S=v.ea[y],k=(x=m.data).addNormalizedLandmark,w=g,S=Object.assign({},S,{visibility:S.visibility?S.visibility:0});var I=new qt;Qe(I,1,S.x),Qe(I,2,S.y),Qe(I,3,S.z),S.visibility&&Qe(I,4,S.visibility),S=I.l(),k.call(x,w,S)}if(v.ba)for(y=0;y<v.ba.length;++y)k=(x=m.data).addClassification,w=g,S=v.ba[y],Qe(I=new Gt,2,S.qa),S.index&&He(I,1,S.index),S.label&&He(I,3,S.label),S.displayName&&He(I,4,S.displayName),S=I.l(),k.call(x,w,S)}m=m.data;break e;default:m={}}}switch(c=m,l=u.stream,u.type){case"video":r.pushTexture2d(Object.assign({},c,{stream:l,timestamp:n}));break;case"detections":(h=c).stream=l,h.timestamp=n,r.pushDetectionList(h);break;default:throw Error("Unknown input config type: '"+u.type+"'")}}return p.j.send(r),b(d,p.I,4);case 4:r.delete(),d.h=0}}))},e.onResults=function(e,t){this.listeners[t||"$"]=e},N("Solution",dn),N("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(e=bn.prototype).reset=function(){this.h.reset()},e.close=function(){return this.h.close(),Promise.resolve()},e.onResults=function(e){this.h.onResults(e)},e.initialize=function(){var e=this;return I((function(t){return b(t,e.h.initialize(),0)}))},e.send=function(e,t){var n=this;return I((function(r){return b(r,n.h.send(e,t),0)}))},e.setOptions=function(e){this.h.setOptions(e)},N("Pose",bn),N("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),N("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),N("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),N("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),N("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),N("VERSION","0.5.1675469404")}).call(this)},2664:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"}),"ThumbDown");t.Z=o},786:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"}),"ThumbUp");t.Z=o},5649:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(6119)},6119:function(e,t,n){"use strict";n.r(t),n.d(t,{capitalize:function(){return s},createChainedFunction:function(){return u},createSvgIcon:function(){return rr},debounce:function(){return ar},deprecatedPropType:function(){return ir},isMuiElement:function(){return or},ownerDocument:function(){return ur},ownerWindow:function(){return cr},requirePropFactory:function(){return lr},setRef:function(){return pr},unstable_ClassNameGenerator:function(){return _r},unstable_useEnhancedEffect:function(){return fr},unstable_useId:function(){return gr},unsupportedProp:function(){return yr},useControlled:function(){return br},useEventCallback:function(){return xr},useForkRef:function(){return wr},useIsFocusVisible:function(){return Ar}});var r=function(e){return e},a=function(){var e=r;return{configure:function(t){e=t},generate:function(t){return e(t)},reset:function(){e=r}}}();function i(e){for(var t="https://mui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}function o(e){if("string"!==typeof e)throw new Error(i(7));return e.charAt(0).toUpperCase()+e.slice(1)}var s=o;var u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e.apply(this,r),t.apply(this,r)}}),(function(){}))},c=n(7462),l=n(2791),h=n.t(l,2),p=n(3366);function d(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=d(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}var f=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=d(e))&&(r&&(r+=" "),r+=t);return r};function m(e,t){var n=(0,c.Z)({},t);return Object.keys(e).forEach((function(r){if(r.toString().match(/^(components|slots)$/))n[r]=(0,c.Z)({},e[r],n[r]);else if(r.toString().match(/^(componentsProps|slotProps)$/)){var a=e[r]||{},i=t[r];n[r]={},i&&Object.keys(i)?a&&Object.keys(a)?(n[r]=(0,c.Z)({},i),Object.keys(a).forEach((function(e){n[r][e]=m(a[e],i[e])}))):n[r]=i:n[r]=a}else void 0===n[r]&&(n[r]=e[r])})),n}function v(e){var t=e.theme,n=e.name,r=e.props;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?m(t.components[n].defaultProps,r):r}function g(e){return null!==e&&"object"===typeof e&&e.constructor===Object}function y(e){if(!g(e))return e;var t={};return Object.keys(e).forEach((function(n){t[n]=y(e[n])})),t}function b(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},r=n.clone?(0,c.Z)({},e):e;return g(e)&&g(t)&&Object.keys(t).forEach((function(a){"__proto__"!==a&&(g(t[a])&&a in e&&g(e[a])?r[a]=b(e[a],t[a],n):n.clone?r[a]=g(t[a])?y(t[a]):t[a]:r[a]=t[a])})),r}var x=n(4942),k=["values","unit","step"],w=function(e){var t=Object.keys(e).map((function(t){return{key:t,val:e[t]}}))||[];return t.sort((function(e,t){return e.val-t.val})),t.reduce((function(e,t){return(0,c.Z)({},e,(0,x.Z)({},t.key,t.val))}),{})};var S={borderRadius:4},I=n(885),C={xs:0,sm:600,md:900,lg:1200,xl:1536},T={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(C[e],"px)")}};function N(e,t,n){var r=e.theme||{};if(Array.isArray(t)){var a=r.breakpoints||T;return t.reduce((function(e,r,i){return e[a.up(a.keys[i])]=n(t[i]),e}),{})}if("object"===typeof t){var i=r.breakpoints||T;return Object.keys(t).reduce((function(e,r){if(-1!==Object.keys(i.values||C).indexOf(r)){e[i.up(r)]=n(t[r],r)}else{var a=r;e[a]=t[a]}return e}),{})}return n(t)}function E(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(null==(e=t.keys)?void 0:e.reduce((function(e,n){return e[t.up(n)]={},e}),{}))||{}}function R(e,t){return e.reduce((function(e,t){var n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function A(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){var r="vars.".concat(t).split(".").reduce((function(e,t){return e&&e[t]?e[t]:null}),e);if(null!=r)return r}return t.split(".").reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e)}function _(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"===typeof e?e(n):Array.isArray(e)?e[n]||a:A(e,n)||a,t&&(r=t(r,a,e)),r}var O=function(e){var t=e.prop,n=e.cssProperty,r=void 0===n?e.prop:n,a=e.themeKey,i=e.transform,s=function(e){if(null==e[t])return null;var n=e[t],s=A(e.theme,a)||{};return N(e,n,(function(e){var n=_(s,i,e);return e===n&&"string"===typeof e&&(n=_(s,i,"".concat(t).concat("default"===e?"":o(e)),e)),!1===r?n:(0,x.Z)({},r,n)}))};return s.propTypes={},s.filterProps=[t],s};var F=function(e,t){return t?b(e,t,{clone:!1}):e};var D={m:"margin",p:"padding"},M={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},P={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},L=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!P[e])return[e];e=P[e]}var t=e.split(""),n=(0,I.Z)(t,2),r=n[0],a=n[1],i=D[r],o=M[a]||"";return Array.isArray(o)?o.map((function(e){return i+e})):[i+o]})),z=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],B=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],U=[].concat(z,B);function W(e,t,n,r){var a,i=null!=(a=A(e,t,!1))?a:n;return"number"===typeof i?function(e){return"string"===typeof e?e:i*e}:Array.isArray(i)?function(e){return"string"===typeof e?e:i[e]}:"function"===typeof i?i:function(){}}function V(e){return W(e,"spacing",8)}function G(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}function j(e,t,n,r){if(-1===t.indexOf(n))return null;var a=function(e,t){return function(n){return e.reduce((function(e,r){return e[r]=G(t,n),e}),{})}}(L(n),r);return N(e,e[n],a)}function H(e,t){var n=V(e.theme);return Object.keys(e).map((function(r){return j(e,t,r,n)})).reduce(F,{})}function Z(e){return H(e,z)}function K(e){return H(e,B)}function q(e){return H(e,U)}Z.propTypes={},Z.filterProps=z,K.propTypes={},K.filterProps=B,q.propTypes={},q.filterProps=U;var X=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return t.filterProps.forEach((function(n){e[n]=t})),e}),{}),a=function(e){return Object.keys(e).reduce((function(t,n){return r[n]?F(t,r[n](e)):t}),{})};return a.propTypes={},a.filterProps=t.reduce((function(e,t){return e.concat(t.filterProps)}),[]),a};function Y(e){return"number"!==typeof e?e:"".concat(e,"px solid")}var Q=O({prop:"border",themeKey:"borders",transform:Y}),J=O({prop:"borderTop",themeKey:"borders",transform:Y}),$=O({prop:"borderRight",themeKey:"borders",transform:Y}),ee=O({prop:"borderBottom",themeKey:"borders",transform:Y}),te=O({prop:"borderLeft",themeKey:"borders",transform:Y}),ne=O({prop:"borderColor",themeKey:"palette"}),re=O({prop:"borderTopColor",themeKey:"palette"}),ae=O({prop:"borderRightColor",themeKey:"palette"}),ie=O({prop:"borderBottomColor",themeKey:"palette"}),oe=O({prop:"borderLeftColor",themeKey:"palette"}),se=function(e){if(void 0!==e.borderRadius&&null!==e.borderRadius){var t=W(e.theme,"shape.borderRadius",4);return N(e,e.borderRadius,(function(e){return{borderRadius:G(t,e)}}))}return null};se.propTypes={},se.filterProps=["borderRadius"];X(Q,J,$,ee,te,ne,re,ae,ie,oe,se);var ue=function(e){if(void 0!==e.gap&&null!==e.gap){var t=W(e.theme,"spacing",8);return N(e,e.gap,(function(e){return{gap:G(t,e)}}))}return null};ue.propTypes={},ue.filterProps=["gap"];var ce=function(e){if(void 0!==e.columnGap&&null!==e.columnGap){var t=W(e.theme,"spacing",8);return N(e,e.columnGap,(function(e){return{columnGap:G(t,e)}}))}return null};ce.propTypes={},ce.filterProps=["columnGap"];var le=function(e){if(void 0!==e.rowGap&&null!==e.rowGap){var t=W(e.theme,"spacing",8);return N(e,e.rowGap,(function(e){return{rowGap:G(t,e)}}))}return null};le.propTypes={},le.filterProps=["rowGap"];X(ue,ce,le,O({prop:"gridColumn"}),O({prop:"gridRow"}),O({prop:"gridAutoFlow"}),O({prop:"gridAutoColumns"}),O({prop:"gridAutoRows"}),O({prop:"gridTemplateColumns"}),O({prop:"gridTemplateRows"}),O({prop:"gridTemplateAreas"}),O({prop:"gridArea"}));function he(e,t){return"grey"===t?t:e}X(O({prop:"color",themeKey:"palette",transform:he}),O({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:he}),O({prop:"backgroundColor",themeKey:"palette",transform:he}));function pe(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}var de=O({prop:"width",transform:pe}),fe=function(e){if(void 0!==e.maxWidth&&null!==e.maxWidth){return N(e,e.maxWidth,(function(t){var n,r,a;return{maxWidth:(null==(n=e.theme)||null==(r=n.breakpoints)||null==(a=r.values)?void 0:a[t])||C[t]||pe(t)}}))}return null};fe.filterProps=["maxWidth"];var me=O({prop:"minWidth",transform:pe}),ve=O({prop:"height",transform:pe}),ge=O({prop:"maxHeight",transform:pe}),ye=O({prop:"minHeight",transform:pe}),be=(O({prop:"size",cssProperty:"width",transform:pe}),O({prop:"size",cssProperty:"height",transform:pe}),X(de,fe,me,ve,ge,ye,O({prop:"boxSizing"})),{border:{themeKey:"borders",transform:Y},borderTop:{themeKey:"borders",transform:Y},borderRight:{themeKey:"borders",transform:Y},borderBottom:{themeKey:"borders",transform:Y},borderLeft:{themeKey:"borders",transform:Y},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:se},color:{themeKey:"palette",transform:he},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:he},backgroundColor:{themeKey:"palette",transform:he},p:{style:K},pt:{style:K},pr:{style:K},pb:{style:K},pl:{style:K},px:{style:K},py:{style:K},padding:{style:K},paddingTop:{style:K},paddingRight:{style:K},paddingBottom:{style:K},paddingLeft:{style:K},paddingX:{style:K},paddingY:{style:K},paddingInline:{style:K},paddingInlineStart:{style:K},paddingInlineEnd:{style:K},paddingBlock:{style:K},paddingBlockStart:{style:K},paddingBlockEnd:{style:K},m:{style:Z},mt:{style:Z},mr:{style:Z},mb:{style:Z},ml:{style:Z},mx:{style:Z},my:{style:Z},margin:{style:Z},marginTop:{style:Z},marginRight:{style:Z},marginBottom:{style:Z},marginLeft:{style:Z},marginX:{style:Z},marginY:{style:Z},marginInline:{style:Z},marginInlineStart:{style:Z},marginInlineEnd:{style:Z},marginBlock:{style:Z},marginBlockStart:{style:Z},marginBlockEnd:{style:Z},displayPrint:{cssProperty:!1,transform:function(e){return{"@media print":{display:e}}}},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:ue},rowGap:{style:le},columnGap:{style:ce},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:pe},maxWidth:{style:fe},minWidth:{transform:pe},height:{transform:pe},maxHeight:{transform:pe},minHeight:{transform:pe},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}});var xe=function(){function e(e,t,n,r){var a,i=(a={},(0,x.Z)(a,e,t),(0,x.Z)(a,"theme",n),a),s=r[e];if(!s)return(0,x.Z)({},e,t);var u=s.cssProperty,c=void 0===u?e:u,l=s.themeKey,h=s.transform,p=s.style;if(null==t)return null;if("typography"===l&&"inherit"===t)return(0,x.Z)({},e,t);var d=A(n,l)||{};if(p)return p(i);return N(i,t,(function(t){var n=_(d,h,t);return t===n&&"string"===typeof t&&(n=_(d,h,"".concat(e).concat("default"===t?"":o(t)),t)),!1===c?n:(0,x.Z)({},c,n)}))}return function t(n){var r,a=n||{},i=a.sx,o=a.theme,s=void 0===o?{}:o;if(!i)return null;var u=null!=(r=s.unstable_sxConfig)?r:be;function c(n){var r=n;if("function"===typeof n)r=n(s);else if("object"!==typeof n)return n;if(!r)return null;var a=E(s.breakpoints),i=Object.keys(a),o=a;return Object.keys(r).forEach((function(n){var a,i,c=(a=r[n],i=s,"function"===typeof a?a(i):a);if(null!==c&&void 0!==c)if("object"===typeof c)if(u[n])o=F(o,e(n,c,s,u));else{var l=N({theme:s},c,(function(e){return(0,x.Z)({},n,e)}));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return e.concat(Object.keys(t))}),[]),a=new Set(r);return t.every((function(e){return a.size===Object.keys(e).length}))}(l,c)?o=F(o,l):o[n]=t({sx:c,theme:s})}else o=F(o,e(n,c,s,u))})),R(i,o)}return Array.isArray(i)?i.map(c):c(i)}}();xe.filterProps=["sx"];var ke=xe,we=["breakpoints","palette","spacing","shape"];var Se=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,r=e.palette,a=void 0===r?{}:r,i=e.spacing,o=e.shape,s=void 0===o?{}:o,u=(0,p.Z)(e,we),l=function(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:900,lg:1200,xl:1536}:t,r=e.unit,a=void 0===r?"px":r,i=e.step,o=void 0===i?5:i,s=(0,p.Z)(e,k),u=w(n),l=Object.keys(u);function h(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(a,")")}function d(e){var t="number"===typeof n[e]?n[e]:e;return"@media (max-width:".concat(t-o/100).concat(a,")")}function f(e,t){var r=l.indexOf(t);return"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(a,") and ")+"(max-width:".concat((-1!==r&&"number"===typeof n[l[r]]?n[l[r]]:t)-o/100).concat(a,")")}return(0,c.Z)({keys:l,values:u,up:h,down:d,between:f,only:function(e){return l.indexOf(e)+1<l.length?f(e,l[l.indexOf(e)+1]):h(e)},not:function(e){var t=l.indexOf(e);return 0===t?h(l[1]):t===l.length-1?d(l[t]):f(e,l[l.indexOf(e)+1]).replace("@media","@media not all and")},unit:a},s)}(n),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=V({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0===n.length?[1]:n).map((function(e){var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return n.mui=!0,n}(i),d=b({breakpoints:l,direction:"ltr",components:{},palette:(0,c.Z)({mode:"light"},a),spacing:h,shape:(0,c.Z)({},S,s)},u),f=arguments.length,m=new Array(f>1?f-1:0),v=1;v<f;v++)m[v-1]=arguments[v];return(d=m.reduce((function(e,t){return b(e,t)}),d)).unstable_sxConfig=(0,c.Z)({},be,null==u?void 0:u.unstable_sxConfig),d.unstable_sx=function(e){return ke({sx:e,theme:this})},d};var Ie=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),Ce=Math.abs,Te=String.fromCharCode,Ne=Object.assign;function Ee(e){return e.trim()}function Re(e,t,n){return e.replace(t,n)}function Ae(e,t){return e.indexOf(t)}function _e(e,t){return 0|e.charCodeAt(t)}function Oe(e,t,n){return e.slice(t,n)}function Fe(e){return e.length}function De(e){return e.length}function Me(e,t){return t.push(e),e}var Pe=1,Le=1,ze=0,Be=0,Ue=0,We="";function Ve(e,t,n,r,a,i,o){return{value:e,root:t,parent:n,type:r,props:a,children:i,line:Pe,column:Le,length:o,return:""}}function Ge(e,t){return Ne(Ve("",null,null,"",null,null,0),e,{length:-e.length},t)}function je(){return Ue=Be>0?_e(We,--Be):0,Le--,10===Ue&&(Le=1,Pe--),Ue}function He(){return Ue=Be<ze?_e(We,Be++):0,Le++,10===Ue&&(Le=1,Pe++),Ue}function Ze(){return _e(We,Be)}function Ke(){return Be}function qe(e,t){return Oe(We,e,t)}function Xe(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Ye(e){return Pe=Le=1,ze=Fe(We=e),Be=0,[]}function Qe(e){return We="",e}function Je(e){return Ee(qe(Be-1,tt(91===e?e+2:40===e?e+1:e)))}function $e(e){for(;(Ue=Ze())&&Ue<33;)He();return Xe(e)>2||Xe(Ue)>3?"":" "}function et(e,t){for(;--t&&He()&&!(Ue<48||Ue>102||Ue>57&&Ue<65||Ue>70&&Ue<97););return qe(e,Ke()+(t<6&&32==Ze()&&32==He()))}function tt(e){for(;He();)switch(Ue){case e:return Be;case 34:case 39:34!==e&&39!==e&&tt(Ue);break;case 40:41===e&&tt(e);break;case 92:He()}return Be}function nt(e,t){for(;He()&&e+Ue!==57&&(e+Ue!==84||47!==Ze()););return"/*"+qe(t,Be-1)+"*"+Te(47===e?e:He())}function rt(e){for(;!Xe(Ze());)He();return qe(e,Be)}var at="-ms-",it="-moz-",ot="-webkit-",st="comm",ut="rule",ct="decl",lt="@keyframes";function ht(e,t){for(var n="",r=De(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function pt(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case ct:return e.return=e.return||e.value;case st:return"";case lt:return e.return=e.value+"{"+ht(e.children,r)+"}";case ut:e.value=e.props.join(",")}return Fe(n=ht(e.children,r))?e.return=e.value+"{"+n+"}":""}function dt(e){return Qe(ft("",null,null,null,[""],e=Ye(e),0,[0],e))}function ft(e,t,n,r,a,i,o,s,u){for(var c=0,l=0,h=o,p=0,d=0,f=0,m=1,v=1,g=1,y=0,b="",x=a,k=i,w=r,S=b;v;)switch(f=y,y=He()){case 40:if(108!=f&&58==_e(S,h-1)){-1!=Ae(S+=Re(Je(y),"&","&\f"),"&\f")&&(g=-1);break}case 34:case 39:case 91:S+=Je(y);break;case 9:case 10:case 13:case 32:S+=$e(f);break;case 92:S+=et(Ke()-1,7);continue;case 47:switch(Ze()){case 42:case 47:Me(vt(nt(He(),Ke()),t,n),u);break;default:S+="/"}break;case 123*m:s[c++]=Fe(S)*g;case 125*m:case 59:case 0:switch(y){case 0:case 125:v=0;case 59+l:-1==g&&(S=Re(S,/\f/g,"")),d>0&&Fe(S)-h&&Me(d>32?gt(S+";",r,n,h-1):gt(Re(S," ","")+";",r,n,h-2),u);break;case 59:S+=";";default:if(Me(w=mt(S,t,n,c,l,a,s,b,x=[],k=[],h),i),123===y)if(0===l)ft(S,t,w,w,x,i,h,s,k);else switch(99===p&&110===_e(S,3)?100:p){case 100:case 108:case 109:case 115:ft(e,w,w,r&&Me(mt(e,w,w,0,0,a,s,b,a,x=[],h),k),a,k,h,s,r?x:k);break;default:ft(S,w,w,w,[""],k,0,s,k)}}c=l=d=0,m=g=1,b=S="",h=o;break;case 58:h=1+Fe(S),d=f;default:if(m<1)if(123==y)--m;else if(125==y&&0==m++&&125==je())continue;switch(S+=Te(y),y*m){case 38:g=l>0?1:(S+="\f",-1);break;case 44:s[c++]=(Fe(S)-1)*g,g=1;break;case 64:45===Ze()&&(S+=Je(He())),p=Ze(),l=h=Fe(b=S+=rt(Ke())),y++;break;case 45:45===f&&2==Fe(S)&&(m=0)}}return i}function mt(e,t,n,r,a,i,o,s,u,c,l){for(var h=a-1,p=0===a?i:[""],d=De(p),f=0,m=0,v=0;f<r;++f)for(var g=0,y=Oe(e,h+1,h=Ce(m=o[f])),b=e;g<d;++g)(b=Ee(m>0?p[g]+" "+y:Re(y,/&\f/g,p[g])))&&(u[v++]=b);return Ve(e,t,n,0===a?ut:s,u,c,l)}function vt(e,t,n){return Ve(e,t,n,st,Te(Ue),Oe(e,2,-2),0)}function gt(e,t,n,r){return Ve(e,t,n,ct,Oe(e,0,r),Oe(e,r+1,-1),r)}var yt=function(e,t,n){for(var r=0,a=0;r=a,a=Ze(),38===r&&12===a&&(t[n]=1),!Xe(a);)He();return qe(e,Be)},bt=function(e,t){return Qe(function(e,t){var n=-1,r=44;do{switch(Xe(r)){case 0:38===r&&12===Ze()&&(t[n]=1),e[n]+=yt(Be-1,t,n);break;case 2:e[n]+=Je(r);break;case 4:if(44===r){e[++n]=58===Ze()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=Te(r)}}while(r=He());return e}(Ye(e),t))},xt=new WeakMap,kt=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||xt.get(n))&&!r){xt.set(e,!0);for(var a=[],i=bt(t,a),o=n.props,s=0,u=0;s<i.length;s++)for(var c=0;c<o.length;c++,u++)e.props[u]=a[s]?i[s].replace(/&\f/g,o[c]):o[c]+" "+i[s]}}},wt=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function St(e,t){switch(function(e,t){return 45^_e(e,0)?(((t<<2^_e(e,0))<<2^_e(e,1))<<2^_e(e,2))<<2^_e(e,3):0}(e,t)){case 5103:return ot+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ot+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return ot+e+it+e+at+e+e;case 6828:case 4268:return ot+e+at+e+e;case 6165:return ot+e+at+"flex-"+e+e;case 5187:return ot+e+Re(e,/(\w+).+(:[^]+)/,ot+"box-$1$2"+at+"flex-$1$2")+e;case 5443:return ot+e+at+"flex-item-"+Re(e,/flex-|-self/,"")+e;case 4675:return ot+e+at+"flex-line-pack"+Re(e,/align-content|flex-|-self/,"")+e;case 5548:return ot+e+at+Re(e,"shrink","negative")+e;case 5292:return ot+e+at+Re(e,"basis","preferred-size")+e;case 6060:return ot+"box-"+Re(e,"-grow","")+ot+e+at+Re(e,"grow","positive")+e;case 4554:return ot+Re(e,/([^-])(transform)/g,"$1"+ot+"$2")+e;case 6187:return Re(Re(Re(e,/(zoom-|grab)/,ot+"$1"),/(image-set)/,ot+"$1"),e,"")+e;case 5495:case 3959:return Re(e,/(image-set\([^]*)/,ot+"$1$`$1");case 4968:return Re(Re(e,/(.+:)(flex-)?(.*)/,ot+"box-pack:$3"+at+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ot+e+e;case 4095:case 3583:case 4068:case 2532:return Re(e,/(.+)-inline(.+)/,ot+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Fe(e)-1-t>6)switch(_e(e,t+1)){case 109:if(45!==_e(e,t+4))break;case 102:return Re(e,/(.+:)(.+)-([^]+)/,"$1"+ot+"$2-$3$1"+it+(108==_e(e,t+3)?"$3":"$2-$3"))+e;case 115:return~Ae(e,"stretch")?St(Re(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==_e(e,t+1))break;case 6444:switch(_e(e,Fe(e)-3-(~Ae(e,"!important")&&10))){case 107:return Re(e,":",":"+ot)+e;case 101:return Re(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ot+(45===_e(e,14)?"inline-":"")+"box$3$1"+ot+"$2$3$1"+at+"$2box$3")+e}break;case 5936:switch(_e(e,t+11)){case 114:return ot+e+at+Re(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return ot+e+at+Re(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return ot+e+at+Re(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return ot+e+at+e+e}return e}var It=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case ct:e.return=St(e.value,e.length);break;case lt:return ht([Ge(e,{value:Re(e.value,"@","@"+ot)})],r);case ut:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return ht([Ge(e,{props:[Re(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return ht([Ge(e,{props:[Re(t,/:(plac\w+)/,":"+ot+"input-$1")]}),Ge(e,{props:[Re(t,/:(plac\w+)/,":-moz-$1")]}),Ge(e,{props:[Re(t,/:(plac\w+)/,at+"input-$1")]})],r)}return""}))}}],Ct=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||It;var a,i,o={},s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)o[t[n]]=!0;s.push(e)}));var u,c,l=[pt,(c=function(e){u.insert(e)},function(e){e.root||(e=e.return)&&c(e)})],h=function(e){var t=De(e);return function(n,r,a,i){for(var o="",s=0;s<t;s++)o+=e[s](n,r,a,i)||"";return o}}([kt,wt].concat(r,l));i=function(e,t,n,r){u=n,ht(dt(e?e+"{"+t.styles+"}":t.styles),h),r&&(p.inserted[t.name]=!0)};var p={key:t,sheet:new Ie({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:i};return p.sheet.hydrate(s),p};var Tt={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};function Nt(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}var Et=/[A-Z]|^ms/g,Rt=/_EMO_([^_]+?)_([^]*?)_EMO_/g,At=function(e){return 45===e.charCodeAt(1)},_t=function(e){return null!=e&&"boolean"!==typeof e},Ot=Nt((function(e){return At(e)?e:e.replace(Et,"-$&").toLowerCase()})),Ft=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(Rt,(function(e,t,n){return Mt={name:t,styles:n,next:Mt},t}))}return 1===Tt[e]||At(e)||"number"!==typeof t||0===t?t:t+"px"};function Dt(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return Mt={name:n.name,styles:n.styles,next:Mt},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)Mt={name:r.name,styles:r.styles,next:Mt},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=Dt(e,t,n[a])+";";else for(var i in n){var o=n[i];if("object"!==typeof o)null!=t&&void 0!==t[o]?r+=i+"{"+t[o]+"}":_t(o)&&(r+=Ot(i)+":"+Ft(i,o)+";");else if(!Array.isArray(o)||"string"!==typeof o[0]||null!=t&&void 0!==t[o[0]]){var s=Dt(e,t,o);switch(i){case"animation":case"animationName":r+=Ot(i)+":"+s+";";break;default:r+=i+"{"+s+"}"}}else for(var u=0;u<o.length;u++)_t(o[u])&&(r+=Ot(i)+":"+Ft(i,o[u])+";")}return r}(e,t,n);case"function":if(void 0!==e){var a=Mt,i=n(e);return Mt=a,Dt(e,t,i)}}if(null==t)return n;var o=t[n];return void 0!==o?o:n}var Mt,Pt=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var Lt=!!h.useInsertionEffect&&h.useInsertionEffect,zt=Lt||function(e){return e()},Bt=(Lt||l.useLayoutEffect,l.createContext("undefined"!==typeof HTMLElement?Ct({key:"css"}):null));Bt.Provider;var Ut=function(e){return(0,l.forwardRef)((function(t,n){var r=(0,l.useContext)(Bt);return e(t,r,n)}))};var Wt=l.createContext({});var Vt=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=l.useContext(Wt);return n&&(e=n,0!==Object.keys(e).length)?n:t},Gt=Se();var jt=function(){return Vt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gt)};function Ht(e,t){var n;return(0,c.Z)({toolbar:(n={minHeight:56},(0,x.Z)(n,e.up("xs"),{"@media (orientation: landscape)":{minHeight:48}}),(0,x.Z)(n,e.up("sm"),{minHeight:64}),n)},t)}function Zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function Kt(e){if(e.type)return e;if("#"===e.charAt(0))return Kt(function(e){e=e.slice(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error(i(9,e));var r,a=e.substring(t+1,e.length-1);if("color"===n){if(r=(a=a.split(" ")).shift(),4===a.length&&"/"===a[3].charAt(0)&&(a[3]=a[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error(i(10,r))}else a=a.split(",");return{type:n,values:a=a.map((function(e){return parseFloat(e)})),colorSpace:r}}function qt(e){var t=e.type,n=e.colorSpace,r=e.values;return-1!==t.indexOf("rgb")?r=r.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(r[1]="".concat(r[1],"%"),r[2]="".concat(r[2],"%")),r=-1!==t.indexOf("color")?"".concat(n," ").concat(r.join(" ")):"".concat(r.join(", ")),"".concat(t,"(").concat(r,")")}function Xt(e){var t="hsl"===(e=Kt(e)).type||"hsla"===e.type?Kt(function(e){var t=(e=Kt(e)).values,n=t[0],r=t[1]/100,a=t[2]/100,i=r*Math.min(a,1-a),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return a-i*Math.max(Math.min(t-3,9-t,1),-1)},s="rgb",u=[Math.round(255*o(0)),Math.round(255*o(8)),Math.round(255*o(4))];return"hsla"===e.type&&(s+="a",u.push(t[3])),qt({type:s,values:u})}(e)).values:e.values;return t=t.map((function(t){return"color"!==e.type&&(t/=255),t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function Yt(e,t){if(e=Kt(e),t=Zt(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return qt(e)}function Qt(e,t){if(e=Kt(e),t=Zt(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(var r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return qt(e)}var Jt={black:"#000",white:"#fff"},$t={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},en={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},tn={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},nn={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},rn={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},an={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},on={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},sn=["mode","contrastThreshold","tonalOffset"],un={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Jt.white,default:Jt.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},cn={text:{primary:Jt.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Jt.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function ln(e,t,n,r){var a=r.light||r,i=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=Qt(e.main,a):"dark"===t&&(e.dark=Yt(e.main,i)))}function hn(e){var t=e.mode,n=void 0===t?"light":t,r=e.contrastThreshold,a=void 0===r?3:r,o=e.tonalOffset,s=void 0===o?.2:o,u=(0,p.Z)(e,sn),l=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:rn[200],light:rn[50],dark:rn[400]}:{main:rn[700],light:rn[400],dark:rn[800]}}(n),h=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:en[200],light:en[50],dark:en[400]}:{main:en[500],light:en[300],dark:en[700]}}(n),d=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:tn[500],light:tn[300],dark:tn[700]}:{main:tn[700],light:tn[400],dark:tn[800]}}(n),f=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:an[400],light:an[300],dark:an[700]}:{main:an[700],light:an[500],dark:an[900]}}(n),m=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:on[400],light:on[300],dark:on[700]}:{main:on[800],light:on[500],dark:on[900]}}(n),v=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:nn[400],light:nn[300],dark:nn[700]}:{main:"#ed6c02",light:nn[500],dark:nn[900]}}(n);function g(e){var t=function(e,t){var n=Xt(e),r=Xt(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}(e,cn.text.primary)>=a?cn.text.primary:un.text.primary;return t}var y=function(e){var t=e.color,n=e.name,r=e.mainShade,a=void 0===r?500:r,o=e.lightShade,u=void 0===o?300:o,l=e.darkShade,h=void 0===l?700:l;if(!(t=(0,c.Z)({},t)).main&&t[a]&&(t.main=t[a]),!t.hasOwnProperty("main"))throw new Error(i(11,n?" (".concat(n,")"):"",a));if("string"!==typeof t.main)throw new Error(i(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return ln(t,"light",u,s),ln(t,"dark",h,s),t.contrastText||(t.contrastText=g(t.main)),t},x={dark:cn,light:un};return b((0,c.Z)({common:(0,c.Z)({},Jt),mode:n,primary:y({color:l,name:"primary"}),secondary:y({color:h,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:y({color:d,name:"error"}),warning:y({color:v,name:"warning"}),info:y({color:f,name:"info"}),success:y({color:m,name:"success"}),grey:$t,contrastThreshold:a,getContrastText:g,augmentColor:y,tonalOffset:s},x[n]),u)}var pn=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];var dn={textTransform:"uppercase"},fn='"Roboto", "Helvetica", "Arial", sans-serif';function mn(e,t){var n="function"===typeof t?t(e):t,r=n.fontFamily,a=void 0===r?fn:r,i=n.fontSize,o=void 0===i?14:i,s=n.fontWeightLight,u=void 0===s?300:s,l=n.fontWeightRegular,h=void 0===l?400:l,d=n.fontWeightMedium,f=void 0===d?500:d,m=n.fontWeightBold,v=void 0===m?700:m,g=n.htmlFontSize,y=void 0===g?16:g,x=n.allVariants,k=n.pxToRem,w=(0,p.Z)(n,pn);var S=o/14,I=k||function(e){return"".concat(e/y*S,"rem")},C=function(e,t,n,r,i){return(0,c.Z)({fontFamily:a,fontWeight:e,fontSize:I(t),lineHeight:n},a===fn?{letterSpacing:"".concat((o=r/t,Math.round(1e5*o)/1e5),"em")}:{},i,x);var o},T={h1:C(u,96,1.167,-1.5),h2:C(u,60,1.2,-.5),h3:C(h,48,1.167,0),h4:C(h,34,1.235,.25),h5:C(h,24,1.334,0),h6:C(f,20,1.6,.15),subtitle1:C(h,16,1.75,.15),subtitle2:C(f,14,1.57,.1),body1:C(h,16,1.5,.15),body2:C(h,14,1.43,.15),button:C(f,14,1.75,.4,dn),caption:C(h,12,1.66,.4),overline:C(h,12,2.66,1,dn),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return b((0,c.Z)({htmlFontSize:y,pxToRem:I,fontFamily:a,fontSize:o,fontWeightLight:u,fontWeightRegular:h,fontWeightMedium:f,fontWeightBold:v},T),w,{clone:!1})}function vn(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var gn=["none",vn(0,2,1,-1,0,1,1,0,0,1,3,0),vn(0,3,1,-2,0,2,2,0,0,1,5,0),vn(0,3,3,-2,0,3,4,0,0,1,8,0),vn(0,2,4,-1,0,4,5,0,0,1,10,0),vn(0,3,5,-1,0,5,8,0,0,1,14,0),vn(0,3,5,-1,0,6,10,0,0,1,18,0),vn(0,4,5,-2,0,7,10,1,0,2,16,1),vn(0,5,5,-3,0,8,10,1,0,3,14,2),vn(0,5,6,-3,0,9,12,1,0,3,16,2),vn(0,6,6,-3,0,10,14,1,0,4,18,3),vn(0,6,7,-4,0,11,15,1,0,4,20,3),vn(0,7,8,-4,0,12,17,2,0,5,22,4),vn(0,7,8,-4,0,13,19,2,0,5,24,4),vn(0,7,9,-4,0,14,21,2,0,5,26,4),vn(0,8,9,-5,0,15,22,2,0,6,28,5),vn(0,8,10,-5,0,16,24,2,0,6,30,5),vn(0,8,11,-5,0,17,26,2,0,6,32,5),vn(0,9,11,-5,0,18,28,2,0,7,34,6),vn(0,9,12,-6,0,19,29,2,0,7,36,6),vn(0,10,13,-6,0,20,31,3,0,8,38,7),vn(0,10,13,-6,0,21,33,3,0,8,40,7),vn(0,10,14,-6,0,22,35,3,0,8,42,7),vn(0,11,14,-7,0,23,36,3,0,9,44,8),vn(0,11,15,-7,0,24,38,3,0,9,46,8)],yn=["duration","easing","delay"],bn={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},xn={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function kn(e){return"".concat(Math.round(e),"ms")}function wn(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}function Sn(e){var t=(0,c.Z)({},bn,e.easing),n=(0,c.Z)({},xn,e.duration);return(0,c.Z)({getAutoHeightDuration:wn,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.duration,i=void 0===a?n.standard:a,o=r.easing,s=void 0===o?t.easeInOut:o,u=r.delay,c=void 0===u?0:u;(0,p.Z)(r,yn);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof i?i:kn(i)," ").concat(s," ").concat("string"===typeof c?c:kn(c))})).join(",")}},e,{easing:t,duration:n})}var In={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},Cn=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function Tn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mixins,n=void 0===t?{}:t,r=e.palette,a=void 0===r?{}:r,o=e.transitions,s=void 0===o?{}:o,u=e.typography,l=void 0===u?{}:u,h=(0,p.Z)(e,Cn);if(e.vars)throw new Error(i(18));var d=hn(a),f=Se(e),m=b(f,{mixins:Ht(f.breakpoints,n),palette:d,shadows:gn.slice(),typography:mn(d,l),transitions:Sn(s),zIndex:(0,c.Z)({},In)});m=b(m,h);for(var v=arguments.length,g=new Array(v>1?v-1:0),y=1;y<v;y++)g[y-1]=arguments[y];return(m=g.reduce((function(e,t){return b(e,t)}),m)).unstable_sxConfig=(0,c.Z)({},be,null==h?void 0:h.unstable_sxConfig),m.unstable_sx=function(e){return ke({sx:e,theme:this})},m}var Nn=Tn(),En="$$material";function Rn(e){return function(e){var t=e.props,n=e.name,r=e.defaultTheme,a=e.themeId,i=jt(r);return a&&(i=i[a]||i),v({theme:i,name:n,props:t})}({props:e.props,name:e.name,defaultTheme:Nn,themeId:En})}var An=n(2982),_n=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/;var On=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},Fn=Nt((function(e){return _n.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),Dn=function(e){return"theme"!==e},Mn=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?Fn:Dn},Pn=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},Ln=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return On(t,n,r),zt((function(){return function(e,t,n){On(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0),a=a.next}while(void 0!==a)}}(t,n,r)})),null},zn=function e(t,n){var r,a,i=t.__emotion_real===t,o=i&&t.__emotion_base||t;void 0!==n&&(r=n.label,a=n.target);var s=Pn(t,n,i),u=s||Mn(o),h=!u("as");return function(){var p=arguments,d=i&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&d.push("label:"+r+";"),null==p[0]||void 0===p[0].raw)d.push.apply(d,p);else{0,d.push(p[0][0]);for(var f=p.length,m=1;m<f;m++)d.push(p[m],p[0][m])}var v=Ut((function(e,t,n){var r=h&&e.as||o,i="",c=[],p=e;if(null==e.theme){for(var f in p={},e)p[f]=e[f];p.theme=l.useContext(Wt)}"string"===typeof e.className?i=function(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}(t.registered,c,e.className):null!=e.className&&(i=e.className+" ");var m=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,a="";Mt=void 0;var i=e[0];null==i||void 0===i.raw?(r=!1,a+=Dt(n,t,i)):a+=i[0];for(var o=1;o<e.length;o++)a+=Dt(n,t,e[o]),r&&(a+=i[o]);Pt.lastIndex=0;for(var s,u="";null!==(s=Pt.exec(a));)u+="-"+s[1];var c=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(a)+u;return{name:c,styles:a,next:Mt}}(d.concat(c),t.registered,p);i+=t.key+"-"+m.name,void 0!==a&&(i+=" "+a);var v=h&&void 0===s?Mn(r):u,g={};for(var y in e)h&&"as"===y||v(y)&&(g[y]=e[y]);return g.className=i,g.ref=n,l.createElement(l.Fragment,null,l.createElement(Ln,{cache:t,serialized:m,isStringTag:"string"===typeof r}),l.createElement(r,g))}));return v.displayName=void 0!==r?r:"Styled("+("string"===typeof o?o:o.displayName||o.name||"Component")+")",v.defaultProps=t.defaultProps,v.__emotion_real=v,v.__emotion_base=o,v.__emotion_styles=d,v.__emotion_forwardProp=s,Object.defineProperty(v,"toString",{value:function(){return"."+a}}),v.withComponent=function(t,r){return e(t,(0,c.Z)({},n,r,{shouldForwardProp:Pn(v,r,!0)})).apply(void 0,d)},v}}.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){zn[e]=zn(e)}));var Bn=["variant"];function Un(e){return 0===e.length}function Wn(e){var t=e.variant,n=(0,p.Z)(e,Bn),r=t||"";return Object.keys(n).sort().forEach((function(t){r+="color"===t?Un(r)?e[t]:o(e[t]):"".concat(Un(r)?t:o(t)).concat(o(e[t].toString()))})),r}var Vn=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function Gn(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}var jn=Se();function Hn(e){var t,n=e.defaultTheme,r=e.theme,a=e.themeId;return t=r,0===Object.keys(t).length?n:r[a]||r}var Zn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.themeId,n=e.defaultTheme,r=void 0===n?jn:n,a=e.rootShouldForwardProp,i=void 0===a?Gn:a,o=e.slotShouldForwardProp,s=void 0===o?Gn:o,u=function(e){return ke((0,c.Z)({},e,{theme:Hn((0,c.Z)({},e,{defaultTheme:r,themeId:t}))}))};return u.__mui_systemSx=!0,function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}(e,(function(e){return e.filter((function(e){return!(null!=e&&e.__mui_systemSx)}))}));var a=n.name,o=n.slot,l=n.skipVariantsResolver,h=n.skipSx,d=n.overridesResolver,f=(0,p.Z)(n,Vn),m=void 0!==l?l:o&&"Root"!==o||!1,v=h||!1;var g=Gn;"Root"===o?g=i:o?g=s:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(g=void 0);var y=function(e,t){return zn(e,t)}(e,(0,c.Z)({shouldForwardProp:g,label:undefined},f)),b=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];var l=o?o.map((function(e){return"function"===typeof e&&e.__emotion_real!==e?function(n){return e((0,c.Z)({},n,{theme:Hn((0,c.Z)({},n,{defaultTheme:r,themeId:t}))}))}:e})):[],h=n;a&&d&&l.push((function(e){var n=Hn((0,c.Z)({},e,{defaultTheme:r,themeId:t})),i=function(e,t){return t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null}(a,n);if(i){var o={};return Object.entries(i).forEach((function(t){var r=(0,I.Z)(t,2),a=r[0],i=r[1];o[a]="function"===typeof i?i((0,c.Z)({},e,{theme:n})):i})),d(e,o)}return null})),a&&!m&&l.push((function(e){var n=Hn((0,c.Z)({},e,{defaultTheme:r,themeId:t}));return function(e,t,n,r){var a,i,o=e.ownerState,s=void 0===o?{}:o,u=[],c=null==n||null==(a=n.components)||null==(i=a[r])?void 0:i.variants;return c&&c.forEach((function(n){var r=!0;Object.keys(n.props).forEach((function(t){s[t]!==n.props[t]&&e[t]!==n.props[t]&&(r=!1)})),r&&u.push(t[Wn(n.props)])})),u}(e,function(e,t){var n=[];t&&t.components&&t.components[e]&&t.components[e].variants&&(n=t.components[e].variants);var r={};return n.forEach((function(e){var t=Wn(e.props);r[t]=e.style})),r}(a,n),n,a)})),v||l.push(u);var p=l.length-o.length;if(Array.isArray(n)&&p>0){var f=new Array(p).fill("");(h=[].concat((0,An.Z)(n),(0,An.Z)(f))).raw=[].concat((0,An.Z)(n.raw),(0,An.Z)(f))}else"function"===typeof n&&n.__emotion_real!==n&&(h=function(e){return n((0,c.Z)({},e,{theme:Hn((0,c.Z)({},e,{defaultTheme:r,themeId:t}))}))});var g=y.apply(void 0,[h].concat((0,An.Z)(l)));return e.muiName&&(g.muiName=e.muiName),g};return y.withConfig&&(b.withConfig=y.withConfig),b}}({themeId:En,defaultTheme:Nn,rootShouldForwardProp:function(e){return Gn(e)&&"classes"!==e}}),Kn=Zn,qn={active:"active",checked:"checked",completed:"completed",disabled:"disabled",readOnly:"readOnly",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function Xn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",r=qn[t];return r?"".concat(n,"-").concat(r):"".concat(a.generate(e),"-").concat(t)}function Yn(e){return Xn("MuiSvgIcon",e)}!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",r={};t.forEach((function(t){r[t]=Xn(e,t,n)}))}("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var Qn=n(184),Jn=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],$n=function(e){var t=e.color,n=e.fontSize,r=e.classes;return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r={};return Object.keys(e).forEach((function(a){r[a]=e[a].reduce((function(e,r){if(r){var a=t(r);""!==a&&e.push(a),n&&n[r]&&e.push(n[r])}return e}),[]).join(" ")})),r}({root:["root","inherit"!==t&&"color".concat(s(t)),"fontSize".concat(s(n))]},Yn,r)},er=Kn("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,"inherit"!==n.color&&t["color".concat(s(n.color))],t["fontSize".concat(s(n.fontSize))]]}})((function(e){var t,n,r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y=e.theme,b=e.ownerState;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:b.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(t=y.transitions)||null==(n=t.create)?void 0:n.call(t,"fill",{duration:null==(r=y.transitions)||null==(a=r.duration)?void 0:a.shorter}),fontSize:{inherit:"inherit",small:(null==(i=y.typography)||null==(o=i.pxToRem)?void 0:o.call(i,20))||"1.25rem",medium:(null==(s=y.typography)||null==(u=s.pxToRem)?void 0:u.call(s,24))||"1.5rem",large:(null==(c=y.typography)||null==(l=c.pxToRem)?void 0:l.call(c,35))||"2.1875rem"}[b.fontSize],color:null!=(h=null==(p=(y.vars||y).palette)||null==(d=p[b.color])?void 0:d.main)?h:{action:null==(f=(y.vars||y).palette)||null==(m=f.action)?void 0:m.active,disabled:null==(v=(y.vars||y).palette)||null==(g=v.action)?void 0:g.disabled,inherit:void 0}[b.color]}})),tr=l.forwardRef((function(e,t){var n=Rn({props:e,name:"MuiSvgIcon"}),r=n.children,a=n.className,i=n.color,o=void 0===i?"inherit":i,s=n.component,u=void 0===s?"svg":s,h=n.fontSize,d=void 0===h?"medium":h,m=n.htmlColor,v=n.inheritViewBox,g=void 0!==v&&v,y=n.titleAccess,b=n.viewBox,x=void 0===b?"0 0 24 24":b,k=(0,p.Z)(n,Jn),w=l.isValidElement(r)&&"svg"===r.type,S=(0,c.Z)({},n,{color:o,component:u,fontSize:d,instanceFontSize:e.fontSize,inheritViewBox:g,viewBox:x,hasSvgAsChild:w}),I={};g||(I.viewBox=x);var C=$n(S);return(0,Qn.jsxs)(er,(0,c.Z)({as:u,className:f(C.root,a),focusable:"false",color:m,"aria-hidden":!y||void 0,role:y?"img":void 0,ref:t},I,k,w&&r.props,{ownerState:S,children:[w?r.props.children:r,y?(0,Qn.jsx)("title",{children:y}):null]}))}));tr.muiName="SvgIcon";var nr=tr;function rr(e,t){function n(n,r){return(0,Qn.jsx)(nr,(0,c.Z)({"data-testid":"".concat(t,"Icon"),ref:r},n,{children:e}))}return n.muiName=nr.muiName,l.memo(l.forwardRef(n))}var ar=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=this,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];clearTimeout(t),t=setTimeout((function(){e.apply(r,i)}),n)}return r.clear=function(){clearTimeout(t)},r};var ir=function(e,t){return function(){return null}};var or=function(e,t){return l.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)};function sr(e){return e&&e.ownerDocument||document}var ur=sr;var cr=function(e){return sr(e).defaultView||window};var lr=function(e,t){return function(){return null}};function hr(e,t){"function"===typeof e?e(t):e&&(e.current=t)}var pr=hr,dr="undefined"!==typeof window?l.useLayoutEffect:l.useEffect,fr=dr,mr=0;var vr=h["useId".toString()];var gr=function(e){if(void 0!==vr){var t=vr();return null!=e?e:t}return function(e){var t=l.useState(e),n=(0,I.Z)(t,2),r=n[0],a=n[1],i=e||r;return l.useEffect((function(){null==r&&a("mui-".concat(mr+=1))}),[r]),i}(e)};var yr=function(e,t,n,r,a){return null};var br=function(e){var t=e.controlled,n=e.default,r=(e.name,e.state,l.useRef(void 0!==t).current),a=l.useState(n),i=(0,I.Z)(a,2),o=i[0],s=i[1];return[r?t:o,l.useCallback((function(e){r||s(e)}),[])]};var xr=function(e){var t=l.useRef(e);return dr((function(){t.current=e})),l.useCallback((function(){return t.current.apply(void 0,arguments)}),[])};var kr,wr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo((function(){return t.every((function(e){return null==e}))?null:function(e){t.forEach((function(t){hr(t,e)}))}}),t)},Sr=!0,Ir=!1,Cr={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function Tr(e){e.metaKey||e.altKey||e.ctrlKey||(Sr=!0)}function Nr(){Sr=!1}function Er(){"hidden"===this.visibilityState&&Ir&&(Sr=!0)}function Rr(e){var t=e.target;try{return t.matches(":focus-visible")}catch(n){}return Sr||function(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!Cr[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}var Ar=function(){var e=l.useCallback((function(e){var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",Tr,!0),t.addEventListener("mousedown",Nr,!0),t.addEventListener("pointerdown",Nr,!0),t.addEventListener("touchstart",Nr,!0),t.addEventListener("visibilitychange",Er,!0))}),[]),t=l.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!Rr(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(Ir=!0,window.clearTimeout(kr),kr=window.setTimeout((function(){Ir=!1}),100),t.current=!1,!0)},ref:e}},_r={configure:function(e){a.configure(e)}}},2610:function(e,t,n){"use strict";n.r(t),n.d(t,{createBrowserHistory:function(){return I},createHashHistory:function(){return A},createLocation:function(){return v},createMemoryHistory:function(){return O},createPath:function(){return m},locationsAreEqual:function(){return g},parsePath:function(){return f}});var r=n(7462);function a(e){return"/"===e.charAt(0)}function i(e,t){for(var n=t,r=n+1,a=e.length;r<a;n+=1,r+=1)e[n]=e[r];e.pop()}var o=function(e,t){void 0===t&&(t="");var n,r=e&&e.split("/")||[],o=t&&t.split("/")||[],s=e&&a(e),u=t&&a(t),c=s||u;if(e&&a(e)?o=r:r.length&&(o.pop(),o=o.concat(r)),!o.length)return"/";if(o.length){var l=o[o.length-1];n="."===l||".."===l||""===l}else n=!1;for(var h=0,p=o.length;p>=0;p--){var d=o[p];"."===d?i(o,p):".."===d?(i(o,p),h++):h&&(i(o,p),h--)}if(!c)for(;h--;h)o.unshift("..");!c||""===o[0]||o[0]&&a(o[0])||o.unshift("");var f=o.join("/");return n&&"/"!==f.substr(-1)&&(f+="/"),f};function s(e){return e.valueOf?e.valueOf():Object.prototype.valueOf.call(e)}var u=function e(t,n){if(t===n)return!0;if(null==t||null==n)return!1;if(Array.isArray(t))return Array.isArray(n)&&t.length===n.length&&t.every((function(t,r){return e(t,n[r])}));if("object"===typeof t||"object"===typeof n){var r=s(t),a=s(n);return r!==t||a!==n?e(r,a):Object.keys(Object.assign({},t,n)).every((function(r){return e(t[r],n[r])}))}return!1},c=n(4554);function l(e){return"/"===e.charAt(0)?e:"/"+e}function h(e){return"/"===e.charAt(0)?e.substr(1):e}function p(e,t){return function(e,t){return 0===e.toLowerCase().indexOf(t.toLowerCase())&&-1!=="/?#".indexOf(e.charAt(t.length))}(e,t)?e.substr(t.length):e}function d(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}function f(e){var t=e||"/",n="",r="",a=t.indexOf("#");-1!==a&&(r=t.substr(a),t=t.substr(0,a));var i=t.indexOf("?");return-1!==i&&(n=t.substr(i),t=t.substr(0,i)),{pathname:t,search:"?"===n?"":n,hash:"#"===r?"":r}}function m(e){var t=e.pathname,n=e.search,r=e.hash,a=t||"/";return n&&"?"!==n&&(a+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(a+="#"===r.charAt(0)?r:"#"+r),a}function v(e,t,n,a){var i;"string"===typeof e?(i=f(e)).state=t:(void 0===(i=(0,r.Z)({},e)).pathname&&(i.pathname=""),i.search?"?"!==i.search.charAt(0)&&(i.search="?"+i.search):i.search="",i.hash?"#"!==i.hash.charAt(0)&&(i.hash="#"+i.hash):i.hash="",void 0!==t&&void 0===i.state&&(i.state=t));try{i.pathname=decodeURI(i.pathname)}catch(s){throw s instanceof URIError?new URIError('Pathname "'+i.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):s}return n&&(i.key=n),a?i.pathname?"/"!==i.pathname.charAt(0)&&(i.pathname=o(i.pathname,a.pathname)):i.pathname=a.pathname:i.pathname||(i.pathname="/"),i}function g(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash&&e.key===t.key&&u(e.state,t.state)}function y(){var e=null;var t=[];return{setPrompt:function(t){return e=t,function(){e===t&&(e=null)}},confirmTransitionTo:function(t,n,r,a){if(null!=e){var i="function"===typeof e?e(t,n):e;"string"===typeof i?"function"===typeof r?r(i,a):a(!0):a(!1!==i)}else a(!0)},appendListener:function(e){var n=!0;function r(){n&&e.apply(void 0,arguments)}return t.push(r),function(){n=!1,t=t.filter((function(e){return e!==r}))}},notifyListeners:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.forEach((function(e){return e.apply(void 0,n)}))}}}var b=!("undefined"===typeof window||!window.document||!window.document.createElement);function x(e,t){t(window.confirm(e))}var k="popstate",w="hashchange";function S(){try{return window.history.state||{}}catch(e){return{}}}function I(e){void 0===e&&(e={}),b||(0,c.Z)(!1);var t=window.history,n=function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history}(),a=!(-1===window.navigator.userAgent.indexOf("Trident")),i=e,o=i.forceRefresh,s=void 0!==o&&o,u=i.getUserConfirmation,h=void 0===u?x:u,f=i.keyLength,g=void 0===f?6:f,I=e.basename?d(l(e.basename)):"";function C(e){var t=e||{},n=t.key,r=t.state,a=window.location,i=a.pathname+a.search+a.hash;return I&&(i=p(i,I)),v(i,r,n)}function T(){return Math.random().toString(36).substr(2,g)}var N=y();function E(e){(0,r.Z)(U,e),U.length=t.length,N.notifyListeners(U.location,U.action)}function R(e){(function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")})(e)||O(C(e.state))}function A(){O(C(S()))}var _=!1;function O(e){if(_)_=!1,E();else{N.confirmTransitionTo(e,"POP",h,(function(t){t?E({action:"POP",location:e}):function(e){var t=U.location,n=D.indexOf(t.key);-1===n&&(n=0);var r=D.indexOf(e.key);-1===r&&(r=0);var a=n-r;a&&(_=!0,P(a))}(e)}))}}var F=C(S()),D=[F.key];function M(e){return I+m(e)}function P(e){t.go(e)}var L=0;function z(e){1===(L+=e)&&1===e?(window.addEventListener(k,R),a&&window.addEventListener(w,A)):0===L&&(window.removeEventListener(k,R),a&&window.removeEventListener(w,A))}var B=!1;var U={length:t.length,action:"POP",location:F,createHref:M,push:function(e,r){var a="PUSH",i=v(e,r,T(),U.location);N.confirmTransitionTo(i,a,h,(function(e){if(e){var r=M(i),o=i.key,u=i.state;if(n)if(t.pushState({key:o,state:u},null,r),s)window.location.href=r;else{var c=D.indexOf(U.location.key),l=D.slice(0,c+1);l.push(i.key),D=l,E({action:a,location:i})}else window.location.href=r}}))},replace:function(e,r){var a="REPLACE",i=v(e,r,T(),U.location);N.confirmTransitionTo(i,a,h,(function(e){if(e){var r=M(i),o=i.key,u=i.state;if(n)if(t.replaceState({key:o,state:u},null,r),s)window.location.replace(r);else{var c=D.indexOf(U.location.key);-1!==c&&(D[c]=i.key),E({action:a,location:i})}else window.location.replace(r)}}))},go:P,goBack:function(){P(-1)},goForward:function(){P(1)},block:function(e){void 0===e&&(e=!1);var t=N.setPrompt(e);return B||(z(1),B=!0),function(){return B&&(B=!1,z(-1)),t()}},listen:function(e){var t=N.appendListener(e);return z(1),function(){z(-1),t()}}};return U}var C="hashchange",T={hashbang:{encodePath:function(e){return"!"===e.charAt(0)?e:"!/"+h(e)},decodePath:function(e){return"!"===e.charAt(0)?e.substr(1):e}},noslash:{encodePath:h,decodePath:l},slash:{encodePath:l,decodePath:l}};function N(e){var t=e.indexOf("#");return-1===t?e:e.slice(0,t)}function E(){var e=window.location.href,t=e.indexOf("#");return-1===t?"":e.substring(t+1)}function R(e){window.location.replace(N(window.location.href)+"#"+e)}function A(e){void 0===e&&(e={}),b||(0,c.Z)(!1);var t=window.history,n=(window.navigator.userAgent.indexOf("Firefox"),e),a=n.getUserConfirmation,i=void 0===a?x:a,o=n.hashType,s=void 0===o?"slash":o,u=e.basename?d(l(e.basename)):"",h=T[s],f=h.encodePath,g=h.decodePath;function k(){var e=g(E());return u&&(e=p(e,u)),v(e)}var w=y();function S(e){(0,r.Z)(U,e),U.length=t.length,w.notifyListeners(U.location,U.action)}var I=!1,A=null;function _(){var e,t,n=E(),r=f(n);if(n!==r)R(r);else{var a=k(),o=U.location;if(!I&&(t=a,(e=o).pathname===t.pathname&&e.search===t.search&&e.hash===t.hash))return;if(A===m(a))return;A=null,function(e){if(I)I=!1,S();else{var t="POP";w.confirmTransitionTo(e,t,i,(function(n){n?S({action:t,location:e}):function(e){var t=U.location,n=M.lastIndexOf(m(t));-1===n&&(n=0);var r=M.lastIndexOf(m(e));-1===r&&(r=0);var a=n-r;a&&(I=!0,P(a))}(e)}))}}(a)}}var O=E(),F=f(O);O!==F&&R(F);var D=k(),M=[m(D)];function P(e){t.go(e)}var L=0;function z(e){1===(L+=e)&&1===e?window.addEventListener(C,_):0===L&&window.removeEventListener(C,_)}var B=!1;var U={length:t.length,action:"POP",location:D,createHref:function(e){var t=document.querySelector("base"),n="";return t&&t.getAttribute("href")&&(n=N(window.location.href)),n+"#"+f(u+m(e))},push:function(e,t){var n="PUSH",r=v(e,void 0,void 0,U.location);w.confirmTransitionTo(r,n,i,(function(e){if(e){var t=m(r),a=f(u+t);if(E()!==a){A=t,function(e){window.location.hash=e}(a);var i=M.lastIndexOf(m(U.location)),o=M.slice(0,i+1);o.push(t),M=o,S({action:n,location:r})}else S()}}))},replace:function(e,t){var n="REPLACE",r=v(e,void 0,void 0,U.location);w.confirmTransitionTo(r,n,i,(function(e){if(e){var t=m(r),a=f(u+t);E()!==a&&(A=t,R(a));var i=M.indexOf(m(U.location));-1!==i&&(M[i]=t),S({action:n,location:r})}}))},go:P,goBack:function(){P(-1)},goForward:function(){P(1)},block:function(e){void 0===e&&(e=!1);var t=w.setPrompt(e);return B||(z(1),B=!0),function(){return B&&(B=!1,z(-1)),t()}},listen:function(e){var t=w.appendListener(e);return z(1),function(){z(-1),t()}}};return U}function _(e,t,n){return Math.min(Math.max(e,t),n)}function O(e){void 0===e&&(e={});var t=e,n=t.getUserConfirmation,a=t.initialEntries,i=void 0===a?["/"]:a,o=t.initialIndex,s=void 0===o?0:o,u=t.keyLength,c=void 0===u?6:u,l=y();function h(e){(0,r.Z)(x,e),x.length=x.entries.length,l.notifyListeners(x.location,x.action)}function p(){return Math.random().toString(36).substr(2,c)}var d=_(s,0,i.length-1),f=i.map((function(e){return v(e,void 0,"string"===typeof e?p():e.key||p())})),g=m;function b(e){var t=_(x.index+e,0,x.entries.length-1),r=x.entries[t];l.confirmTransitionTo(r,"POP",n,(function(e){e?h({action:"POP",location:r,index:t}):h()}))}var x={length:f.length,action:"POP",location:f[d],index:d,entries:f,createHref:g,push:function(e,t){var r="PUSH",a=v(e,t,p(),x.location);l.confirmTransitionTo(a,r,n,(function(e){if(e){var t=x.index+1,n=x.entries.slice(0);n.length>t?n.splice(t,n.length-t,a):n.push(a),h({action:r,location:a,index:t,entries:n})}}))},replace:function(e,t){var r="REPLACE",a=v(e,t,p(),x.location);l.confirmTransitionTo(a,r,n,(function(e){e&&(x.entries[x.index]=a,h({action:r,location:a}))}))},go:b,goBack:function(){b(-1)},goForward:function(){b(1)},canGo:function(e){var t=x.index+e;return t>=0&&t<x.entries.length},block:function(e){return void 0===e&&(e=!1),l.setPrompt(e)},listen:function(e){return l.appendListener(e)}};return x}},2110:function(e,t,n){"use strict";var r=n(8309),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function u(e){return r.isMemo(e)?o:s[e.$$typeof]||a}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var c=Object.defineProperty,l=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(f){var a=d(n);a&&a!==f&&e(t,a,r)}var o=l(n);h&&(o=o.concat(h(n)));for(var s=u(t),m=u(n),v=0;v<o.length;++v){var g=o[v];if(!i[g]&&(!r||!r[g])&&(!m||!m[g])&&(!s||!s[g])){var y=p(n,g);try{c(t,g,y)}catch(b){}}}}return t}},746:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,d=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function k(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case h:case i:case s:case o:case d:return e;default:switch(e=e&&e.$$typeof){case c:case p:case v:case m:case u:return e;default:return t}}case a:return t}}}function w(e){return k(e)===h}t.AsyncMode=l,t.ConcurrentMode=h,t.ContextConsumer=c,t.ContextProvider=u,t.Element=r,t.ForwardRef=p,t.Fragment=i,t.Lazy=v,t.Memo=m,t.Portal=a,t.Profiler=s,t.StrictMode=o,t.Suspense=d,t.isAsyncMode=function(e){return w(e)||k(e)===l},t.isConcurrentMode=w,t.isContextConsumer=function(e){return k(e)===c},t.isContextProvider=function(e){return k(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return k(e)===p},t.isFragment=function(e){return k(e)===i},t.isLazy=function(e){return k(e)===v},t.isMemo=function(e){return k(e)===m},t.isPortal=function(e){return k(e)===a},t.isProfiler=function(e){return k(e)===s},t.isStrictMode=function(e){return k(e)===o},t.isSuspense=function(e){return k(e)===d},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===i||e===h||e===s||e===o||e===d||e===f||"object"===typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===m||e.$$typeof===u||e.$$typeof===c||e.$$typeof===p||e.$$typeof===y||e.$$typeof===b||e.$$typeof===x||e.$$typeof===g)},t.typeOf=k},8309:function(e,t,n){"use strict";e.exports=n(746)},8987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(C){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:v;if(t){if(e<0)return g;if(e>=d)return w}else{if(e<=-f)return S;if(e+1>=f)return k}return e<0?s(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var c=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(c(n,8)),i=v,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+u),n);if(u<8){var p=s(c(n,u));i=i.mul(p).add(s(h))}else i=(i=i.mul(a)).add(s(h))}return i.unsigned=t,i}function h(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=h;var p=4294967296,d=p*p,f=d/2,m=o(1<<24),v=o(0);n.ZERO=v;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var x=o(-1);n.NEG_ONE=x;var k=u(-1,2147483647,!1);n.MAX_VALUE=k;var w=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var S=u(0,-2147483648,!1);n.MIN_VALUE=S;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(c(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),l=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1===(1&this.low)},I.isEven=function(){return 0===(1&this.low)},I.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(y)},I.neg=I.negate,I.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,p=0,d=0,f=0;return d+=(f+=i+(65535&e.low))>>>16,p+=(d+=a+c)>>>16,l+=(p+=n+s)>>>16,l+=t+o,u((d&=65535)<<16|(f&=65535),(l&=65535)<<16|(p&=65535),this.unsigned)},I.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return v;if(r(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(S))return e.isOdd()?S:v;if(e.eq(S))return this.isOdd()?S:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,c=e.high>>>16,l=65535&e.high,p=e.low>>>16,d=65535&e.low,f=0,g=0,y=0,b=0;return y+=(b+=o*d)>>>16,g+=(y+=i*d)>>>16,y&=65535,g+=(y+=o*p)>>>16,f+=(g+=a*d)>>>16,g&=65535,f+=(g+=i*p)>>>16,g&=65535,f+=(g+=o*l)>>>16,f+=n*d+a*p+i*l+o*c,u((y&=65535)<<16|(b&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(S))return e.eq(y)||e.eq(x)?S:e.eq(S)?y:(n=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?y:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(S))return this.unsigned?g:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=v}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:c(2,o-48),p=s(n),d=p.mul(e);d.isNegative()||d.gt(a);)d=(p=s(n-=l,this.unsigned)).mul(e);p.isZero()&&(p=y),i=i.add(p),a=a.sub(d)}return i},I.div=I.divide,I.modulo=function(e){return r(e)||(e=h(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.and=function(e){return r(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},1725:function(e){"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(a){return!1}}()?Object.assign:function(e,a){for(var i,o,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in i=Object(arguments[u]))n.call(i,c)&&(s[c]=i[c]);if(t){o=t(i);for(var l=0;l<o.length;l++)r.call(i,o[l])&&(s[o[l]]=i[o[l]])}}return s}},6151:function(e,t,n){var r=n(2878);e.exports=d,e.exports.parse=i,e.exports.compile=function(e,t){return s(i(e,t),t)},e.exports.tokensToFunction=s,e.exports.tokensToRegExp=p;var a=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function i(e,t){for(var n,r=[],i=0,o=0,s="",l=t&&t.delimiter||"/";null!=(n=a.exec(e));){var h=n[0],p=n[1],d=n.index;if(s+=e.slice(o,d),o=d+h.length,p)s+=p[1];else{var f=e[o],m=n[2],v=n[3],g=n[4],y=n[5],b=n[6],x=n[7];s&&(r.push(s),s="");var k=null!=m&&null!=f&&f!==m,w="+"===b||"*"===b,S="?"===b||"*"===b,I=n[2]||l,C=g||y;r.push({name:v||i++,prefix:m||"",delimiter:I,optional:S,repeat:w,partial:k,asterisk:!!x,pattern:C?c(C):x?".*":"[^"+u(I)+"]+?"})}}return o<e.length&&(s+=e.substr(o)),s&&r.push(s),r}function o(e){return encodeURI(e).replace(/[\/?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function s(e,t){for(var n=new Array(e.length),a=0;a<e.length;a++)"object"===typeof e[a]&&(n[a]=new RegExp("^(?:"+e[a].pattern+")$",h(t)));return function(t,a){for(var i="",s=t||{},u=(a||{}).pretty?o:encodeURIComponent,c=0;c<e.length;c++){var l=e[c];if("string"!==typeof l){var h,p=s[l.name];if(null==p){if(l.optional){l.partial&&(i+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(r(p)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var d=0;d<p.length;d++){if(h=u(p[d]),!n[c].test(h))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(h)+"`");i+=(0===d?l.prefix:l.delimiter)+h}}else{if(h=l.asterisk?encodeURI(p).replace(/[?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})):u(p),!n[c].test(h))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+h+'"');i+=l.prefix+h}}else i+=l}return i}}function u(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function l(e,t){return e.keys=t,e}function h(e){return e&&e.sensitive?"":"i"}function p(e,t,n){r(t)||(n=t||n,t=[]);for(var a=(n=n||{}).strict,i=!1!==n.end,o="",s=0;s<e.length;s++){var c=e[s];if("string"===typeof c)o+=u(c);else{var p=u(c.prefix),d="(?:"+c.pattern+")";t.push(c),c.repeat&&(d+="(?:"+p+d+")*"),o+=d=c.optional?c.partial?p+"("+d+")?":"(?:"+p+"("+d+"))?":p+"("+d+")"}}var f=u(n.delimiter||"/"),m=o.slice(-f.length)===f;return a||(o=(m?o.slice(0,-f.length):o)+"(?:"+f+"(?=$))?"),o+=i?"$":a&&m?"":"(?="+f+"|$)",l(new RegExp("^"+o,h(n)),t)}function d(e,t,n){return r(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return l(e,t)}(e,t):r(e)?function(e,t,n){for(var r=[],a=0;a<e.length;a++)r.push(d(e[a],t,n).source);return l(new RegExp("(?:"+r.join("|")+")",h(n)),t)}(e,t,n):function(e,t,n){return p(i(e,n),t,n)}(e,t,n)}},2878:function(e){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},888:function(e,t,n){"use strict";var r=n(9047);function a(){}function i(){}i.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,i,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:a};return n.PropTypes=n,n}},2007:function(e,t,n){e.exports=n(888)()},9047:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4463:function(e,t,n){"use strict";var r=n(2791),a=n(1725),i=n(5296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));function s(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var u=!1,c=null,l=!1,h=null,p={onError:function(e){u=!0,c=e}};function d(e,t,n,r,a,i,o,l,h){u=!1,c=null,s.apply(p,arguments)}var f=null,m=null,v=null;function g(e,t,n){var r=e.type||"unknown-event";e.currentTarget=v(n),function(e,t,n,r,a,i,s,p,f){if(d.apply(this,arguments),u){if(!u)throw Error(o(198));var m=c;u=!1,c=null,l||(l=!0,h=m)}}(r,t,void 0,e),e.currentTarget=null}var y=null,b={};function x(){if(y)for(var e in b){var t=b[e],n=y.indexOf(e);if(!(-1<n))throw Error(o(96,e));if(!w[n]){if(!t.extractEvents)throw Error(o(97,e));for(var r in w[n]=t,n=t.eventTypes){var a=void 0,i=n[r],s=t,u=r;if(S.hasOwnProperty(u))throw Error(o(99,u));S[u]=i;var c=i.phasedRegistrationNames;if(c){for(a in c)c.hasOwnProperty(a)&&k(c[a],s,u);a=!0}else i.registrationName?(k(i.registrationName,s,u),a=!0):a=!1;if(!a)throw Error(o(98,r,e))}}}}function k(e,t,n){if(I[e])throw Error(o(100,e));I[e]=t,C[e]=t.eventTypes[n].dependencies}var w=[],S={},I={},C={};function T(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!b.hasOwnProperty(t)||b[t]!==r){if(b[t])throw Error(o(102,t));b[t]=r,n=!0}}n&&x()}var N=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),E=null,R=null,A=null;function _(e){if(e=m(e)){if("function"!==typeof E)throw Error(o(280));var t=e.stateNode;t&&(t=f(t),E(e.stateNode,e.type,t))}}function O(e){R?A?A.push(e):A=[e]:R=e}function F(){if(R){var e=R,t=A;if(A=R=null,_(e),t)for(e=0;e<t.length;e++)_(t[e])}}function D(e,t){return e(t)}function M(e,t,n,r,a){return e(t,n,r,a)}function P(){}var L=D,z=!1,B=!1;function U(){null===R&&null===A||(P(),F())}function W(e,t,n){if(B)return e(t,n);B=!0;try{return L(e,t,n)}finally{B=!1,U()}}var V=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G=Object.prototype.hasOwnProperty,j={},H={};function Z(e,t,n,r,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i}var K={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){K[e]=new Z(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];K[t]=new Z(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){K[e]=new Z(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){K[e]=new Z(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){K[e]=new Z(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){K[e]=new Z(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){K[e]=new Z(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){K[e]=new Z(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){K[e]=new Z(e,5,!1,e.toLowerCase(),null,!1)}));var q=/[\-:]([a-z])/g;function X(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(q,X);K[t]=new Z(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(q,X);K[t]=new Z(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(q,X);K[t]=new Z(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){K[e]=new Z(e,1,!1,e.toLowerCase(),null,!1)})),K.xlinkHref=new Z("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){K[e]=new Z(e,1,!1,e.toLowerCase(),null,!0)}));var Y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Q(e,t,n,r){var a=K.hasOwnProperty(t)?K[t]:null;(null!==a?0===a.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!G.call(H,e)||!G.call(j,e)&&(V.test(e)?H[e]=!0:(j[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}Y.hasOwnProperty("ReactCurrentDispatcher")||(Y.ReactCurrentDispatcher={current:null}),Y.hasOwnProperty("ReactCurrentBatchConfig")||(Y.ReactCurrentBatchConfig={suspense:null});var J=/^(.*)[\\\/]/,$="function"===typeof Symbol&&Symbol.for,ee=$?Symbol.for("react.element"):60103,te=$?Symbol.for("react.portal"):60106,ne=$?Symbol.for("react.fragment"):60107,re=$?Symbol.for("react.strict_mode"):60108,ae=$?Symbol.for("react.profiler"):60114,ie=$?Symbol.for("react.provider"):60109,oe=$?Symbol.for("react.context"):60110,se=$?Symbol.for("react.concurrent_mode"):60111,ue=$?Symbol.for("react.forward_ref"):60112,ce=$?Symbol.for("react.suspense"):60113,le=$?Symbol.for("react.suspense_list"):60120,he=$?Symbol.for("react.memo"):60115,pe=$?Symbol.for("react.lazy"):60116,de=$?Symbol.for("react.block"):60121,fe="function"===typeof Symbol&&Symbol.iterator;function me(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=fe&&e[fe]||e["@@iterator"])?e:null}function ve(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case ae:return"Profiler";case re:return"StrictMode";case ce:return"Suspense";case le:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case oe:return"Context.Consumer";case ie:return"Context.Provider";case ue:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case he:return ve(e.type);case de:return ve(e.render);case pe:if(e=1===e._status?e._result:null)return ve(e)}return null}function ge(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,a=e._debugSource,i=ve(e.type);n=null,r&&(n=ve(r.type)),r=i,i="",a?i=" (at "+a.fileName.replace(J,"")+":"+a.lineNumber+")":n&&(i=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+i}t+=n,e=e.return}while(e);return t}function ye(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function be(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function xe(e){e._valueTracker||(e._valueTracker=function(e){var t=be(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ke(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=be(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function we(e,t){var n=t.checked;return a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Se(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=ye(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Ie(e,t){null!=(t=t.checked)&&Q(e,"checked",t,!1)}function Ce(e,t){Ie(e,t);var n=ye(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Ne(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ne(e,t.type,ye(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Te(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Ne(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Ee(e,t){return e=a({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Re(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ye(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function Ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function _e(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ye(n)}}function Oe(e,t){var n=ye(t.value),r=ye(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Fe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var De="http://www.w3.org/1999/xhtml",Me="http://www.w3.org/2000/svg";function Pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ze,Be,Ue=(Be=function(e,t){if(e.namespaceURI!==Me||"innerHTML"in e)e.innerHTML=t;else{for((ze=ze||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ze.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return Be(e,t)}))}:Be);function We(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ve(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ge={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},je={},He={};function Ze(e){if(je[e])return je[e];if(!Ge[e])return e;var t,n=Ge[e];for(t in n)if(n.hasOwnProperty(t)&&t in He)return je[e]=n[t];return e}N&&(He=document.createElement("div").style,"AnimationEvent"in window||(delete Ge.animationend.animation,delete Ge.animationiteration.animation,delete Ge.animationstart.animation),"TransitionEvent"in window||delete Ge.transitionend.transition);var Ke=Ze("animationend"),qe=Ze("animationiteration"),Xe=Ze("animationstart"),Ye=Ze("transitionend"),Qe="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Je=new("function"===typeof WeakMap?WeakMap:Map);function $e(e){var t=Je.get(e);return void 0===t&&(t=new Map,Je.set(e,t)),t}function et(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function tt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function nt(e){if(et(e)!==e)throw Error(o(188))}function rt(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=et(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return nt(a),e;if(i===r)return nt(a),t;i=i.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s){for(u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function at(e,t){if(null==t)throw Error(o(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function it(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var ot=null;function st(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)g(e,t[r],n[r]);else t&&g(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function ut(e){if(null!==e&&(ot=at(ot,e)),e=ot,ot=null,e){if(it(e,st),ot)throw Error(o(95));if(l)throw e=h,l=!1,h=null,e}}function ct(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function lt(e){if(!N)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}var ht=[];function pt(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>ht.length&&ht.push(e)}function dt(e,t,n,r){if(ht.length){var a=ht.pop();return a.topLevelType=e,a.eventSystemFlags=r,a.nativeEvent=t,a.targetInst=n,a}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function ft(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=Fn(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var a=ct(e.nativeEvent);r=e.topLevelType;var i=e.nativeEvent,o=e.eventSystemFlags;0===n&&(o|=64);for(var s=null,u=0;u<w.length;u++){var c=w[u];c&&(c=c.extractEvents(r,t,i,a,o))&&(s=at(s,c))}ut(s)}}function mt(e,t,n){if(!n.has(e)){switch(e){case"scroll":Xt(t,"scroll",!0);break;case"focus":case"blur":Xt(t,"focus",!0),Xt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":lt(e)&&Xt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Qe.indexOf(e)&&qt(e,t)}n.set(e,null)}}var vt,gt,yt,bt=!1,xt=[],kt=null,wt=null,St=null,It=new Map,Ct=new Map,Tt=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Et="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Rt(e,t,n,r,a){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:a,container:r}}function At(e,t){switch(e){case"focus":case"blur":kt=null;break;case"dragenter":case"dragleave":wt=null;break;case"mouseover":case"mouseout":St=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ct.delete(t.pointerId)}}function _t(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e=Rt(t,n,r,a,i),null!==t&&(null!==(t=Dn(t))&&gt(t)),e):(e.eventSystemFlags|=r,e)}function Ot(e){var t=Fn(e.target);if(null!==t){var n=et(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=tt(n)))return e.blockedOn=t,void i.unstable_runWithPriority(e.priority,(function(){yt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;var t=$t(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Dn(t);return null!==n&&gt(n),e.blockedOn=t,!1}return!0}function Dt(e,t,n){Ft(e)&&n.delete(t)}function Mt(){for(bt=!1;0<xt.length;){var e=xt[0];if(null!==e.blockedOn){null!==(e=Dn(e.blockedOn))&&vt(e);break}var t=$t(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:xt.shift()}null!==kt&&Ft(kt)&&(kt=null),null!==wt&&Ft(wt)&&(wt=null),null!==St&&Ft(St)&&(St=null),It.forEach(Dt),Ct.forEach(Dt)}function Pt(e,t){e.blockedOn===t&&(e.blockedOn=null,bt||(bt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Mt)))}function Lt(e){function t(t){return Pt(t,e)}if(0<xt.length){Pt(xt[0],e);for(var n=1;n<xt.length;n++){var r=xt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==kt&&Pt(kt,e),null!==wt&&Pt(wt,e),null!==St&&Pt(St,e),It.forEach(t),Ct.forEach(t),n=0;n<Tt.length;n++)(r=Tt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Tt.length&&null===(n=Tt[0]).blockedOn;)Ot(n),null===n.blockedOn&&Tt.shift()}var zt={},Bt=new Map,Ut=new Map,Wt=["abort","abort",Ke,"animationEnd",qe,"animationIteration",Xe,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ye,"transitionEnd","waiting","waiting"];function Vt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],a=e[n+1],i="on"+(a[0].toUpperCase()+a.slice(1));i={phasedRegistrationNames:{bubbled:i,captured:i+"Capture"},dependencies:[r],eventPriority:t},Ut.set(r,t),Bt.set(r,i),zt[a]=i}}Vt("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Vt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Vt(Wt,2);for(var Gt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),jt=0;jt<Gt.length;jt++)Ut.set(Gt[jt],0);var Ht=i.unstable_UserBlockingPriority,Zt=i.unstable_runWithPriority,Kt=!0;function qt(e,t){Xt(t,e,!1)}function Xt(e,t,n){var r=Ut.get(t);switch(void 0===r?2:r){case 0:r=Yt.bind(null,t,1,e);break;case 1:r=Qt.bind(null,t,1,e);break;default:r=Jt.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Yt(e,t,n,r){z||P();var a=Jt,i=z;z=!0;try{M(a,e,t,n,r)}finally{(z=i)||U()}}function Qt(e,t,n,r){Zt(Ht,Jt.bind(null,e,t,n,r))}function Jt(e,t,n,r){if(Kt)if(0<xt.length&&-1<Nt.indexOf(e))e=Rt(null,e,t,n,r),xt.push(e);else{var a=$t(e,t,n,r);if(null===a)At(e,r);else if(-1<Nt.indexOf(e))e=Rt(a,e,t,n,r),xt.push(e);else if(!function(e,t,n,r,a){switch(t){case"focus":return kt=_t(kt,e,t,n,r,a),!0;case"dragenter":return wt=_t(wt,e,t,n,r,a),!0;case"mouseover":return St=_t(St,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return It.set(i,_t(It.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Ct.set(i,_t(Ct.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r)){At(e,r),e=dt(e,r,null,t);try{W(ft,e)}finally{pt(e)}}}}function $t(e,t,n,r){if(null!==(n=Fn(n=ct(r)))){var a=et(n);if(null===a)n=null;else{var i=a.tag;if(13===i){if(null!==(n=tt(a)))return n;n=null}else if(3===i){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;n=null}else a!==n&&(n=null)}}e=dt(e,r,n,t);try{W(ft,e)}finally{pt(e)}return null}var en={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tn=["Webkit","ms","Moz","O"];function nn(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||en.hasOwnProperty(e)&&en[e]?(""+t).trim():t+"px"}function rn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=nn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(en).forEach((function(e){tn.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),en[t]=en[e]}))}));var an=a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(e,t){if(t){if(an[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62,""))}}function sn(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var un=De;function cn(e,t){var n=$e(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=C[t];for(var r=0;r<t.length;r++)mt(t[r],e,n)}function ln(){}function hn(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function pn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dn(e,t){var n,r=pn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=pn(r)}}function fn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function mn(){for(var e=window,t=hn();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=hn((e=t.contentWindow).document)}return t}function vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var gn="$",yn="/$",bn="$?",xn="$!",kn=null,wn=null;function Sn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function In(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Cn="function"===typeof setTimeout?setTimeout:void 0,Tn="function"===typeof clearTimeout?clearTimeout:void 0;function Nn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function En(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===gn||n===xn||n===bn){if(0===t)return e;t--}else n===yn&&t++}e=e.previousSibling}return null}var Rn=Math.random().toString(36).slice(2),An="__reactInternalInstance$"+Rn,_n="__reactEventHandlers$"+Rn,On="__reactContainere$"+Rn;function Fn(e){var t=e[An];if(t)return t;for(var n=e.parentNode;n;){if(t=n[On]||n[An]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=En(e);null!==e;){if(n=e[An])return n;e=En(e)}return t}n=(e=n).parentNode}return null}function Dn(e){return!(e=e[An]||e[On])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Mn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Pn(e){return e[_n]||null}function Ln(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function zn(e,t){var n=e.stateNode;if(!n)return null;var r=f(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}function Bn(e,t,n){(t=zn(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=at(n._dispatchListeners,t),n._dispatchInstances=at(n._dispatchInstances,e))}function Un(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Ln(t);for(t=n.length;0<t--;)Bn(n[t],"captured",e);for(t=0;t<n.length;t++)Bn(n[t],"bubbled",e)}}function Wn(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=zn(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=at(n._dispatchListeners,t),n._dispatchInstances=at(n._dispatchInstances,e))}function Vn(e){e&&e.dispatchConfig.registrationName&&Wn(e._targetInst,null,e)}function Gn(e){it(e,Un)}var jn=null,Hn=null,Zn=null;function Kn(){if(Zn)return Zn;var e,t,n=Hn,r=n.length,a="value"in jn?jn.value:jn.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return Zn=a.slice(e,1<t?1-t:void 0)}function qn(){return!0}function Xn(){return!1}function Yn(e,t,n,r){for(var a in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(a)&&((t=e[a])?this[a]=t(n):"target"===a?this.target=r:this[a]=n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?qn:Xn,this.isPropagationStopped=Xn,this}function Qn(e,t,n,r){if(this.eventPool.length){var a=this.eventPool.pop();return this.call(a,e,t,n,r),a}return new this(e,t,n,r)}function Jn(e){if(!(e instanceof this))throw Error(o(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function $n(e){e.eventPool=[],e.getPooled=Qn,e.release=Jn}a(Yn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qn)},persist:function(){this.isPersistent=qn},isPersistent:Xn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Xn,this._dispatchInstances=this._dispatchListeners=null}}),Yn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Yn.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return a(i,n.prototype),n.prototype=i,n.prototype.constructor=n,n.Interface=a({},r.Interface,e),n.extend=r.extend,$n(n),n},$n(Yn);var er=Yn.extend({data:null}),tr=Yn.extend({data:null}),nr=[9,13,27,32],rr=N&&"CompositionEvent"in window,ar=null;N&&"documentMode"in document&&(ar=document.documentMode);var ir=N&&"TextEvent"in window&&!ar,or=N&&(!rr||ar&&8<ar&&11>=ar),sr=String.fromCharCode(32),ur={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},cr=!1;function lr(e,t){switch(e){case"keyup":return-1!==nr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function hr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var pr=!1;var dr={eventTypes:ur,extractEvents:function(e,t,n,r){var a;if(rr)e:{switch(e){case"compositionstart":var i=ur.compositionStart;break e;case"compositionend":i=ur.compositionEnd;break e;case"compositionupdate":i=ur.compositionUpdate;break e}i=void 0}else pr?lr(e,n)&&(i=ur.compositionEnd):"keydown"===e&&229===n.keyCode&&(i=ur.compositionStart);return i?(or&&"ko"!==n.locale&&(pr||i!==ur.compositionStart?i===ur.compositionEnd&&pr&&(a=Kn()):(Hn="value"in(jn=r)?jn.value:jn.textContent,pr=!0)),i=er.getPooled(i,t,n,r),a?i.data=a:null!==(a=hr(n))&&(i.data=a),Gn(i),a=i):a=null,(e=ir?function(e,t){switch(e){case"compositionend":return hr(t);case"keypress":return 32!==t.which?null:(cr=!0,sr);case"textInput":return(e=t.data)===sr&&cr?null:e;default:return null}}(e,n):function(e,t){if(pr)return"compositionend"===e||!rr&&lr(e,t)?(e=Kn(),Zn=Hn=jn=null,pr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return or&&"ko"!==t.locale?null:t.data}}(e,n))?((t=tr.getPooled(ur.beforeInput,t,n,r)).data=e,Gn(t)):t=null,null===a?t:null===t?a:[a,t]}},fr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!fr[e.type]:"textarea"===t}var vr={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function gr(e,t,n){return(e=Yn.getPooled(vr.change,e,t,n)).type="change",O(n),Gn(e),e}var yr=null,br=null;function xr(e){ut(e)}function kr(e){if(ke(Mn(e)))return e}function wr(e,t){if("change"===e)return t}var Sr=!1;function Ir(){yr&&(yr.detachEvent("onpropertychange",Cr),br=yr=null)}function Cr(e){if("value"===e.propertyName&&kr(br))if(e=gr(br,e,ct(e)),z)ut(e);else{z=!0;try{D(xr,e)}finally{z=!1,U()}}}function Tr(e,t,n){"focus"===e?(Ir(),br=n,(yr=t).attachEvent("onpropertychange",Cr)):"blur"===e&&Ir()}function Nr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return kr(br)}function Er(e,t){if("click"===e)return kr(t)}function Rr(e,t){if("input"===e||"change"===e)return kr(t)}N&&(Sr=lt("input")&&(!document.documentMode||9<document.documentMode));var Ar={eventTypes:vr,_isInputEventSupported:Sr,extractEvents:function(e,t,n,r){var a=t?Mn(t):window,i=a.nodeName&&a.nodeName.toLowerCase();if("select"===i||"input"===i&&"file"===a.type)var o=wr;else if(mr(a))if(Sr)o=Rr;else{o=Nr;var s=Tr}else(i=a.nodeName)&&"input"===i.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(o=Er);if(o&&(o=o(e,t)))return gr(o,n,r);s&&s(e,a,t),"blur"===e&&(e=a._wrapperState)&&e.controlled&&"number"===a.type&&Ne(a,"number",a.value)}},_r=Yn.extend({view:null,detail:null}),Or={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Or[e])&&!!t[e]}function Dr(){return Fr}var Mr=0,Pr=0,Lr=!1,zr=!1,Br=_r.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Dr,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Mr;return Mr=e.screenX,Lr?"mousemove"===e.type?e.screenX-t:0:(Lr=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Pr;return Pr=e.screenY,zr?"mousemove"===e.type?e.screenY-t:0:(zr=!0,0)}}),Ur=Br.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Wr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Vr={eventTypes:Wr,extractEvents:function(e,t,n,r,a){var i="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(i&&0===(32&a)&&(n.relatedTarget||n.fromElement)||!o&&!i)return null;(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,o)?(o=t,null!==(t=(t=n.relatedTarget||n.toElement)?Fn(t):null)&&(t!==et(t)||5!==t.tag&&6!==t.tag)&&(t=null)):o=null;if(o===t)return null;if("mouseout"===e||"mouseover"===e)var s=Br,u=Wr.mouseLeave,c=Wr.mouseEnter,l="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=Ur,u=Wr.pointerLeave,c=Wr.pointerEnter,l="pointer");if(e=null==o?i:Mn(o),i=null==t?i:Mn(t),(u=s.getPooled(u,o,n,r)).type=l+"leave",u.target=e,u.relatedTarget=i,(n=s.getPooled(c,t,n,r)).type=l+"enter",n.target=i,n.relatedTarget=e,l=t,(r=o)&&l)e:{for(c=l,o=0,e=s=r;e;e=Ln(e))o++;for(e=0,t=c;t;t=Ln(t))e++;for(;0<o-e;)s=Ln(s),o--;for(;0<e-o;)c=Ln(c),e--;for(;o--;){if(s===c||s===c.alternate)break e;s=Ln(s),c=Ln(c)}s=null}else s=null;for(c=s,s=[];r&&r!==c&&(null===(o=r.alternate)||o!==c);)s.push(r),r=Ln(r);for(r=[];l&&l!==c&&(null===(o=l.alternate)||o!==c);)r.push(l),l=Ln(l);for(l=0;l<s.length;l++)Wn(s[l],"bubbled",u);for(l=r.length;0<l--;)Wn(r[l],"captured",n);return 0===(64&a)?[u]:[u,n]}};var Gr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},jr=Object.prototype.hasOwnProperty;function Hr(e,t){if(Gr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!jr.call(t,n[r])||!Gr(e[n[r]],t[n[r]]))return!1;return!0}var Zr=N&&"documentMode"in document&&11>=document.documentMode,Kr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},qr=null,Xr=null,Yr=null,Qr=!1;function Jr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Qr||null==qr||qr!==hn(n)?null:("selectionStart"in(n=qr)&&vn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Yr&&Hr(Yr,n)?null:(Yr=n,(e=Yn.getPooled(Kr.select,Xr,e,t)).type="select",e.target=qr,Gn(e),e))}var $r={eventTypes:Kr,extractEvents:function(e,t,n,r,a,i){if(!(i=!(a=i||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{a=$e(a),i=C.onSelect;for(var o=0;o<i.length;o++)if(!a.has(i[o])){a=!1;break e}a=!0}i=!a}if(i)return null;switch(a=t?Mn(t):window,e){case"focus":(mr(a)||"true"===a.contentEditable)&&(qr=a,Xr=t,Yr=null);break;case"blur":Yr=Xr=qr=null;break;case"mousedown":Qr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Qr=!1,Jr(n,r);case"selectionchange":if(Zr)break;case"keydown":case"keyup":return Jr(n,r)}return null}},ea=Yn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ta=Yn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),na=_r.extend({relatedTarget:null});function ra(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var aa={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ia={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oa=_r.extend({key:function(e){if(e.key){var t=aa[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ra(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ia[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Dr,charCode:function(e){return"keypress"===e.type?ra(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ra(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),sa=Br.extend({dataTransfer:null}),ua=_r.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Dr}),ca=Yn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),la=Br.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),ha={eventTypes:zt,extractEvents:function(e,t,n,r){var a=Bt.get(e);if(!a)return null;switch(e){case"keypress":if(0===ra(n))return null;case"keydown":case"keyup":e=oa;break;case"blur":case"focus":e=na;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Br;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=sa;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=ua;break;case Ke:case qe:case Xe:e=ea;break;case Ye:e=ca;break;case"scroll":e=_r;break;case"wheel":e=la;break;case"copy":case"cut":case"paste":e=ta;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Ur;break;default:e=Yn}return Gn(t=e.getPooled(a,t,n,r)),t}};if(y)throw Error(o(101));y=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),x(),f=Pn,m=Dn,v=Mn,T({SimpleEventPlugin:ha,EnterLeaveEventPlugin:Vr,ChangeEventPlugin:Ar,SelectEventPlugin:$r,BeforeInputEventPlugin:dr});var pa=[],da=-1;function fa(e){0>da||(e.current=pa[da],pa[da]=null,da--)}function ma(e,t){da++,pa[da]=e.current,e.current=t}var va={},ga={current:va},ya={current:!1},ba=va;function xa(e,t){var n=e.type.contextTypes;if(!n)return va;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function ka(e){return null!==(e=e.childContextTypes)&&void 0!==e}function wa(){fa(ya),fa(ga)}function Sa(e,t,n){if(ga.current!==va)throw Error(o(168));ma(ga,t),ma(ya,n)}function Ia(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(o(108,ve(t)||"Unknown",i));return a({},n,{},r)}function Ca(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||va,ba=ga.current,ma(ga,e),ma(ya,ya.current),!0}function Ta(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Ia(e,t,ba),r.__reactInternalMemoizedMergedChildContext=e,fa(ya),fa(ga),ma(ga,e)):fa(ya),ma(ya,n)}var Na=i.unstable_runWithPriority,Ea=i.unstable_scheduleCallback,Ra=i.unstable_cancelCallback,Aa=i.unstable_requestPaint,_a=i.unstable_now,Oa=i.unstable_getCurrentPriorityLevel,Fa=i.unstable_ImmediatePriority,Da=i.unstable_UserBlockingPriority,Ma=i.unstable_NormalPriority,Pa=i.unstable_LowPriority,La=i.unstable_IdlePriority,za={},Ba=i.unstable_shouldYield,Ua=void 0!==Aa?Aa:function(){},Wa=null,Va=null,Ga=!1,ja=_a(),Ha=1e4>ja?_a:function(){return _a()-ja};function Za(){switch(Oa()){case Fa:return 99;case Da:return 98;case Ma:return 97;case Pa:return 96;case La:return 95;default:throw Error(o(332))}}function Ka(e){switch(e){case 99:return Fa;case 98:return Da;case 97:return Ma;case 96:return Pa;case 95:return La;default:throw Error(o(332))}}function qa(e,t){return e=Ka(e),Na(e,t)}function Xa(e,t,n){return e=Ka(e),Ea(e,t,n)}function Ya(e){return null===Wa?(Wa=[e],Va=Ea(Fa,Ja)):Wa.push(e),za}function Qa(){if(null!==Va){var e=Va;Va=null,Ra(e)}Ja()}function Ja(){if(!Ga&&null!==Wa){Ga=!0;var e=0;try{var t=Wa;qa(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Wa=null}catch(n){throw null!==Wa&&(Wa=Wa.slice(e+1)),Ea(Fa,Qa),n}finally{Ga=!1}}}function $a(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function ei(e,t){if(e&&e.defaultProps)for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var ti={current:null},ni=null,ri=null,ai=null;function ii(){ai=ri=ni=null}function oi(e){var t=ti.current;fa(ti),e.type._context._currentValue=t}function si(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function ui(e,t){ni=e,ai=ri=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Po=!0),e.firstContext=null)}function ci(e,t){if(ai!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(ai=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ri){if(null===ni)throw Error(o(308));ri=t,ni.dependencies={expirationTime:0,firstContext:t,responders:null}}else ri=ri.next=t;return e._currentValue}var li=!1;function hi(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function pi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function di(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function fi(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function mi(e,t){var n=e.alternate;null!==n&&pi(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function vi(e,t,n,r){var i=e.updateQueue;li=!1;var o=i.baseQueue,s=i.shared.pending;if(null!==s){if(null!==o){var u=o.next;o.next=s.next,s.next=u}o=s,i.shared.pending=null,null!==(u=e.alternate)&&(null!==(u=u.updateQueue)&&(u.baseQueue=s))}if(null!==o){u=o.next;var c=i.baseState,l=0,h=null,p=null,d=null;if(null!==u)for(var f=u;;){if((s=f.expirationTime)<r){var m={expirationTime:f.expirationTime,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null};null===d?(p=d=m,h=c):d=d.next=m,s>l&&(l=s)}else{null!==d&&(d=d.next={expirationTime:1073741823,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null}),wu(s,f.suspenseConfig);e:{var v=e,g=f;switch(s=t,m=n,g.tag){case 1:if("function"===typeof(v=g.payload)){c=v.call(m,c,s);break e}c=v;break e;case 3:v.effectTag=-4097&v.effectTag|64;case 0:if(null===(s="function"===typeof(v=g.payload)?v.call(m,c,s):v)||void 0===s)break e;c=a({},c,s);break e;case 2:li=!0}}null!==f.callback&&(e.effectTag|=32,null===(s=i.effects)?i.effects=[f]:s.push(f))}if(null===(f=f.next)||f===u){if(null===(s=i.shared.pending))break;f=o.next=s.next,s.next=u,i.baseQueue=o=s,i.shared.pending=null}}null===d?h=c:d.next=p,i.baseState=h,i.baseQueue=d,Su(l),e.expirationTime=l,e.memoizedState=c}}function gi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=a,a=n,"function"!==typeof r)throw Error(o(191,r));r.call(a)}}}var yi=Y.ReactCurrentBatchConfig,bi=(new r.Component).refs;function xi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var ki={isMounted:function(e){return!!(e=e._reactInternalFiber)&&et(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=cu(),a=yi.suspense;(a=di(r=lu(r,e,a),a)).payload=t,void 0!==n&&null!==n&&(a.callback=n),fi(e,a),hu(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=cu(),a=yi.suspense;(a=di(r=lu(r,e,a),a)).tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),fi(e,a),hu(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=cu(),r=yi.suspense;(r=di(n=lu(n,e,r),r)).tag=2,void 0!==t&&null!==t&&(r.callback=t),fi(e,r),hu(e,n)}};function wi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!Hr(n,r)||!Hr(a,i))}function Si(e,t,n){var r=!1,a=va,i=t.contextType;return"object"===typeof i&&null!==i?i=ci(i):(a=ka(t)?ba:ga.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?xa(e,a):va),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ki,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Ii(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ki.enqueueReplaceState(t,t.state,null)}function Ci(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=bi,hi(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=ci(i):(i=ka(t)?ba:ga.current,a.context=xa(e,i)),vi(e,n,a,r),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(xi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&ki.enqueueReplaceState(a,a.state,null),vi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.effectTag|=4)}var Ti=Array.isArray;function Ni(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===bi&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ei(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Ri(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Gu(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Zu(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=a(t,n.props)).ref=Ni(e,t,n),r.return=e,r):((r=ju(n.type,n.key,n.props,null,e.mode,r)).ref=Ni(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ku(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Hu(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function p(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Zu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=ju(t.type,t.key,t.props,null,e.mode,n)).ref=Ni(e,null,t),n.return=e,n;case te:return(t=Ku(t,e.mode,n)).return=e,t}if(Ti(t)||me(t))return(t=Hu(t,e.mode,n,null)).return=e,t;Ei(e,t)}return null}function d(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===a?n.type===ne?h(e,t,n.props.children,r,a):c(e,t,n,r):null;case te:return n.key===a?l(e,t,n,r):null}if(Ti(n)||me(n))return null!==a?null:h(e,t,n,r,null);Ei(e,n)}return null}function f(e,t,n,r,a){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case ee:return e=e.get(null===r.key?n:r.key)||null,r.type===ne?h(t,e,r.props.children,a,r.key):c(t,e,r,a);case te:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a)}if(Ti(r)||me(r))return h(t,e=e.get(n)||null,r,a,null);Ei(t,r)}return null}function m(a,o,s,u){for(var c=null,l=null,h=o,m=o=0,v=null;null!==h&&m<s.length;m++){h.index>m?(v=h,h=null):v=h.sibling;var g=d(a,h,s[m],u);if(null===g){null===h&&(h=v);break}e&&h&&null===g.alternate&&t(a,h),o=i(g,o,m),null===l?c=g:l.sibling=g,l=g,h=v}if(m===s.length)return n(a,h),c;if(null===h){for(;m<s.length;m++)null!==(h=p(a,s[m],u))&&(o=i(h,o,m),null===l?c=h:l.sibling=h,l=h);return c}for(h=r(a,h);m<s.length;m++)null!==(v=f(h,a,m,s[m],u))&&(e&&null!==v.alternate&&h.delete(null===v.key?m:v.key),o=i(v,o,m),null===l?c=v:l.sibling=v,l=v);return e&&h.forEach((function(e){return t(a,e)})),c}function v(a,s,u,c){var l=me(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var h=l=null,m=s,v=s=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=d(a,m,y.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(a,m),s=i(b,s,v),null===h?l=b:h.sibling=b,h=b,m=g}if(y.done)return n(a,m),l;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=p(a,y.value,c))&&(s=i(y,s,v),null===h?l=y:h.sibling=y,h=y);return l}for(m=r(a,m);!y.done;v++,y=u.next())null!==(y=f(m,a,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=i(y,s,v),null===h?l=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(a,e)})),l}return function(e,r,i,u){var c="object"===typeof i&&null!==i&&i.type===ne&&null===i.key;c&&(i=i.props.children);var l="object"===typeof i&&null!==i;if(l)switch(i.$$typeof){case ee:e:{for(l=i.key,c=r;null!==c;){if(c.key===l){if(7===c.tag){if(i.type===ne){n(e,c.sibling),(r=a(c,i.props.children)).return=e,e=r;break e}}else if(c.elementType===i.type){n(e,c.sibling),(r=a(c,i.props)).ref=Ni(e,c,i),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}i.type===ne?((r=Hu(i.props.children,e.mode,u,i.key)).return=e,e=r):((u=ju(i.type,i.key,i.props,null,e.mode,u)).ref=Ni(e,r,i),u.return=e,e=u)}return s(e);case te:e:{for(c=i.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),(r=a(r,i.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Ku(i,e.mode,u)).return=e,e=r}return s(e)}if("string"===typeof i||"number"===typeof i)return i=""+i,null!==r&&6===r.tag?(n(e,r.sibling),(r=a(r,i)).return=e,e=r):(n(e,r),(r=Zu(i,e.mode,u)).return=e,e=r),s(e);if(Ti(i))return m(e,r,i,u);if(me(i))return v(e,r,i,u);if(l&&Ei(e,i),"undefined"===typeof i&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(o(152,e.displayName||e.name||"Component"))}return n(e,r)}}var Ai=Ri(!0),_i=Ri(!1),Oi={},Fi={current:Oi},Di={current:Oi},Mi={current:Oi};function Pi(e){if(e===Oi)throw Error(o(174));return e}function Li(e,t){switch(ma(Mi,t),ma(Di,e),ma(Fi,Oi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Le(null,"");break;default:t=Le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}fa(Fi),ma(Fi,t)}function zi(){fa(Fi),fa(Di),fa(Mi)}function Bi(e){Pi(Mi.current);var t=Pi(Fi.current),n=Le(t,e.type);t!==n&&(ma(Di,e),ma(Fi,n))}function Ui(e){Di.current===e&&(fa(Fi),fa(Di))}var Wi={current:0};function Vi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===bn||n.data===xn))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Gi(e,t){return{responder:e,props:t}}var ji=Y.ReactCurrentDispatcher,Hi=Y.ReactCurrentBatchConfig,Zi=0,Ki=null,qi=null,Xi=null,Yi=!1;function Qi(){throw Error(o(321))}function Ji(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Gr(e[n],t[n]))return!1;return!0}function $i(e,t,n,r,a,i){if(Zi=i,Ki=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,ji.current=null===e||null===e.memoizedState?So:Io,e=n(r,a),t.expirationTime===Zi){i=0;do{if(t.expirationTime=0,!(25>i))throw Error(o(301));i+=1,Xi=qi=null,t.updateQueue=null,ji.current=Co,e=n(r,a)}while(t.expirationTime===Zi)}if(ji.current=wo,t=null!==qi&&null!==qi.next,Zi=0,Xi=qi=Ki=null,Yi=!1,t)throw Error(o(300));return e}function eo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Xi?Ki.memoizedState=Xi=e:Xi=Xi.next=e,Xi}function to(){if(null===qi){var e=Ki.alternate;e=null!==e?e.memoizedState:null}else e=qi.next;var t=null===Xi?Ki.memoizedState:Xi.next;if(null!==t)Xi=t,qi=e;else{if(null===e)throw Error(o(310));e={memoizedState:(qi=e).memoizedState,baseState:qi.baseState,baseQueue:qi.baseQueue,queue:qi.queue,next:null},null===Xi?Ki.memoizedState=Xi=e:Xi=Xi.next=e}return Xi}function no(e,t){return"function"===typeof t?t(e):t}function ro(e){var t=to(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=qi,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(null!==a){a=a.next,r=r.baseState;var u=s=i=null,c=a;do{var l=c.expirationTime;if(l<Zi){var h={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===u?(s=u=h,i=r):u=u.next=h,l>Ki.expirationTime&&(Ki.expirationTime=l,Su(l))}else null!==u&&(u=u.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),wu(l,c.suspenseConfig),r=c.eagerReducer===e?c.eagerState:e(r,c.action);c=c.next}while(null!==c&&c!==a);null===u?i=r:u.next=s,Gr(r,t.memoizedState)||(Po=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function ao(e){var t=to(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{i=e(i,s.action),s=s.next}while(s!==a);Gr(i,t.memoizedState)||(Po=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function io(e){var t=eo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:no,lastRenderedState:e}).dispatch=ko.bind(null,Ki,e),[t.memoizedState,e]}function oo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Ki.updateQueue)?(t={lastEffect:null},Ki.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function so(){return to().memoizedState}function uo(e,t,n,r){var a=eo();Ki.effectTag|=e,a.memoizedState=oo(1|t,n,void 0,void 0===r?null:r)}function co(e,t,n,r){var a=to();r=void 0===r?null:r;var i=void 0;if(null!==qi){var o=qi.memoizedState;if(i=o.destroy,null!==r&&Ji(r,o.deps))return void oo(t,n,i,r)}Ki.effectTag|=e,a.memoizedState=oo(1|t,n,i,r)}function lo(e,t){return uo(516,4,e,t)}function ho(e,t){return co(516,4,e,t)}function po(e,t){return co(4,2,e,t)}function fo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function mo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,co(4,2,fo.bind(null,t,e),n)}function vo(){}function go(e,t){return eo().memoizedState=[e,void 0===t?null:t],e}function yo(e,t){var n=to();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ji(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function bo(e,t){var n=to();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ji(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function xo(e,t,n){var r=Za();qa(98>r?98:r,(function(){e(!0)})),qa(97<r?97:r,(function(){var r=Hi.suspense;Hi.suspense=void 0===t?null:t;try{e(!1),n()}finally{Hi.suspense=r}}))}function ko(e,t,n){var r=cu(),a=yi.suspense;a={expirationTime:r=lu(r,e,a),suspenseConfig:a,action:n,eagerReducer:null,eagerState:null,next:null};var i=t.pending;if(null===i?a.next=a:(a.next=i.next,i.next=a),t.pending=a,i=e.alternate,e===Ki||null!==i&&i===Ki)Yi=!0,a.expirationTime=Zi,Ki.expirationTime=Zi;else{if(0===e.expirationTime&&(null===i||0===i.expirationTime)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.eagerReducer=i,a.eagerState=s,Gr(s,o))return}catch(u){}hu(e,r)}}var wo={readContext:ci,useCallback:Qi,useContext:Qi,useEffect:Qi,useImperativeHandle:Qi,useLayoutEffect:Qi,useMemo:Qi,useReducer:Qi,useRef:Qi,useState:Qi,useDebugValue:Qi,useResponder:Qi,useDeferredValue:Qi,useTransition:Qi},So={readContext:ci,useCallback:go,useContext:ci,useEffect:lo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,uo(4,2,fo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return uo(4,2,e,t)},useMemo:function(e,t){var n=eo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=eo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=ko.bind(null,Ki,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},eo().memoizedState=e},useState:io,useDebugValue:vo,useResponder:Gi,useDeferredValue:function(e,t){var n=io(e),r=n[0],a=n[1];return lo((function(){var n=Hi.suspense;Hi.suspense=void 0===t?null:t;try{a(e)}finally{Hi.suspense=n}}),[e,t]),r},useTransition:function(e){var t=io(!1),n=t[0];return t=t[1],[go(xo.bind(null,t,e),[t,e]),n]}},Io={readContext:ci,useCallback:yo,useContext:ci,useEffect:ho,useImperativeHandle:mo,useLayoutEffect:po,useMemo:bo,useReducer:ro,useRef:so,useState:function(){return ro(no)},useDebugValue:vo,useResponder:Gi,useDeferredValue:function(e,t){var n=ro(no),r=n[0],a=n[1];return ho((function(){var n=Hi.suspense;Hi.suspense=void 0===t?null:t;try{a(e)}finally{Hi.suspense=n}}),[e,t]),r},useTransition:function(e){var t=ro(no),n=t[0];return t=t[1],[yo(xo.bind(null,t,e),[t,e]),n]}},Co={readContext:ci,useCallback:yo,useContext:ci,useEffect:ho,useImperativeHandle:mo,useLayoutEffect:po,useMemo:bo,useReducer:ao,useRef:so,useState:function(){return ao(no)},useDebugValue:vo,useResponder:Gi,useDeferredValue:function(e,t){var n=ao(no),r=n[0],a=n[1];return ho((function(){var n=Hi.suspense;Hi.suspense=void 0===t?null:t;try{a(e)}finally{Hi.suspense=n}}),[e,t]),r},useTransition:function(e){var t=ao(no),n=t[0];return t=t[1],[yo(xo.bind(null,t,e),[t,e]),n]}},To=null,No=null,Eo=!1;function Ro(e,t){var n=Wu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function _o(e){if(Eo){var t=No;if(t){var n=t;if(!Ao(e,t)){if(!(t=Nn(n.nextSibling))||!Ao(e,t))return e.effectTag=-1025&e.effectTag|2,Eo=!1,void(To=e);Ro(To,n)}To=e,No=Nn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Eo=!1,To=e}}function Oo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;To=e}function Fo(e){if(e!==To)return!1;if(!Eo)return Oo(e),Eo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!In(t,e.memoizedProps))for(t=No;t;)Ro(e,t),t=Nn(t.nextSibling);if(Oo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if(n===yn){if(0===t){No=Nn(e.nextSibling);break e}t--}else n!==gn&&n!==xn&&n!==bn||t++}e=e.nextSibling}No=null}}else No=To?Nn(e.stateNode.nextSibling):null;return!0}function Do(){No=To=null,Eo=!1}var Mo=Y.ReactCurrentOwner,Po=!1;function Lo(e,t,n,r){t.child=null===e?_i(t,null,n,r):Ai(t,e.child,n,r)}function zo(e,t,n,r,a){n=n.render;var i=t.ref;return ui(t,a),r=$i(e,t,n,r,i,a),null===e||Po?(t.effectTag|=1,Lo(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=a&&(e.expirationTime=0),ts(e,t,a))}function Bo(e,t,n,r,a,i){if(null===e){var o=n.type;return"function"!==typeof o||Vu(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ju(n.type,null,r,null,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Uo(e,t,o,r,a,i))}return o=e.child,a<i&&(a=o.memoizedProps,(n=null!==(n=n.compare)?n:Hr)(a,r)&&e.ref===t.ref)?ts(e,t,i):(t.effectTag|=1,(e=Gu(o,r)).ref=t.ref,e.return=t,t.child=e)}function Uo(e,t,n,r,a,i){return null!==e&&Hr(e.memoizedProps,r)&&e.ref===t.ref&&(Po=!1,a<i)?(t.expirationTime=e.expirationTime,ts(e,t,i)):Vo(e,t,n,r,i)}function Wo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Vo(e,t,n,r,a){var i=ka(n)?ba:ga.current;return i=xa(t,i),ui(t,a),n=$i(e,t,n,r,i,a),null===e||Po?(t.effectTag|=1,Lo(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=a&&(e.expirationTime=0),ts(e,t,a))}function Go(e,t,n,r,a){if(ka(n)){var i=!0;Ca(t)}else i=!1;if(ui(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Si(t,n,r),Ci(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=ci(c):c=xa(t,c=ka(n)?ba:ga.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Ii(t,o,r,c),li=!1;var p=t.memoizedState;o.state=p,vi(t,r,o,a),u=t.memoizedState,s!==r||p!==u||ya.current||li?("function"===typeof l&&(xi(t,n,l,r),u=t.memoizedState),(s=li||wi(t,n,s,r,p,u,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.effectTag|=4)):("function"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,pi(e,t),s=t.memoizedProps,o.props=t.type===t.elementType?s:ei(t.type,s),u=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=ci(c):c=xa(t,c=ka(n)?ba:ga.current),(h="function"===typeof(l=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Ii(t,o,r,c),li=!1,u=t.memoizedState,o.state=u,vi(t,r,o,a),p=t.memoizedState,s!==r||u!==p||ya.current||li?("function"===typeof l&&(xi(t,n,l,r),p=t.memoizedState),(l=li||wi(t,n,s,r,u,p,c))?(h||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.effectTag|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return jo(e,t,n,r,i,a)}function jo(e,t,n,r,a,i){Wo(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return a&&Ta(t,n,!1),ts(e,t,i);r=t.stateNode,Mo.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=Ai(t,e.child,null,i),t.child=Ai(t,null,s,i)):Lo(e,t,s,i),t.memoizedState=r.state,a&&Ta(t,n,!0),t.child}function Ho(e){var t=e.stateNode;t.pendingContext?Sa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Sa(0,t.context,!1),Li(e,t.containerInfo)}var Zo,Ko,qo,Xo,Yo={dehydrated:null,retryTime:0};function Qo(e,t,n){var r,a=t.mode,i=t.pendingProps,o=Wi.current,s=!1;if((r=0!==(64&t.effectTag))||(r=0!==(2&o)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),ma(Wi,1&o),null===e){if(void 0!==i.fallback&&_o(t),s){if(s=i.fallback,(i=Hu(null,a,0,null)).return=t,0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,i.child=e;null!==e;)e.return=i,e=e.sibling;return(n=Hu(s,a,n,null)).return=t,i.sibling=n,t.memoizedState=Yo,t.child=i,n}return a=i.children,t.memoizedState=null,t.child=_i(t,null,a,n)}if(null!==e.memoizedState){if(a=(e=e.child).sibling,s){if(i=i.fallback,(n=Gu(e,e.pendingProps)).return=t,0===(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(a=Gu(a,i)).return=t,n.sibling=a,n.childExpirationTime=0,t.memoizedState=Yo,t.child=n,a}return n=Ai(t,e.child,i.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=i.fallback,(i=Hu(null,a,0,null)).return=t,i.child=e,null!==e&&(e.return=i),0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,i.child=e;null!==e;)e.return=i,e=e.sibling;return(n=Hu(s,a,n,null)).return=t,i.sibling=n,n.effectTag|=2,i.childExpirationTime=0,t.memoizedState=Yo,t.child=i,n}return t.memoizedState=null,t.child=Ai(t,e,i.children,n)}function Jo(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),si(e.return,t)}function $o(e,t,n,r,a,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:a,lastEffect:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailExpiration=0,o.tailMode=a,o.lastEffect=i)}function es(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Lo(e,t,r.children,n),0!==(2&(r=Wi.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!==(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Jo(e,n);else if(19===e.tag)Jo(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ma(Wi,r),0===(2&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===Vi(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),$o(t,!1,a,n,i,t.lastEffect);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===Vi(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}$o(t,!0,n,null,i,t.lastEffect);break;case"together":$o(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ts(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&Su(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Gu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Gu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ns(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function rs(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return ka(t.type)&&wa(),null;case 3:return zi(),fa(ya),fa(ga),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Fo(t)||(t.effectTag|=4),Ko(t),null;case 5:Ui(t),n=Pi(Mi.current);var i=t.type;if(null!==e&&null!=t.stateNode)qo(e,t,i,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Pi(Fi.current),Fo(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[An]=t,r[_n]=s,i){case"iframe":case"object":case"embed":qt("load",r);break;case"video":case"audio":for(e=0;e<Qe.length;e++)qt(Qe[e],r);break;case"source":qt("error",r);break;case"img":case"image":case"link":qt("error",r),qt("load",r);break;case"form":qt("reset",r),qt("submit",r);break;case"details":qt("toggle",r);break;case"input":Se(r,s),qt("invalid",r),cn(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!s.multiple},qt("invalid",r),cn(n,"onChange");break;case"textarea":_e(r,s),qt("invalid",r),cn(n,"onChange")}for(var u in on(i,s),e=null,s)if(s.hasOwnProperty(u)){var c=s[u];"children"===u?"string"===typeof c?r.textContent!==c&&(e=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(e=["children",""+c]):I.hasOwnProperty(u)&&null!=c&&cn(n,u)}switch(i){case"input":xe(r),Te(r,s,!0);break;case"textarea":xe(r),Fe(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=ln)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(u=9===n.nodeType?n:n.ownerDocument,e===un&&(e=Pe(i)),e===un?"script"===i?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(i,{is:r.is}):(e=u.createElement(i),"select"===i&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,i),e[An]=t,e[_n]=r,Zo(e,t,!1,!1),t.stateNode=e,u=sn(i,r),i){case"iframe":case"object":case"embed":qt("load",e),c=r;break;case"video":case"audio":for(c=0;c<Qe.length;c++)qt(Qe[c],e);c=r;break;case"source":qt("error",e),c=r;break;case"img":case"image":case"link":qt("error",e),qt("load",e),c=r;break;case"form":qt("reset",e),qt("submit",e),c=r;break;case"details":qt("toggle",e),c=r;break;case"input":Se(e,r),c=we(e,r),qt("invalid",e),cn(n,"onChange");break;case"option":c=Ee(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},c=a({},r,{value:void 0}),qt("invalid",e),cn(n,"onChange");break;case"textarea":_e(e,r),c=Ae(e,r),qt("invalid",e),cn(n,"onChange");break;default:c=r}on(i,c);var l=c;for(s in l)if(l.hasOwnProperty(s)){var h=l[s];"style"===s?rn(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&Ue(e,h):"children"===s?"string"===typeof h?("textarea"!==i||""!==h)&&We(e,h):"number"===typeof h&&We(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(I.hasOwnProperty(s)?null!=h&&cn(n,s):null!=h&&Q(e,s,h,u))}switch(i){case"input":xe(e),Te(e,r,!1);break;case"textarea":xe(e),Fe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+ye(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?Re(e,!!r.multiple,n,!1):null!=r.defaultValue&&Re(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof c.onClick&&(e.onclick=ln)}Sn(i,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Xo(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=Pi(Mi.current),Pi(Fi.current),Fo(t)?(n=t.stateNode,r=t.memoizedProps,n[An]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[An]=t,t.stateNode=n)}return null;case 13:return fa(Wi),r=t.memoizedState,0!==(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Fo(t):(r=null!==(i=e.memoizedState),n||null===i||null!==(i=e.child.sibling)&&(null!==(s=t.firstEffect)?(t.firstEffect=i,i.nextEffect=s):(t.firstEffect=t.lastEffect=i,i.nextEffect=null),i.effectTag=8)),n&&!r&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Wi.current)?Gs===Fs&&(Gs=Ps):(Gs!==Fs&&Gs!==Ps||(Gs=Ls),0!==qs&&null!==Us&&(Yu(Us,Vs),Qu(Us,qs)))),(n||r)&&(t.effectTag|=4),null);case 4:return zi(),Ko(t),null;case 10:return oi(t),null;case 19:if(fa(Wi),null===(r=t.memoizedState))return null;if(i=0!==(64&t.effectTag),null===(s=r.rendering)){if(i)ns(r,!1);else if(Gs!==Fs||null!==e&&0!==(64&e.effectTag))for(s=t.child;null!==s;){if(null!==(e=Vi(s))){for(t.effectTag|=64,ns(r,!1),null!==(i=e.updateQueue)&&(t.updateQueue=i,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)s=n,(i=r).effectTag&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,null===(e=i.alternate)?(i.childExpirationTime=0,i.expirationTime=s,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null):(i.childExpirationTime=e.childExpirationTime,i.expirationTime=e.expirationTime,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,s=e.dependencies,i.dependencies=null===s?null:{expirationTime:s.expirationTime,firstContext:s.firstContext,responders:s.responders}),r=r.sibling;return ma(Wi,1&Wi.current|2),t.child}s=s.sibling}}else{if(!i)if(null!==(e=Vi(s))){if(t.effectTag|=64,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),ns(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Ha()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,i=!0,ns(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=r.last)?n.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Ha()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Ha(),n.sibling=null,t=Wi.current,ma(Wi,i?1&t|2:1&t),n):null}throw Error(o(156,t.tag))}function as(e){switch(e.tag){case 1:ka(e.type)&&wa();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(zi(),fa(ya),fa(ga),0!==(64&(t=e.effectTag)))throw Error(o(285));return e.effectTag=-4097&t|64,e;case 5:return Ui(e),null;case 13:return fa(Wi),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return fa(Wi),null;case 4:return zi(),null;case 10:return oi(e),null;default:return null}}function is(e,t){return{value:e,source:t,stack:ge(t)}}Zo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ko=function(){},qo=function(e,t,n,r,i){var o=e.memoizedProps;if(o!==r){var s,u,c=t.stateNode;switch(Pi(Fi.current),e=null,n){case"input":o=we(c,o),r=we(c,r),e=[];break;case"option":o=Ee(c,o),r=Ee(c,r),e=[];break;case"select":o=a({},o,{value:void 0}),r=a({},r,{value:void 0}),e=[];break;case"textarea":o=Ae(c,o),r=Ae(c,r),e=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(c.onclick=ln)}for(s in on(n,r),n=null,o)if(!r.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s)for(u in c=o[s])c.hasOwnProperty(u)&&(n||(n={}),n[u]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(I.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var l=r[s];if(c=null!=o?o[s]:void 0,r.hasOwnProperty(s)&&l!==c&&(null!=l||null!=c))if("style"===s)if(c){for(u in c)!c.hasOwnProperty(u)||l&&l.hasOwnProperty(u)||(n||(n={}),n[u]="");for(u in l)l.hasOwnProperty(u)&&c[u]!==l[u]&&(n||(n={}),n[u]=l[u])}else n||(e||(e=[]),e.push(s,n)),n=l;else"dangerouslySetInnerHTML"===s?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(e=e||[]).push(s,l)):"children"===s?c===l||"string"!==typeof l&&"number"!==typeof l||(e=e||[]).push(s,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(I.hasOwnProperty(s)?(null!=l&&cn(i,s),e||c===l||(e=[])):(e=e||[]).push(s,l))}n&&(e=e||[]).push("style",n),i=e,(t.updateQueue=i)&&(t.effectTag|=4)}},Xo=function(e,t,n,r){n!==r&&(t.effectTag|=4)};var os="function"===typeof WeakSet?WeakSet:Set;function ss(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=ge(n)),null!==n&&ve(n.type),t=t.value,null!==e&&1===e.tag&&ve(e.type);try{console.error(t)}catch(a){setTimeout((function(){throw a}))}}function us(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Mu(e,n)}else t.current=null}function cs(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 3:case 5:case 6:case 4:case 17:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:ei(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return}throw Error(o(163))}function ls(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function hs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ps(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void hs(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:ei(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&gi(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}gi(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&Sn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Lt(n)))))}throw Error(o(163))}function ds(e,t,n){switch("function"===typeof Bu&&Bu(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;qa(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var a=t;try{n()}catch(i){Mu(a,i)}}e=e.next}while(e!==r)}))}break;case 1:us(t),"function"===typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){Mu(e,n)}}(t,n);break;case 5:us(t);break;case 4:bs(e,t,n)}}function fs(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&fs(t)}function ms(e){return 5===e.tag||3===e.tag||4===e.tag}function vs(e){e:{for(var t=e.return;null!==t;){if(ms(t)){var n=t;break e}t=t.return}throw Error(o(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.effectTag&&(We(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ms(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?gs(e,n,t):ys(e,n,t)}function gs(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=ln));else if(4!==r&&null!==(e=e.child))for(gs(e,t,n),e=e.sibling;null!==e;)gs(e,t,n),e=e.sibling}function ys(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ys(e,t,n),e=e.sibling;null!==e;)ys(e,t,n),e=e.sibling}function bs(e,t,n){for(var r,a,i=t,s=!1;;){if(!s){s=i.return;e:for(;;){if(null===s)throw Error(o(160));switch(r=s.stateNode,s.tag){case 5:a=!1;break e;case 3:case 4:r=r.containerInfo,a=!0;break e}s=s.return}s=!0}if(5===i.tag||6===i.tag){e:for(var u=e,c=i,l=n,h=c;;)if(ds(u,h,l),null!==h.child&&4!==h.tag)h.child.return=h,h=h.child;else{if(h===c)break e;for(;null===h.sibling;){if(null===h.return||h.return===c)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a?(u=r,c=i.stateNode,8===u.nodeType?u.parentNode.removeChild(c):u.removeChild(c)):r.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,a=!0,i.child.return=i,i=i.child;continue}}else if(ds(e,i,n),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(s=!1)}i.sibling.return=i.return,i=i.sibling}}function xs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void ls(3,t);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,a=null!==e?e.memoizedProps:r;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,null!==i){for(n[_n]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Ie(n,r),sn(e,a),t=sn(e,r),a=0;a<i.length;a+=2){var s=i[a],u=i[a+1];"style"===s?rn(n,u):"dangerouslySetInnerHTML"===s?Ue(n,u):"children"===s?We(n,u):Q(n,s,u,t)}switch(e){case"input":Ce(n,r);break;case"textarea":Oe(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?Re(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?Re(n,!!r.multiple,r.defaultValue,!0):Re(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Lt(t.containerInfo)));case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,Ys=Ha()),null!==n)e:for(e=n;;){if(5===e.tag)i=e.stateNode,r?"function"===typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none":(i=e.stateNode,a=void 0!==(a=e.memoizedProps.style)&&null!==a&&a.hasOwnProperty("display")?a.display:null,i.style.display=nn("display",a));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(i=e.child.sibling).return=e,e=i;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void ks(t);case 19:return void ks(t)}throw Error(o(163))}function ks(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new os),t.forEach((function(t){var r=Lu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var ws="function"===typeof WeakMap?WeakMap:Map;function Ss(e,t,n){(n=di(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){$s||($s=!0,eu=r),ss(e,t)},n}function Is(e,t,n){(n=di(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return ss(e,t),r(a)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===tu?tu=new Set([this]):tu.add(this),ss(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var Cs,Ts=Math.ceil,Ns=Y.ReactCurrentDispatcher,Es=Y.ReactCurrentOwner,Rs=0,As=8,_s=16,Os=32,Fs=0,Ds=1,Ms=2,Ps=3,Ls=4,zs=5,Bs=Rs,Us=null,Ws=null,Vs=0,Gs=Fs,js=null,Hs=1073741823,Zs=1073741823,Ks=null,qs=0,Xs=!1,Ys=0,Qs=500,Js=null,$s=!1,eu=null,tu=null,nu=!1,ru=null,au=90,iu=null,ou=0,su=null,uu=0;function cu(){return(Bs&(_s|Os))!==Rs?1073741821-(Ha()/10|0):0!==uu?uu:uu=1073741821-(Ha()/10|0)}function lu(e,t,n){if(0===(2&(t=t.mode)))return 1073741823;var r=Za();if(0===(4&t))return 99===r?1073741823:1073741822;if((Bs&_s)!==Rs)return Vs;if(null!==n)e=$a(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=$a(e,150,100);break;case 97:case 96:e=$a(e,5e3,250);break;case 95:e=2;break;default:throw Error(o(326))}return null!==Us&&e===Vs&&--e,e}function hu(e,t){if(50<ou)throw ou=0,su=null,Error(o(185));if(null!==(e=pu(e,t))){var n=Za();1073741823===t?(Bs&As)!==Rs&&(Bs&(_s|Os))===Rs?vu(e):(fu(e),Bs===Rs&&Qa()):fu(e),(4&Bs)===Rs||98!==n&&99!==n||(null===iu?iu=new Map([[e,t]]):(void 0===(n=iu.get(e))||n>t)&&iu.set(e,t))}}function pu(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,a=null;if(null===r&&3===e.tag)a=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){a=r.stateNode;break}r=r.return}return null!==a&&(Us===a&&(Su(t),Gs===Ls&&Yu(a,Vs)),Qu(a,t)),a}function du(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Xu(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function fu(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Ya(vu.bind(null,e));else{var t=du(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=cu();if(1073741823===t?r=99:1===t||2===t?r=95:r=0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var a=e.callbackPriority;if(e.callbackExpirationTime===t&&a>=r)return;n!==za&&Ra(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?Ya(vu.bind(null,e)):Xa(r,mu.bind(null,e),{timeout:10*(1073741821-t)-Ha()}),e.callbackNode=t}}}function mu(e,t){if(uu=0,t)return Ju(e,t=cu()),fu(e),null;var n=du(e);if(0!==n){if(t=e.callbackNode,(Bs&(_s|Os))!==Rs)throw Error(o(327));if(Ou(),e===Us&&n===Vs||bu(e,n),null!==Ws){var r=Bs;Bs|=_s;for(var a=ku();;)try{Cu();break}catch(u){xu(e,u)}if(ii(),Bs=r,Ns.current=a,Gs===Ds)throw t=js,bu(e,n),Yu(e,n),fu(e),t;if(null===Ws)switch(a=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=Gs,Us=null,r){case Fs:case Ds:throw Error(o(345));case Ms:Ju(e,2<n?2:n);break;case Ps:if(Yu(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Eu(a)),1073741823===Hs&&10<(a=Ys+Qs-Ha())){if(Xs){var i=e.lastPingedTime;if(0===i||i>=n){e.lastPingedTime=n,bu(e,n);break}}if(0!==(i=du(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=Cn(Ru.bind(null,e),a);break}Ru(e);break;case Ls:if(Yu(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Eu(a)),Xs&&(0===(a=e.lastPingedTime)||a>=n)){e.lastPingedTime=n,bu(e,n);break}if(0!==(a=du(e))&&a!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==Zs?r=10*(1073741821-Zs)-Ha():1073741823===Hs?r=0:(r=10*(1073741821-Hs)-5e3,0>(r=(a=Ha())-r)&&(r=0),(n=10*(1073741821-n)-a)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ts(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=Cn(Ru.bind(null,e),r);break}Ru(e);break;case zs:if(1073741823!==Hs&&null!==Ks){i=Hs;var s=Ks;if(0>=(r=0|s.busyMinDurationMs)?r=0:(a=0|s.busyDelayMs,r=(i=Ha()-(10*(1073741821-i)-(0|s.timeoutMs||5e3)))<=a?0:a+r-i),10<r){Yu(e,n),e.timeoutHandle=Cn(Ru.bind(null,e),r);break}}Ru(e);break;default:throw Error(o(329))}if(fu(e),e.callbackNode===t)return mu.bind(null,e)}}return null}function vu(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,(Bs&(_s|Os))!==Rs)throw Error(o(327));if(Ou(),e===Us&&t===Vs||bu(e,t),null!==Ws){var n=Bs;Bs|=_s;for(var r=ku();;)try{Iu();break}catch(a){xu(e,a)}if(ii(),Bs=n,Ns.current=r,Gs===Ds)throw n=js,bu(e,t),Yu(e,t),fu(e),n;if(null!==Ws)throw Error(o(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Us=null,Ru(e),fu(e)}return null}function gu(e,t){var n=Bs;Bs|=1;try{return e(t)}finally{(Bs=n)===Rs&&Qa()}}function yu(e,t){var n=Bs;Bs&=-2,Bs|=As;try{return e(t)}finally{(Bs=n)===Rs&&Qa()}}function bu(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Tn(n)),null!==Ws)for(n=Ws.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&wa();break;case 3:zi(),fa(ya),fa(ga);break;case 5:Ui(r);break;case 4:zi();break;case 13:case 19:fa(Wi);break;case 10:oi(r)}n=n.return}Us=e,Ws=Gu(e.current,null),Vs=t,Gs=Fs,js=null,Zs=Hs=1073741823,Ks=null,qs=0,Xs=!1}function xu(e,t){for(;;){try{if(ii(),ji.current=wo,Yi)for(var n=Ki.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(Zi=0,Xi=qi=Ki=null,Yi=!1,null===Ws||null===Ws.return)return Gs=Ds,js=t,Ws=null;e:{var a=e,i=Ws.return,o=Ws,s=t;if(t=Vs,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==s&&"object"===typeof s&&"function"===typeof s.then){var u=s;if(0===(2&o.mode)){var c=o.alternate;c?(o.updateQueue=c.updateQueue,o.memoizedState=c.memoizedState,o.expirationTime=c.expirationTime):(o.updateQueue=null,o.memoizedState=null)}var l=0!==(1&Wi.current),h=i;do{var p;if(p=13===h.tag){var d=h.memoizedState;if(null!==d)p=null!==d.dehydrated;else{var f=h.memoizedProps;p=void 0!==f.fallback&&(!0!==f.unstable_avoidThisFallback||!l)}}if(p){var m=h.updateQueue;if(null===m){var v=new Set;v.add(u),h.updateQueue=v}else m.add(u);if(0===(2&h.mode)){if(h.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var g=di(1073741823,null);g.tag=2,fi(o,g)}o.expirationTime=1073741823;break e}s=void 0,o=t;var y=a.pingCache;if(null===y?(y=a.pingCache=new ws,s=new Set,y.set(u,s)):void 0===(s=y.get(u))&&(s=new Set,y.set(u,s)),!s.has(o)){s.add(o);var b=Pu.bind(null,a,u,o);u.then(b,b)}h.effectTag|=4096,h.expirationTime=t;break e}h=h.return}while(null!==h);s=Error((ve(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+ge(o))}Gs!==zs&&(Gs=Ms),s=is(s,o),h=i;do{switch(h.tag){case 3:u=s,h.effectTag|=4096,h.expirationTime=t,mi(h,Ss(h,u,t));break e;case 1:u=s;var x=h.type,k=h.stateNode;if(0===(64&h.effectTag)&&("function"===typeof x.getDerivedStateFromError||null!==k&&"function"===typeof k.componentDidCatch&&(null===tu||!tu.has(k)))){h.effectTag|=4096,h.expirationTime=t,mi(h,Is(h,u,t));break e}}h=h.return}while(null!==h)}Ws=Nu(Ws)}catch(w){t=w;continue}break}}function ku(){var e=Ns.current;return Ns.current=wo,null===e?wo:e}function wu(e,t){e<Hs&&2<e&&(Hs=e),null!==t&&e<Zs&&2<e&&(Zs=e,Ks=t)}function Su(e){e>qs&&(qs=e)}function Iu(){for(;null!==Ws;)Ws=Tu(Ws)}function Cu(){for(;null!==Ws&&!Ba();)Ws=Tu(Ws)}function Tu(e){var t=Cs(e.alternate,e,Vs);return e.memoizedProps=e.pendingProps,null===t&&(t=Nu(e)),Es.current=null,t}function Nu(e){Ws=e;do{var t=Ws.alternate;if(e=Ws.return,0===(2048&Ws.effectTag)){if(t=rs(t,Ws,Vs),1===Vs||1!==Ws.childExpirationTime){for(var n=0,r=Ws.child;null!==r;){var a=r.expirationTime,i=r.childExpirationTime;a>n&&(n=a),i>n&&(n=i),r=r.sibling}Ws.childExpirationTime=n}if(null!==t)return t;null!==e&&0===(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Ws.firstEffect),null!==Ws.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Ws.firstEffect),e.lastEffect=Ws.lastEffect),1<Ws.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Ws:e.firstEffect=Ws,e.lastEffect=Ws))}else{if(null!==(t=as(Ws)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Ws.sibling))return t;Ws=e}while(null!==Ws);return Gs===Fs&&(Gs=zs),null}function Eu(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Ru(e){var t=Za();return qa(99,Au.bind(null,e,t)),null}function Au(e,t){do{Ou()}while(null!==ru);if((Bs&(_s|Os))!==Rs)throw Error(o(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var a=Eu(n);if(e.firstPendingTime=a,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Us&&(Ws=Us=null,Vs=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,a=n.firstEffect):a=n:a=n.firstEffect,null!==a){var i=Bs;Bs|=Os,Es.current=null,kn=Kt;var s=mn();if(vn(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{var c=(u=(u=s.ownerDocument)&&u.defaultView||window).getSelection&&u.getSelection();if(c&&0!==c.rangeCount){u=c.anchorNode;var l=c.anchorOffset,h=c.focusNode;c=c.focusOffset;try{u.nodeType,h.nodeType}catch(T){u=null;break e}var p=0,d=-1,f=-1,m=0,v=0,g=s,y=null;t:for(;;){for(var b;g!==u||0!==l&&3!==g.nodeType||(d=p+l),g!==h||0!==c&&3!==g.nodeType||(f=p+c),3===g.nodeType&&(p+=g.nodeValue.length),null!==(b=g.firstChild);)y=g,g=b;for(;;){if(g===s)break t;if(y===u&&++m===l&&(d=p),y===h&&++v===c&&(f=p),null!==(b=g.nextSibling))break;y=(g=y).parentNode}g=b}u=-1===d||-1===f?null:{start:d,end:f}}else u=null}u=u||{start:0,end:0}}else u=null;wn={activeElementDetached:null,focusedElem:s,selectionRange:u},Kt=!1,Js=a;do{try{_u()}catch(T){if(null===Js)throw Error(o(330));Mu(Js,T),Js=Js.nextEffect}}while(null!==Js);Js=a;do{try{for(s=e,u=t;null!==Js;){var x=Js.effectTag;if(16&x&&We(Js.stateNode,""),128&x){var k=Js.alternate;if(null!==k){var w=k.ref;null!==w&&("function"===typeof w?w(null):w.current=null)}}switch(1038&x){case 2:vs(Js),Js.effectTag&=-3;break;case 6:vs(Js),Js.effectTag&=-3,xs(Js.alternate,Js);break;case 1024:Js.effectTag&=-1025;break;case 1028:Js.effectTag&=-1025,xs(Js.alternate,Js);break;case 4:xs(Js.alternate,Js);break;case 8:bs(s,l=Js,u),fs(l)}Js=Js.nextEffect}}catch(T){if(null===Js)throw Error(o(330));Mu(Js,T),Js=Js.nextEffect}}while(null!==Js);if(w=wn,k=mn(),x=w.focusedElem,u=w.selectionRange,k!==x&&x&&x.ownerDocument&&fn(x.ownerDocument.documentElement,x)){null!==u&&vn(x)&&(k=u.start,void 0===(w=u.end)&&(w=k),"selectionStart"in x?(x.selectionStart=k,x.selectionEnd=Math.min(w,x.value.length)):(w=(k=x.ownerDocument||document)&&k.defaultView||window).getSelection&&(w=w.getSelection(),l=x.textContent.length,s=Math.min(u.start,l),u=void 0===u.end?s:Math.min(u.end,l),!w.extend&&s>u&&(l=u,u=s,s=l),l=dn(x,s),h=dn(x,u),l&&h&&(1!==w.rangeCount||w.anchorNode!==l.node||w.anchorOffset!==l.offset||w.focusNode!==h.node||w.focusOffset!==h.offset)&&((k=k.createRange()).setStart(l.node,l.offset),w.removeAllRanges(),s>u?(w.addRange(k),w.extend(h.node,h.offset)):(k.setEnd(h.node,h.offset),w.addRange(k))))),k=[];for(w=x;w=w.parentNode;)1===w.nodeType&&k.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"===typeof x.focus&&x.focus(),x=0;x<k.length;x++)(w=k[x]).element.scrollLeft=w.left,w.element.scrollTop=w.top}Kt=!!kn,wn=kn=null,e.current=n,Js=a;do{try{for(x=e;null!==Js;){var S=Js.effectTag;if(36&S&&ps(x,Js.alternate,Js),128&S){k=void 0;var I=Js.ref;if(null!==I){var C=Js.stateNode;Js.tag,k=C,"function"===typeof I?I(k):I.current=k}}Js=Js.nextEffect}}catch(T){if(null===Js)throw Error(o(330));Mu(Js,T),Js=Js.nextEffect}}while(null!==Js);Js=null,Ua(),Bs=i}else e.current=n;if(nu)nu=!1,ru=e,au=t;else for(Js=a;null!==Js;)t=Js.nextEffect,Js.nextEffect=null,Js=t;if(0===(t=e.firstPendingTime)&&(tu=null),1073741823===t?e===su?ou++:(ou=0,su=e):ou=0,"function"===typeof zu&&zu(n.stateNode,r),fu(e),$s)throw $s=!1,e=eu,eu=null,e;return(Bs&As)!==Rs||Qa(),null}function _u(){for(;null!==Js;){var e=Js.effectTag;0!==(256&e)&&cs(Js.alternate,Js),0===(512&e)||nu||(nu=!0,Xa(97,(function(){return Ou(),null}))),Js=Js.nextEffect}}function Ou(){if(90!==au){var e=97<au?97:au;return au=90,qa(e,Fu)}}function Fu(){if(null===ru)return!1;var e=ru;if(ru=null,(Bs&(_s|Os))!==Rs)throw Error(o(331));var t=Bs;for(Bs|=Os,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:ls(5,n),hs(5,n)}}catch(r){if(null===e)throw Error(o(330));Mu(e,r)}n=e.nextEffect,e.nextEffect=null,e=n}return Bs=t,Qa(),!0}function Du(e,t,n){fi(e,t=Ss(e,t=is(n,t),1073741823)),null!==(e=pu(e,1073741823))&&fu(e)}function Mu(e,t){if(3===e.tag)Du(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Du(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===tu||!tu.has(r))){fi(n,e=Is(n,e=is(t,e),1073741823)),null!==(n=pu(n,1073741823))&&fu(n);break}}n=n.return}}function Pu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),Us===e&&Vs===n?Gs===Ls||Gs===Ps&&1073741823===Hs&&Ha()-Ys<Qs?bu(e,Vs):Xs=!0:Xu(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,fu(e)))}function Lu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=lu(t=cu(),e,null)),null!==(e=pu(e,t))&&fu(e)}Cs=function(e,t,n){var r=t.expirationTime;if(null!==e){var a=t.pendingProps;if(e.memoizedProps!==a||ya.current)Po=!0;else{if(r<n){switch(Po=!1,t.tag){case 3:Ho(t),Do();break;case 5:if(Bi(t),4&t.mode&&1!==n&&a.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:ka(t.type)&&Ca(t);break;case 4:Li(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,a=t.type._context,ma(ti,a._currentValue),a._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Qo(e,t,n):(ma(Wi,1&Wi.current),null!==(t=ts(e,t,n))?t.sibling:null);ma(Wi,1&Wi.current);break;case 19:if(r=t.childExpirationTime>=n,0!==(64&e.effectTag)){if(r)return es(e,t,n);t.effectTag|=64}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null),ma(Wi,Wi.current),!r)return null}return ts(e,t,n)}Po=!1}}else Po=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,a=xa(t,ga.current),ui(t,n),a=$i(null,t,r,e,a,n),t.effectTag|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,ka(r)){var i=!0;Ca(t)}else i=!1;t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,hi(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&xi(t,r,s,e),a.updater=ki,t.stateNode=a,a._reactInternalFiber=t,Ci(t,r,e,n),t=jo(null,t,r,!0,i,n)}else t.tag=0,Lo(null,t,a,n),t=t.child;return t;case 16:e:{if(a=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(a),1!==a._status)throw a._result;switch(a=a._result,t.type=a,i=t.tag=function(e){if("function"===typeof e)return Vu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===ue)return 11;if(e===he)return 14}return 2}(a),e=ei(a,e),i){case 0:t=Vo(null,t,a,e,n);break e;case 1:t=Go(null,t,a,e,n);break e;case 11:t=zo(null,t,a,e,n);break e;case 14:t=Bo(null,t,a,ei(a.type,e),r,n);break e}throw Error(o(306,a,""))}return t;case 0:return r=t.type,a=t.pendingProps,Vo(e,t,r,a=t.elementType===r?a:ei(r,a),n);case 1:return r=t.type,a=t.pendingProps,Go(e,t,r,a=t.elementType===r?a:ei(r,a),n);case 3:if(Ho(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,a=null!==(a=t.memoizedState)?a.element:null,pi(e,t),vi(t,r,null,n),(r=t.memoizedState.element)===a)Do(),t=ts(e,t,n);else{if((a=t.stateNode.hydrate)&&(No=Nn(t.stateNode.containerInfo.firstChild),To=t,a=Eo=!0),a)for(n=_i(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Lo(e,t,r,n),Do();t=t.child}return t;case 5:return Bi(t),null===e&&_o(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,s=a.children,In(r,a)?s=null:null!==i&&In(r,i)&&(t.effectTag|=16),Wo(e,t),4&t.mode&&1!==n&&a.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Lo(e,t,s,n),t=t.child),t;case 6:return null===e&&_o(t),null;case 13:return Qo(e,t,n);case 4:return Li(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ai(t,null,r,n):Lo(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,zo(e,t,r,a=t.elementType===r?a:ei(r,a),n);case 7:return Lo(e,t,t.pendingProps,n),t.child;case 8:case 12:return Lo(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,a=t.pendingProps,s=t.memoizedProps,i=a.value;var u=t.type._context;if(ma(ti,u._currentValue),u._currentValue=i,null!==s)if(u=s.value,0===(i=Gr(u,i)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,i):1073741823))){if(s.children===a.children&&!ya.current){t=ts(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){s=u.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&i)){1===u.tag&&((l=di(n,null)).tag=2,fi(u,l)),u.expirationTime<n&&(u.expirationTime=n),null!==(l=u.alternate)&&l.expirationTime<n&&(l.expirationTime=n),si(u.return,n),c.expirationTime<n&&(c.expirationTime=n);break}l=l.next}}else s=10===u.tag&&u.type===t.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===t){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}Lo(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=(i=t.pendingProps).children,ui(t,n),r=r(a=ci(a,i.unstable_observedBits)),t.effectTag|=1,Lo(e,t,r,n),t.child;case 14:return i=ei(a=t.type,t.pendingProps),Bo(e,t,a,i=ei(a.type,i),r,n);case 15:return Uo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ei(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,ka(r)?(e=!0,Ca(t)):e=!1,ui(t,n),Si(t,r,a),Ci(t,r,a,n),jo(null,t,r,!0,e,n);case 19:return es(e,t,n)}throw Error(o(156,t.tag))};var zu=null,Bu=null;function Uu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Wu(e,t,n,r){return new Uu(e,t,n,r)}function Vu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gu(e,t){var n=e.alternate;return null===n?((n=Wu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ju(e,t,n,r,a,i){var s=2;if(r=e,"function"===typeof e)Vu(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case ne:return Hu(n.children,a,i,t);case se:s=8,a|=7;break;case re:s=8,a|=1;break;case ae:return(e=Wu(12,n,t,8|a)).elementType=ae,e.type=ae,e.expirationTime=i,e;case ce:return(e=Wu(13,n,t,a)).type=ce,e.elementType=ce,e.expirationTime=i,e;case le:return(e=Wu(19,n,t,a)).elementType=le,e.expirationTime=i,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case ie:s=10;break e;case oe:s=9;break e;case ue:s=11;break e;case he:s=14;break e;case pe:s=16,r=null;break e;case de:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Wu(s,n,t,a)).elementType=e,t.type=r,t.expirationTime=i,t}function Hu(e,t,n,r){return(e=Wu(7,e,r,t)).expirationTime=n,e}function Zu(e,t,n){return(e=Wu(6,e,null,t)).expirationTime=n,e}function Ku(e,t,n){return(t=Wu(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qu(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Xu(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Yu(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Qu(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Ju(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function $u(e,t,n,r){var a=t.current,i=cu(),s=yi.suspense;i=lu(i,a,s);e:if(n){t:{if(et(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(o(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(ka(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(o(171))}if(1===n.tag){var c=n.type;if(ka(c)){n=Ia(n,c,u);break e}}n=u}else n=va;return null===t.context?t.context=n:t.pendingContext=n,(t=di(i,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),fi(a,t),hu(a,i),i}function ec(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function tc(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function nc(e,t){tc(e,t),(e=e.alternate)&&tc(e,t)}function rc(e,t,n){var r=new qu(e,t,n=null!=n&&!0===n.hydrate),a=Wu(3,null,null,2===t?7:1===t?3:0);r.current=a,a.stateNode=r,hi(a),e[On]=r.current,n&&0!==t&&function(e,t){var n=$e(t);Nt.forEach((function(e){mt(e,t,n)})),Et.forEach((function(e){mt(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function ac(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ic(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i._internalRoot;if("function"===typeof a){var s=a;a=function(){var e=ec(o);s.call(e)}}$u(t,o,e,a)}else{if(i=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new rc(e,0,t?{hydrate:!0}:void 0)}(n,r),o=i._internalRoot,"function"===typeof a){var u=a;a=function(){var e=ec(o);u.call(e)}}yu((function(){$u(t,o,e,a)}))}return ec(o)}function oc(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ac(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}rc.prototype.render=function(e){$u(e,this._internalRoot,null,null)},rc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;$u(null,e,null,(function(){t[On]=null}))},vt=function(e){if(13===e.tag){var t=$a(cu(),150,100);hu(e,t),nc(e,t)}},gt=function(e){13===e.tag&&(hu(e,3),nc(e,3))},yt=function(e){if(13===e.tag){var t=cu();hu(e,t=lu(t,e,null)),nc(e,t)}},E=function(e,t,n){switch(t){case"input":if(Ce(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=Pn(r);if(!a)throw Error(o(90));ke(r),Ce(r,a)}}}break;case"textarea":Oe(e,n);break;case"select":null!=(t=n.value)&&Re(e,!!n.multiple,t,!1)}},D=gu,M=function(e,t,n,r,a){var i=Bs;Bs|=4;try{return qa(98,e.bind(null,t,n,r,a))}finally{(Bs=i)===Rs&&Qa()}},P=function(){(Bs&(1|_s|Os))===Rs&&(function(){if(null!==iu){var e=iu;iu=null,e.forEach((function(e,t){Ju(t,e),fu(t)})),Qa()}}(),Ou())},L=function(e,t){var n=Bs;Bs|=2;try{return e(t)}finally{(Bs=n)===Rs&&Qa()}};var sc={Events:[Dn,Mn,Pn,T,S,Gn,function(e){it(e,Vn)},O,F,Jt,ut,Ou,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);zu=function(e){try{t.onCommitFiberRoot(n,e,void 0,64===(64&e.current.effectTag))}catch(r){}},Bu=function(e){try{t.onCommitFiberUnmount(n,e)}catch(r){}}}catch(r){}})(a({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:Fn,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sc,t.createPortal=oc,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=rt(t))?null:e.stateNode},t.flushSync=function(e,t){if((Bs&(_s|Os))!==Rs)throw Error(o(187));var n=Bs;Bs|=1;try{return qa(99,e.bind(null,t))}finally{Bs=n,Qa()}},t.hydrate=function(e,t,n){if(!ac(t))throw Error(o(200));return ic(null,e,t,!0,n)},t.render=function(e,t,n){if(!ac(t))throw Error(o(200));return ic(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!ac(e))throw Error(o(40));return!!e._reactRootContainer&&(yu((function(){ic(null,null,e,!1,(function(){e._reactRootContainer=null,e[On]=null}))})),!0)},t.unstable_batchedUpdates=gu,t.unstable_createPortal=function(e,t){return oc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ac(n))throw Error(o(200));if(null==e||void 0===e._reactInternalFiber)throw Error(o(38));return ic(e,t,n,!1,r)},t.version="16.14.0"},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},2025:function(e,t,n){"use strict";function r(e){return e&&"object"===typeof e&&"default"in e?e.default:e}var a=n(9271),i=r(n(2791)),o=n(2610),s=r(n(2007)),u=r(n(5501)),c=r(n(90));function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function p(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var d=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).history=o.createBrowserHistory(t.props),t}return h(t,e),t.prototype.render=function(){return i.createElement(a.Router,{history:this.history,children:this.props.children})},t}(i.Component);d.propTypes={basename:s.string,children:s.node,forceRefresh:s.bool,getUserConfirmation:s.func,keyLength:s.number},d.prototype.componentDidMount=function(){u(!this.props.history,"<BrowserRouter> ignores the history prop. To use a custom history, use `import { Router }` instead of `import { BrowserRouter as Router }`.")};var f=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).history=o.createHashHistory(t.props),t}return h(t,e),t.prototype.render=function(){return i.createElement(a.Router,{history:this.history,children:this.props.children})},t}(i.Component);f.propTypes={basename:s.string,children:s.node,getUserConfirmation:s.func,hashType:s.oneOf(["hashbang","noslash","slash"])},f.prototype.componentDidMount=function(){u(!this.props.history,"<HashRouter> ignores the history prop. To use a custom history, use `import { Router }` instead of `import { HashRouter as Router }`.")};var m=function(e,t){return"function"===typeof e?e(t):e},v=function(e,t){return"string"===typeof e?o.createLocation(e,null,null,t):e},g=function(e){return e},y=i.forwardRef;"undefined"===typeof y&&(y=g);var b=y((function(e,t){var n=e.innerRef,r=e.navigate,a=e.onClick,o=p(e,["innerRef","navigate","onClick"]),s=o.target,u=l({},o,{onClick:function(e){try{a&&a(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||s&&"_self"!==s||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)||(e.preventDefault(),r())}});return u.ref=g!==y&&t||n,i.createElement("a",u)}));b.displayName="LinkAnchor";var x=y((function(e,t){var n=e.component,r=void 0===n?b:n,o=e.replace,s=e.to,u=e.innerRef,h=p(e,["component","replace","to","innerRef"]);return i.createElement(a.__RouterContext.Consumer,null,(function(e){e||c(!1,"You should not use <Link> outside a <Router>");var n=e.history,a=v(m(s,e.location),e.location),p=a?n.createHref(a):"",d=l({},h,{href:p,navigate:function(){var t=m(s,e.location);(o?n.replace:n.push)(t)}});return g!==y?d.ref=t||u:d.innerRef=u,i.createElement(r,d)}))})),k=s.oneOfType([s.string,s.object,s.func]),w=s.oneOfType([s.string,s.func,s.shape({current:s.any})]);x.displayName="Link",x.propTypes={innerRef:w,onClick:s.func,replace:s.bool,target:s.string,to:k.isRequired};var S=function(e){return e},I=i.forwardRef;"undefined"===typeof I&&(I=S);var C=I((function(e,t){var n=e["aria-current"],r=void 0===n?"page":n,o=e.activeClassName,s=void 0===o?"active":o,u=e.activeStyle,h=e.className,d=e.exact,f=e.isActive,g=e.location,y=e.sensitive,b=e.strict,k=e.style,w=e.to,C=e.innerRef,T=p(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return i.createElement(a.__RouterContext.Consumer,null,(function(e){e||c(!1,"You should not use <NavLink> outside a <Router>");var n=g||e.location,o=v(m(w,n),n),p=o.pathname,N=p&&p.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),E=N?a.matchPath(n.pathname,{path:N,exact:d,sensitive:y,strict:b}):null,R=!!(f?f(E,n):E),A=R?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")}(h,s):h,_=R?l({},k,{},u):k,O=l({"aria-current":R&&r||null,className:A,style:_,to:o},T);return S!==I?O.ref=t||C:O.innerRef=C,i.createElement(x,O)}))}));C.displayName="NavLink";var T=s.oneOf(["page","step","location","date","time","true"]);C.propTypes=l({},x.propTypes,{"aria-current":T,activeClassName:s.string,activeStyle:s.object,className:s.string,exact:s.bool,isActive:s.func,location:s.object,sensitive:s.bool,strict:s.bool,style:s.object}),Object.defineProperty(t,"k6",{enumerable:!0,get:function(){return a.useHistory}})},9271:function(e,t,n){"use strict";n.r(t),n.d(t,{MemoryRouter:function(){return I},Prompt:function(){return T},Redirect:function(){return _},Route:function(){return P},Router:function(){return S},StaticRouter:function(){return V},Switch:function(){return G},__HistoryContext:function(){return x},__RouterContext:function(){return w},generatePath:function(){return A},matchPath:function(){return M},useHistory:function(){return Z},useLocation:function(){return K},useParams:function(){return q},useRouteMatch:function(){return X},withRouter:function(){return j}});var r=n(4578),a=n(2791),i=n(2610),o=n(2007),s=n.n(o),u=1073741823,c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{};var l=a.createContext||function(e,t){var n,i,o="__create-react-context-"+function(){var e="__global_unique_id__";return c[e]=(c[e]||0)+1}()+"__",l=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).emitter=function(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter((function(t){return t!==e}))},get:function(){return e},set:function(n,r){e=n,t.forEach((function(t){return t(e,r)}))}}}(t.props.value),t}(0,r.Z)(n,e);var a=n.prototype;return a.getChildContext=function(){var e;return(e={})[o]=this.emitter,e},a.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var n,r=this.props.value,a=e.value;((i=r)===(o=a)?0!==i||1/i===1/o:i!==i&&o!==o)?n=0:(n="function"===typeof t?t(r,a):u,0!==(n|=0)&&this.emitter.set(e.value,n))}var i,o},a.render=function(){return this.props.children},n}(a.Component);l.childContextTypes=((n={})[o]=s().object.isRequired,n);var h=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).state={value:e.getValue()},e.onUpdate=function(t,n){0!==((0|e.observedBits)&n)&&e.setState({value:e.getValue()})},e}(0,r.Z)(n,t);var a=n.prototype;return a.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=void 0===t||null===t?u:t},a.componentDidMount=function(){this.context[o]&&this.context[o].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=void 0===e||null===e?u:e},a.componentWillUnmount=function(){this.context[o]&&this.context[o].off(this.onUpdate)},a.getValue=function(){return this.context[o]?this.context[o].get():e},a.render=function(){return(e=this.props.children,Array.isArray(e)?e[0]:e)(this.state.value);var e},n}(a.Component);return h.contextTypes=((i={})[o]=s().object,i),{Provider:l,Consumer:h}},h=l,p=n(4554),d=n(7462),f=n(6151),m=n.n(f),v=(n(8228),n(3366)),g=n(2110),y=n.n(g),b=function(e){var t=h();return t.displayName=e,t},x=b("Router-History"),k=function(e){var t=h();return t.displayName=e,t},w=k("Router"),S=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={location:t.history.location},n._isMounted=!1,n._pendingLocation=null,t.staticContext||(n.unlisten=t.history.listen((function(e){n._isMounted?n.setState({location:e}):n._pendingLocation=e}))),n}(0,r.Z)(t,e),t.computeRootMatch=function(e){return{path:"/",url:"/",params:{},isExact:"/"===e}};var n=t.prototype;return n.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},n.componentWillUnmount=function(){this.unlisten&&this.unlisten()},n.render=function(){return a.createElement(w.Provider,{value:{history:this.props.history,location:this.state.location,match:t.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},a.createElement(x.Provider,{children:this.props.children||null,value:this.props.history}))},t}(a.Component);var I=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).history=(0,i.createMemoryHistory)(t.props),t}return(0,r.Z)(t,e),t.prototype.render=function(){return a.createElement(S,{history:this.history,children:this.props.children})},t}(a.Component);var C=function(e){function t(){return e.apply(this,arguments)||this}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.onMount&&this.props.onMount.call(this,this)},n.componentDidUpdate=function(e){this.props.onUpdate&&this.props.onUpdate.call(this,this,e)},n.componentWillUnmount=function(){this.props.onUnmount&&this.props.onUnmount.call(this,this)},n.render=function(){return null},t}(a.Component);function T(e){var t=e.message,n=e.when,r=void 0===n||n;return a.createElement(w.Consumer,null,(function(e){if(e||(0,p.Z)(!1),!r||e.staticContext)return null;var n=e.history.block;return a.createElement(C,{onMount:function(e){e.release=n(t)},onUpdate:function(e,r){r.message!==t&&(e.release(),e.release=n(t))},onUnmount:function(e){e.release()},message:t})}))}var N={},E=1e4,R=0;function A(e,t){return void 0===e&&(e="/"),void 0===t&&(t={}),"/"===e?e:function(e){if(N[e])return N[e];var t=m().compile(e);return R<E&&(N[e]=t,R++),t}(e)(t,{pretty:!0})}function _(e){var t=e.computedMatch,n=e.to,r=e.push,o=void 0!==r&&r;return a.createElement(w.Consumer,null,(function(e){e||(0,p.Z)(!1);var r=e.history,s=e.staticContext,u=o?r.push:r.replace,c=(0,i.createLocation)(t?"string"===typeof n?A(n,t.params):(0,d.Z)({},n,{pathname:A(n.pathname,t.params)}):n);return s?(u(c),null):a.createElement(C,{onMount:function(){u(c)},onUpdate:function(e,t){var n=(0,i.createLocation)(t.to);(0,i.locationsAreEqual)(n,(0,d.Z)({},c,{key:n.key}))||u(c)},to:n})}))}var O={},F=1e4,D=0;function M(e,t){void 0===t&&(t={}),("string"===typeof t||Array.isArray(t))&&(t={path:t});var n=t,r=n.path,a=n.exact,i=void 0!==a&&a,o=n.strict,s=void 0!==o&&o,u=n.sensitive,c=void 0!==u&&u;return[].concat(r).reduce((function(t,n){if(!n&&""!==n)return null;if(t)return t;var r=function(e,t){var n=""+t.end+t.strict+t.sensitive,r=O[n]||(O[n]={});if(r[e])return r[e];var a=[],i={regexp:m()(e,a,t),keys:a};return D<F&&(r[e]=i,D++),i}(n,{end:i,strict:s,sensitive:c}),a=r.regexp,o=r.keys,u=a.exec(e);if(!u)return null;var l=u[0],h=u.slice(1),p=e===l;return i&&!p?null:{path:n,url:"/"===n&&""===l?"/":l,isExact:p,params:o.reduce((function(e,t,n){return e[t.name]=h[n],e}),{})}}),null)}var P=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.render=function(){var e=this;return a.createElement(w.Consumer,null,(function(t){t||(0,p.Z)(!1);var n=e.props.location||t.location,r=e.props.computedMatch?e.props.computedMatch:e.props.path?M(n.pathname,e.props):t.match,i=(0,d.Z)({},t,{location:n,match:r}),o=e.props,s=o.children,u=o.component,c=o.render;return Array.isArray(s)&&0===s.length&&(s=null),a.createElement(w.Provider,{value:i},i.match?s?"function"===typeof s?s(i):s:u?a.createElement(u,i):c?c(i):null:"function"===typeof s?s(i):null)}))},t}(a.Component);function L(e){return"/"===e.charAt(0)?e:"/"+e}function z(e,t){if(!e)return t;var n=L(e);return 0!==t.pathname.indexOf(n)?t:(0,d.Z)({},t,{pathname:t.pathname.substr(n.length)})}function B(e){return"string"===typeof e?e:(0,i.createPath)(e)}function U(e){return function(){(0,p.Z)(!1)}}function W(){}var V=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).handlePush=function(e){return t.navigateTo(e,"PUSH")},t.handleReplace=function(e){return t.navigateTo(e,"REPLACE")},t.handleListen=function(){return W},t.handleBlock=function(){return W},t}(0,r.Z)(t,e);var n=t.prototype;return n.navigateTo=function(e,t){var n=this.props,r=n.basename,a=void 0===r?"":r,o=n.context,s=void 0===o?{}:o;s.action=t,s.location=function(e,t){return e?(0,d.Z)({},t,{pathname:L(e)+t.pathname}):t}(a,(0,i.createLocation)(e)),s.url=B(s.location)},n.render=function(){var e=this.props,t=e.basename,n=void 0===t?"":t,r=e.context,o=void 0===r?{}:r,s=e.location,u=void 0===s?"/":s,c=(0,v.Z)(e,["basename","context","location"]),l={createHref:function(e){return L(n+B(e))},action:"POP",location:z(n,(0,i.createLocation)(u)),push:this.handlePush,replace:this.handleReplace,go:U(),goBack:U(),goForward:U(),listen:this.handleListen,block:this.handleBlock};return a.createElement(S,(0,d.Z)({},c,{history:l,staticContext:o}))},t}(a.Component);var G=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.render=function(){var e=this;return a.createElement(w.Consumer,null,(function(t){t||(0,p.Z)(!1);var n,r,i=e.props.location||t.location;return a.Children.forEach(e.props.children,(function(e){if(null==r&&a.isValidElement(e)){n=e;var o=e.props.path||e.props.from;r=o?M(i.pathname,(0,d.Z)({},e.props,{path:o})):t.match}})),r?a.cloneElement(n,{location:i,computedMatch:r}):null}))},t}(a.Component);function j(e){var t="withRouter("+(e.displayName||e.name)+")",n=function(t){var n=t.wrappedComponentRef,r=(0,v.Z)(t,["wrappedComponentRef"]);return a.createElement(w.Consumer,null,(function(t){return t||(0,p.Z)(!1),a.createElement(e,(0,d.Z)({},r,t,{ref:n}))}))};return n.displayName=t,n.WrappedComponent=e,y()(n,e)}var H=a.useContext;function Z(){return H(x)}function K(){return H(w).location}function q(){var e=H(w).match;return e?e.params:{}}function X(e){var t=K(),n=H(w).match;return e?M(t.pathname,e):n}},9195:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,d=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function k(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case h:case i:case s:case o:case d:return e;default:switch(e=e&&e.$$typeof){case c:case p:case v:case m:case u:return e;default:return t}}case a:return t}}}function w(e){return k(e)===h}},8228:function(e,t,n){"use strict";n(9195)},97:function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,r){t.call(navigator,e,n,r)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.unmounted=!1,n.state={hasUserMedia:!1},n}return a(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;s()?e.hasUserMedia||this.requestUserMedia():t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),a=e.minScreenshotWidth!==t.minScreenshotWidth,i=e.minScreenshotHeight!==t.minScreenshotHeight;(r||a||i)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().map((function(t){e.removeTrack(t),t.stop()}))):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var r=this.getCanvas(e);return r&&r.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=this.video.videoWidth,a=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var i=r/a;a=(r=n.minScreenshotWidth||this.video.clientWidth)/i,n.minScreenshotHeight&&a<n.minScreenshotHeight&&(r=(a=n.minScreenshotHeight)*i)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||r,this.canvas.height=(null===e||void 0===e?void 0:e.height)||a,this.ctx=this.canvas.getContext("2d")}var o=this.ctx,s=this.canvas;return o&&s&&(n.mirrored&&(o.translate(s.width,0),o.scale(-1,1)),o.imageSmoothingEnabled=n.imageSmoothing,o.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||s.width,(null===e||void 0===e?void 0:e.height)||s.height),n.mirrored&&(o.scale(-1,1),o.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,n=this.props,r=function(r,a){var i={video:"undefined"===typeof a||a};n.audio&&(i.audio="undefined"===typeof r||r),navigator.mediaDevices.getUserMedia(i).then((function(n){e.unmounted?t.stopMediaStream(n):e.handleUserMedia(null,n)})).catch((function(t){e.handleUserMedia(t)}))};if("mediaDevices"in navigator)r(n.audioConstraints,n.videoConstraints);else{var a=function(e){return{optional:[{sourceId:e}]}},i=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources((function(e){var t=null,o=null;e.forEach((function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(o=e.id)}));var s=i(n.audioConstraints);s&&(t=s);var u=i(n.videoConstraints);u&&(o=u),r(a(t),a(o))}))}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(r){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,a=n.audio,s=(n.forceScreenshotSourceSize,n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),u=n.style,c=void 0===u?{}:u,l=o(n,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style"]),h=s?i(i({},c),{transform:(c.transform||"")+" scaleX(-1)"}):c;return r.createElement("video",i({autoPlay:!0,src:t.src,muted:a,playsInline:!0,ref:function(t){e.video=t},style:h},l))},t.defaultProps={audio:!0,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=u},react:function(t,n){t.exports=e}}).default},e.exports=r(n(2791))},6374:function(e,t,n){"use strict";var r=n(2791),a=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var i=Symbol.for;a=i("react.element"),t.Fragment=i("react.fragment")}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:o.current}}t.jsx=c,t.jsxs=c},9117:function(e,t,n){"use strict";var r=n(1725),a="function"===typeof Symbol&&Symbol.for,i=a?Symbol.for("react.element"):60103,o=a?Symbol.for("react.portal"):60106,s=a?Symbol.for("react.fragment"):60107,u=a?Symbol.for("react.strict_mode"):60108,c=a?Symbol.for("react.profiler"):60114,l=a?Symbol.for("react.provider"):60109,h=a?Symbol.for("react.context"):60110,p=a?Symbol.for("react.forward_ref"):60112,d=a?Symbol.for("react.suspense"):60113,f=a?Symbol.for("react.memo"):60115,m=a?Symbol.for("react.lazy"):60116,v="function"===typeof Symbol&&Symbol.iterator;function g(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function x(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||y}function k(){}function w(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||y}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(g(85));this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=x.prototype;var S=w.prototype=new k;S.constructor=w,r(S,x.prototype),S.isPureReactComponent=!0;var I={current:null},C=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,n){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,r)&&!T.hasOwnProperty(r)&&(a[r]=t[r]);var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];a.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===a[r]&&(a[r]=u[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:I.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var R=/\/+/g,A=[];function _(e,t,n,r){if(A.length){var a=A.pop();return a.result=e,a.keyPrefix=t,a.func=n,a.context=r,a.count=0,a}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function O(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>A.length&&A.push(e)}function F(e,t,n,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var s=!1;if(null===e)s=!0;else switch(a){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case i:case o:s=!0}}if(s)return n(r,e,""===t?"."+M(e,0):t),1;if(s=0,t=""===t?".":t+":",Array.isArray(e))for(var u=0;u<e.length;u++){var c=t+M(a=e[u],u);s+=F(a,c,n,r)}else if(null===e||"object"!==typeof e?c=null:c="function"===typeof(c=v&&e[v]||e["@@iterator"])?c:null,"function"===typeof c)for(e=c.call(e),u=0;!(a=e.next()).done;)s+=F(a=a.value,c=t+M(a,u++),n,r);else if("object"===a)throw n=""+e,Error(g(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return s}function D(e,t,n){return null==e?0:F(e,"",t,n)}function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function P(e,t){e.func.call(e.context,t,e.count++)}function L(e,t,n){var r=e.result,a=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?z(e,r,n,(function(e){return e})):null!=e&&(E(e)&&(e=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,a+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(R,"$&/")+"/")+n)),r.push(e))}function z(e,t,n,r,a){var i="";null!=n&&(i=(""+n).replace(R,"$&/")+"/"),D(e,L,t=_(t,i,r,a)),O(t)}var B={current:null};function U(){var e=B.current;if(null===e)throw Error(g(321));return e}var W={ReactCurrentDispatcher:B,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:I,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return z(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;D(e,P,t=_(null,null,t,n)),O(t)},count:function(e){return D(e,(function(){return null}),null)},toArray:function(e){var t=[];return z(e,t,null,(function(e){return e})),t},only:function(e){if(!E(e))throw Error(g(143));return e}},t.Component=x,t.Fragment=s,t.Profiler=c,t.PureComponent=w,t.StrictMode=u,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(g(267,e));var a=r({},e.props),o=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=I.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)C.call(t,l)&&!T.hasOwnProperty(l)&&(a[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){c=Array(l);for(var h=0;h<l;h++)c[h]=arguments[h+2];a.children=c}return{$$typeof:i,type:e.type,key:o,ref:s,props:a,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:h,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=N,t.createFactory=function(e){var t=N.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:p,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return U().useCallback(e,t)},t.useContext=function(e,t){return U().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return U().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return U().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return U().useLayoutEffect(e,t)},t.useMemo=function(e,t){return U().useMemo(e,t)},t.useReducer=function(e,t,n){return U().useReducer(e,t,n)},t.useRef=function(e){return U().useRef(e)},t.useState=function(e){return U().useState(e)},t.version="16.14.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";var n,r,a,i,o;if("undefined"===typeof window||"function"!==typeof MessageChannel){var s=null,u=null,c=function e(){if(null!==s)try{var n=t.unstable_now();s(!0,n),s=null}catch(r){throw setTimeout(e,0),r}},l=Date.now();t.unstable_now=function(){return Date.now()-l},n=function(e){null!==s?setTimeout(n,0,e):(s=e,setTimeout(c,0))},r=function(e,t){u=setTimeout(e,t)},a=function(){clearTimeout(u)},i=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var h=window.performance,p=window.Date,d=window.setTimeout,f=window.clearTimeout;if("undefined"!==typeof console){var m=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof h&&"function"===typeof h.now)t.unstable_now=function(){return h.now()};else{var v=p.now();t.unstable_now=function(){return p.now()-v}}var g=!1,y=null,b=-1,x=5,k=0;i=function(){return t.unstable_now()>=k},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):x=0<e?Math.floor(1e3/e):5};var w=new MessageChannel,S=w.port2;w.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();k=e+x;try{y(!0,e)?S.postMessage(null):(g=!1,y=null)}catch(n){throw S.postMessage(null),n}}else g=!1},n=function(e){y=e,g||(g=!0,S.postMessage(null))},r=function(e,n){b=d((function(){e(t.unstable_now())}),n)},a=function(){f(b),b=-1}}function I(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,a=e[r];if(!(void 0!==a&&0<N(a,t)))break e;e[r]=t,e[n]=a,n=r}}function C(e){return void 0===(e=e[0])?null:e}function T(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length;r<a;){var i=2*(r+1)-1,o=e[i],s=i+1,u=e[s];if(void 0!==o&&0>N(o,n))void 0!==u&&0>N(u,o)?(e[r]=u,e[s]=n,r=s):(e[r]=o,e[i]=n,r=i);else{if(!(void 0!==u&&0>N(u,n)))break e;e[r]=u,e[s]=n,r=s}}}return t}return null}function N(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var E=[],R=[],A=1,_=null,O=3,F=!1,D=!1,M=!1;function P(e){for(var t=C(R);null!==t;){if(null===t.callback)T(R);else{if(!(t.startTime<=e))break;T(R),t.sortIndex=t.expirationTime,I(E,t)}t=C(R)}}function L(e){if(M=!1,P(e),!D)if(null!==C(E))D=!0,n(z);else{var t=C(R);null!==t&&r(L,t.startTime-e)}}function z(e,n){D=!1,M&&(M=!1,a()),F=!0;var o=O;try{for(P(n),_=C(E);null!==_&&(!(_.expirationTime>n)||e&&!i());){var s=_.callback;if(null!==s){_.callback=null,O=_.priorityLevel;var u=s(_.expirationTime<=n);n=t.unstable_now(),"function"===typeof u?_.callback=u:_===C(E)&&T(E),P(n)}else T(E);_=C(E)}if(null!==_)var c=!0;else{var l=C(R);null!==l&&r(L,l.startTime-n),c=!1}return c}finally{_=null,O=o,F=!1}}function B(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var U=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){D||F||(D=!0,n(z))},t.unstable_getCurrentPriorityLevel=function(){return O},t.unstable_getFirstCallbackNode=function(){return C(E)},t.unstable_next=function(e){switch(O){case 1:case 2:case 3:var t=3;break;default:t=O}var n=O;O=t;try{return e()}finally{O=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=O;O=e;try{return t()}finally{O=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();if("object"===typeof o&&null!==o){var u=o.delay;u="number"===typeof u&&0<u?s+u:s,o="number"===typeof o.timeout?o.timeout:B(e)}else o=B(e),u=s;return e={id:A++,callback:i,priorityLevel:e,startTime:u,expirationTime:o=u+o,sortIndex:-1},u>s?(e.sortIndex=u,I(R,e),null===C(E)&&e===C(R)&&(M?a():M=!0,r(L,u-s))):(e.sortIndex=o,I(E,e),D||F||(D=!0,n(z))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();P(e);var n=C(E);return n!==_&&null!==_&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<_.expirationTime||i()},t.unstable_wrapCallback=function(e){var t=O;return function(){var n=O;O=t;try{return e.apply(this,arguments)}finally{O=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},6699:function(e,t,n){var r=n(2501),a=n(9112),i=n(2132),o=n(890),s=n(4113),u=n(1350),c=n(3411);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},2501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},1350:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},9112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},4113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},2132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},3411:function(e,t,n){var r;!function(a,i,o){var s,u=256,c=o.pow(u,6),l=o.pow(2,52),h=2*l,p=u-1;function d(e,t,n){var r=[],p=g(v((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,y(i)]}}():e,3),r),d=new f(r),b=function(){for(var e=d.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=d.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|d.g(4)},b.quick=function(){return d.g(4)/4294967296},b.double=b,g(y(d.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,d),e.state=function(){return m(d,{})}),n?(o.random=e,t):e})(b,p,"global"in t?t.global:this==o,t.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=p&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=p&a+1],n=n*u+o[p&(o[a]=o[i=p&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(v(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[p&a]=p&(n^=19*t[p&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(o.random(),i),e.exports){e.exports=d;try{s=n(5042)}catch(b){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},90:function(e){"use strict";var t="Invariant failed";e.exports=function(e,n){if(!e)throw new Error(t)}},5501:function(e,t,n){"use strict";n.r(t);t.default=function(e,t){}},5410:function(){},8628:function(){},6759:function(){},549:function(){},6401:function(){},5042:function(){},4836:function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},907:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},4942:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9142);function a(e,t,n){return(t=(0,r.Z)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},7462:function(e,t,n){"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}n.d(t,{Z:function(){return r}})},4578:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9611);function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,r.Z)(e,t)}},3366:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}n.d(t,{Z:function(){return r}})},9611:function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,{Z:function(){return r}})},885:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(181);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(l){c=!0,a=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(e,t)||(0,r.Z)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},2982:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(907);var a=n(181);function i(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,a.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},9142:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(1002);function a(e){var t=function(e,t){if("object"!==(0,r.Z)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==(0,r.Z)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===(0,r.Z)(t)?t:String(t)}},1002:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{Z:function(){return r}})},181:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"===typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}},4554:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=!0,a="Invariant failed";function i(e,t){if(!e){if(r)throw new Error(a);var n="function"===typeof t?t():t,i=n?"".concat(a,": ").concat(n):a;throw new Error(i)}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){o[e]=function(){return r[e]}}));return o.default=function(){return r},n.d(i,o),i}}(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".cda612ba.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="frontend:";n.l=function(r,a,i,o){if(e[r])e[r].push(a);else{var s,u;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var h=c[l];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+i){s=h;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=r),e[r]=[a];var p=function(t,n){s.onerror=s.onload=null,clearTimeout(d);var a=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((function(e){return e(n)})),t)return t(n)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/",function(){var e={179:0};n.f.j=function(t,r){var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var i=new Promise((function(n,r){a=e[t]=[n,r]}));r.push(a[2]=i);var o=n.p+n.u(t),s=new Error;n.l(o,(function(r){if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,a[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var a,i,o=r[0],s=r[1],u=r[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(u)u(n)}for(t&&t(r);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkfrontend=self.webpackChunkfrontend||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){"use strict";var e={};n.r(e),n.d(e,{CompositeArrayBuffer:function(){return Ps},browserFiles:function(){return Dc},browserHTTPRequest:function(){return Zc},concatenateArrayBuffers:function(){return Zs},copyModel:function(){return Pu},decodeWeights:function(){return Us},encodeWeights:function(){return zs},fromMemory:function(){return Qc},fromMemorySync:function(){return Jc},getLoadHandlers:function(){return iu},getModelArtifactsForJSON:function(){return Ys},getModelArtifactsForJSONSync:function(){return Xs},getModelArtifactsInfoForJSON:function(){return Js},getSaveHandlers:function(){return au},getWeightSpecs:function(){return $s},http:function(){return Hc},isHTTPScheme:function(){return Gc},listModels:function(){return Ou},loadWeights:function(){return zc},moveModel:function(){return zu},registerLoadRouter:function(){return ru},registerSaveRouter:function(){return nu},removeModel:function(){return Du},weightsLoaderFactory:function(){return Uc},withSaveHandler:function(){return $c},withSaveHandlerSync:function(){return el}});var t={};n.r(t),n.d(t,{conv2d:function(){return _f},depthwiseConv2d:function(){return Df},matMul:function(){return Mf}});var r={};n.r(r),n.d(r,{json:function(){return xI}});var a={};n.r(a),n.d(a,{json:function(){return kI}});var i={};n.r(i),n.d(i,{json:function(){return wI}});var o={};n.r(o),n.d(o,{json:function(){return SI}});var s={};n.r(s),n.d(s,{json:function(){return II}});var u={};n.r(u),n.d(u,{json:function(){return CI}});var c={};n.r(c),n.d(c,{json:function(){return TI}});var l={};n.r(l),n.d(l,{json:function(){return NI}});var h={};n.r(h),n.d(h,{json:function(){return EI}});var p={};n.r(p),n.d(p,{json:function(){return RI}});var d={};n.r(d),n.d(d,{json:function(){return AI}});var f={};n.r(f),n.d(f,{json:function(){return _I}});var m={};n.r(m),n.d(m,{json:function(){return OI}});var v={};n.r(v),n.d(v,{json:function(){return FI}});var g={};n.r(g),n.d(g,{json:function(){return DI}});var y={};n.r(y),n.d(y,{json:function(){return MI}});var b={};n.r(b),n.d(b,{json:function(){return PI}});var x={};n.r(x),n.d(x,{json:function(){return LI}});var k={};n.r(k),n.d(k,{json:function(){return zI}});var w={};n.r(w),n.d(w,{OP_SCOPE_SUFFIX:function(){return As},abs:function(){return kc},acos:function(){return gl},acosh:function(){return yl},add:function(){return nc},addN:function(){return bl},all:function(){return xl},any:function(){return kl},argMax:function(){return wl},argMin:function(){return Sl},asin:function(){return Il},asinh:function(){return Cl},atan:function(){return Tl},atan2:function(){return Nl},atanh:function(){return El},avgPool:function(){return Hl},avgPool3d:function(){return Zl},basicLSTMCell:function(){return Jl},batchNorm:function(){return eh},batchNorm2d:function(){return th},batchNorm3d:function(){return nh},batchNorm4d:function(){return rh},batchToSpaceND:function(){return $l},bincount:function(){return ah},bitwiseAnd:function(){return ih},booleanMaskAsync:function(){return mf},broadcastArgs:function(){return oh},broadcastTo:function(){return sh},buffer:function(){return ju},cast:function(){return Hu},ceil:function(){return uh},clipByValue:function(){return ch},clone:function(){return Zu},complex:function(){return Os},concat:function(){return Kl},concat1d:function(){return lh},concat2d:function(){return hh},concat3d:function(){return ph},concat4d:function(){return dh},conv1d:function(){return mh},conv2d:function(){return fh},conv2dTranspose:function(){return gh},conv3d:function(){return yh},conv3dTranspose:function(){return xh},cos:function(){return kh},cosh:function(){return wh},cosineWindow:function(){return Sf},cumprod:function(){return Sh},cumsum:function(){return Ih},denseBincount:function(){return Ch},depthToSpace:function(){return Th},depthwiseConv2d:function(){return Nh},diag:function(){return Eh},dilation2d:function(){return Rh},div:function(){return ac},divNoNan:function(){return Oh},dot:function(){return Fh},dropout:function(){return kf},einsum:function(){return Dh},elu:function(){return Mh},enclosingPowerOfTwo:function(){return wf},ensureShape:function(){return Ph},equal:function(){return Ah},erf:function(){return Lh},euclideanNorm:function(){return Yh},exp:function(){return Qh},expandDims:function(){return Jh},expm1:function(){return $h},eye:function(){return tp},fft:function(){return zd},fill:function(){return vc},floor:function(){return np},floorDiv:function(){return rc},fused:function(){return t},gather:function(){return rp},gatherND:function(){return xf},greater:function(){return ap},greaterEqual:function(){return ip},ifft:function(){return Bd},imag:function(){return op},image:function(){return zm},inTopKAsync:function(){return Cf},irfft:function(){return Ud},isFinite:function(){return sp},isInf:function(){return up},isNaN:function(){return cp},leakyRelu:function(){return lp},less:function(){return hp},lessEqual:function(){return pp},linalg:function(){return Bm},linspace:function(){return dp},localResponseNormalization:function(){return fp},log:function(){return mp},log1p:function(){return vp},logSigmoid:function(){return bp},logSoftmax:function(){return xp},logSumExp:function(){return kp},logicalAnd:function(){return wp},logicalNot:function(){return Sp},logicalOr:function(){return Ip},logicalXor:function(){return Cp},losses:function(){return Um},lowerBound:function(){return Ep},matMul:function(){return ql},max:function(){return Hh},maxPool:function(){return Rp},maxPool3d:function(){return Ap},maxPoolWithArgmax:function(){return _p},maximum:function(){return Cc},mean:function(){return Op},meshgrid:function(){return Mp},min:function(){return Zh},minimum:function(){return Pp},mirrorPad:function(){return Lp},mod:function(){return zp},moments:function(){return Bp},movingAverage:function(){return gf},mul:function(){return ic},multiRNNCell:function(){return Up},multinomial:function(){return Wp},neg:function(){return gp},norm:function(){return Xh},notEqual:function(){return Vp},oneHot:function(){return Gp},ones:function(){return Dp},onesLike:function(){return jp},op:function(){return _s},outerProduct:function(){return Hp},pad:function(){return Zp},pad1d:function(){return Kp},pad2d:function(){return qp},pad3d:function(){return Xp},pad4d:function(){return Yp},pool:function(){return Jp},pow:function(){return yc},prelu:function(){return $p},print:function(){return Ku},prod:function(){return ed},raggedGather:function(){return td},raggedRange:function(){return nd},raggedTensorToTensor:function(){return rd},rand:function(){return ad},randomGamma:function(){return cd},randomNormal:function(){return ld},randomStandardNormal:function(){return hd},randomUniform:function(){return pd},randomUniformInt:function(){return dd},range:function(){return fd},real:function(){return md},reciprocal:function(){return vd},relu:function(){return gd},relu6:function(){return yd},reshape:function(){return jl},reverse:function(){return bd},reverse1d:function(){return xd},reverse2d:function(){return kd},reverse3d:function(){return wd},reverse4d:function(){return Sd},rfft:function(){return Vd},round:function(){return Id},rsqrt:function(){return Cd},scalar:function(){return lc},scatterND:function(){return yf},searchSorted:function(){return Np},selu:function(){return Td},separableConv2d:function(){return Nd},setdiff1dAsync:function(){return Rd},sigmoid:function(){return Xl},sign:function(){return Ad},signal:function(){return Lm},sin:function(){return _d},sinh:function(){return Od},slice:function(){return Yl},slice1d:function(){return Fd},slice2d:function(){return Dd},slice3d:function(){return Md},slice4d:function(){return Pd},softmax:function(){return Ld},softplus:function(){return yp},spaceToBatchND:function(){return Qp},sparse:function(){return Wm},sparseToDense:function(){return bf},spectral:function(){return Pm},split:function(){return Wd},sqrt:function(){return oc},square:function(){return sc},squaredDifference:function(){return Gd},squeeze:function(){return jd},stack:function(){return Hd},step:function(){return Zd},stridedSlice:function(){return Kd},string:function(){return Vm},sub:function(){return bc},sum:function(){return Kh},tan:function(){return qd},tanh:function(){return Ql},tensor:function(){return Ds},tensor1d:function(){return Xd},tensor2d:function(){return Yd},tensor3d:function(){return tl},tensor4d:function(){return Qd},tensor5d:function(){return Jd},tensor6d:function(){return $d},tensorScatterUpdate:function(){return nf},tile:function(){return ep},topk:function(){return rf},transpose:function(){return vf},truncatedNormal:function(){return af},unique:function(){return of},unsortedSegmentSum:function(){return sf},unstack:function(){return uf},upperBound:function(){return cf},variable:function(){return lf},where:function(){return _h},whereAsync:function(){return df},zeros:function(){return Fp},zerosLike:function(){return uc}});var S=n(2791),I=n(4164),C=n(4942);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){(0,C.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=n(885),R=n(9271),A=n(4578),_=n(2610),O=n(7462),F=n(3366),D=n(4554),M=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).history=(0,_.createBrowserHistory)(t.props),t}return(0,A.Z)(t,e),t.prototype.render=function(){return S.createElement(R.Router,{history:this.history,children:this.props.children})},t}(S.Component);S.Component;var P=function(e,t){return"function"===typeof e?e(t):e},L=function(e,t){return"string"===typeof e?(0,_.createLocation)(e,null,null,t):e},z=function(e){return e},B=S.forwardRef;"undefined"===typeof B&&(B=z);var U=B((function(e,t){var n=e.innerRef,r=e.navigate,a=e.onClick,i=(0,F.Z)(e,["innerRef","navigate","onClick"]),o=i.target,s=(0,O.Z)({},i,{onClick:function(e){try{a&&a(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||o&&"_self"!==o||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)||(e.preventDefault(),r())}});return s.ref=z!==B&&t||n,S.createElement("a",s)}));var W=B((function(e,t){var n=e.component,r=void 0===n?U:n,a=e.replace,i=e.to,o=e.innerRef,s=(0,F.Z)(e,["component","replace","to","innerRef"]);return S.createElement(R.__RouterContext.Consumer,null,(function(e){e||(0,D.Z)(!1);var n=e.history,u=L(P(i,e.location),e.location),c=u?n.createHref(u):"",l=(0,O.Z)({},s,{href:c,navigate:function(){var t=P(i,e.location);(a?n.replace:n.push)(t)}});return z!==B?l.ref=t||o:l.innerRef=o,S.createElement(r,l)}))})),V=function(e){return e},G=S.forwardRef;"undefined"===typeof G&&(G=V);G((function(e,t){var n=e["aria-current"],r=void 0===n?"page":n,a=e.activeClassName,i=void 0===a?"active":a,o=e.activeStyle,s=e.className,u=e.exact,c=e.isActive,l=e.location,h=e.sensitive,p=e.strict,d=e.style,f=e.to,m=e.innerRef,v=(0,F.Z)(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return S.createElement(R.__RouterContext.Consumer,null,(function(e){e||(0,D.Z)(!1);var n=l||e.location,a=L(P(f,n),n),g=a.pathname,y=g&&g.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),b=y?(0,R.matchPath)(n.pathname,{path:y,exact:u,sensitive:h,strict:p}):null,x=!!(c?c(b,n):b),k=x?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")}(s,i):s,w=x?(0,O.Z)({},d,{},o):d,I=(0,O.Z)({"aria-current":x&&r||null,className:k,style:w,to:a},v);return V!==G?I.ref=t||m:I.innerRef=m,S.createElement(W,I)}))})),n.p;var j=n(184);function H(e,t){return function(){return e.apply(t,arguments)}}var Z,K=Object.prototype.toString,q=Object.getPrototypeOf,X=(Z=Object.create(null),function(e){var t=K.call(e);return Z[t]||(Z[t]=t.slice(8,-1).toLowerCase())}),Y=function(e){return e=e.toLowerCase(),function(t){return X(t)===e}},Q=function(e){return function(t){return typeof t===e}},J=Array.isArray,$=Q("undefined");var ee=Y("ArrayBuffer");var te=Q("string"),ne=Q("function"),re=Q("number"),ae=function(e){return null!==e&&"object"===typeof e},ie=function(e){if("object"!==X(e))return!1;var t=q(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},oe=Y("Date"),se=Y("File"),ue=Y("Blob"),ce=Y("FileList"),le=Y("URLSearchParams");function he(e,t){var n,r,a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allOwnKeys,i=void 0!==a&&a;if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),J(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{var o,s=i?Object.getOwnPropertyNames(e):Object.keys(e),u=s.length;for(n=0;n<u;n++)o=s[n],t.call(null,e[o],o,e)}}function pe(e,t){t=t.toLowerCase();for(var n,r=Object.keys(e),a=r.length;a-- >0;)if(t===(n=r[a]).toLowerCase())return n;return null}var de="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,fe=function(e){return!$(e)&&e!==de};var me,ve=(me="undefined"!==typeof Uint8Array&&q(Uint8Array),function(e){return me&&e instanceof me}),ge=Y("HTMLFormElement"),ye=function(e){var t=Object.prototype.hasOwnProperty;return function(e,n){return t.call(e,n)}}(),be=Y("RegExp"),xe=function(e,t){var n=Object.getOwnPropertyDescriptors(e),r={};he(n,(function(n,a){!1!==t(n,a,e)&&(r[a]=n)})),Object.defineProperties(e,r)},ke="abcdefghijklmnopqrstuvwxyz",we="0123456789",Se={DIGIT:we,ALPHA:ke,ALPHA_DIGIT:ke+ke.toUpperCase()+we};var Ie=Y("AsyncFunction"),Ce={isArray:J,isArrayBuffer:ee,isBuffer:function(e){return null!==e&&!$(e)&&null!==e.constructor&&!$(e.constructor)&&ne(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:function(e){var t;return e&&("function"===typeof FormData&&e instanceof FormData||ne(e.append)&&("formdata"===(t=X(e))||"object"===t&&ne(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ee(e.buffer)},isString:te,isNumber:re,isBoolean:function(e){return!0===e||!1===e},isObject:ae,isPlainObject:ie,isUndefined:$,isDate:oe,isFile:se,isBlob:ue,isRegExp:be,isFunction:ne,isStream:function(e){return ae(e)&&ne(e.pipe)},isURLSearchParams:le,isTypedArray:ve,isFileList:ce,forEach:he,merge:function e(){for(var t=(fe(this)&&this||{}).caseless,n={},r=function(r,a){var i=t&&pe(n,a)||a;ie(n[i])&&ie(r)?n[i]=e(n[i],r):ie(r)?n[i]=e({},r):J(r)?n[i]=r.slice():n[i]=r},a=0,i=arguments.length;a<i;a++)arguments[a]&&he(arguments[a],r);return n},extend:function(e,t,n){return he(t,(function(t,r){n&&ne(t)?e[r]=H(t,n):e[r]=t}),{allOwnKeys:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).allOwnKeys}),e},trim:function(e){return e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n,r){var a,i,o,s={};if(t=t||{},null==e)return t;do{for(i=(a=Object.getOwnPropertyNames(e)).length;i-- >0;)o=a[i],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&q(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:X,kindOfTest:Y,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;if(J(e))return e;var t=e.length;if(!re(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},forEachEntry:function(e,t){for(var n,r=(e&&e[Symbol.iterator]).call(e);(n=r.next())&&!n.done;){var a=n.value;t.call(e,a[0],a[1])}},matchAll:function(e,t){for(var n,r=[];null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:ge,hasOwnProperty:ye,hasOwnProp:ye,reduceDescriptors:xe,freezeMethods:function(e){xe(e,(function(t,n){if(ne(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;var r=e[n];ne(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=function(){throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:function(e,t){var n={},r=function(e){e.forEach((function(e){n[e]=!0}))};return J(e)?r(e):r(String(e).split(t)),n},toCamelCase:function(e){return e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n}))},noop:function(){},toFiniteNumber:function(e,t){return e=+e,Number.isFinite(e)?e:t},findKey:pe,global:de,isContextDefined:fe,ALPHABET:Se,generateString:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Se.ALPHA_DIGIT,n="",r=t.length;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&ne(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:function(e){var t=new Array(10);return function e(n,r){if(ae(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[r]=n;var a=J(n)?[]:{};return he(n,(function(t,n){var i=e(t,r+1);!$(i)&&(a[n]=i)})),t[r]=void 0,a}}return n}(e,0)},isAsyncFn:Ie,isThenable:function(e){return e&&(ae(e)||ne(e))&&ne(e.then)&&ne(e.catch)}};function Te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ne=n(9142);function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(0,Ne.Z)(r.key),r)}}function Re(e,t,n){return t&&Ee(e.prototype,t),n&&Ee(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ae(e,t,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a)}Ce.inherits(Ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ce.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var _e=Ae.prototype,Oe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((function(e){Oe[e]={value:e}})),Object.defineProperties(Ae,Oe),Object.defineProperty(_e,"isAxiosError",{value:!0}),Ae.from=function(e,t,n,r,a,i){var o=Object.create(_e);return Ce.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(function(e){return"isAxiosError"!==e})),Ae.call(o,e.message,t,n,r,a),o.cause=e,o.name=e.name,i&&Object.assign(o,i),o};var Fe=Ae;function De(e){return Ce.isPlainObject(e)||Ce.isArray(e)}function Me(e){return Ce.endsWith(e,"[]")?e.slice(0,-2):e}function Pe(e,t,n){return e?e.concat(t).map((function(e,t){return e=Me(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}var Le=Ce.toFlatObject(Ce,{},null,(function(e){return/^is[A-Z]/.test(e)}));var ze=function(e,t,n){if(!Ce.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;var r=(n=Ce.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Ce.isUndefined(t[e])}))).metaTokens,a=n.visitor||c,i=n.dots,o=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&Ce.isSpecCompliantForm(t);if(!Ce.isFunction(a))throw new TypeError("visitor must be a function");function u(e){if(null===e)return"";if(Ce.isDate(e))return e.toISOString();if(!s&&Ce.isBlob(e))throw new Fe("Blob is not supported. Use a Buffer instead.");return Ce.isArrayBuffer(e)||Ce.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,a){var s=e;if(e&&!a&&"object"===typeof e)if(Ce.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Ce.isArray(e)&&function(e){return Ce.isArray(e)&&!e.some(De)}(e)||(Ce.isFileList(e)||Ce.endsWith(n,"[]"))&&(s=Ce.toArray(e)))return n=Me(n),s.forEach((function(e,r){!Ce.isUndefined(e)&&null!==e&&t.append(!0===o?Pe([n],r,i):null===o?n:n+"[]",u(e))})),!1;return!!De(e)||(t.append(Pe(a,n,i),u(e)),!1)}var l=[],h=Object.assign(Le,{defaultVisitor:c,convertValue:u,isVisitable:De});if(!Ce.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Ce.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),Ce.forEach(n,(function(n,i){!0===(!(Ce.isUndefined(n)||null===n)&&a.call(t,n,Ce.isString(i)?i.trim():i,r,h))&&e(n,r?r.concat(i):[i])})),l.pop()}}(e),t};function Be(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Ue(e,t){this._pairs=[],e&&ze(e,this,t)}var We=Ue.prototype;We.append=function(e,t){this._pairs.push([e,t])},We.toString=function(e){var t=e?function(t){return e.call(this,t,Be)}:Be;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var Ve=Ue;function Ge(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function je(e,t,n){if(!t)return e;var r,a=n&&n.encode||Ge,i=n&&n.serialize;if(r=i?i(t,n):Ce.isURLSearchParams(t)?t.toString():new Ve(t,n).toString(a)){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}var He=function(){function e(){Te(this,e),this.handlers=[]}return Re(e,[{key:"use",value:function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(e){this.handlers[e]&&(this.handlers[e]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(e){Ce.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}]),e}(),Ze=He,Ke={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qe={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Ve,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},isStandardBrowserEnv:function(){var e;return("undefined"===typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!==typeof window&&"undefined"!==typeof document)}(),isStandardBrowserWebWorkerEnv:"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};var Xe=function(e){function t(e,n,r,a){var i=e[a++],o=Number.isFinite(+i),s=a>=e.length;return i=!i&&Ce.isArray(r)?r.length:i,s?(Ce.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!o):(r[i]&&Ce.isObject(r[i])||(r[i]=[]),t(e,n,r[i],a)&&Ce.isArray(r[i])&&(r[i]=function(e){var t,n,r={},a=Object.keys(e),i=a.length;for(t=0;t<i;t++)r[n=a[t]]=e[n];return r}(r[i])),!o)}if(Ce.isFormData(e)&&Ce.isFunction(e.entries)){var n={};return Ce.forEachEntry(e,(function(e,r){t(function(e){return Ce.matchAll(/\w+|\[(\w*)]/g,e).map((function(e){return"[]"===e[0]?"":e[1]||e[0]}))}(e),r,n,0)})),n}return null},Ye={"Content-Type":void 0};var Qe={transitional:Ke,adapter:["xhr","http"],transformRequest:[function(e,t){var n,r=t.getContentType()||"",a=r.indexOf("application/json")>-1,i=Ce.isObject(e);if(i&&Ce.isHTMLForm(e)&&(e=new FormData(e)),Ce.isFormData(e))return a&&a?JSON.stringify(Xe(e)):e;if(Ce.isArrayBuffer(e)||Ce.isBuffer(e)||Ce.isStream(e)||Ce.isFile(e)||Ce.isBlob(e))return e;if(Ce.isArrayBufferView(e))return e.buffer;if(Ce.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ze(e,new qe.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return qe.isNode&&Ce.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((n=Ce.isFileList(e))||r.indexOf("multipart/form-data")>-1){var o=this.env&&this.env.FormData;return ze(n?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||a?(t.setContentType("application/json",!1),function(e,t,n){if(Ce.isString(e))try{return(t||JSON.parse)(e),Ce.trim(e)}catch(JG){if("SyntaxError"!==JG.name)throw JG}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Qe.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&Ce.isString(e)&&(n&&!this.responseType||r)){var a=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(JG){if(a){if("SyntaxError"===JG.name)throw Fe.from(JG,Fe.ERR_BAD_RESPONSE,this,null,this.response);throw JG}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:qe.classes.FormData,Blob:qe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ce.forEach(["delete","get","head"],(function(e){Qe.headers[e]={}})),Ce.forEach(["post","put","patch"],(function(e){Qe.headers[e]=Ce.merge(Ye)}));var Je=Qe,$e=Ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),et=Symbol("internals");function tt(e){return e&&String(e).trim().toLowerCase()}function nt(e){return!1===e||null==e?e:Ce.isArray(e)?e.map(nt):String(e)}function rt(e,t,n,r,a){return Ce.isFunction(r)?r.call(this,t,n):(a&&(t=n),Ce.isString(t)?Ce.isString(r)?-1!==t.indexOf(r):Ce.isRegExp(r)?r.test(t):void 0:void 0)}var at=function(e,t){function n(e){Te(this,n),e&&this.set(e)}return Re(n,[{key:"set",value:function(e,t,n){var r=this;function a(e,t,n){var a=tt(t);if(!a)throw new Error("header name must be a non-empty string");var i=Ce.findKey(r,a);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=nt(e))}var i=function(e,t){return Ce.forEach(e,(function(e,n){return a(e,n,t)}))};return Ce.isPlainObject(e)||e instanceof this.constructor?i(e,t):Ce.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?i(function(e){var t,n,r,a={};return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),t=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim(),!t||a[t]&&$e[t]||("set-cookie"===t?a[t]?a[t].push(n):a[t]=[n]:a[t]=a[t]?a[t]+", "+n:n)})),a}(e),t):null!=e&&a(t,e,n),this}},{key:"get",value:function(e,t){if(e=tt(e)){var n=Ce.findKey(this,e);if(n){var r=this[n];if(!t)return r;if(!0===t)return function(e){for(var t,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;t=r.exec(e);)n[t[1]]=t[2];return n}(r);if(Ce.isFunction(t))return t.call(this,r,n);if(Ce.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}},{key:"has",value:function(e,t){if(e=tt(e)){var n=Ce.findKey(this,e);return!(!n||void 0===this[n]||t&&!rt(0,this[n],n,t))}return!1}},{key:"delete",value:function(e,t){var n=this,r=!1;function a(e){if(e=tt(e)){var a=Ce.findKey(n,e);!a||t&&!rt(0,n[a],a,t)||(delete n[a],r=!0)}}return Ce.isArray(e)?e.forEach(a):a(e),r}},{key:"clear",value:function(e){for(var t=Object.keys(this),n=t.length,r=!1;n--;){var a=t[n];e&&!rt(0,this[a],a,e,!0)||(delete this[a],r=!0)}return r}},{key:"normalize",value:function(e){var t=this,n={};return Ce.forEach(this,(function(r,a){var i=Ce.findKey(n,a);if(i)return t[i]=nt(r),void delete t[a];var o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n}))}(a):String(a).trim();o!==a&&delete t[a],t[o]=nt(r),n[o]=!0})),this}},{key:"concat",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.constructor).concat.apply(e,[this].concat(n))}},{key:"toJSON",value:function(e){var t=Object.create(null);return Ce.forEach(this,(function(n,r){null!=n&&!1!==n&&(t[r]=e&&Ce.isArray(n)?n.join(", "):n)})),t}},{key:Symbol.iterator,value:function(){return Object.entries(this.toJSON())[Symbol.iterator]()}},{key:"toString",value:function(){return Object.entries(this.toJSON()).map((function(e){var t=(0,E.Z)(e,2);return t[0]+": "+t[1]})).join("\n")}},{key:Symbol.toStringTag,get:function(){return"AxiosHeaders"}}],[{key:"from",value:function(e){return e instanceof this?e:new this(e)}},{key:"concat",value:function(e){for(var t=new this(e),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.forEach((function(e){return t.set(e)})),t}},{key:"accessor",value:function(e){var t=(this[et]=this[et]={accessors:{}}).accessors,n=this.prototype;function r(e){var r=tt(e);t[r]||(!function(e,t){var n=Ce.toCamelCase(" "+t);["get","set","has"].forEach((function(r){Object.defineProperty(e,r+n,{value:function(e,n,a){return this[r].call(this,t,e,n,a)},configurable:!0})}))}(n,e),t[r]=!0)}return Ce.isArray(e)?e.forEach(r):r(e),this}}]),n}();at.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ce.freezeMethods(at.prototype),Ce.freezeMethods(at);var it=at;function ot(e,t){var n=this||Je,r=t||n,a=it.from(r.headers),i=r.data;return Ce.forEach(e,(function(e){i=e.call(n,i,a.normalize(),t?t.status:void 0)})),a.normalize(),i}function st(e){return!(!e||!e.__CANCEL__)}function ut(e,t,n){Fe.call(this,null==e?"canceled":e,Fe.ERR_CANCELED,t,n),this.name="CanceledError"}Ce.inherits(ut,Fe,{__CANCEL__:!0});var ct=ut;var lt=qe.isStandardBrowserEnv?{write:function(e,t,n,r,a,i){var o=[];o.push(e+"="+encodeURIComponent(t)),Ce.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Ce.isString(r)&&o.push("path="+r),Ce.isString(a)&&o.push("domain="+a),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function ht(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var pt=qe.isStandardBrowserEnv?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=Ce.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0};var dt=function(e,t){e=e||10;var n,r=new Array(e),a=new Array(e),i=0,o=0;return t=void 0!==t?t:1e3,function(s){var u=Date.now(),c=a[o];n||(n=u),r[i]=s,a[i]=u;for(var l=o,h=0;l!==i;)h+=r[l++],l%=e;if((i=(i+1)%e)===o&&(o=(o+1)%e),!(u-n<t)){var p=c&&u-c;return p?Math.round(1e3*h/p):void 0}}};function ft(e,t){var n=0,r=dt(50,250);return function(a){var i=a.loaded,o=a.lengthComputable?a.total:void 0,s=i-n,u=r(s);n=i;var c={loaded:i,total:o,progress:o?i/o:void 0,bytes:s,rate:u||void 0,estimated:u&&o&&i<=o?(o-i)/u:void 0,event:a};c[t?"download":"upload"]=!0,e(c)}}var mt={http:null,xhr:"undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){var r,a=e.data,i=it.from(e.headers).normalize(),o=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}Ce.isFormData(a)&&(qe.isStandardBrowserEnv||qe.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));var u=new XMLHttpRequest;if(e.auth){var c=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(c+":"+l))}var h=ht(e.baseURL,e.url);function p(){if(u){var r=it.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Fe("Request failed with status code "+n.status,[Fe.ERR_BAD_REQUEST,Fe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),s()}),(function(e){n(e),s()}),{data:o&&"text"!==o&&"json"!==o?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}}if(u.open(e.method.toUpperCase(),je(h,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=p:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(p)},u.onabort=function(){u&&(n(new Fe("Request aborted",Fe.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new Fe("Network Error",Fe.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||Ke;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new Fe(t,r.clarifyTimeoutError?Fe.ETIMEDOUT:Fe.ECONNABORTED,e,u)),u=null},qe.isStandardBrowserEnv){var d=(e.withCredentials||pt(h))&&e.xsrfCookieName&&lt.read(e.xsrfCookieName);d&&i.set(e.xsrfHeaderName,d)}void 0===a&&i.setContentType(null),"setRequestHeader"in u&&Ce.forEach(i.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),Ce.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),o&&"json"!==o&&(u.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&u.addEventListener("progress",ft(e.onDownloadProgress,!0)),"function"===typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",ft(e.onUploadProgress)),(e.cancelToken||e.signal)&&(r=function(t){u&&(n(!t||t.type?new ct(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r)));var f=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(h);f&&-1===qe.protocols.indexOf(f)?n(new Fe("Unsupported protocol "+f+":",Fe.ERR_BAD_REQUEST,e)):u.send(a||null)}))}};Ce.forEach(mt,(function(e,t){if(e){try{Object.defineProperty(e,"name",{value:t})}catch(JG){}Object.defineProperty(e,"adapterName",{value:t})}}));var vt=function(e){for(var t,n,r=(e=Ce.isArray(e)?e:[e]).length,a=0;a<r&&(t=e[a],!(n=Ce.isString(t)?mt[t.toLowerCase()]:t));a++);if(!n){if(!1===n)throw new Fe("Adapter ".concat(t," is not supported by the environment"),"ERR_NOT_SUPPORT");throw new Error(Ce.hasOwnProp(mt,t)?"Adapter '".concat(t,"' is not available in the build"):"Unknown adapter '".concat(t,"'"))}if(!Ce.isFunction(n))throw new TypeError("adapter is not a function");return n};function gt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ct(null,e)}function yt(e){return gt(e),e.headers=it.from(e.headers),e.data=ot.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),vt(e.adapter||Je.adapter)(e).then((function(t){return gt(e),t.data=ot.call(e,e.transformResponse,t),t.headers=it.from(t.headers),t}),(function(t){return st(t)||(gt(e),t&&t.response&&(t.response.data=ot.call(e,e.transformResponse,t.response),t.response.headers=it.from(t.response.headers))),Promise.reject(t)}))}var bt=function(e){return e instanceof it?e.toJSON():e};function xt(e,t){t=t||{};var n={};function r(e,t,n){return Ce.isPlainObject(e)&&Ce.isPlainObject(t)?Ce.merge.call({caseless:n},e,t):Ce.isPlainObject(t)?Ce.merge({},t):Ce.isArray(t)?t.slice():t}function a(e,t,n){return Ce.isUndefined(t)?Ce.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function i(e,t){if(!Ce.isUndefined(t))return r(void 0,t)}function o(e,t){return Ce.isUndefined(t)?Ce.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,a,i){return i in t?r(n,a):i in e?r(void 0,n):void 0}var u={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:function(e,t){return a(bt(e),bt(t),!0)}};return Ce.forEach(Object.keys(Object.assign({},e,t)),(function(r){var i=u[r]||a,o=i(e[r],t[r],r);Ce.isUndefined(o)&&i!==s||(n[r]=o)})),n}var kt="1.4.0",wt={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){wt[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var St={};wt.transitional=function(e,t,n){function r(e,t){return"[Axios v1.4.0] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,a,i){if(!1===e)throw new Fe(r(a," has been removed"+(t?" in "+t:"")),Fe.ERR_DEPRECATED);return t&&!St[a]&&(St[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,a,i)}};var It={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Fe("options must be an object",Fe.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),a=r.length;a-- >0;){var i=r[a],o=t[i];if(o){var s=e[i],u=void 0===s||o(s,i,e);if(!0!==u)throw new Fe("option "+i+" must be "+u,Fe.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Fe("Unknown option "+i,Fe.ERR_BAD_OPTION)}},validators:wt},Ct=It.validators,Tt=function(){function e(t){Te(this,e),this.defaults=t,this.interceptors={request:new Ze,response:new Ze}}return Re(e,[{key:"request",value:function(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{};var n,r=t=xt(this.defaults,t),a=r.transitional,i=r.paramsSerializer,o=r.headers;void 0!==a&&It.assertOptions(a,{silentJSONParsing:Ct.transitional(Ct.boolean),forcedJSONParsing:Ct.transitional(Ct.boolean),clarifyTimeoutError:Ct.transitional(Ct.boolean)},!1),null!=i&&(Ce.isFunction(i)?t.paramsSerializer={serialize:i}:It.assertOptions(i,{encode:Ct.function,serialize:Ct.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase(),(n=o&&Ce.merge(o.common,o[t.method]))&&Ce.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete o[e]})),t.headers=it.concat(n,o);var s=[],u=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(u=u&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));var c,l=[];this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));var h,p=0;if(!u){var d=[yt.bind(this),void 0];for(d.unshift.apply(d,s),d.push.apply(d,l),h=d.length,c=Promise.resolve(t);p<h;)c=c.then(d[p++],d[p++]);return c}h=s.length;var f=t;for(p=0;p<h;){var m=s[p++],v=s[p++];try{f=m(f)}catch(g){v.call(this,g);break}}try{c=yt.call(this,f)}catch(g){return Promise.reject(g)}for(p=0,h=l.length;p<h;)c=c.then(l[p++],l[p++]);return c}},{key:"getUri",value:function(e){return je(ht((e=xt(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}]),e}();Ce.forEach(["delete","get","head","options"],(function(e){Tt.prototype[e]=function(t,n){return this.request(xt(n||{},{method:e,url:t,data:(n||{}).data}))}})),Ce.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,a){return this.request(xt(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Tt.prototype[e]=t(),Tt.prototype[e+"Form"]=t(!0)}));var Nt=Tt,Et=function(){function e(t){if(Te(this,e),"function"!==typeof t)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(e){n=e}));var r=this;this.promise.then((function(e){if(r._listeners){for(var t=r._listeners.length;t-- >0;)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},t((function(e,t,a){r.reason||(r.reason=new ct(e,t,a),n(r.reason))}))}return Re(e,[{key:"throwIfRequested",value:function(){if(this.reason)throw this.reason}},{key:"subscribe",value:function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}},{key:"unsubscribe",value:function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}}}],[{key:"source",value:function(){var t,n=new e((function(e){t=e}));return{token:n,cancel:t}}}]),e}(),Rt=Et;var At={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(At).forEach((function(e){var t=(0,E.Z)(e,2),n=t[0],r=t[1];At[r]=n}));var _t=At;var Ot=function e(t){var n=new Nt(t),r=H(Nt.prototype.request,n);return Ce.extend(r,Nt.prototype,n,{allOwnKeys:!0}),Ce.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(xt(t,n))},r}(Je);Ot.Axios=Nt,Ot.CanceledError=ct,Ot.CancelToken=Rt,Ot.isCancel=st,Ot.VERSION=kt,Ot.toFormData=ze,Ot.AxiosError=Fe,Ot.Cancel=Ot.CanceledError,Ot.all=function(e){return Promise.all(e)},Ot.spread=function(e){return function(t){return e.apply(null,t)}},Ot.isAxiosError=function(e){return Ce.isObject(e)&&!0===e.isAxiosError},Ot.mergeConfig=xt,Ot.AxiosHeaders=it,Ot.formToJSON=function(e){return Xe(Ce.isHTMLForm(e)?new FormData(e):e)},Ot.HttpStatusCode=_t,Ot.default=Ot;var Ft=Ot,Dt=(0,S.createContext)("");function Mt(){var e=(0,R.useHistory)(),t=(0,S.useState)(""),n=(0,E.Z)(t,2),r=n[0],a=n[1],i=(0,S.useState)(""),o=(0,E.Z)(i,2),s=o[0],u=o[1],c="https://begym.azurewebsites.net",l=(0,S.useState)(""),h=(0,E.Z)(l,2),p=h[0],d=h[1],f=(0,S.useState)(""),m=(0,E.Z)(f,2),v=m[0],g=m[1],y=(0,S.useState)(""),b=(0,E.Z)(y,2),x=b[0],k=b[1],w=(0,S.useContext)(Dt).setAuthState;return(0,j.jsxs)("div",{className:"login",children:[(0,j.jsx)("h1",{children:"Registration"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{children:"Username"}),(0,j.jsx)("input",{type:"text",onChange:function(e){a(e.target.value)}})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{children:"Password"}),(0,j.jsx)("input",{type:"password",onChange:function(e){u(e.target.value)}})]}),(0,j.jsx)("button",{onClick:function(){Ft.post("".concat(c,"/auth"),{username:r,password:s}).then((function(e){e.data.error?(k(e.data.error),alert(e.data.error)):(k(e.data),alert(e.data))}))},children:"Register"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{children:"Login"}),(0,j.jsx)("label",{children:"Username"}),(0,j.jsx)("input",{type:"text",onChange:function(e){d(e.target.value)}})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{children:"Password"}),(0,j.jsx)("input",{type:"password",onChange:function(e){g(e.target.value)}})]}),(0,j.jsx)("button",{onClick:function(){Ft.post("".concat(c,"/auth/login"),{username:p,password:v}).then((function(t){t.data.error?(k(t.data.error),alert(t.data.error)):(localStorage.setItem("accessToken",t.data.token),w({username:t.data.username,id:t.data.id,status:!0}),e.push("/home"))}))},children:"Login"}),(0,j.jsx)("h1",{children:x})]})}var Pt=function(){return(0,j.jsx)("div",{children:(0,j.jsx)(Mt,{})})},Lt=n(2982),zt=n(786),Bt=n(2664);function Ut(){var e="https://begym.azurewebsites.net",t=(0,S.useState)([]),n=(0,E.Z)(t,2),r=n[0],a=n[1],i=(0,S.useState)([]),o=(0,E.Z)(i,2),s=o[0],u=o[1],c=(0,R.useHistory)();(0,S.useEffect)((function(){Ft.get("".concat(e,"/posts"),{headers:{accessToken:localStorage.getItem("accessToken")}}).then((function(e){a(e.data.postsList),u(e.data.likedPosts.map((function(e){return e.PostId})))}))}),[]);var l=function(t){Ft.post("".concat(e,"/likes"),{PostId:t},{headers:{accessToken:localStorage.getItem("accessToken")}}).then((function(e){var n=e.data.liked;a(r.map((function(e){if(e.id===t){if(n)return N(N({},e),{},{Likes:[].concat((0,Lt.Z)(e.Likes),[0])});var r=e.Likes;return r.pop(),N(N({},e),{},{Likes:r})}return e}))),s.includes(t)?u(s.filter((function(e){return e!==t}))):u([].concat((0,Lt.Z)(s),[t]))}))};return(0,j.jsx)("div",{className:"feed",children:r.map((function(e,t){return(0,j.jsxs)("div",{className:"posts",children:[(0,j.jsxs)("div",{className:"title",onClick:function(){c.push("/post/".concat(e.id))},children:[" ",e.title," "]}),(0,j.jsxs)("div",{className:"user",children:[(0,j.jsxs)("div",{className:"user-username",children:[" ",e.user," "]}),(0,j.jsxs)("div",{className:"likecontainer",children:[s.includes(e.id)?(0,j.jsx)(Bt.Z,{className:"like",onClick:function(){l(e.id)}}):(0,j.jsx)(zt.Z,{className:"like",onClick:function(){l(e.id)}}),(0,j.jsx)("label",{children:e.Likes.length})]})]})]})}))})}function Wt(){return(0,j.jsx)("div",{children:(0,j.jsx)(Ut,{})})}var Vt=n(1002);function Gt(){Gt=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(E){u=function(e,t,n){return e[t]=n}}function c(e,t,n,a){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),s=new C(a||[]);return r(o,"_invoke",{value:k(e,n,s)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(E){return{type:"throw",arg:E}}}e.wrap=c;var h={};function p(){}function d(){}function f(){}var m={};u(m,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(T([])));g&&g!==t&&n.call(g,i)&&(m=g);var y=f.prototype=p.prototype=Object.create(m);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function a(r,i,o,s){var u=l(e[r],e,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==(0,Vt.Z)(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){a("next",e,o,s)}),(function(e){a("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,s)}))}s(u.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function k(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return N()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=l(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:N}}function N(){return{value:void 0,done:!0}}return d.prototype=f,r(y,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:d,configurable:!0}),d.displayName=u(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(x.prototype),u(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new x(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(y),u(y,s,"Generator"),u(y,i,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;I(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function jt(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function Ht(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){jt(i,r,a,o,s,"next",e)}function s(e){jt(i,r,a,o,s,"throw",e)}o(void 0)}))}}var Zt=n(181);function Kt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,Zt.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}var qt=function(){function e(t,n){Te(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return Re(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),Xt=function(){function e(){Te(this,e)}return Re(e,[{key:"refCount",value:function(e){return Yt("refCount")}},{key:"incRef",value:function(e){return Yt("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return Yt("time")}},{key:"read",value:function(e){return Yt("read")}},{key:"readSync",value:function(e){return Yt("readSync")}},{key:"readToGPU",value:function(e,t){return Yt("readToGPU")}},{key:"numDataIds",value:function(){return Yt("numDataIds")}},{key:"disposeData",value:function(e,t){return Yt("disposeData")}},{key:"write",value:function(e,t,n){return Yt("write")}},{key:"move",value:function(e,t,n,r,a){return Yt("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return Yt("createTensorFromGPUData")}},{key:"memory",value:function(){return Yt("memory")}},{key:"floatPrecision",value:function(){return Yt("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return Yt("dispose")}}]),e}();function Yt(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Qt(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,en(e,--t,n)}function Jt(e,t,n){return Math.max(e,Math.min(t,n))}function $t(e){return e%2===0?e:e+1}function en(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function tn(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function nn(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function rn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";nn(sn(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function an(e){nn(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function on(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function sn(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function un(e){return e%1===0}function cn(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ln(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function hn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function pn(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function dn(e,t){var n=t.length;return nn((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),nn(e.every((function(e){return un(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function fn(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:dn(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function mn(e,t){return vn(e,t)}function vn(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function gn(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function yn(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function bn(e){return"string"===typeof e||e instanceof String}function xn(e){return"number"===typeof e}function kn(e){return Array.isArray(e)?kn(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":xn(e)?"float32":bn(e)?"string":"boolean"===typeof e?"bool":"float32"}function wn(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Sn(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function In(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Cn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=Cn(e+l*c,u,n,r);return a}function Tn(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Cn(0,e,t,n)}function Nn(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}function En(e,t){for(var n=Rn(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Rn(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function An(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Tn(e,new Float32Array(n));if("int32"===t)return Tn(e,new Int32Array(n));if("bool"===t)return Tn(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function _n(e){e.forEach((function(t){nn(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function On(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Fn(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Dn(e){return e&&e.then&&"function"===typeof e.then}var Mn="tfjsflags",Pn=function(){function e(t){Te(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ln,this.populateURLFlags()}return Re(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(zn().getBool("IS_TEST")||zn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];zn().getBool("IS_TEST")||zn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Dn(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getString",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(Mn in t)t[Mn].split(",").forEach((function(t){var n=t.split(":"),r=(0,E.Z)(n,2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){var n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,i)}))}}}]),e}();function Ln(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function zn(){return Un}var Bn,Un=null;function Wn(){if(null==Bn){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}Bn=e}return Bn}function Vn(e,t){var n=function(){var e=Wn();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var Gn="Abs",jn="Acos",Hn="Acosh",Zn="Add",Kn="AddN",qn="All",Xn="Any",Yn="ArgMax",Qn="ArgMin",Jn="Asin",$n="Asinh",er="Atan",tr="Atanh",nr="Atan2",rr="AvgPool",ar="AvgPoolGrad",ir="AvgPool3D",or="AvgPool3DGrad",sr="BatchMatMul",ur="BatchToSpaceND",cr="Bincount",lr="BitwiseAnd",hr="BroadcastArgs",pr="Cast",dr="Ceil",fr="ClipByValue",mr="Complex",vr="ComplexAbs",gr="Concat",yr="Conv2D",br="Conv2DBackpropFilter",xr="Conv2DBackpropInput",kr="Conv3D",wr="Conv3DBackpropFilterV2",Sr="Conv3DBackpropInputV2",Ir="Cos",Cr="Cosh",Tr="Cumprod",Nr="Cumsum",Er="CropAndResize",Rr="DenseBincount",Ar="DepthToSpace",_r="DepthwiseConv2dNative",Or="DepthwiseConv2dNativeBackpropFilter",Fr="DepthwiseConv2dNativeBackpropInput",Dr="Diag",Mr="Dilation2D",Pr="Dilation2DBackpropInput",Lr="Dilation2DBackpropFilter",zr="Draw",Br="RealDiv",Ur="Einsum",Wr="Elu",Vr="EluGrad",Gr="Erf",jr="Equal",Hr="Exp",Zr="ExpandDims",Kr="Expm1",qr="FFT",Xr="Fill",Yr="FlipLeftRight",Qr="Floor",Jr="FloorDiv",$r="FusedBatchNorm",ea="GatherV2",ta="GatherNd",na="Greater",ra="GreaterEqual",aa="Identity",ia="IFFT",oa="Imag",sa="IsFinite",ua="IsInf",ca="IsNan",la="LeakyRelu",ha="Less",pa="LessEqual",da="LinSpace",fa="Log",ma="Log1p",va="LogicalAnd",ga="LogicalNot",ya="LogicalOr",ba="LRN",xa="LRNGrad",ka="Max",wa="Maximum",Sa="MaxPool",Ia="MaxPoolGrad",Ca="MaxPool3D",Ta="MaxPool3DGrad",Na="MaxPoolWithArgmax",Ea="Mean",Ra="Min",Aa="Minimum",_a="MirrorPad",Oa="Mod",Fa="Multinomial",Da="Multiply",Ma="Neg",Pa="NotEqual",La="NonMaxSuppressionV3",za="NonMaxSuppressionV4",Ba="NonMaxSuppressionV5",Ua="OnesLike",Wa="OneHot",Va="Pack",Ga="PadV2",ja="Pow",Ha="Prelu",Za="Prod",Ka="RaggedGather",qa="RaggedRange",Xa="RaggedTensorToTensor",Ya="Range",Qa="Real",Ja="Reciprocal",$a="Relu",ei="Reshape",ti="ResizeNearestNeighbor",ni="ResizeNearestNeighborGrad",ri="ResizeBilinear",ai="ResizeBilinearGrad",ii="Relu6",oi="Reverse",si="Round",ui="Rsqrt",ci="ScatterNd",li="TensorScatterUpdate",hi="SearchSorted",pi="Select",di="Selu",fi="Slice",mi="Sin",vi="Sinh",gi="Sign",yi="Sigmoid",bi="Softplus",xi="Sqrt",ki="Sum",wi="SpaceToBatchND",Si="SplitV",Ii="Softmax",Ci="SparseFillEmptyRows",Ti="SparseReshape",Ni="SparseSegmentMean",Ei="SparseSegmentSum",Ri="SparseToDense",Ai="SquaredDifference",_i="Square",Oi="StaticRegexReplace",Fi="StridedSlice",Di="StringNGrams",Mi="StringSplit",Pi="StringToHashBucketFast",Li="Sub",zi="Tan",Bi="Tanh",Ui="Tile",Wi="TopK",Vi="Transform",Gi="Transpose",ji="Unique",Hi="Unpack",Zi="UnsortedSegmentSum",Ki="ZerosLike",qi="Step",Xi="FromPixels",Yi="RotateWithOffset",Qi="_FusedMatMul",Ji="FusedConv2D",$i="FusedDepthwiseConv2D";function eo(){var e;zn().getBool("IS_TEST")||zn().getBool("PROD")||(e=console).warn.apply(e,arguments)}var to=Vn("kernelRegistry",(function(){return new Map})),no=Vn("gradRegistry",(function(){return new Map}));function ro(e,t){var n=uo(e,t);return to.get(n)}function ao(e){return no.get(e)}function io(e){for(var t=to.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=(0,E.Z)(i,2),s=o[0],u=o[1],c=s.split("_");(0,E.Z)(c,1)[0]===e&&n.push(u)}return n}function oo(e){var t=e.kernelName,n=e.backendName,r=uo(t,n);to.has(r)&&eo("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),to.set(r,e)}function so(e){var t=e.kernelName;no.has(t)&&zn().getBool("DEBUG")&&eo("Overriding the gradient for '".concat(t,"'")),no.set(t,e)}function uo(e,t){return"".concat(t,"_").concat(e)}function co(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var lo=n(8987),ho=n.n(lo)()||lo;function po(e){return ho.fromString(e,!0,16)}var fo=po("c3a5c85c97cb3127"),mo=po("b492b66fbe98f273"),vo=po("9ae16a3b2f90404f");function go(e){return e.xor(e.shru(47))}function yo(e,t,n){var r=e.slice(t,t+n);return ho.fromBytes(Array.from(r),!0,!0)}function bo(e,t){return yo(e,t,8)}function xo(e,t){return yo(e,t,4)}function ko(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function wo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:po("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function So(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=ko(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(ko(a,44)),[a.add(r),i.add(o)]}(bo(e,t),bo(e,t+8),bo(e,t+16),bo(e,t+24),n,r)}function Io(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=ho.fromNumber(81,!0);if(t<=32)return t<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=vo.add(2*t),r=bo(e,0).add(vo),a=bo(e,t-8);return wo(ko(a,37).mul(n).add(r),ko(r,25).add(a).mul(n),n)}if(t>=4){var i=vo.add(2*t);return wo(xo(e,0).shl(3).add(t),xo(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return go(vo.mul(o).xor(fo.mul(s))).mul(vo)}return vo}(e,t):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=vo.add(2*t),r=bo(e,0).mul(mo),a=bo(e,8),i=bo(e,t-8).mul(n),o=bo(e,t-16).mul(vo);return wo(ko(r.add(a),43).add(ko(i,30)).add(o),r.add(ko(a.add(vo),18)).add(i),n)}(e,t);if(t<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=vo.add(2*t),r=bo(e,0).mul(vo),a=bo(e,8),i=bo(e,t-8).mul(n),o=bo(e,t-16).mul(vo),s=ko(r.add(a),43).add(ko(i,30)).add(o),u=wo(s,r.add(ko(a.add(vo),18)).add(i),n),c=bo(e,16).mul(n),l=bo(e,24),h=s.add(bo(e,t-32)).mul(n),p=u.add(bo(e,t-24)).mul(n);return wo(ko(c.add(l),43).add(ko(h,30)).add(p),c.add(ko(l.add(r),18)).add(h),n)}(e,t);var r=n,a=n.mul(mo).add(113),i=go(a.mul(vo).add(113)).mul(vo),o=[ho.UZERO,ho.UZERO],s=[ho.UZERO,ho.UZERO];r=r.mul(vo).add(bo(e,0));var u=0,c=64*(t-1>>6),l=c+(t-1&63)-63;do{r=ko(r.add(a).add(o[0]).add(bo(e,u+8)),37).mul(mo),a=ko(a.add(o[1]).add(bo(e,u+48)),42).mul(mo),r=r.xor(s[1]),a=a.add(o[0]).add(bo(e,u+40)),i=ko(i.add(s[0]),33).mul(mo),o=So(e,u,o[1].mul(mo),r.add(s[0])),s=So(e,u+32,i.add(s[1]),a.add(bo(e,u+16)));var h=[r,i];i=h[0],r=h[1],u+=64}while(u!==c);var p=mo.add(i.and(255).shl(1));u=l,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=ko(r.add(a).add(o[0]).add(bo(e,u+8)),37).mul(p),a=ko(a.add(o[1]).add(bo(e,u+48)),42).mul(p),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(bo(e,u+40))),i=ko(i.add(s[0]),33).mul(p),o=So(e,u,o[1].mul(p),r.add(s[0])),s=So(e,u+32,i.add(s[1]),a.add(bo(e,u+16)));var d=[r,i];return i=d[0],r=d[1],wo(wo(o[0],s[0],p).add(go(a).mul(fo)).add(i),wo(o[1],s[1],p).add(r),p)}function Co(e,t){return"string"===t?Eo(e):To([e],t)}function To(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=_o(e)),zn().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function No(){return zn().platform.now()}function Eo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",zn().platform.encode(e,t)}function Ro(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",zn().platform.decode(e,t)}function Ao(e){return null!=zn().platform.isTypedArray?zn().platform.isTypedArray(e):co(e)}function _o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||Dn(e)||null==e||Ao(e)&&n)t.push(e);else if(Array.isArray(e)||Ao(e))for(var r=0;r<e.length;++r)_o(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)_o(e[u],t,n)}return t}var Oo=function(){function e(t,n){Te(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new Fo)}return Re(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=No();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=Kt(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(h){u.e(h)}finally{u.f()}a=Promise.resolve({kernelMs:No()-o})}if(zn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(){var t=r[l];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},l=0;l<r.length;l++)c();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var Fo=function(){function e(){Te(this,e)}return Re(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?ln("".concat(r,"ms"),9):r.error,s=ln(e,25),u=t.rank,c=t.size,l=ln(t.shape.toString(),14),h="";for(var p in a){var d=a[p];if(null!=d){var f=d.shape||t.shape,m=f.length;h+="".concat(p,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var Do=n(9611);function Mo(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,Do.Z)(e,t)}function Po(e){return Po=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Po(e)}function Lo(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(JG){return!1}}function zo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bo(e,t){if(t&&("object"===(0,Vt.Z)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return zo(e)}function Uo(e){var t=Lo();return function(){var n,r=Po(e);if(t){var a=Po(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Bo(this,n)}}var Wo=20,Vo=3,Go=7;function jo(e,t,n,r){var a=In(t),i=function(e,t,n,r){var a=on(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?qo(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],Ho(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=Ko(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function Ho(e,t,n){return ln(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(Go))," + ")+"".concat(parseFloat(e[1].toFixed(Go)),"j"):bn(e)?"'".concat(e,"'"):"bool"===n?Zo(e):parseFloat(e.toFixed(Go)).toString(),t)}function Zo(e){return 0===e?"false":"true"}function Ko(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[Ho(qo(e)[0],0,n)]:"bool"===n?[Zo(e[0])]:[e[0].toString()];if(1===u){if(s>Wo){var c=Vo*o,l=Array.from(e.slice(0,c)),h=Array.from(e.slice((s-Vo)*o,s*o));return"complex64"===n&&(l=qo(l),h=qo(h)),["["+l.map((function(e,t){return Ho(e,a[t],n)})).join(", ")+", ..., "+h.map((function(e,t){return Ho(e,a[s-Vo+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?qo(e):Array.from(e)).map((function(e,t){return Ho(e,a[t],n)})).join(", ")+"]"]}var p=t.slice(1),d=r.slice(1),f=r[0]*o,m=[];if(s>Wo){for(var v=0;v<Vo;v++){var g=v*f,y=g+f;m.push.apply(m,(0,Lt.Z)(Ko(e.slice(g,y),p,n,d,a,!1)))}m.push("...");for(var b=s-Vo;b<s;b++){var x=b*f,k=x+f;m.push.apply(m,(0,Lt.Z)(Ko(e.slice(x,k),p,n,d,a,b===s-1)))}}else for(var w=0;w<s;w++){var S=w*f,I=S+f;m.push.apply(m,(0,Lt.Z)(Ko(e.slice(S,I),p,n,d,a,w===s-1)))}var C=2===u?",":"";m[0]="["+(s>0?m[0]+C:"");for(var T=1;T<m.length-1;T++)m[T]=" "+m[T]+C;for(var N=",\n",E=2;E<u;E++)N+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":N),m}function qo(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Xo=function(){function e(t,n,r){var a=this;if(Te(this,e),this.dtype=n,this.shape=t.slice(),this.size=on(t),null!=r){var i=r.length;nn(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||vn(n,this.size),this.strides=In(t)}return Re(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),nn(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return Yo().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),Yo=null,Qo=null;var Jo=function(){function e(t,n,r,a){Te(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=on(t),this.strides=In(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Re(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Qo.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return Qo.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Tn(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Tn(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=Ht(Gt().mark((function e(){var t,n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=Yo().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return Ro(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),Yo().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=Yo().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Ro(e)}))}catch(OK){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,Yo().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(Yo().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Qo.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),Qo.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return jo(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),Qo.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Yo().makeVariable(this,e,t,n)}}]),e}();function $o(){return Vn("Tensor",(function(){return Jo}))}Object.defineProperty(Jo,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),$o();var es,ts,ns,rs,as,is=function(e){Mo(n,e);var t=Uo(n);function n(e,r,a,i){var o;return Te(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return Re(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!sn(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));Yo().disposeTensor(this),this.dataId=e.dataId,Yo().incRef(this,null)}},{key:"dispose",value:function(){Yo().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(Jo);Object.defineProperty(is,Symbol.hasInstance,{value:function(e){return e instanceof Jo&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(es||(es={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(ts||(ts={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(ns||(ns={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(rs||(rs={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(as||(as={}));var os={float32:rs,int32:ts,bool:ns,complex64:as};function ss(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return os[e][t]}function us(e){return ss(e,"int32")}function cs(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function ls(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function hs(e,t){if(e.dtype===t.dtype)return[e,t];var n=ss(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function ps(e,t){return t.some((function(t){return t.id===e.id}))}function ds(e){var t=[];return fs(e,t,new Set),t}function fs(e,t,n){if(null!=e)if(e instanceof Jo)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),fs(o,t,n))}}}function ms(e){return null!=e.kernelName}var vs=function(){function e(){Te(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return Re(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),gs=function(){function e(t){Te(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new vs}return Re(e,[{key:"ready",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(eo("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Oo(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;io(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;io(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof Xt||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,eo("Initialization of backend ".concat(e," failed")),eo(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return eo("Initialization of backend ".concat(e," failed")),eo(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=xs.runKernel(aa,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return xs.runKernel(pr,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=ro(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=ms(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(ms(e)){var l=e.kernelName,h=e.inputs,p=e.attrs;null==this.backendName&&this.backend;var d=ro(l,this.backendName);nn(null!=d,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=d.kernelFunc({inputs:h,attrs:p,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,h,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var f=e.forwardFunc,m=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return f(a.backend,m)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=ms(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(v=a.profiler.profileKernel(c,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(v),t=v.outputs):t=n()})),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=ao(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(nn(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&bn(e[0])&&(a=e.map((function(e){return Eo(e)})));var i=r.write(a,t,n),o=new Jo(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new Jo(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new is(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*yn(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof is||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*yn(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,(0,Lt.Z)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=Kt(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=ao(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Rn(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=ds(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(nn(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));nn(i instanceof Jo,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,p=0;p<t.length;p++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var b in g)d[g[b].id]=!0,f[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&f[w.id]){var S={};for(var I in w.inputs){var C=w.inputs[I];r[C.id]&&(S[I]=C)}var T=Object.assign({},w);T.inputs=S,T.outputs=w.outputs,x.push(T)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=En(on(e),"float32");return xs.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!sn(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(i.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),ks);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=Kt(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return nn(wn(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;nn(r.every((function(e){return e instanceof Jo})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return nn((i=e.apply(void 0,[].concat(r,[n]))).value instanceof Jo,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),nn(wn(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];nn(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),nn(a.every((function(e){return e instanceof Jo})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=No(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=No()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new vs,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function ys(){var e=Wn();if(null==e._tfengine){var t=new Pn(e);e._tfengine=new gs(t)}return function(e){Un=e}(e._tfengine.ENV),Yo=function(){return e._tfengine},e._tfengine}gs.nextTensorId=0,gs.nextVariableId=0;var bs,xs=ys();function ks(e,t){var n={a:e,b:t};return xs.runKernel(Zn,n)}function ws(e){if(void 0!==bs)return bs;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Ss(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var Is=zn();function Cs(e,t){var n=e;if(Ao(e))return"string"===t?[]:[e.length];if(cs(e)){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if(ls(e))return[e.buffer.size/(null==t?4:yn(t))];if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||Ao(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&zn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Ts(e,a,[]),a}function Ts(e,t,n){if(n=n||[],Array.isArray(e)||Ao(e)){nn(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),nn(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)Ts(e[a],r,n.concat(a))}else nn(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function Ns(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function Es(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Jo)return Ns(r,e.dtype,t,n),e;var a=kn(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Ns(r,a,t,n),null==e||!Ao(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Cs(e,a);Ao(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?To(e,a):_o(e,[],!0);return xs.makeTensor(s,o,a)}function Rs(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((function(e,a){return Es(e,"".concat(t,"[").concat(a,"]"),n,r)}))}Is.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Is.registerFlag("IS_BROWSER",(function(){return Ss()})),Is.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),Is.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Is.registerFlag("IS_SAFARI",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)})),Is.registerFlag("PROD",(function(){return!1})),Is.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Is.getBool("DEBUG")})),Is.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Is.registerFlag("IS_TEST",(function(){return!1})),Is.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return Is.getBool("DEBUG")})),Is.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),Is.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),Is.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var As="__op";function _s(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=As;var a=function(){xs.startScope(n);try{var e=r.apply(void 0,arguments);return Dn(e)&&console.error("Cannot return a Promise inside of tidy."),xs.endScope(e),e}catch(t){throw xs.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Os=_s({complex_:function(e,t){var n=Es(e,"real","complex"),r=Es(t,"imag","complex");rn(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return xs.runKernel(mr,a)}});function Fs(e,t,n,r){if(null==r)r=kn(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(ls(e)||cs(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return xs.backend.createTensorFromGPUData(e,t||n,r)}if(!Ao(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){_n(t);var a=on(t),i=on(n);nn(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==on(t.slice(o));nn(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return Ao(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?To(e,r):_o(e,[],!0),xs.makeTensor(e,t,r)}function Ds(e,t,n){return Fs(e,t,Cs(e,n),n)}var Ms={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Ps=function(){function e(t){if(Te(this,e),this.shards=[],this.previousShardIndex=0,null!=t&&(t instanceof Array||(t=[t]),0!==(t=t.map((function(e){return Ao(e)?e.buffer:e}))).length)){this.bufferUniformSize=t[0].byteLength;for(var n=0,r=0;r<t.length;r++){var a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=n+a.byteLength;this.shards.push({buffer:a,start:n,end:i}),n=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return Re(e,[{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));for(var r=new ArrayBuffer(t-e),a=new Uint8Array(r),i=0,o=n;o<this.shards.length;o++){var s=this.shards[o],u=e+i-s.start,c=i,l=Math.min(t,s.end)-s.start,h=new Uint8Array(s.buffer,u,l-u);if(a.set(h,c),i+=h.length,t<s.end)break}return r}},{key:"findShardForByte",value:function(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;var n=function(e,t){var n=0,r=e.length;for(;n<=r;){var a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}],[{key:"join",value:function(t){return new e(t).slice()}}]),e}();var Ls=4;function zs(e,t){return Bs.apply(this,arguments)}function Bs(){return Bs=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=Gt().mark((function e(){var o,u,c,l;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(u=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===u.dtype||"bool"===u.dtype||"string"===u.dtype||"complex64"===u.dtype){e.next=4;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));case 4:c={name:o,shape:u.shape,dtype:u.dtype},"string"===u.dtype?(l=new Promise(function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,c;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+Ls*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=Ls,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(l)):a.push(u.data()),null!=n&&(c.group=n),r.push(c);case 8:case"end":return e.stop()}}),e)})),s=0;case 5:if(!(s<i.length)){e.next=10;break}return e.delegateYield(o(),"t0",7);case 7:++s,e.next=5;break;case 10:return e.next=12,Promise.all(a);case 12:return u=e.sent,e.abrupt("return",{data:Ws(u),specs:r});case 14:case"end":return e.stop()}}),e)}))),Bs.apply(this,arguments)}function Us(e,t){var n,r,a=new Ps(e),i={},o=0,s=Kt(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,c=u.name,l=u.dtype,h=u.shape,p=on(h),d=void 0;if("quantization"in u){var f=u.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(u.name," with quantization ").concat(f.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(u.name," has unknown ")+"quantization dtype ".concat(f.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==l)throw new Error("Weight ".concat(u.name," is quantized with ").concat(f.dtype," ")+"which only supports weights of type float32 not ".concat(l,"."))}var m=Ms[f.dtype],v=a.slice(o,o+p*m),g="uint8"===f.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===l)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(g.length);for(var y=0;y<g.length;y++){var b=g[y];d[y]=b*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type float32.");void 0===n&&(n=eu()),d=n(g)}else{if("int32"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type int32.");d=new Int32Array(g.length);for(var x=0;x<g.length;x++){var k=g[x];d[x]=Math.round(k*f.scale+f.min)}}o+=p*m}else if("string"===l){var w=on(u.shape);d=[];for(var S=0;S<w;S++){var I=new Uint32Array(a.slice(o,o+Ls))[0];o+=Ls;var C=new Uint8Array(a.slice(o,o+I));d.push(C),o+=I}}else{var T=Ms[l],N=a.slice(o,o+p*T);if("float32"===l)d=new Float32Array(N);else if("int32"===l)d=new Int32Array(N);else if("bool"===l)d=new Uint8Array(N);else{if("complex64"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));d=new Float32Array(N);for(var E=new Float32Array(d.length/2),R=new Float32Array(d.length/2),A=0;A<E.length;A++)E[A]=d[2*A],R[A]=d[2*A+1];var _=Ds(E,h,"float32"),O=Ds(R,h,"float32");i[c]=Os(_,O),_.dispose(),O.dispose()}o+=p*T}"complex64"!==l&&(i[c]=Ds(d,h,l))}}catch(F){s.e(F)}finally{s.f()}return i}function Ws(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var Vs="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function Gs(e){return Vs?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function js(e){if(Vs)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Hs(e){if(Vs){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function Zs(e){return Ps.join(e)}function Ks(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function qs(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function Xs(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function Ys(e,t){return Qs.apply(this,arguments)}function Qs(){return Qs=Ht(Gt().mark((function e(t,n){var r,a,i,o;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.weightsManifest){e.next=7;break}return e.next=3,n(t.weightsManifest);case 3:i=e.sent,o=(0,E.Z)(i,2),r=o[0],a=o[1];case 7:return e.abrupt("return",Xs(t,r,a));case 8:case"end":return e.stop()}}),e)}))),Qs.apply(this,arguments)}function Js(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Gs(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Gs(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new Ps(e.weightData).byteLength}}function $s(e){var t,n=[],r=Kt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,(0,Lt.Z)(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function eu(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var tu=function(){function e(){Te(this,e),this.saveRouters=[],this.loadRouters=[]}return Re(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),nu=function(e){return tu.registerSaveRouter(e)},ru=function(e){return tu.registerLoadRouter(e)},au=function(e){return tu.getSaveHandlers(e)},iu=function(e,t){return tu.getLoadHandlers(e,t)},ou="tensorflowjs",su="models_store",uu="model_info_store";function cu(){if(!zn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function lu(e){var t=e.result;t.createObjectStore(su,{keyPath:"modelPath"}),t.createObjectStore(uu,{keyPath:"modelPath"})}var hu=function(){function e(t){if(Te(this,e),this.indexedDB=cu(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return Re(e,[{key:"save",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(ou,1);a.onupgradeneeded=function(){return lu(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(su,"readonly"),s=o.objectStore(su).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{t.weightData=Ps.join(t.weightData);var u,c,l=Js(t),h=i.transaction(uu,"readwrite"),p=h.objectStore(uu);try{u=p.put({modelPath:n.modelPath,modelArtifactsInfo:l})}catch(d){return r(d)}u.onsuccess=function(){var a,o=(c=i.transaction(su,"readwrite")).objectStore(su);try{a=o.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l})}catch(d){return r(d)}a.onsuccess=function(){return e({modelArtifactsInfo:l})},a.onerror=function(e){var t=(p=h.objectStore(uu)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},u.onerror=function(e){return i.close(),r(u.error)},h.oncomplete=function(){null==c?i.close():c.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();hu.URL_SCHEME="indexeddb://";var pu=function(e){return zn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(hu.URL_SCHEME)?(t=e.slice(hu.URL_SCHEME.length),new hu(t)):null;var t};tu.registerSaveRouter(pu),tu.registerLoadRouter(pu);var du=function(){function e(){Te(this,e),this.indexedDB=cu()}return Re(e,[{key:"listModels",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(ou,1);r.onupgradeneeded=function(){return lu(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(uu,"readonly"),i=a.objectStore(uu).getAll();i.onsuccess=function(){var t,n={},r=Kt(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=Ht(Gt().mark((function e(t){var n=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(hu.URL_SCHEME)?r.slice(hu.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(ou,1);a.onupgradeneeded=function(){return lu(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(uu,"readwrite"),s=o.objectStore(uu),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(su,"readwrite")).objectStore(su).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),fu="/",mu="tensorflowjs_models",vu="info",gu="model_topology",yu="weight_specs",bu="weight_data",xu="model_metadata";function ku(e){return{info:[mu,e,vu].join(fu),topology:[mu,e,gu].join(fu),weightSpecs:[mu,e,yu].join(fu),weightData:[mu,e,bu].join(fu),modelMetadata:[mu,e,xu].join(fu)}}function wu(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function Su(e){var t=e.split(fu);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(fu)}var Iu=function(){function e(t){if(Te(this,e),!zn().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=ku(this.modelPath)}return Re(e,[{key:"save",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Js(t),i=Ps.join(t.weightData),e.prev=8,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,js(i)),o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),e.abrupt("return",{modelArtifactsInfo:a});case 18:throw e.prev=18,e.t0=e.catch(8),wu(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 22:case"end":return e.stop()}}),e,this,[[8,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=Hs(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();Iu.URL_SCHEME="localstorage://";var Cu=function(e){return zn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Iu.URL_SCHEME)?(t=e.slice(Iu.URL_SCHEME.length),new Iu(t)):null;var t};tu.registerSaveRouter(Cu),tu.registerLoadRouter(Cu);var Tu=function(){function e(){Te(this,e),nn(zn().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),nn("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return Re(e,[{key:"listModels",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=mu+fu,r=fu+vu,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=Su(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(Iu.URL_SCHEME)?a.slice(Iu.URL_SCHEME.length):a,n=ku(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),wu(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Nu="://",Eu=function(){function e(){Te(this,e),this.managers={}}return Re(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){nn(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Nu)&&(t=t.slice(0,t.indexOf(Nu))),nn(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();nn(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function Ru(e){if(-1===e.indexOf(Nu))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(Eu.getSchemes().join(",")));return{scheme:e.split(Nu)[0],path:e.split(Nu)[1]}}function Au(e,t){return _u.apply(this,arguments)}function _u(){return _u=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],nn(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),nn((a=tu.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),nn(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],nn((o=tu.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),nn(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],u=Ru(t).scheme,c=Ru(t).path,l=u===Ru(t).scheme,e.next=15,i.load();case 15:if(h=e.sent,!r||!l){e.next=19;break}return e.next=19,Eu.getManager(u).removeModel(c);case 19:return e.next=21,s.save(h);case 21:if(p=e.sent,!r||l){e.next=25;break}return e.next=25,Eu.getManager(u).removeModel(c);case 25:return e.abrupt("return",p.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),_u.apply(this,arguments)}function Ou(){return Fu.apply(this,arguments)}function Fu(){return(Fu=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Eu.getSchemes(),n={},r=Kt(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,Eu.getManager(i).listModels();case 9:for(s in o=e.sent)n[i+Nu+s]=o[s];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function Du(e){return Mu.apply(this,arguments)}function Mu(){return(Mu=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ru(t),r=Eu.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pu(e,t){return Lu.apply(this,arguments)}function Lu(){return(Lu=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",Au(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zu(e,t){return Bu.apply(this,arguments)}function Bu(){return(Bu=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",Au(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Uu=function(){function e(){Te(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return Re(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!==typeof window&&zn().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return co(e)}}]),e}();if(zn().get("IS_BROWSER")){zn().setPlatform("browser",new Uu);try{Eu.registerManager(Iu.URL_SCHEME,new Tu)}catch($Q){}try{Eu.registerManager(hu.URL_SCHEME,new du)}catch($Q){}}var Wu,Vu=function(){return n(5410)};var Gu=function(){function e(){Te(this,e),this.util=n(8628),this.textEncoder=new this.util.TextEncoder}return Re(e,[{key:"fetch",value:function(e,t){return null!=zn().global.fetch?zn().global.fetch(e,t):(null==Wu&&(Wu=Vu()),Wu(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function ju(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",_n(e),new Xo(e,t,n)}zn().get("IS_NODE")&&!zn().get("IS_BROWSER")&&zn().setPlatform("node",new Gu);var Hu=_s({cast_:function(e,t){var n=Es(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return xs.runKernel(pr,r,a)}});var Zu=_s({clone_:function(e){var t={x:Es(e,"x","clone","string_or_numeric")};return xs.runKernel(aa,t)}});function Ku(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function qu(){return xs}function Xu(){return xs.memory()}function Yu(e,t){return xs.tidy(e,t)}function Qu(e){ds(e).forEach((function(e){return e.dispose()}))}function Ju(e){return xs.keep(e)}function $u(){return xs.backendName}function ec(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return xs.registerBackend(e,t,n)}function tc(){return xs.backend}ys(),Qo={buffer:ju,cast:Hu,clone:Zu,print:Ku};var nc=_s({add_:function(e,t){var n=Es(e,"a","add"),r=Es(t,"b","add"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(Zn,o)}});var rc=_s({floorDiv_:function(e,t){var n=Es(e,"a","floorDiv"),r=Es(t,"b","floorDiv"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(Jr,o)}});var ac=_s({div_:function(e,t){var n=Es(e,"a","div"),r=Es(t,"b","div"),a=hs(n,r),i=(0,E.Z)(a,2);if(n=i[0],r=i[1],"int32"===n.dtype&&"int32"===r.dtype)return rc(n,r);var o={a:n,b:r};return xs.runKernel(Br,o,{})}});var ic=_s({mul_:function(e,t){var n=Es(e,"a","mul"),r=Es(t,"b","mul"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(Da,o)}});var oc=_s({sqrt_:function(e){var t={x:Es(e,"x","sqrt","float32")};return xs.runKernel(xi,t)}});var sc=_s({square_:function(e){var t=Es(e,"x","square");return xs.runKernel("Square",{x:t},{})}});var uc=_s({zerosLike_:function(e){var t={x:Es(e,"x","zerosLike")};return xs.runKernel(Ki,t)}});function cc(e){return xs.customGrad(e)}function lc(e,t){if((Ao(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Ao(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Fs(e,[],[],t)}var hc=function(){function e(){Te(this,e)}return Re(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),pc=function(){function e(){Te(this,e),this.classNameMap={}}return Re(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function dc(e){nn(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),nn("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),nn(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),pc.register(e)}var fc=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Qu(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){nn(wn(e),(function(){return"The f passed in variableGrads(f) must be a function"})),nn(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof is})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],xs.registeredVariables)t.push(xs.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),nn(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=xs.gradients(e,t,null,!0),s=o.value,u=o.grads;nn(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),nn(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Qu(this.iterations_)}},{key:"saveIterations",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:lc(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(hc);Object.defineProperty(fc,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var mc=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Te(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=xs.backend.epsilon()),a}return Re(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=xs.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Yu((function(){return uc(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Yu((function(){return uc(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Yu((function(){var e=nc(ic(o,t.rho),ic(sc(i),1-t.rho)),n=ic(ac(oc(nc(s,t.epsilon)),oc(nc(o,t.epsilon))),i),r=nc(ic(s,t.rho),ic(sc(n),1-t.rho));o.assign(e),s.assign(r);var u=nc(ic(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Qu(this.accumulatedGrads.map((function(e){return e.variable}))),Qu(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,Lt.Z)(this.accumulatedGrads),(0,Lt.Z)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){var n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adadelta"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(fc);function vc(e,t,n){_n(e);var r={shape:e,value:t,dtype:n=n||kn(t)};return xs.runKernel(Xr,{},r)}var gc=function(e){Mo(n,e);var t=Uo(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return Te(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return Re(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=xs.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Yu((function(){return vc(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Yu((function(){var e=nc(o,sc(i));o.assign(e);var n=nc(ic(ac(i,oc(nc(e,xs.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Qu(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"className",get:function(){return"Adagrad"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(fc);var yc=_s({pow_:function(e,t){var n=Es(e,"base","pow"),r=Es(t,"exp","pow"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(ja,o)}});var bc=_s({sub_:function(e,t){var n=Es(e,"a","sub"),r=Es(t,"b","sub"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(Li,o)}}),xc=function(e){Mo(n,e);var t=Uo(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Te(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Yu((function(){i.accBeta1=lc(r).variable(),i.accBeta2=lc(a).variable()})),null==o&&(i.epsilon=xs.backend.epsilon()),i}return Re(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Yu((function(){var r=bc(1,t.accBeta1),a=bc(1,t.accBeta2);n.forEach((function(n,i){var o=xs.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Yu((function(){return uc(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Yu((function(){return uc(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=nc(ic(u,t.beta1),ic(s,1-t.beta1)),h=nc(ic(c,t.beta2),ic(sc(s),1-t.beta2)),p=ac(l,r),d=ac(h,a);u.assign(l),c.assign(h);var f=nc(ic(ac(p,nc(oc(d),t.epsilon)),-t.learningRate),o);o.assign(f)}})),t.accBeta1.assign(ic(t.accBeta1,t.beta1)),t.accBeta2.assign(ic(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Qu(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Qu(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,Lt.Z)(this.accumulatedFirstMoment),(0,Lt.Z)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){var n,r=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,Yu((function(){r.accBeta1.assign(yc(r.beta1,r.iterations_+1)),r.accBeta2.assign(yc(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adam"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(fc);var kc=_s({abs_:function(e){var t=Es(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return xs.runKernel(vr,n)}var r={x:t};return xs.runKernel(Gn,r)}});function wc(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function Sc(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function Ic(e,t){for(var n=Math.max(e.length,t.length),r=new Array(n),a=0;a<n;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}r[n-a-1]=i}}return r}var Cc=_s({maximum_:function(e,t){var n=Es(e,"a","maximum"),r=Es(t,"b","maximum"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],"bool"===n.dtype&&(n=Hu(n,"int32"),r=Hu(r,"int32")),Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(wa,o)}}),Tc=function(e){Mo(n,e);var t=Uo(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Te(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Yu((function(){i.iteration=lc(0).variable(),i.accBeta1=lc(r).variable()})),null==o&&(i.epsilon=xs.backend.epsilon()),i}return Re(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Yu((function(){var r=bc(1,t.accBeta1),a=ac(-t.learningRate,nc(ic(t.iteration,t.decay),1));n.forEach((function(n,i){var o=xs.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:uc(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:uc(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=nc(ic(u,t.beta1),ic(s,1-t.beta1)),h=ic(c,t.beta2),p=kc(s),d=Cc(h,p);u.assign(l),c.assign(d);var f=nc(ic(ac(a,r),ac(l,nc(d,t.epsilon))),o);o.assign(f)}})),t.iteration.assign(nc(t.iteration,1)),t.accBeta1.assign(ic(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Qu(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Qu(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"className",get:function(){return"Adamax"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(fc),Nc=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return Re(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=xs.registeredVariables[n];Yu((function(){var e=nc(ic(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Ju(lc(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"className",get:function(){return"SGD"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(fc),Ec=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Te(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=lc(a.momentum),a}return Re(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=xs.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Yu((function(){return uc(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Yu((function(){var e,n=nc(ic(t.m,i),o);e=t.useNesterov?nc(ic(t.c,nc(o,ic(n,t.m))),a):nc(ic(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Qu(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"className",get:function(){return"Momentum"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(Nc),Rc=function(e){Mo(n,e);var t=Uo(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Te(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=xs.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return Re(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=xs.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Yu((function(){return uc(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Yu((function(){return uc(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Yu((function(){return uc(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;Yu((function(){var e=nc(ic(s,t.decay),ic(sc(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=nc(ic(n,t.decay),ic(o,1-t.decay)),c=ac(ic(o,t.learningRate),oc(bc(e,nc(sc(i),t.epsilon)))),l=nc(ic(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var h=bc(a,l);a.assign(h)}else{var p=nc(ic(s,t.decay),ic(sc(o),1-t.decay)),d=nc(ic(u,t.momentum),ac(ic(o,t.learningRate),oc(nc(p,t.epsilon))));s.assign(p),u.assign(d);var f=bc(a,d);a.assign(f)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Qu(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Qu(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Qu(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,Lt.Z)(this.accumulatedMeanSquares),(0,Lt.Z)(this.accumulatedMoments)),this.centered&&t.push.apply(t,(0,Lt.Z)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"className",get:function(){return"RMSProp"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(fc),Ac=[mc,gc,xc,Tc,Ec,Rc,Nc];function _c(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Oc=function(){function e(t){if(Te(this,e),!zn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return Re(e,[{key:"save",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,u;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=Ps.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=8;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 8:return a=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i=qs(t,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,s.href=o,e.next=16,_c((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:if(null==t.weightData){e.next=22;break}return(u=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=r,e.next=22,_c((function(){return u.dispatchEvent(new MouseEvent("click"))}));case 22:return e.abrupt("return",{modelArtifactsInfo:Js(t)});case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Oc.URL_SCHEME="downloads://";var Fc=function(){function e(t){if(Te(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return Re(e,[{key:"load",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=Ys(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=Kt(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,(0,Lt.Z)(o.weights)),a.push.apply(a,(0,Lt.Z)(o.paths))}}catch($Q){i.e($Q)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,e]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return Ks(e.name)})),i={},o=Kt(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=Ks(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch($Q){o.e($Q)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function Dc(e){return new Fc(e)}function Mc(e,t,n,r){!function(e){nn(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){nn(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),nn(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),nn(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Pc(e,t){return Lc.apply(this,arguments)}function Lc(){return(Lc=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?zn().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Mc(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,Mc(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return h=e.t1,e.abrupt("return",h);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zc(e){return Bc.apply(this,arguments)}function Bc(){return Bc=Ht(Gt().mark((function e(t){var n,r,a,i,o=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=Uc((function(e){return Pc(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),Bc.apply(this,arguments)}function Uc(e){return function(){var t=Ht(Gt().mark((function t(n){var r,a,i,o,s,u,c,l,h,p,d,f,m=arguments;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=Ms[r]*on(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 10:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),h=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;h.push(t)}))})),t.next=15,e(h);case 15:return p=t.sent,d={},f=0,l.forEach((function(e){var t=n[e].paths.length,r=new Ps(p.slice(f,f+t));o[e].forEach((function(e){var t=Us(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),f+=t})),t.abrupt("return",d);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}tu.registerSaveRouter((function(e){return zn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Oc.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Oc(e)}(e.slice(Oc.URL_SCHEME.length)):null}));var Wc=function(){function e(t,n){if(Te(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(nn("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=zn().platform.fetch,nn(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&nn(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return Re(e,[{key:"save",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=qs(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&(i=Ps.join(t.weightData),n.body.append("model.weights.bin",new Blob([i],{type:"application/octet-stream"}),"model.weights.bin")),e.next=10,this.fetch(this.path,n);case 10:if(!(o=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:Js(t),responses:[o]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",Ys(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,p,d,f,m,v,g;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Vc(n),a=(0,E.Z)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=$s(t),c=[],l=[],h=Kt(t);try{for(h.s();!(p=h.n()).done;){d=p.value,f=Kt(d.paths);try{for(f.s();!(m=f.n()).done;)v=m.value,null!=this.weightUrlConverter?l.push(this.weightUrlConverter(v)):c.push(s+v+o)}catch($Q){f.e($Q)}finally{f.f()}}}catch($Q){h.e($Q)}finally{h.f()}if(!this.weightUrlConverter){e.next=17;break}return e.t0=c.push,e.t1=c,e.t2=Lt.Z,e.next=14,Promise.all(l);case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 17:return e.next=19,Pc(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 19:return g=e.sent,e.abrupt("return",[u,g]);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Vc(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Gc(e){return null!=e.match(Wc.URL_SCHEME_REGEX)}Wc.URL_SCHEME_REGEX=/^https?:\/\//;var jc=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Gc(e)})):Gc(e))?Hc(e,t):null};function Hc(e,t){return new Wc(e,t)}function Zc(e,t){return Hc(e,t)}tu.registerSaveRouter(jc),tu.registerLoadRouter(jc);var Kc,qc=function(){function e(t){Te(this,e),this.modelArtifacts=t}return Re(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),Xc=function(){function e(t){Te(this,e),this.saveHandler=t}return Re(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Yc=Re((function e(t){Te(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Qc(e,t,n,r){var a=arguments;return new Yc(Jc.apply(void 0,(0,Lt.Z)(a)))}function Jc(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new qc(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new qc({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new qc({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function $c(e){return new Xc(e)}function el(e){return new Xc(e)}function tl(e,t,n){if(an(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Cs(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Fs(e,t,r,n)}var nl=!1;function rl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));s=!0}if(null!=ro(Xi,xs.backendName)){var u={pixels:e},c={numChannels:t};return xs.runKernel(Xi,u,c)}var l,h,p=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],d=(0,E.Z)(p,2),f=d[0],m=d[1];if(o)l=e.getContext("2d").getImageData(0,0,f,m).data;else if(r||n)l=e.data;else if(i||a||s){if(null==Kc)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Kc=new OffscreenCanvas(1,1).getContext("2d")}else Kc=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Kc.canvas.width=f,Kc.canvas.height=m,Kc.drawImage(e,0,0,f,m),l=Kc.getImageData(0,0,f,m).data}if(4===t)h=new Int32Array(l);else{var v=f*m;h=new Int32Array(v*t);for(var g=0;g<v;g++)for(var y=0;y<t;++y)h[g*t+y]=l[4*g+y]}return tl(h,[m,f,t],"int32")}function al(e){if(2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(e.rank,"."));var t=2===e.rank?1:e.shape[2];if(t>4||2===t)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(t));if("float32"!==e.dtype&&"int32"!==e.dtype)throw new Error("Unsupported type for toPixels: ".concat(e.dtype,".")+" Please use float32 or int32 tensors.")}function il(e,t){return ol.apply(this,arguments)}function ol(){return(ol=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Es(t,"img","toPixels"),t instanceof Jo||(r=Hu(a=r,"int32"),a.dispose()),al(r),i=r.shape.slice(0,2),o=(0,E.Z)(i,2),s=o[0],u=o[1],c=2===r.rank?1:r.shape[2],e.next=7,r.data();case 7:l=e.sent,h="float32"===r.dtype?255:1,p=new Uint8ClampedArray(u*s*4),d=0;case 11:if(!(d<s*u)){e.next=36;break}f=[0,0,0,255],m=0;case 14:if(!(m<c)){e.next=28;break}if(v=l[d*c+m],"float32"!==r.dtype){e.next=21;break}if(!(v<0||v>1)){e.next=19;break}throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(v,"."));case 19:e.next=24;break;case 21:if("int32"!==r.dtype){e.next=24;break}if(!(v<0||v>255)){e.next=24;break}throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(v,"."));case 24:1===c?(f[0]=v*h,f[1]=v*h,f[2]=v*h):f[m]=v*h;case 25:m++,e.next=14;break;case 28:p[(g=4*d)+0]=Math.round(f[0]),p[g+1]=Math.round(f[1]),p[g+2]=Math.round(f[2]),p[g+3]=Math.round(f[3]);case 33:++d,e.next=11;break;case 36:return null!=n&&(nl||(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),nl=!0),n.width=u,n.height=s,y=n.getContext("2d"),b=new ImageData(p,u,s),y.putImageData(b,0,0)),r!==t&&r.dispose(),e.abrupt("return",p);case 39:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var sl=_s({fromPixels_:rl}),ul=-2,cl=-1;function ll(e,t,n){var r=e.shape.length;nn(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),nn(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){nn(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function hl(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function pl(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function dl(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function fl(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat((0,Lt.Z)(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){nn(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat((0,Lt.Z)(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(nn(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function ml(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,h={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},p=0;p<h.dims;p++)l&&0!==(1<<p&s)&&h.numAddAxisAfterEllipsis++,1<<p&o&&(l=!0);l||(h.ellipsisMask|=1<<h.dims,h.dims++);var d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(ul),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(cl),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);for(var f=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===d.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(d.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[d.beginMask&1<<b,d.endMask&1<<b],S=[d.strides[b]>0?0:-1,d.strides[b]>0?k:k-1];if(x&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===d.strides[b];var I=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(x){var C=d.begin[b]<0?k+d.begin[b]:d.begin[b];if(d.begin[b]=C,d.end[b]=d.begin[b]+1,C<0||C>=k)throw Error("slice index ".concat(d.begin[b]," of dimension ").concat(b," out of bounds."))}else d.begin[b]=vl(d.begin[b],0,d.strides[b],k,w,S),d.end[b]=vl(d.end[b],1,d.strides[b],k,w,S);var T=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===k;f=f&&T,m=m&&(0===b&&1===d.strides[b]||T)}else f=f&&1===d.strides[b]&&I,m=m&&(0===b&&1===d.strides[b]||I);var N=void 0,E=!1;if(d.beginValid&&d.endValid?(N=d.end[b]-d.begin[b],E=!0):x?(N=1,E=!0):I&&k>=0&&(N=d.strides[b]<0?-k:k,E=!0),E){var R=void 0;R=0===N||N<0!==d.strides[b]<0?0:Math.trunc(N/d.strides[b])+(N%d.strides[b]!==0?1:0),g.push(R)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<d.finalShapeGatherIndices.length;++A){var _=d.finalShapeGatherIndices[A];_>=0?y.push(g[_]):_===ul&&y.push(1)}var O=y.filter((function(e,t){return d.finalShapeGatherIndices[t]!==ul}));return{finalShapeSparse:O,finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:v,begin:d.begin,end:d.end,strides:d.strides}}function vl(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var gl=_s({acos_:function(e){var t={x:Es(e,"x","acos")};return xs.runKernel(jn,t)}});var yl=_s({acosh_:function(e){var t={x:Es(e,"x","acosh")};return xs.runKernel(Hn,t)}});var bl=_s({addN_:function(e){nn(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),nn(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length)}));var t=e.map((function(e,t){return Es(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!sn(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return xs.runKernel(Kn,r)}});var xl=_s({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Es(e,"x","all","bool")},a={axis:t,keepDims:n};return xs.runKernel(qn,r,a)}});var kl=_s({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Es(e,"x","any","bool")},a={axis:t,keepDims:n};return xs.runKernel(Xn,r,a)}});var wl=_s({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Es(e,"x","argMax")},r={axis:t};return xs.runKernel(Yn,n,r)}});var Sl=_s({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Es(e,"x","argMin")},r={axis:t};return xs.runKernel(Qn,n,r)}});var Il=_s({asin_:function(e){var t={x:Es(e,"x","asin")};return xs.runKernel(Jn,t)}});var Cl=_s({asinh_:function(e){var t={x:Es(e,"x","asinh")};return xs.runKernel($n,t)}});var Tl=_s({atan_:function(e){var t={x:Es(e,"x","atan")};return xs.runKernel(er,t)}});var Nl=_s({atan2_:function(e,t){var n=Es(e,"a","atan2"),r=Es(t,"b","atan2"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(nr,o)}});var El=_s({atanh_:function(e){var t={x:Es(e,"x","atanh")};return xs.runKernel(tr,t)}});function Rl(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return Ol(e,[].concat((0,Lt.Z)(t),[o]),n,i,r,null,null,Vl(a))}function Al(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Ml(t),c=(0,E.Z)(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,h,e[1],e[1]]}return Ol(e,o,n,r,a,i,!1,s)}function _l(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Pl(t),l=(0,E.Z)(c,3),h=l[0],p=l[1],d=l[2];if("NDHWC"===u)s="channelsLast",o=[h,p,d,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[h,p,d,e[1],e[1]]}return Fl(e,o,n,r,a,!1,s,i)}function Ol(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var p=(0,E.Z)(e,4);u=p[0],c=p[1],l=p[2],h=p[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var d=(0,E.Z)(e,4);u=d[0],h=d[1],c=d[2],l=d[3]}var f,m=(0,E.Z)(t,4),v=m[0],g=m[1],y=m[3],b=Ml(n),x=(0,E.Z)(b,2),k=x[0],w=x[1],S=Ml(r),I=(0,E.Z)(S,2),C=I[0],T=I[1],N=Ll(v,C),R=Ll(g,T),A=function(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var p=function(e,t,n,r,a){null==r&&(r=Dl(e,t,n));var i=e[0],o=e[1],s=zl((i-t+2*r)/n+1,a),u=zl((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=p[0],h=p[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(h-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=zl((t-i+y+b)/r+1,s),h=zl((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}(a,c,l,k,w,N,R,i,s),_=A.padInfo,O=A.outHeight,F=A.outWidth,D=o?y*h:y;return"channelsFirst"===s?f=[u,D,O,F]:"channelsLast"===s&&(f=[u,O,F,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:O,outWidth:F,outChannels:D,padInfo:_,strideHeight:k,strideWidth:w,filterHeight:v,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:R,dilationHeight:C,dilationWidth:T,inShape:e,outShape:f,filterShape:t}}function Fl(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,p=-1;if("channelsLast"===o){var d=(0,E.Z)(e,5);u=d[0],c=d[1],l=d[2],h=d[3],p=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var f=(0,E.Z)(e,5);u=f[0],p=f[1],c=f[2],l=f[3],h=f[4]}var m,v=(0,E.Z)(t,5),g=v[0],y=v[1],b=v[2],x=v[4],k=Pl(n),w=(0,E.Z)(k,3),S=w[0],I=w[1],C=w[2],T=Pl(r),N=(0,E.Z)(T,3),R=N[0],A=N[1],_=N[2],O=Ll(g,R),F=Ll(y,A),D=Ll(b,_),M=function(e,t,n,r,a,i,o,s,u,c,l){var h,p,d,f;"valid"===e&&(e=0);if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=Dl(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=zl((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,c],1,[a,i,o],e,l);p=m[0],d=m[1],f=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var v=((p=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((f=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,S=Math.floor(y/2);h={top:k,bottom:w,left:S,right:y-S,front:b,back:x,type:"SAME"}}return{padInfo:h,outDepth:p,outHeight:d,outWidth:f}}(a,c,l,h,S,I,C,O,F,D,s),P=M.padInfo,L=M.outDepth,z=M.outHeight,B=M.outWidth,U=i?x*p:x;return"channelsFirst"===o?m=[u,U,L,z,B]:"channelsLast"===o&&(m=[u,L,z,B,U]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:p,outDepth:L,outHeight:z,outWidth:B,outChannels:U,padInfo:P,strideDepth:S,strideHeight:I,strideWidth:C,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:O,effectiveFilterHeight:F,effectiveFilterWidth:D,dilationDepth:R,dilationHeight:A,dilationWidth:_,inShape:e,outShape:m,filterShape:t}}function Dl(e,t,n){var r=Ll(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function Ml(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Pl(e){return"number"===typeof e?[e,e,e]:e}function Ll(e,t){return t<=1?e:e+(e-1)*(t-1)}function zl(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Bl(e){var t=Ml(e),n=(0,E.Z)(t,3),r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function Ul(e,t){return Bl(e)||Bl(t)}function Wl(e){return Ml(e).every((function(e){return e>0}))}function Vl(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function Gl(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)nn(un(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){nn(un(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}var jl=_s({reshape_:function(e,t){var n={x:Es(e,"x","reshape","string_or_numeric")},r={shape:t};return xs.runKernel(ei,n,r)}});var Hl=_s({avgPool_:function(e,t,n,r,a){var i=Es(e,"x","avgPool","float32");nn(Ul(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=jl(i,[1,i.shape[0],i.shape[1],i.shape[2]])),nn(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),Gl("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=xs.runKernel(rr,u,c);return l=Hu(l,i.dtype),s?jl(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Zl=_s({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Es(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=jl(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),nn(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),nn("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),nn("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),Gl("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=xs.runKernel(ir,c,l);return h=Hu(h,s.dtype),u?jl(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var Kl=_s({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;nn(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Rs(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return Zu(n[0]);var r=n,a={axis:t};return xs.runKernel(gr,r,a)}});var ql=_s({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Es(e,"a","matMul"),i=Es(t,"b","matMul"),o=hs(a,i),s=(0,E.Z)(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return xs.runKernel(sr,u,c)}});var Xl=_s({sigmoid_:function(e){var t={x:Es(e,"x","sigmoid","float32")};return xs.runKernel(yi,t)}});var Yl=_s({slice_:function(e,t,n){var r=Es(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return xs.runKernel(fi,a,i)}});var Ql=_s({tanh_:function(e){var t={x:Es(e,"x","tanh","float32")};return xs.runKernel(Bi,t)}});var Jl=_s({basicLSTMCell_:function(e,t,n,r,a,i){var o=Es(e,"forgetBias","basicLSTMCell"),s=Es(t,"lstmKernel","basicLSTMCell"),u=Es(n,"lstmBias","basicLSTMCell"),c=Es(r,"data","basicLSTMCell"),l=Es(a,"c","basicLSTMCell"),h=Es(i,"h","basicLSTMCell"),p=Kl([c,h],1),d=ql(p,s),f=nc(d,u),m=f.shape[0],v=f.shape[1]/4,g=[m,v],y=Yl(f,[0,0],g),b=Yl(f,[0,v],g),x=Yl(f,[0,2*v],g),k=Yl(f,[0,3*v],g),w=nc(ic(Xl(y),Ql(b)),ic(l,Xl(nc(o,x))));return[w,ic(Ql(w),Xl(k))]}});var $l=_s({batchToSpaceND_:function(e,t,n){var r=Es(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));nn(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),nn(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),nn(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return xs.runKernel(ur,i,o)}});var eh=_s({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=Es(e,"x","batchNorm"),c=Es(t,"mean","batchNorm"),l=Es(n,"variance","batchNorm");null!=a&&(o=Es(a,"scale","batchNorm")),null!=r&&(s=Es(r,"offset","batchNorm")),nn(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),nn(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),nn(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h={x:function(e){return 0===e.rank||1===e.rank?jl(e,[1,1,1,e.size]):2===e.rank?jl(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?jl(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),scale:o,offset:s,mean:c,variance:l},p={varianceEpsilon:i},d=xs.runKernel($r,h,p);return jl(d,u.shape)}});var th=_s({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Es(e,"x","batchNorm"),c=Es(t,"mean","batchNorm"),l=Es(n,"variance","batchNorm");return null!=a&&(o=Es(a,"scale","batchNorm")),null!=r&&(s=Es(r,"offset","batchNorm")),nn(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),nn(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),nn(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&nn(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&nn(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),eh(u,c,l,s,o,i)}});var nh=_s({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Es(e,"x","batchNorm"),c=Es(t,"mean","batchNorm"),l=Es(n,"variance","batchNorm");return null!=a&&(o=Es(a,"scale","batchNorm")),null!=r&&(s=Es(r,"offset","batchNorm")),nn(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),nn(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),nn(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&nn(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&nn(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),eh(u,c,l,s,o,i)}});var rh=_s({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Es(e,"x","batchNorm"),c=Es(t,"mean","batchNorm"),l=Es(n,"variance","batchNorm");return null!=a&&(o=Es(a,"scale","batchNorm")),null!=r&&(s=Es(r,"offset","batchNorm")),nn(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),nn(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),nn(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&nn(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&nn(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),eh(u,c,l,s,o,i)}});var ah=_s({bincount_:function(e,t,n){var r=Es(e,"x","bincount"),a=Es(t,"weights","bincount");nn("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),nn(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),nn(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return xs.runKernel(cr,i,o)}});var ih=_s({bitwiseAnd_:function(e,t){var n=Es(e,"x","bitwiseAnd"),r=Es(t,"y","bitwiseAnd");if(!sn(n.shape,r.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(n.shape,", y: ").concat(r.shape));if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(n.dtype," and type of y: ").concat(r.dtype));var a={a:n,b:r};return xs.runKernel(lr,a)}});var oh=_s({broadcastArgs_:function(e,t){var n=Es(e,"s0","broadcastArgs","int32"),r=Es(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:n,s1:r};return xs.runKernel(hr,a)}});var sh=_s({broadcastTo_:function(e,t){var n=Es(e,"broadcastTo","x"),r=n.shape;if(_n(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=jl(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return Zu(n);var u={x:n},c={reps:o};return xs.runKernel(Ui,u,c)}});var uh=_s({ceil_:function(e){var t={x:Es(e,"x","ceil","float32")};return xs.runKernel(dr,t)}});var ch=_s({clipByValue_:function(e,t,n){var r=Es(e,"x","clipByValue");if(nn(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")})),t===n)return vc(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return xs.runKernel(fr,a,i)}});var lh=_s({concat1d_:function(e){return Kl(e,0)}});var hh=_s({concat2d_:function(e,t){return Kl(e,t)}});var ph=_s({concat3d_:function(e,t){return Kl(e,t)}});var dh=_s({concat4d_:function(e,t){return Kl(e,t)}});var fh=_s({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Es(e,"x","conv2d","float32"),u=Es(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=jl(s,[1,s.shape[0],s.shape[1],s.shape[2]])),nn(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),nn(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),Gl("conv2d",r,o);var h="NHWC"===a?c.shape[3]:c.shape[1];nn(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),nn(Ul(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),nn(Wl(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),nn(Wl(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var p={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=xs.runKernel(yr,p,d);return l?jl(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var mh=_s({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Es(e,"x","conv1d"),u=Es(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=jl(s,[1,s.shape[0],s.shape[1]])),nn(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),nn(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),Gl("conv1d",r,o),nn(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),nn(Ul(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),nn(Wl(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),nn(Wl(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),nn("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=jl(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=jl(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=fh(p,h,[1,n],r,"NHWC",[1,i],o);return jl(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});var vh=_s({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;nn(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=jl(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),nn(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),nn(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),nn(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];nn(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),nn(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),Gl("conv2dDerInput",a,o);var p={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},f=xs.runKernel(xr,p,d);return c?jl(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var gh=_s({conv2dTranspose_:function(e,t,n,r,a,i){var o=Es(e,"x","conv2dTranspose"),s=Es(t,"filter","conv2dTranspose");return vh(n,o,s,r,a,"NHWC",i)}});var yh=_s({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Es(e,"x","conv3d"),s=Es(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=jl(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),nn(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),nn(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),nn(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),nn(Ul(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),nn("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),nn(Wl(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),nn(Wl(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var l={x:u,filter:s},h={strides:n,pad:r,dataFormat:a,dilations:i},p=xs.runKernel(kr,l,h);return c?jl(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var bh=_s({conv3DBackpropInput_:function(e,t,n,r,a){nn(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=jl(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];nn(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),nn(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),nn(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),nn(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),nn(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},h={pad:a,strides:r,inputShape:i},p=xs.runKernel(Sr,l,h);return s?jl(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var xh=_s({conv3dTranspose_:function(e,t,n,r,a){var i=Es(e,"x","conv3dTranspose"),o=Es(t,"filter","conv3dTranspose");return bh(n,i,o,r,a)}});var kh=_s({cos_:function(e){var t={x:Es(e,"x","cos","float32")};return xs.runKernel(Ir,t)}});var wh=_s({cosh_:function(e){var t={x:Es(e,"x","cosh","float32")};return xs.runKernel(Cr,t)}});var Sh=_s({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:Es(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return xs.runKernel(Tr,a,i)}});var Ih=_s({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:Es(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return xs.runKernel(Nr,a,i)}});var Ch=_s({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Es(e,"x","denseBincount"),i=Es(t,"weights","denseBincount");nn("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),nn(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),nn(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),nn(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return xs.runKernel(Rr,o,s)}});var Th=_s({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Es(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];nn(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),nn(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),nn(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),nn(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return xs.runKernel(Ar,s,u)}});var Nh=_s({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Es(e,"x","depthwiseConv2d","float32"),u=Es(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=jl(s,[1,s.shape[0],s.shape[1],s.shape[2]])),nn(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),nn(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];nn(h===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),Gl("depthwiseConv2d",r,o);var p={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=xs.runKernel(_r,p,d);return l?jl(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Eh=_s({diag_:function(e){var t={x:Es(e,"x","diag")};return xs.runKernel(Dr,t)}});var Rh=_s({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Es(e,"x","dilation2d"),s=Es(t,"filter","dilation2d");nn(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),nn(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),nn("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=jl(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),nn(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var l={x:u,filter:s},h={strides:n,pad:r,dilations:a},p=xs.runKernel(Mr,l,h);return c?jl(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var Ah=_s({equal_:function(e,t){var n=Es(e,"a","equal","string_or_numeric"),r=Es(t,"b","equal","string_or_numeric"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(jr,o)}});var _h=_s({where_:function(e,t,n){var r=Es(t,"a","where"),a=Es(n,"b","where"),i=Es(e,"condition","where","bool"),o=Ic(Ic(i.shape,r.shape),a.shape),s={condition:sh(i,o),t:sh(r,o),e:sh(a,o)};return xs.runKernel(pi,s)}});var Oh=_s({divNoNan_:function(e,t){var n=Es(e,"a","div"),r=Es(t,"b","div"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1];var o=ac(n,r),s=uc(o),u=Ah(r,s);return _h(u,s,o)}});var Fh=_s({dot_:function(e,t){var n=Es(e,"t1","dot"),r=Es(t,"t2","dot");nn((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(nn(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=jl(n,[1,-1]),s=jl(r,[-1,1]),u=ql(o,s);return jl(u,[])}if(1===n.rank&&2===r.rank){var c=jl(n,[1,-1]),l=jl(r,[r.shape[0],r.shape[1]]),h=ql(c,l);return jl(h,[h.size])}if(2===n.rank&&1===r.rank){var p=jl(r,[-1,1]),d=ql(n,p);return jl(d,[d.size])}var f=jl(r,[r.shape[0],r.shape[1]]);return ql(n,f)}});var Dh=_s({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return Es(e,"tensors".concat(t),"einsum")})),i={equation:e};return xs.runKernel(Ur,a,i)}});var Mh=_s({elu_:function(e){var t={x:Es(e,"x","elu","float32")};return xs.runKernel(Wr,t)}});var Ph=_s({ensureShape_:function(e,t){var n=Es(e,"x","ensureShape","string_or_numeric");if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}(n.shape,t))throw new Error("EnsureShape: Shape of tensor ".concat(n.shape," is not compatible with expected shape ").concat(t));return e}});var Lh=_s({erf_:function(e){var t=Es(e,"x","erf");nn("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Hu(t,"float32"));var n={x:t};return xs.runKernel(Gr,n)}});function zh(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Bh(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function Uh(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function Wh(e,t,n){nn(zh(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function Vh(e,t){if(zh(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Gh(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function jh(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Hh=_s({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Es(e,"x","max")},a={reductionIndices:t,keepDims:n};return xs.runKernel(ka,r,a)}});var Zh=_s({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Es(e,"x","min")},a={axis:t,keepDims:n};return xs.runKernel(Ra,r,a)}});var Kh=_s({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Es(e,"x","sum");"bool"===r.dtype&&(r=Hu(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return xs.runKernel(ki,a,i)}});function qh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return kc(e);if(1!==e.rank&&null===n)return qh(jl(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Kh(kc(e),n);if(t===1/0)return Hh(kc(e),n);if(t===-1/0)return Zh(kc(e),n);if("euclidean"===t||2===t)return oc(Kh(yc(kc(e),lc(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Hh(Kh(kc(e),n[0]),n[1]-1);if(t===1/0)return Hh(Kh(kc(e),n[1]),n[0]);if(t===-1/0)return Zh(Kh(kc(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return oc(Kh(sc(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Xh=_s({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qh(e=Es(e,"x","norm"),t,n),i=a.shape;if(r){var o=dn(n,e.shape);i=Uh(a.shape,o)}return jl(a,i)}});var Yh=_s({euclideanNorm_:function(e){return Xh(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});var Qh=_s({exp_:function(e){var t={x:Es(e,"x","exp")};return xs.runKernel(Hr,t)}});var Jh=_s({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Es(e,"x","expandDims","string_or_numeric");nn(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return xs.runKernel(Zr,r,a)}});var $h=_s({expm1_:function(e){var t={x:Es(e,"x","expm1")};return xs.runKernel(Kr,t)}});var ep=_s({tile_:function(e,t){var n=Es(e,"x","tile","string_or_numeric");nn(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return xs.runKernel(Ui,r,a)}});var tp=_s({eye_:function(e,t,n){null==t&&(t=e);for(var r=ju([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=jl(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return ep(Jh(o,0),[n[0],1,1]);if(2===n.length)return ep(Jh(Jh(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return ep(Jh(Jh(Jh(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var np=_s({floor_:function(e){var t={x:Es(e,"x","floor","float32")};return xs.runKernel(Qr,t)}});var rp=_s({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:Es(e,"x","gather"),indices:Es(t,"indices","gather","int32")},i={axis:n,batchDims:r};return xs.runKernel(ea,a,i)}});var ap=_s({greater_:function(e,t){var n=Es(e,"a","greater","string_or_numeric"),r=Es(t,"b","greater","string_or_numeric"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(na,o)}});var ip=_s({greaterEqual_:function(e,t){var n=Es(e,"a","greaterEqual","string_or_numeric"),r=Es(t,"b","greaterEqual","string_or_numeric"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(ra,o)}});var op=_s({imag_:function(e){var t={input:Es(e,"input","imag")};return xs.runKernel(oa,t)}});var sp=_s({isFinite_:function(e){var t={x:Es(e,"x","isFinite")};return xs.runKernel(sa,t)}});var up=_s({isInf_:function(e){var t={x:Es(e,"x","isInf")};return xs.runKernel(ua,t)}});var cp=_s({isNaN_:function(e){var t={x:Es(e,"x","isNaN")};return xs.runKernel(ca,t)}});var lp=_s({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:Es(e,"x","leakyRelu")},r={alpha:t};return xs.runKernel(la,n,r)}});var hp=_s({less_:function(e,t){var n=Es(e,"a","less","string_or_numeric"),r=Es(t,"b","less","string_or_numeric"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(ha,o)}});var pp=_s({lessEqual_:function(e,t){var n=Es(e,"a","lessEqual","string_or_numeric"),r=Es(t,"b","lessEqual","string_or_numeric"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(pa,o)}});function dp(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return xs.runKernel(da,{},r)}var fp=_s({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Es(e,"x","localResponseNormalization");nn(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),nn(un(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=jl(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=xs.runKernel(ba,u,c);return s?jl(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var mp=_s({log_:function(e){var t={x:Es(e,"x","log","float32")};return xs.runKernel(fa,t)}});var vp=_s({log1p_:function(e){var t={x:Es(e,"x","log1p")};return xs.runKernel(ma,t)}});var gp=_s({neg_:function(e){var t={x:Es(e,"x","neg")};return xs.runKernel(Ma,t)}});var yp=_s({softplus_:function(e){var t={x:Es(e,"x","softplus")};return xs.runKernel(bi,t)}});var bp=_s({logSigmoid_:function(e){var t=Es(e,"x","logSigmoid");return cc((function(e){return{value:gp(yp(gp(e))),gradFunc:function(t){return ic(t,Xl(gp(e)))}}}))(t)}});var xp=_s({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Es(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=cc((function(e,n){var r=Hh(e,t,!0),a=bc(e,r),i=bc(Hu(a,"float32"),mp(Kh(Qh(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=(0,E.Z)(n,1)[0],a=Qh(r);return bc(e,ic(Kh(e,t,!0),a))}}}));return r(n)}});var kp=_s({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Es(e,"x","logSumExp"),a=dn(t,r.shape),i=Hh(r,a,!0),o=bc(r,i),s=Qh(o),u=Kh(s,a),c=mp(u),l=nc(jl(i,c.shape),c);if(n){var h=Uh(l.shape,a);return jl(l,h)}return l}});var wp=_s({logicalAnd_:function(e,t){var n=Es(e,"a","logicalAnd","bool"),r=Es(t,"b","logicalAnd","bool");Ic(n.shape,r.shape);var a={a:n,b:r};return xs.runKernel(va,a)}});var Sp=_s({logicalNot_:function(e){var t={x:Es(e,"x","logicalNot","bool")};return xs.runKernel(ga,t)}});var Ip=_s({logicalOr_:function(e,t){var n=Es(e,"a","logicalOr","bool"),r=Es(t,"b","logicalOr","bool");Ic(n.shape,r.shape);var a={a:n,b:r};return xs.runKernel(ya,a)}});var Cp=_s({logicalXor_:function(e,t){var n=Es(e,"a","logicalXor","bool"),r=Es(t,"b","logicalXor","bool");return Ic(n.shape,r.shape),wp(Ip(e,t),Sp(wp(e,t)))}}),Tp=2147483648;var Np=_s({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=Es(e,"sortedSequence","searchSorted"),a=Es(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=jl(r,[-1,i]),u=jl(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(on(u.shape)>=Tp)throw new Error("values tensor size must less than ".concat(Tp));if(s.shape[1]>=Tp)throw new Error("trailing dim_size must less than ".concat(Tp," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return xs.runKernel(hi,c,l)}});function Ep(e,t){return Np(e,t,"left")}var Rp=_s({maxPool_:function(e,t,n,r,a){var i=Es(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=jl(i,[1,i.shape[0],i.shape[1],i.shape[2]])),nn(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),nn(Ul(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),Gl("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=xs.runKernel(Sa,u,c);return s?jl(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Ap=_s({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Es(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=jl(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),nn(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),nn("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Gl("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=xs.runKernel(Ca,c,l);return u?jl(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var _p=_s({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:Es(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=xs.runKernel(Na,i,o);return{result:s[0],indexes:s[1]}}});var Op=_s({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Es(e,"x","mean")},a={axis:t,keepDims:n};return xs.runKernel(Ea,r,a)}});function Fp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(_n(e),"complex64"===t){var n=Fp(e,"float32"),r=Fp(e,"float32");return Os(n,r)}var a=Rn(on(e),t);return xs.makeTensor(a,e,t)}function Dp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(_n(e),"complex64"===t){var n=Dp(e,"float32"),r=Fp(e,"float32");return Os(n,r)}var a=En(on(e),t);return xs.makeTensor(a,e,t)}function Mp(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).indexing,r=void 0===n?"xy":n;if("xy"!==r&&"ij"!==r)throw new TypeError("".concat(r," is not a valid third argument to meshgrid"));if(void 0===e)return[];var a=Es(e,"x","meshgrid",e instanceof Jo?e.dtype:"float32");if(void 0===t)return[a];var i=Es(t,"y","meshgrid",t instanceof Jo?t.dtype:"float32"),o=on(a.shape),s=on(i.shape);return"xy"===r?(a=jl(a,[1,-1]),i=jl(i,[-1,1]),[ql(Dp([s,1],a.dtype),a),ql(i,Dp([1,o],i.dtype))]):(a=jl(a,[-1,1]),i=jl(i,[1,-1]),[ql(a,Dp([1,s],a.dtype)),ql(Dp([o,1],i.dtype),i)])}var Pp=_s({minimum_:function(e,t){var n=Es(e,"a","minimum"),r=Es(t,"b","minimum"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],"bool"===n.dtype&&(n=Hu(n,"int32"),r=Hu(r,"int32")),Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(Aa,o)}});var Lp=_s({mirrorPad_:function(e,t,n){nn("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=Es(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");nn(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){nn(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),nn(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return xs.runKernel(_a,u,s)}});var zp=_s({mod_:function(e,t){var n=Es(e,"a","mod"),r=Es(t,"b","mod"),a=hs(n,r),i=(0,E.Z)(a,2),o={a:n=i[0],b:r=i[1]};return xs.runKernel(Oa,o)}});var Bp=_s({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=dn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=Es(e,"x","moments")).shape),r=Op(e,n,t),a=r.shape;t||(a=Uh(r.shape,n));var i=sc(bc(Hu(e,"float32"),jl(r,a)));return{mean:r,variance:Op(i,n,t)}}});var Up=_s({multiRNNCell_:function(e,t,n,r){for(var a=Es(t,"data","multiRNNCell"),i=Rs(n,"c","multiRNNCell"),o=Rs(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var h=[],p=[],d=0;d<u.length;d+=2)h.push(u[d]),p.push(u[d+1]);return[h,p]}});var Wp=_s({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Es(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?jl(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=xs.runKernel(Fa,s,u);return 1===o?jl(c,[c.size]):c}});var Vp=_s({notEqual_:function(e,t){var n=Es(e,"a","notEqual","string_or_numeric"),r=Es(t,"b","notEqual","string_or_numeric"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(Pa,o)}});var Gp=_s({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:Es(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return xs.runKernel(Wa,i,o)}});var jp=_s({onesLike_:function(e){var t={x:Es(e,"x","onesLike")};return xs.runKernel(Ua,t)}});var Hp=_s({outerProduct_:function(e,t){var n=Es(e,"v1","outerProduct"),r=Es(t,"v2","outerProduct");nn(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=jl(n,[-1,1]),i=jl(r,[1,-1]);return ql(a,i)}});var Zp=_s({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Es(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return xs.runKernel(Ga,i,a)}});var Kp=_s({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return nn(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Zp(e,[t],n)}});var qp=_s({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return nn(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Zp(e,t,n)}});var Xp=_s({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return nn(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Zp(e,t,n)}});var Yp=_s({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return nn(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Zp(e,t,n)}});var Qp=_s({spaceToBatchND_:function(e,t,n){var r=Es(e,"x","spaceToBatchND");nn(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),nn(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),nn(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return xs.runKernel(wi,a,i)}});var Jp=_s({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=Es(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=jl(s,[1,s.shape[0],s.shape[1],s.shape[2]])),nn(Ul(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,h=Al(u.shape,t,i,a,r),p=[h.dilationHeight,h.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})),r=n.map((function(e){return e-1})),a=r.map((function(e){return Math.floor(e/2)})),i=r.map((function(e,t){return e-a[t]}));return r.map((function(e,t){return[a[t],i[t]]}))}([h.filterHeight,h.filterWidth],p):[[0,0],[0,0]];var d=1===p[0]&&1===p[1],f=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([h.inHeight,h.inWidth],p,l),m=(0,E.Z)(f,2),v=m[0],g=m[1],y=d?r:"valid",b=d?u:Qp(u,p,v),x=("avg"===n?function(){return Hl(b,t,i,y,o)}:function(){return Rp(b,t,i,y,o)})(),k=d?x:$l(x,p,g);return c?jl(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});var $p=_s({prelu_:function(e,t){var n={x:Es(e,"x","prelu"),alpha:Es(t,"alpha","prelu")};return xs.runKernel(Ha,n)}});var ed=_s({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Es(e,"x","prod");"bool"===r.dtype&&(r=Hu(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return xs.runKernel(Za,a,i)}});var td=_s({raggedGather_:function(e,t,n,r){var a={paramsNestedSplits:e.map((function(e,t){return Es(e,"tensors".concat(t),"raggedGather","int32")})),paramsDenseValues:Es(t,"paramsDenseValues","raggedGather"),indices:Es(n,"indices","raggedGather","int32")},i={outputRaggedRank:r},o=xs.runKernel(Ka,a,i);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});var nd=_s({raggedRange_:function(e,t,n){var r=Es(e,"starts","raggedRange"),a={starts:r,limits:Es(t,"limits","raggedRange",r.dtype),deltas:Es(n,"deltas","raggedRange",r.dtype)},i=xs.runKernel(qa,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});var rd=_s({raggedTensorToTensor_:function(e,t,n,r,a){var i=Es(e,"shape","raggedTensorToTensor","int32"),o=Es(t,"values","raggedTensorToTensor"),s={shape:i,values:o,defaultValue:Es(n,"defaultValue","raggedTensorToTensor",o.dtype),rowPartitionTensors:r.map((function(e,t){return Es(e,"tensors".concat(t),"raggedTensorToTensor","int32")}))},u={rowPartitionTypes:a};return xs.runKernel(Xa,s,u)}});var ad=_s({rand_:function(e,t,n){_n(e);var r=on(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return xs.makeTensor(a,e,n)}}),id=n(6699),od=function(){function e(t,n,r,a,i){Te(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=id.alea(o.toString())}return Re(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),sd=function(){function e(t,n,r,a){Te(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=id.alea(i.toString()),this.randn=new od(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return Re(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),ud=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(Te(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=id.alea(i)}return Re(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var cd=_s({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(_n(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new sd(t,n,r,a),o=ju(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var ld=_s({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(_n(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new od(t,n,r,!1,a),o=ju(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var hd=_s({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return ld(e,0,1,t,n)}});var pd=_s({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;_n(e);for(var i=ju(e,r),o=new ud(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});var dd=_s({randomUniformInt_:function(e,t,n,r){return pd(e,t,n,"int32",r)}});function fd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return xs.runKernel(Ya,{},a)}var md=_s({real_:function(e){var t={input:Es(e,"input","real")};return xs.runKernel(Qa,t)}});var vd=_s({reciprocal_:function(e){var t={x:Es(e,"x","reciprocal")};return xs.runKernel(Ja,t)}});var gd=_s({relu_:function(e){var t={x:Es(e,"x","relu")};return xs.runKernel($a,t)}});var yd=_s({relu6_:function(e){var t={x:Es(e,"x","relu6")};return xs.runKernel(ii,t)}});var bd=_s({reverse_:function(e,t){var n={x:Es(e,"x","reverse")},r={dims:t};return xs.runKernel(oi,n,r)}});var xd=_s({reverse1d_:function(e){var t=Es(e,"x","reverse");return nn(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),bd(t,0)}});var kd=_s({reverse2d_:function(e,t){var n=Es(e,"x","reverse");return nn(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),bd(n,t)}});var wd=_s({reverse3d_:function(e,t){var n=Es(e,"x","reverse");return nn(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),bd(n,t)}});var Sd=_s({reverse4d_:function(e,t){var n=Es(e,"x","reverse");return nn(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),bd(n,t)}});var Id=_s({round_:function(e){var t={x:Es(e,"x","round")};return xs.runKernel(si,t)}});var Cd=_s({rsqrt_:function(e){var t={x:Es(e,"x","rsqrt","float32")};return xs.runKernel(ui,t)}});var Td=_s({selu_:function(e){var t={x:Es(e,"x","selu")};return xs.runKernel(di,t)}});var Nd=_s({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Es(e,"x","separableConv2d"),u=Es(t,"depthwiseFilter","separableConv2d"),c=Es(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=jl(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");nn(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),nn(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),nn(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),nn(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),nn(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var p=u.shape[2],d=u.shape[3];nn(c.shape[2]===p*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(p*d,", ")+"but got ".concat(c.shape[2],".")}));var f=Nh(l,u,r,a,o,i),m=fh(f,c,1,"valid",o);return h?jl(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});function Ed(){return Ed=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Es(t,"x","setdiff1d"),a=Es(n,"y","setdiff1d"),nn(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),nn(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),nn(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=7,r.data();case 7:return i=e.sent,e.next=10,a.data();case 10:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new Xo([u],r.dtype),h=new Xo([u],"int32"),p=0,d=0;p<i.length;p++)s.has(i[p])||(l.values[d]=i[p],h.values[d]=p,d++);return e.abrupt("return",[l.toTensor(),h.toTensor()]);case 18:case"end":return e.stop()}}),e)}))),Ed.apply(this,arguments)}var Rd=function(e,t){return Ed.apply(this,arguments)};var Ad=_s({sign_:function(e){var t={x:Es(e,"x","sign")};return xs.runKernel(gi,t)}});var _d=_s({sin_:function(e){var t={x:Es(e,"x","sin","float32")};return xs.runKernel(mi,t)}});var Od=_s({sinh_:function(e){var t={x:Es(e,"x","sinh")};return xs.runKernel(vi,t)}});var Fd=_s({slice1d_:function(e,t,n){var r=Es(e,"x","slice1d");return nn(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Yl(r,[t],[n])}});var Dd=_s({slice2d_:function(e,t,n){var r=Es(e,"x","slice2d");return nn(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Yl(r,t,n)}});var Md=_s({slice3d_:function(e,t,n){var r=Es(e,"x","slice3d");return nn(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Yl(r,t,n)}});var Pd=_s({slice4d_:function(e,t,n){var r=Es(e,"x","slice4d");return nn(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Yl(r,t,n)}});var Ld=_s({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Es(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return xs.runKernel(Ii,r,a)}});var zd=_s({fft_:function(e){nn("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return xs.runKernel(qr,t)}});var Bd=_s({ifft_:function(e){nn("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return xs.runKernel(ia,t)}});var Ud=_s({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=jl(e,[r,n]);t=Bd(a)}else{var i=[r,2*(n-1)],o=jl(md(e),[r,n]),s=jl(op(e),[r,n]),u=bd(Yl(o,[0,1],[r,n-2]),1),c=ic(bd(Yl(s,[0,1],[r,n-2]),1),lc(-1)),l=Kl([o,u],1),h=Kl([s,c],1),p=jl(Os(l,h),[i[0],i[1]]);t=Bd(p)}if(t=md(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=jl(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}});var Wd=_s({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:Es(e,"x","split")},a={numOrSizeSplits:t,axis:n};return xs.runKernel(Si,r,a)}});var Vd=_s({rfft_:function(e,t){nn("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Yl(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Kl([e,Fp(s)],e.shape.length-1),r=t}else n=e;var u=uc(n),c=jl(Os(n,u),[a,r]),l=zd(c),h=Math.floor(r/2)+1,p=md(l),d=op(l),f=Wd(p,[h,r-h],p.shape.length-1),m=Wd(d,[h,r-h],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=h,jl(Os(f[0],m[0]),v)}});var Gd=_s({squaredDifference_:function(e,t){var n=Es(e,"a","squaredDifference"),r=Es(t,"b","squaredDifference"),a=hs(n,r),i=(0,E.Z)(a,2);n=i[0],r=i[1],Ic(n.shape,r.shape);var o={a:n,b:r};return xs.runKernel(Ai,o,{})}});var jd=_s({squeeze_:function(e,t){var n=Es(e,"x","squeeze","string_or_numeric");return jl(n,fn(n.shape,t).newShape)}});var Hd=_s({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Rs(e,"tensors","stack","string_or_numeric");nn(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&nn(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return xs.runKernel(Va,r,a)}});var Zd=_s({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Es(e,"x","step")},r={alpha:t};return xs.runKernel(qi,n,r)}});var Kd=_s({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:Es(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return xs.runKernel(Fi,c,l)}});var qd=_s({tan_:function(e){var t={x:Es(e,"x","tan","float32")};return xs.runKernel(zi,t)}});function Xd(e,t){an(e);var n=Cs(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Fs(e,null,n,t)}function Yd(e,t,n){if(an(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Cs(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Fs(e,t,r,n)}function Qd(e,t,n){if(an(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Cs(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Fs(e,t,r,n)}function Jd(e,t,n){if(an(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Cs(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Fs(e,t,r,n)}function $d(e,t,n){if(an(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Cs(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Fs(e,t=t||r,r,n)}function ef(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}(n,t,e)}function tf(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:on(t.shape)/u,sliceSize:o,strides:[].concat((0,Lt.Z)(In(n.slice(0,a))),[1]),outputSize:on(n)}}var nf=_s({tensorScatterUpdate_:function(e,t,n){var r=Es(e,"tensor","tensorScatterupdate"),a=Es(t,"indices","tensorScatterupdate","int32"),i=Es(n,"updates","tensorScatterupdate");if(ef(i,a,r.shape),r.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(r.dtype," and ").concat(i.dtype,"."));var o={tensor:r,indices:a,updates:i};return xs.runKernel(li,o,{})}});var rf=_s({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Es(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=xs.runKernel(Wi,i,o),u=(0,E.Z)(s,2);return{values:u[0],indices:u[1]}}});var af=_s({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(_n(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new od(t,n,r,!0,a),o=ju(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var of=_s({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Es(e,"x","unique","string_or_numeric");nn(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=xs.runKernel(ji,r,a),o=(0,E.Z)(i,2);return{values:o[0],indices:o[1]}}});var sf=_s({unsortedSegmentSum_:function(e,t,n){var r=Es(e,"x","unsortedSegmentSum"),a=Es(t,"segmentIds","unsortedSegmentSum","int32");nn(un(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return xs.runKernel(Zi,i,o)}});var uf=_s({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Es(e,"x","unstack","string_or_numeric");nn(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return xs.runKernel(Hi,r,a)}});function cf(e,t){return Np(e,t,"right")}function lf(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return xs.makeVariable(e,t,n,r)}function hf(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=ju(e,"int32"),i=ju([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function pf(){return(pf=Ht(Gt().mark((function e(t){var n,r,a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Es(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=hf(n.shape,r),t!==n&&n.dispose(),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var df=function(e){return pf.apply(this,arguments)};function ff(){return(ff=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Es(t,"tensor","boolMask"),i=Es(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,nn(s>0,(function(){return"mask cannot be scalar"})),rn(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return h=u.slice(0,o).concat([c],u.slice(o+s)),p=jl(a,h),d=jl(i,[-1]),e.next=14,df(d);case 14:return f=e.sent,m=jd(f,[1]),v=rp(p,m,o),t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),p.dispose(),d.dispose(),f.dispose(),e.abrupt("return",v);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var mf=function(e,t,n){return ff.apply(this,arguments)};var vf=_s({transpose_:function(e,t,n){var r=Es(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),nn(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){nn(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?Yu((function(){var e=md(r),t=op(r);return e=xs.runKernel(Gi,{x:e},i),t=xs.runKernel(Gi,{x:t},i),n&&(t=gp(t)),Os(e,t)})):xs.runKernel(Gi,a,i)}});var gf=_s({movingAverage_:function(e,t,n,r){var a,i,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=Es(e,"v","movingAverage"),u=Es(t,"x","movingAverage"),c=Es(n,"decay","movingAverage");i=u,nn((a=s).dtype===i.dtype,(function(){return"The dtypes of the first(".concat(a.dtype,") and")+" second(".concat(i.dtype,") input must match")})),nn(sn(s.shape,u.shape),(function(){return"Shape mismatch in v and x"}));var l=lc(1),h=bc(l,c),p=ic(bc(u,s),h);if(o){nn(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var d=Es(r,"step","movingAverage");p=ac(p,bc(l,yc(c,d)))}return nc(s,p)}});var yf=_s({scatterND_:function(e,t,n){_n(n);var r=Es(e,"indices","scatterND","int32"),a=Es(t,"updates","scatterND");ef(a,r,n);var i={indices:r,updates:a},o={shape:n};return xs.runKernel(ci,i,o)}});var bf=_s({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_n(n);var a=Es(e,"sparseIndices","sparseToDense","int32"),i=Es(t,"sparseValues","sparseToDense","string_or_numeric"),o=Es(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return xs.runKernel(Ri,s,u)}});var xf=_s({gatherND_:function(e,t){var n=Es(t,"indices","gatherND","int32"),r={params:Es(e,"x","gatherND","string_or_numeric"),indices:n};return xs.runKernel(ta,r)}});var kf=_s({dropout_:function(e,t,n,r){var a=Es(e,"x","dropout");if(nn("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),nn(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof Jo?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(sn(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=ac(np(nc(pd(i,0,1,"float32",r),o)),o);return ic(a,s)}});function wf(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Sf(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Xd(a,"float32")}function If(){return If=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=Es(t,"predictions","inTopK"),i=Es(n,"targets","inTopK"),nn(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(a.rank)})),nn(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(a.rank," and targets rank ").concat(i.rank)})),rn(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],nn(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(o,"), but got ").concat(r)})),e.next=10,a.data();case 10:return s=e.sent,e.next=13,i.data();case 13:u=e.sent,c=s.length/o,l=o,h=mn("bool",c),p=0;case 17:if(!(p<c)){e.next=35;break}for(d=p*l,f=s.subarray(d,d+l),m=[],v=0;v<f.length;v++)m.push({value:f[v],index:v});m.sort((function(e,t){return t.value-e.value})),h[p]=0,g=0;case 25:if(!(g<r)){e.next=32;break}if(m[g].index!==u[p]){e.next=29;break}return h[p]=1,e.abrupt("break",32);case 29:g++,e.next=25;break;case 32:p++,e.next=17;break;case 35:return t!==a&&a.dispose(),n!==i&&i.dispose(),e.abrupt("return",Ds(h,i.shape,"bool"));case 38:case"end":return e.stop()}}),e)}))),If.apply(this,arguments)}var Cf=function(e,t){return If.apply(this,arguments)};var Tf=_s({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=jl(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=jl(t,[1,t.shape[0],t.shape[1],t.shape[2]])),nn(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),nn(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),nn(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];nn(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),nn(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),Gl("conv2dDerFilter",a,o);var h={x:s,dy:u},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return xs.runKernel(br,h,p)}});function Nf(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return ic(e,Zd(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Ef(e,t){var n=t,r=Sc(e.shape,t.shape);return r.length>0&&(n=Kh(n,r)),jl(n,e.shape)}function Rf(e,t,n,r){if("linear"===t)return e;if("relu"===t)return gd(e);if("elu"===t)return Mh(e);if("relu6"===t)return yd(e);if("prelu"===t)return $p(e,n);if("leakyrelu"===t)return lp(e,r);if("sigmoid"===t)return Xl(e);throw new Error("Unknown fused activation ".concat(t,"."))}var Af=function(e,t){return!(e>0)||"linear"===t};var _f=_s({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,p=void 0===h?"linear":h,d=e.preluActivationWeights,f=e.leakyreluAlpha;if(p=p||"linear",!1===Af(xs.state.gradientDepth,p)){nn("NHWC"===o,(function(){return"Error in fused conv2d: got dataFormat of ".concat(o," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."}));var m=fh(t,n,r,a,o,u,c);return null!=l&&(m=nc(m,l)),Rf(m,p,d,f)}var v=Es(t,"x","conv2d","float32"),g=Es(n,"filter","conv2d","float32"),y=v,b=!1;3===v.rank&&(b=!0,y=jl(v,[1,v.shape[0],v.shape[1],v.shape[2]])),nn(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(y.rank,".")})),nn(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(g.rank,".")})),Gl("fused conv2d",a,c);var x="NHWC"===o?y.shape[3]:y.shape[1];nn(g.shape[2]===x,(function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(g.shape[2],".")})),nn(Ul(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")}));var k,w,S=Ol(y.shape,g.shape,r,u,a,c);if(null!=l){var I=hs(k=Es(l,"bias","fused conv2d"),v),C=(0,E.Z)(I,1);k=C[0],"NHWC"===o?Ic(S.outShape,k.shape):(nn(k.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(k.shape.length,".")})),nn(0===k.shape.length||k.shape[0]===S.outChannels||1===k.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(k.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})))}if(null!=d){var T=d.shape;if(nn(T.length<=1||3===T.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(T.length,".")})),1===T.length)nn(1===T[0]||T[0]===S.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(T,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")}));else if(3===T.length)try{Ic(T,S.outShape)}catch(JG){var N="Error in fused conv2d: PReLU activation weights (".concat(T,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(N)}w=Es(d,"prelu weights","fused conv2d")}var R=function(e,t){nn("NHWC"===o,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var n=(0,E.Z)(t,4),i=n[0],s=n[1],c=n[2],l=n[3],h=Nf(e,c,p);nn(Bl(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var d=[vh(s.shape,h,i,r,a),Tf(s,h,i.shape,r,a)];if(null!=l){var f=Ef(l,h);d.push(f)}return d},A={x:y,filter:g,bias:k,preluActivationWeights:w},_={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:p,leakyreluAlpha:f};if(null==l){var O=cc((function(e,t,n){var r=xs.runKernel(Ji,A,_);return n([t,e,r]),b&&(r=jl(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:R}}));return O(y,g)}var F=cc((function(e,t,n,r){var a=xs.runKernel(Ji,A,_);return r([t,e,a,n]),b&&(a=jl(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:R}}));return F(y,g,k)}});var Of=_s({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=jl(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=jl(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return xs.runKernel(Or,c,l)}});var Ff=_s({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=jl(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},h=xs.runKernel(Fr,c,l);return u?jl(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var Df=_s({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,p=void 0===h?"linear":h,d=e.preluActivationWeights,f=e.leakyreluAlpha;if(!1===Af(xs.state.gradientDepth,p)){var m=Nh(t,n,r,a,o,u,c);return null!=l&&(m=nc(m,l)),Rf(m,p,d,f)}var v=Es(t,"x","depthwiseConv2d","float32"),g=Es(n,"filter","depthwiseConv2d","float32"),y=v,b=!1;3===v.rank&&(b=!0,y=jl(v,[1,v.shape[0],v.shape[1],v.shape[2]])),nn(4===y.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(y.rank,".")})),nn(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(g.rank,".")})),nn(y.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(y.shape[3],") must match the inChannels dimension in ")+"filter ".concat(g.shape[2],".")})),null==u&&(u=[1,1]),nn(Ul(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(u,"'")})),Gl("fused depthwiseConv2d",a,c);var x,k,w=Ol(y.shape,g.shape,r,u,a,c,!0);if(null!=l){var S=hs(x=Es(l,"bias","fused conv2d"),v),I=(0,E.Z)(S,1);x=I[0],Ic(w.outShape,x.shape)}null!=d&&(k=Es(d,"prelu weights","fused depthwiseConv2d"));var C=function(e,t){nn(Bl(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(u,"'")}));var n=(0,E.Z)(t,4),i=n[0],o=n[1],s=n[2],l=n[3],h=Nf(e,s,p),d=Ff(o.shape,h,i,r,a,u,c),f=Of(o,h,i.shape,r,a,u,c);return null!=l?[d,f,Ef(x,h)]:[d,f]},T={x:y,filter:g,bias:x,preluActivationWeights:k},N={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:p,leakyreluAlpha:f};if(null==l){var R=cc((function(e,t,n){var r=xs.runKernel($i,T,N);return n([t,e,r]),b&&(r=jl(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:C}}));return R(y,g)}var A=cc((function(e,t,n,r){var a=xs.runKernel($i,T,N);return r([t,e,a,n]),b&&(a=jl(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:C}}));return A(y,g,x)}});var Mf=_s({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,h=e.leakyreluAlpha,p=void 0===h?.2:h;if(!1===Af(xs.state.gradientDepth,c)){var d=ql(t,n,a,o);return null!=s&&(d=nc(d,s)),Rf(d,c,l,p)}var f=Es(t,"a","fused matMul"),m=Es(n,"b","fused matMul"),v=hs(f,m),g=(0,E.Z)(v,2);f=g[0],m=g[1];var y=a?f.shape[f.rank-2]:f.shape[f.rank-1],b=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=a?f.shape[f.rank-1]:f.shape[f.rank-2],k=o?m.shape[m.rank-2]:m.shape[m.rank-1],w=f.shape.slice(0,-2),S=m.shape.slice(0,-2),I=on(w),C=on(S);nn(y===b,(function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(f.shape," and ")+"".concat(m.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var T,N,R=Ic(f.shape.slice(0,-2),m.shape.slice(0,-2)).concat([x,k]),A=jl(f,a?[I,y,x]:[I,x,y]),_=jl(m,o?[C,k,b]:[C,b,k]);if(null!=s){var O=hs(T=Es(s,"bias","fused matMul"),f);T=(0,E.Z)(O,1)[0],Ic(R,T.shape)}null!=l&&(N=Es(l,"prelu weights","fused matMul"));var F=function(e,t){var n,r,i=(0,E.Z)(t,4),u=i[0],l=i[1],h=i[2],p=i[3],d=Nf(jl(e,h.shape),h,c);return a||o?!a&&o?(n=ql(d,l,!1,!1),r=ql(d,u,!0,!1)):a&&!o?(n=ql(l,d,!1,!0),r=ql(u,d,!1,!1)):(n=ql(l,d,!0,!0),r=ql(d,u,!0,!0)):(n=ql(d,l,!1,!0),r=ql(u,d,!0,!1)),null!=s?[n,r,Ef(p,d)]:[n,r]},D={a:A,b:_,bias:T,preluActivationWeights:N},M={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:p};if(null==s){var P=cc((function(e,t,n){var r=xs.runKernel(Qi,D,M);return n([e,t,r]),{value:jl(r,R),gradFunc:F}}));return P(A,_)}var L=cc((function(e,t,n,r){var a=xs.runKernel(Qi,D,M);return r([e,t,a,n]),{value:jl(a,R),gradFunc:F}}));return L(A,_,T)}});var Pf=_s({hammingWindow_:function(e){return Sf(e,.54,.46)}});var Lf=_s({hannWindow_:function(e){return Sf(e,.5,.5)}});var zf=_s({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Yl(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Kl([Yl(e,i,t-s),vc([s],a)]);o.push(u),i+=n}return 0===o.length?Yd([],[0,t]):jl(Kl(o),[o.length,t])}});var Bf=_s({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Lf;null==r&&(r=wf(t));var i=zf(e,t,n),o=ic(i,a(t));return Vd(o,r)}});var Uf=_s({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Es(e,"image","cropAndResize"),s=Es(t,"boxes","cropAndResize","float32"),u=Es(n,"boxInd","cropAndResize","int32"),c=s.shape[0];nn(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),nn(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),nn(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),nn(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),nn(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),nn("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},h={method:a,extrapolationValue:i,cropSize:r};return xs.runKernel(Er,l,h)}});var Wf=_s({flipLeftRight_:function(e){var t=Es(e,"image","flipLeftRight","float32");nn(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return xs.runKernel(Yr,n,{})}});var Vf=_s({grayscaleToRGB_:function(e){var t=Es(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];nn(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),nn(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,ep(t,a)}});var Gf=_s({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Es(e,"image","rotateWithOffset","float32");nn(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return xs.runKernel(Yi,i,o)}});function jf(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),nn(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),nn(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),nn(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),nn(1===t.rank,(function(){return"scores must be a 1D tensor"})),nn(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),nn(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Hf=_s({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Es(e,"boxes","nonMaxSuppression","float32"),o=Es(t,"scores","nonMaxSuppression","float32"),s=jf(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return xs.runKernel(La,{boxes:i,scores:o},u)}});function Zf(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||Kf)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Kf(e,t){return e>t?1:e<t?-1:0}function qf(e,t,n,r,a){return Qf(e,t,n,r,a,0)}function Xf(e,t,n,r,a,i){return Qf(e,t,n,r,a,0,!1,i,!0)}function Yf(e,t,n,r,a,i){return Qf(e,t,n,r,a,i,!0)}function Qf(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(em);for(var h=i>0?-.5/i:0,p=[],d=[];p.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,g=f.suppressBeginIndex;if(m<a)break;for(var y=!1,b=p.length-1;b>=g;--b){var x=Jf(e,v,p[b]);if(x>=r){y=!0;break}if(f.score=f.score*$f(r,h,x),f.score<=a)break}f.suppressBeginIndex=p.length,y||(f.score===m?(p.push(v),d.push(f.score)):f.score>a&&Zf(c,f,em))}var k=p.length,w=n-k;s&&w>0&&(p.push.apply(p,(0,Lt.Z)(new Array(w).fill(0))),d.push.apply(d,(0,Lt.Z)(new Array(w).fill(0))));var S={selectedIndices:p};return o&&(S.selectedScores=d),u&&(S.validOutputs=k),S}function Jf(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),d=(s-i)*(u-o),f=(h-c)*(p-l);if(d<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,p),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(d+f-b)}function $f(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function em(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function tm(){return tm=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=Es(t,"boxes","nonMaxSuppressionAsync"),s=Es(n,"scores","nonMaxSuppressionAsync"),u=jf(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,l=c[0],h=c[1],p=qf(l,h,r,a,i),d=p.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",Xd(d,"int32"));case 17:case"end":return e.stop()}}),e)}))),tm.apply(this,arguments)}var nm=function(e,t,n){return tm.apply(this,arguments)};var rm=_s({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Es(e,"boxes","nonMaxSuppression"),s=Es(t,"scores","nonMaxSuppression"),u=jf(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},h=xs.runKernel(Ba,c,l);return{selectedIndices:h[0],selectedScores:h[1]}}});function am(){return am=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=Es(t,"boxes","nonMaxSuppressionAsync"),u=Es(n,"scores","nonMaxSuppressionAsync"),c=jf(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),u.data()]);case 12:return l=e.sent,h=l[0],p=l[1],d=Yf(h,p,r,a,i,o),f=d.selectedIndices,m=d.selectedScores,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:Xd(f,"int32"),selectedScores:Xd(m)});case 19:case"end":return e.stop()}}),e)}))),am.apply(this,arguments)}var im=function(e,t,n){return am.apply(this,arguments)};var om=_s({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Es(e,"boxes","nonMaxSuppression"),s=Es(t,"scores","nonMaxSuppression"),u=jf(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},h=xs.runKernel(za,c,l);return{selectedIndices:h[0],validOutputs:h[1]}}});function sm(){return sm=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:.5,i=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,o=x.length>5&&void 0!==x[5]&&x[5],s=Es(t,"boxes","nonMaxSuppressionAsync"),u=Es(n,"scores","nonMaxSuppressionAsync"),c=jf(s,u,r,a,i,null),l=c.maxOutputSize,h=c.iouThreshold,p=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return d=e.sent,f=(0,E.Z)(d,2),m=f[0],v=f[1],g=Xf(m,v,l,h,p,o),y=g.selectedIndices,b=g.validOutputs,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:Xd(y,"int32"),validOutputs:lc(b,"int32")});case 19:case"end":return e.stop()}}),e)}))),sm.apply(this,arguments)}var um=function(e,t,n){return sm.apply(this,arguments)};var cm=_s({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Es(e,"images","resizeBilinear");nn(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),nn(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),nn(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=jl(a,[1,a.shape[0],a.shape[1],a.shape[2]])),(0,E.Z)(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=xs.runKernel(ri,s,u);return o?jl(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var lm=_s({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Es(e,"images","resizeNearestNeighbor");nn(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),nn(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),nn("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),nn(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=jl(a,[1,a.shape[0],a.shape[1],a.shape[2]])),(0,E.Z)(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=xs.runKernel(ti,s,u);return o?jl(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var hm=_s({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=Es(e,"image","threshold"),c=u.shape[0]*u.shape[1],l=ic(Xd([s]),255);if(nn(3===u.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(u.rank,".")})),nn(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(u.shape[2],".")})),nn("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(u.dtype,".")})),nn("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var h=Wd(u,[1,1,1],-1),p=(0,E.Z)(h,3);t=p[0],n=p[1],r=p[2];var d=ic(t,.2989),f=ic(n,.587),m=ic(r,.114);a=nc(nc(d,f),m)}else a=e;"otsu"===i&&(l=function(e,t){for(var n,r,a,i,o,s,u=Xd([-1]),c=Xd([0]),l=Xd([0]),h=0;h<e.size-1;h++){n=Yl(e,0,h+1),r=Yl(e,h+1),o=ac(Kh(n),t),s=ac(Kh(r),t);var p=Kh(ic(n,fd(0,n.size)));a=ac(p,Kh(n));var d=vc(r.shape,n.size),f=nc(fd(0,r.size),d),m=ic(r,f);i=ac(Kh(m),Kh(r));var v=bc(a,i),g=bc(a,i),y=ic(o,s);l=ic(ic(y,v),g);var b=ap(l,c);c=_h(b,l,c),u=_h(b,Xd([h]),u)}return u}(ah(Hu(Id(a),"int32"),Ds([]),256),c));var v=o?pp(a,l):ap(a,l);return Hu(ic(v,255),"int32")}});var pm=_s({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=Es(e,"image","transform","float32"),s=Es(t,"transforms","transform","float32");nn(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),nn(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),nn(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return xs.runKernel(Vi,u,c)}});var dm=_s({bandPart_:function(e,t,n){var r=Es(e,"a","bandPart");nn(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a,i,o=r.shape,s=r.shape.slice(-2),u=(0,E.Z)(s,2),c=u[0],l=u[1];"number"===typeof t?(nn(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),nn(t<=c,(function(){return"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(c,").")})),a=Es(t<0?c:t,"numLower","bandPart")):(nn("int32"===t.dtype,(function(){return"bandPart(): numLower's dtype must be an int32."})),a=_h(hp(t,0),c,Pp(t,c))),"number"===typeof n?(nn(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")})),nn(n<=l,(function(){return"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(l,").")})),i=Es(n<0?l:n,"numUpper","bandPart")):(nn("int32"===n.dtype,(function(){return"bandPart(): numUpper's dtype must be an int32."})),i=_h(hp(n,0),l,Pp(n,l)));var h=jl(fd(0,c,1,"int32"),[-1,1]),p=fd(0,l,1,"int32"),d=bc(h,p),f=wp(pp(d,a),ip(d,gp(i))),m=Fp([c,l],r.dtype);return jl(Hd(uf(jl(r,[-1,c,l])).map((function(e){return _h(f,e,m)}))),o)}});var fm=_s({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,nn(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){nn(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=Wd(e,e.shape[0],0).map((function(e){return jd(e,[0])}));nn(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(xs.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=ic(Kh(ic(i[n],t)),i[n]);t=bc(t,r)}return ac(t,Xh(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?Hd(i,0):i}});function mm(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return xs.tidy((function(){nn(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=tp(n),i=Zu(e),o=Yd([[1]],[1,1]),s=Zu(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=xs.tidy((function(){var t=Yl(i,[e,e],[n-e,1]),u=Xh(t),c=Yl(i,[e,e],[1,1]),l=_h(ap(c,0),Yd([[-1]]),Yd([[1]])),h=bc(c,ic(l,u)),p=ac(t,h);s=1===p.shape[0]?Zu(o):Kl([o,Yl(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);var d=gp(ac(ql(l,h),u)),f=Yl(i,[e,0],[n-e,r]),m=ic(d,s),v=vf(s);if(0===e)i=bc(f,ql(m,ql(v,f)));else{var g=bc(f,ql(m,ql(v,f)));i=Kl([Yl(i,[0,0],[e,r]),g],0)}var y=vf(m),b=Yl(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=bc(b,ql(ql(b,s),y));else{var x=bc(b,ql(ql(b,s),y));a=Kl([Yl(a,[0,0],[n,e]),x],1)}return[s,i,a]})),h=(0,E.Z)(l,3);s=h[0],i=h[1],a=h[2],Qu([t,u,c])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Yl(a,[0,0],[n,r]),i=Yl(i,[0,0],[r,r])),[a,i]}))}var vm,gm=_s({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(nn(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return mm(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=uf(jl(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=mm(e,t),r=(0,E.Z)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)})),[jl(Hd(a,0),e.shape),jl(Hd(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(vm||(vm={}));var ym=_s({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vm.SUM_BY_NONZERO_WEIGHTS,r=Es(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Es(t,"weights","computeWeightedLoss"));var i=null==a?r:ic(r,a);if(n===vm.NONE)return i;if(n===vm.SUM)return Kh(i);if(n===vm.MEAN){if(null==a)return Op(i);var o=r.size/a.size,s=ac(Kh(i),Kh(a));return o>1?ac(s,lc(o)):s}if(n===vm.SUM_BY_NONZERO_WEIGHTS){if(null==a)return ac(Kh(i),lc(r.size));var u=ic(a,Dp(r.shape)),c=Hu(Kh(Vp(u,lc(0))),"float32");return ac(Kh(i),c)}throw Error("Unknown reduction: ".concat(n))}});var bm=_s({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vm.SUM_BY_NONZERO_WEIGHTS,a=Es(e,"labels","absoluteDifference"),i=Es(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Es(n,"weights","absoluteDifference")),rn(a.shape,i.shape,"Error in absoluteDifference: ");var s=kc(bc(a,i));return ym(s,o,r)}});var xm=_s({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vm.SUM_BY_NONZERO_WEIGHTS,i=Es(e,"labels","cosineDistance"),o=Es(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Es(r,"weights","cosineDistance")),rn(i.shape,o.shape,"Error in cosineDistance: ");var u=lc(1),c=bc(u,Kh(ic(i,o),n,!0));return ym(c,s,a)}});var km=_s({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vm.SUM_BY_NONZERO_WEIGHTS,a=Es(e,"labels","hingeLoss"),i=Es(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Es(n,"weights","hingeLoss")),rn(a.shape,i.shape,"Error in hingeLoss: ");var s=lc(1);a=bc(ic(lc(2),a),s);var u=gd(bc(s,ic(a,i)));return ym(u,o,r)}});var wm=_s({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vm.SUM_BY_NONZERO_WEIGHTS,i=Es(e,"labels","huberLoss"),o=Es(t,"predictions","huberLoss"),s=null;null!=n&&(s=Es(n,"weights","huberLoss")),rn(i.shape,o.shape,"Error in huberLoss: ");var u=lc(r),c=kc(bc(o,i)),l=Pp(c,u),h=bc(c,l),p=nc(ic(lc(.5),sc(l)),ic(u,h));return ym(p,s,a)}});var Sm=_s({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vm.SUM_BY_NONZERO_WEIGHTS,i=Es(e,"labels","logLoss"),o=Es(t,"predictions","logLoss"),s=null;null!=n&&(s=Es(n,"weights","logLoss")),rn(i.shape,o.shape,"Error in logLoss: ");var u=lc(1),c=lc(r),l=gp(ic(i,mp(nc(o,c)))),h=ic(bc(u,i),mp(nc(bc(u,o),c))),p=bc(l,h);return ym(p,s,a)}});var Im=_s({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vm.SUM_BY_NONZERO_WEIGHTS,a=Es(e,"labels","meanSquaredError"),i=Es(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Es(n,"weights","meanSquaredError")),rn(a.shape,i.shape,"Error in meanSquaredError: ");var s=Gd(a,i);return ym(s,o,r)}});var Cm=_s({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vm.SUM_BY_NONZERO_WEIGHTS,i=Es(e,"multiClassLabels","sigmoidCrossEntropy"),o=Es(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Es(n,"weights","sigmoidCrossEntropy")),rn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=lc(r),c=lc(1),l=lc(.5);i=nc(ic(i,bc(c,u)),ic(l,u))}var h=function(e,t){var n=Es(e,"labels","sigmoidCrossEntropyWithLogits"),r=Es(t,"logits","sigmoidCrossEntropyWithLogits");rn(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=gd(r),i=ic(r,n),o=vp(Qh(gp(kc(r))));return nc(bc(a,i),o)}(i,o);return ym(h,s,a)}});var Tm=_s({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vm.SUM_BY_NONZERO_WEIGHTS,i=Es(e,"onehotLabels","softmaxCrossEntropy"),o=Es(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Es(n,"weights","softmaxCrossEntropy")),rn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=lc(r),c=lc(1),l=lc(i.shape[1]);i=nc(ic(i,bc(c,u)),ac(u,l))}var h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=cc((function(e,t,r){var a=kp(t,[n],!0),i=bc(Hu(t,"float32"),a);r([e,i]);var o=gp(ic(i,e));return{value:Kh(o,[n]),gradFunc:function(e,t){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=Uh(e.shape,[n]);return[ic(jl(e,o),bc(Hu(a,"float32"),Qh(i))),ic(jl(e,o),bc(Qh(i),Hu(a,"float32")))]}}}));return r(e,t)}(i,o);return ym(h,s,a)}});var Nm=_s({sparseFillEmptyRows_:function(e,t,n,r){var a=Es(e,"indices","sparseFillEmptyRows","int32"),i=Es(t,"values","sparseFillEmptyRows"),o=Es(n,"denseShape","sparseFillEmptyRows","int32"),s=Es(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=xs.runKernel(Ci,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var Em=_s({sparseReshape_:function(e,t,n){var r=Es(e,"inputIndices","sparseReshape","int32"),a=Es(t,"inputShape","sparseReshape","int32"),i=Es(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=xs.runKernel(Ti,o);return{outputIndices:s[0],outputShape:s[1]}}});var Rm=_s({sparseSegmentMean_:function(e,t,n){var r=Es(e,"data","sparseSegmentMean"),a=Es(t,"indices","sparseSegmentMean","int32"),i=Es(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return xs.runKernel(Ni,o)}});var Am=_s({sparseSegmentSum_:function(e,t,n){var r=Es(e,"data","sparseSegmentSum"),a=Es(t,"indices","sparseSegmentSum","int32"),i=Es(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return xs.runKernel(Ei,o)}});var _m=_s({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=Es(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=Es(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},h={data:u,dataSplits:c},p=xs.runKernel(Di,h,l);return{nGrams:p[0],nGramsSplits:p[1]}}});var Om=_s({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Es(e,"input","stringSplit","string"),a=Es(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=xs.runKernel(Mi,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var Fm=_s({stringToHashBucketFast_:function(e,t){var n=Es(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return xs.runKernel(Pi,a,r)}});var Dm,Mm=_s({staticRegexReplace_:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Es(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:r};return xs.runKernel(Oi,{x:a},i)}}),Pm={fft:zd,ifft:Bd,rfft:Vd,irfft:Ud},Lm={hammingWindow:Pf,hannWindow:Lf,frame:zf,stft:Bf},zm={flipLeftRight:Wf,grayscaleToRGB:Vf,resizeNearestNeighbor:lm,resizeBilinear:cm,rotateWithOffset:Gf,cropAndResize:Uf,nonMaxSuppression:Hf,nonMaxSuppressionAsync:nm,nonMaxSuppressionWithScore:rm,nonMaxSuppressionWithScoreAsync:im,nonMaxSuppressionPadded:om,nonMaxSuppressionPaddedAsync:um,threshold:hm,transform:pm},Bm={bandPart:dm,gramSchmidt:fm,qr:gm},Um={absoluteDifference:bm,computeWeightedLoss:ym,cosineDistance:xm,hingeLoss:km,huberLoss:wm,logLoss:Sm,meanSquaredError:Im,sigmoidCrossEntropy:Cm,softmaxCrossEntropy:Tm},Wm={sparseFillEmptyRows:Nm,sparseReshape:Em,sparseSegmentMean:Rm,sparseSegmentSum:Am},Vm={stringNGrams:_m,stringSplit:Om,stringToHashBucketFast:Fm,staticRegexReplace:Mm},Gm=function(){function e(){Te(this,e)}return Re(e,null,[{key:"sgd",value:function(e){return new Nc(e)}},{key:"momentum",value:function(e,t){return new Ec(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new Rc(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new xc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new mc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new Tc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new gc(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),jm=Gm,Hm="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function Zm(){return new Promise((function(e){return Hm((function(){return e()}))}))}function Km(e,t){var n=e[0].length;e.forEach((function(e,t){nn(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),nn(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)nn(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function qm(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Xm(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function Ym(e){var t,n={FIRST_DIM_SIZE:Dm.FIRST_DIM_SIZE,VALUE_ROWIDS:Dm.VALUE_ROWIDS,ROW_LENGTHS:Dm.ROW_LENGTHS,ROW_SPLITS:Dm.ROW_SPLITS,ROW_LIMITS:Dm.ROW_LIMITS,ROW_STARTS:Dm.ROW_STARTS},r=[],a=Kt(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch($Q){a.e($Q)}finally{a.f()}return r}function Qm(e){return 0===e.length?0:e[0]===Dm.FIRST_DIM_SIZE?e.length-1:e.length}function Jm(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Dm||(Dm={}));var $m=30;function ev(e){return e<=$m?e:Sn(e,Math.floor(Math.sqrt(e)))}function tv(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function nv(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function rv(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function av(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function iv(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function ov(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function sv(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===on(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,h=i;h<n;++h)l*=u[h],c.push(u[h]);var p=[].concat((0,Lt.Z)(In(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,p]}var uv=1.7580993408473768,cv=1.0507009873554805,lv=.3275911,hv=.254829592,pv=-.284496736,dv=1.421413741,fv=-1.453152027,mv=1.061405429;function vv(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function gv(e,t){return{real:e[2*t],imag:e[2*t+1]}}function yv(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function bv(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var xv="->",kv=/->/g,wv=",",Sv="...";function Iv(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(kv,"").length)/xv.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(xv,'").'));var r=e.split(xv),a=(0,E.Z)(r,2),i=a[0],o=a[1];nn(-1===i.indexOf(Sv),(function(){return'The ellipsis notation ("'.concat(Sv,'") is not supported yet.')}));var s=i.split(wv),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(){var e=o[h];if(!s.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===c.indexOf(e)&&c.push(e)},h=0;h<o.length;++h)l();for(var p=0;p<i.length;++p){var d=i[p];-1===c.indexOf(d)&&d!==wv&&c.push(d)}for(var f=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". ")+"Support for duplicate axes in input is not implemented yet.");f[m]=[];for(var v=0;v<s[m].length;++v)f[m].push(c.indexOf(s[m][v]))}for(var g=c.length,y=[],b=o.length;b<g;++b)y.push(b);return{allDims:c,summedDims:y,idDims:f}}function Cv(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function Tv(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:nn(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function Nv(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=Kt(Rv(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch($Q){c.e($Q)}finally{c.f()}}return{path:r,steps:a}}function Ev(e){return e.every((function(e,t){return e===t}))}function Rv(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function Av(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)nn(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);nn(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}nn(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function _v(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function Ov(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function Fv(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Dv(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Mv(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Pv(e,t){var n=on(e),r=on(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Lv(e,t){var n=on(e),r=on(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function zv(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function Bv(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function Uv(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,p=0;p<r;++p)u.push(e.shape[p]),c*=e.shape[p];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),h*=e.shape[m];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}function Wv(e){try{return e.map((function(e){return Ro(e)}))}catch($Q){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat($Q))}}function Vv(e){return e.map((function(e){return Eo(e)}))}!function(){var e,t=Kt(Ac);try{for(t.s();!(e=t.n()).done;){dc(e.value)}}catch($Q){t.e($Q)}finally{t.f()}}();var Gv={kernelName:Gn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,Zd(Hu(n,"float32"),-1))}}}},jv={kernelName:jn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){var t=sc(Hu(n,"float32")),r=oc(bc(lc(1),t));return gp(ac(e,r))}}}},Hv={kernelName:Hn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){var t=oc(bc(sc(Hu(n,"float32")),1));return ac(e,t)}}}},Zv={kernelName:Zn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=e,n=Sc(r.shape,i);return n.length>0&&(t=Kh(t,n)),jl(t,r.shape)},b:function(){var t=e,n=Sc(a.shape,i);return n.length>0&&(t=Kh(t,n)),jl(t,a.shape)}}}},Kv={kernelName:Kn,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},qv={kernelName:Yn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return uc(n)}}}},Xv={kernelName:Qn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return uc(n)}}}},Yv={kernelName:Jn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,oc(bc(lc(1),sc(Hu(n,"float32")))))}}}},Qv={kernelName:$n,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){var t=oc(nc(lc(1),sc(Hu(n,"float32"))));return ac(e,t)}}}},Jv={kernelName:nr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=nc(sc(r),sc(a)),n=ic(e,ac(a,t)),o=Sc(r.shape,i);return o.length>0&&(n=Kh(n,o)),jl(n,r.shape)},b:function(){var t=nc(sc(r),sc(a)),n=gp(ic(e,ac(r,t))),o=Sc(a.shape,i);return o.length>0&&(n=Kh(n,o)),jl(n,a.shape)}}}},$v={kernelName:er,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,nc(sc(Hu(n,"float32")),1))}}}},eg={kernelName:tr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,bc(lc(1),sc(Hu(n,"float32"))))}}}};var tg=_s({avgPool3dGrad_:function(e,t,n,r,a,i){var o=Es(e,"dy","avgPool3dGrad"),s=Es(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=jl(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=jl(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),nn(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")})),nn(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")})),Gl("avgPool3dGrad",a,i);var h={dy:u,input:c},p={filterSize:n,strides:r,pad:a,dimRoundingMode:i},d=xs.runKernel(or,h,p);return l?jl(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),ng={kernelName:ir,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return tg(e,r,a,i,o,s)}}}};var rg=_s({avgPoolGrad_:function(e,t,n,r,a){var i=Es(e,"dy","avgPoolGrad"),o=Es(t,"input","avgPoolGrad");nn(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=jl(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=jl(i,[1,i.shape[0],i.shape[1],i.shape[2]])),nn(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),nn(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},h={filterSize:n,strides:r,pad:a},p=xs.runKernel(ar,l,h);return c?jl(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),ag={kernelName:rr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return rg(e,r,a,i,o)}}}},ig={kernelName:sr,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return ql(e,i,!1,!1)},b:function(){return ql(e,a,!0,!1)}}:o&&!s?{a:function(){return ql(i,e,!1,!0)},b:function(){return ql(a,e,!1,!1)}}:{a:function(){return ql(i,e,!0,!0)},b:function(){return ql(e,a,!0,!0)}}:{a:function(){return ql(e,i,!1,!0)},b:function(){return ql(a,e,!0,!1)}}}},og={kernelName:ur,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return Qp(e,r,a)}}}},sg={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Kh(e,u,!0)}}}},ug={kernelName:pr,gradFunc:function(e){return{x:function(){return e.clone()}}}},cg={kernelName:dr,gradFunc:function(e){return{x:function(){return uc(e)}}}},lg={kernelName:fr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return _h(wp(ip(r,a),pp(r,i)),e,uc(e))}}}},hg={kernelName:vr,inputsToSave:["x"],gradFunc:Gv.gradFunc},pg={kernelName:gr,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=dn(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Wd(e,i,a).map((function(e){return function(){return e}}))}},dg={kernelName:yr,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return nn(Bl(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return vh(a.shape,e,i,s,u,c)},filter:function(){return Tf(a,e,i.shape,s,u,c)}}}},fg={kernelName:xr,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return fh(e,i,o,s,u,1,c)},filter:function(){return Tf(e,a,i.shape,o,s,u,c)}}}};var mg=_s({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=jl(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=jl(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),nn(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),nn(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),nn(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),nn(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),nn(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return xs.runKernel(wr,s,u)}}),vg={kernelName:kr,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;nn(Bl(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=(0,E.Z)(t,2),s=o[0],u=o[1];return{x:function(){return bh(s.shape,e,u,a,i)},filter:function(){return mg(s,e,u.shape,a,i)}}}},gg={kernelName:Ir,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(gp(_d(Hu(n,"float32"))),e)}}}},yg={kernelName:Cr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(Od(Hu(n,"float32")),e)}}}},bg={kernelName:Nr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=Vh([a],r.rank),n=Ih(e,a,i,!o);return null!=t&&(n=vf(n,t)),n}}}},xg={kernelName:_r,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;nn(Bl(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=(0,E.Z)(t,2),c=u[0],l=u[1];return nn(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),nn(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),nn(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),nn(Ul(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),Gl("depthwiseConv2d",i,o),{x:function(){return Ff(c.shape,e,l,a,i,s,o)},filter:function(){return Of(c,e,l.shape,a,i,s,o)}}}},kg={kernelName:Mr,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return xs.runKernel(Pr,o,n)},filter:function(){return xs.runKernel(Lr,s,n)}}}},wg={kernelName:Wr,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:(0,E.Z)(t,1)[0]};return{x:function(){return xs.runKernel(Vr,n)}}}},Sg={kernelName:Gr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0],r=ic(Qh(gp(sc(n))),2/Math.sqrt(Math.PI));return{x:function(){return ic(e,r)}}}},Ig={kernelName:Hr,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,n)}}}},Cg={kernelName:Zr,inputsToSave:["input"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{input:function(){return jl(e,n.shape)}}}},Tg={kernelName:Kr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,Qh(n))}}}},Ng={kernelName:Qr,gradFunc:function(e){return{x:function(){return uc(e)}}}},Eg={kernelName:Jr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=ac(e,Hu(a,"float32")),n=Sc(r.shape,i);return n.length>0?jl(Kh(t,n),r.shape):t},b:function(){var t=ic(e,Hu(r,"float32")),n=Sc(a.shape,i);n.length>0&&(t=jl(Kh(t,n),a.shape));var o=sc(a);return gp(ac(t,Hu(o,"float32")))}}}},Rg={kernelName:$r,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=(0,E.Z)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?lc(1):u,l=Sc(o.shape,i.shape),h=[];if(1===o.rank){for(var p=0;p<i.shape.length-1;++p)h.push(i.shape[p]);h.push(1)}var d=bc(i,o),f=ic(e,c),m=Cd(nc(s,lc(r))),v=ic(ic(ic(m,m),m),lc(-.5));return{x:function(){return 1===o.rank?jl(ic(ic(e,ep(jl(m,[1,1,1,o.shape[0]]),h)),c),i.shape):jl(ic(ic(e,m),c),i.shape)},mean:function(){var e=ic(ic(m,lc(-1)),f);return 1===o.rank&&(e=Kh(e,l)),jl(e,o.shape)},variance:function(){var e=ic(ic(v,d),f);return 1===o.rank&&(e=Kh(e,l)),jl(e,o.shape)},scale:function(){var t=ic(d,m),n=ic(e,t);return 1===o.rank&&(n=Kh(n,l)),jl(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Kh(t,l)),jl(t,o.shape)}}}},Ag={kernelName:ea,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.axis,s=dn(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=_g(0,u),p=_g(u+1,u+1+l),d=Og([r,[n],c]),f=jl(e,d),m=jl(i,[n]),v=Og([[u],h,p]),g=vf(f,v),y=sf(g,m,a.shape[s]),b=Gh(v);return y=vf(y,b)},indices:function(){return i}}}};function _g(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Og(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Fg={kernelName:ra,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1];return{a:function(){return uc(r)},b:function(){return uc(a)}}}},Dg={kernelName:aa,gradFunc:function(e){return{x:function(){return Hu(e,"float32")}}}},Mg={kernelName:sa,gradFunc:function(e){return{x:function(){return uc(e)}}}},Pg={kernelName:ua,gradFunc:function(e){return{x:function(){return uc(e)}}}},Lg={kernelName:ca,gradFunc:function(e){return{x:function(){return uc(e)}}}},zg={kernelName:la,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.alpha,i=ap(r,0);return{x:function(){return _h(i,e,ic(e,a))}}}},Bg={kernelName:ma,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,nc(n,1))}}}},Ug={kernelName:fa,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,Hu(n,"float32"))}}}},Wg={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.axis;return{logits:function(){var t=Qh(r);return bc(e,ic(Kh(e,a,!0),t))}}}};var Vg=_s({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return xs.runKernel(xa,r,a)}}),Gg={kernelName:ba,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Vg(a,i,e,o,s,u,c)}}}};function jg(e,t,n,r){return t.rank<n.rank&&(t=jl(t,Uh(t.shape,r))),e.rank<n.rank&&(e=jl(e,Uh(e.shape,r))),{x:function(){return ic(e,Hu(Ah(n,t),e.dtype))}}}var Hg={kernelName:ka,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=jg(e,t[1],a,dn(r,a.shape));return{x:function(){return i.x()}}}},Zg={kernelName:wa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1];return{a:function(){return ic(e,Hu(ip(r,a),"float32"))},b:function(){return ic(e,Hu(hp(r,a),"float32"))}}}};var Kg=_s({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=Es(e,"dy","maxPool3dGrad"),u=Es(t,"input","maxPool3dGrad"),c=Es(n,"output","maxPool3dGrad"),l=s,h=u,p=c,d=!1;4===u.rank&&(d=!0,l=jl(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=jl(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=jl(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),nn(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")})),nn(5===h.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")})),nn(5===p.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(p.rank,".")})),Gl("maxPool3dGrad",i,o);var f={dy:l,input:h,output:p},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=xs.runKernel(Ta,f,m);return d?jl(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),qg={kernelName:Ca,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return Kg(e,a,i,o,s,u,c)}}}};var Xg=_s({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=Es(e,"dy","maxPoolGrad"),u=Es(t,"input","maxPoolGrad"),c=Es(n,"output","maxPoolGrad");nn(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),nn(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),nn(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),Gl("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},h={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return xs.runKernel(Ia,l,h)}}),Yg={kernelName:Sa,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,E.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Xg(e,a,i,o,s,u)}}}},Qg={kernelName:_a,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Yl(e,a,r.shape)}}}},Jg={kernelName:Ga,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Yl(e,a,r.shape)}}}},$g={kernelName:ja,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=(0,E.Z)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=Ic(o.shape,s.shape);return{a:function(){var t=Hu(s,"float32"),n=ic(e,ic(t,yc(o,bc(t,lc(1))))),r=Sc(o.shape,u);return r.length>0&&(n=Kh(n,r)),jl(n,o.shape)},b:function(){var t=ap(o,0),n=_h(t,mp(o),uc(o)),r=ic(e,ic(i,n)),a=Sc(s.shape,u);return a.length>0&&(r=Kh(r,a)),jl(r,s.shape)}}}};function ey(e,t,n){var r=e.shape.length,a=r-n.length,i=Vh(n,r),o=e;null!=i&&(o=vf(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=jl(t,r),i=Sh(e,n,!0,!1),o=Sh(e,n,!0,!0),s=ic(i,o);return ic(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=Gh(i);c=vf(c,l)}return c}var ty={kernelName:di,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){var t=ap(n,lc(0)),r=lc(uv),a=lc(cv),i=ic(e,a),o=ic(ic(e,r),Qh(Hu(n,"float32")));return _h(t,i,o)}}}},ny={kernelName:wi,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return $l(e,r,a)}}}},ry={kernelName:Si,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Kl(e,r)}}}},ay={kernelName:Ui,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.reps;return{x:function(){var t=uc(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=nc(t,Yl(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=nc(t,Yl(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=nc(t,Yl(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var p=0;p<a[2];++p)for(var d=0;d<a[3];++d)t=nc(t,Yl(e,[l*r.shape[0],h*r.shape[1],p*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}};for(var iy=0,oy=[Gv,jv,Hv,Zv,Kv,qv,Xv,Yv,Qv,Jv,$v,eg,ng,ag,ig,og,sg,ug,cg,lg,hg,pg,fg,dg,vg,gg,yg,bg,xg,kg,{kernelName:Br,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=ac(e,Hu(a,"float32")),n=Sc(r.shape,i);return n.length>0?jl(Kh(t,n),r.shape):t},b:function(){var t=ic(e,Hu(r,"float32")),n=Sc(a.shape,i);n.length>0&&(t=jl(Kh(t,n),a.shape));var o=sc(a);return gp(ac(t,Hu(o,"float32")))}}}},wg,Sg,Ig,Cg,Tg,Eg,Ng,Rg,Ag,Fg,Dg,Mg,Pg,Lg,zg,Bg,Ug,Wg,Gg,Hg,Hg,Zg,qg,Yg,{kernelName:Ea,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=dn(n.axis,r.shape),i=on(Bh(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=jl(e,t);return ac(ic(n,Dp(r.shape,"float32")),i)}}}},{kernelName:Ra,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=(0,E.Z)(t,2),i=a[0],o=jg(e,a[1],i,dn(r,i.shape));return{x:function(){return o.x()}}}},{kernelName:Aa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1];return{a:function(){return ic(e,Hu(pp(r,a),"float32"))},b:function(){return ic(e,Hu(ap(r,a),"float32"))}}}},Qg,{kernelName:Oa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=Sc(r.shape,i);return t.length>0?jl(Kh(e,t),r.shape):e},b:function(){var t=ic(e,gp(np(ac(r,a)))),n=Sc(a.shape,i);return n.length>0?jl(Kh(t,n),a.shape):t}}}},{kernelName:Da,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=ic(e,Hu(a,"float32")),n=Sc(r.shape,i);return n.length>0?jl(Kh(t,n),r.shape):t},b:function(){var t=ic(e,Hu(r,"float32")),n=Sc(a.shape,i);return n.length>0?jl(Kh(t,n),a.shape):t}}}},{kernelName:Ma,gradFunc:function(e){return{x:function(){return gp(e)}}}},{kernelName:Wa,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Fp(n.shape,"float32")}}}},{kernelName:Ua,gradFunc:function(e){return{x:function(){return uc(e)}}}},{kernelName:Va,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return uf(e,r).map((function(e){return function(){return e}}))}},Jg,Jg,$g,{kernelName:Ha,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=ap(r,0);return{x:function(){return _h(i,e,ic(e,a))},alpha:function(){var t=_h(i,uc(e),ic(e,r)),n=Sc(a.shape,e.shape);return n.length>0&&(t=Kh(t,n)),jl(t,a.shape)}}}},{kernelName:Za,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.axis,i=[];return i=void 0===a||null===a?r.shape.map((function(e,t){return t})):"number"===typeof a?[a]:a,{x:function(){return ey(r,e,i)}}}},{kernelName:Ja,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,gp(sc(n)))}}}},{kernelName:ii,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0],r=ic(pp(n,6),Zd(n));return{x:function(){return ic(e,Hu(r,"float32"))}}}},{kernelName:$a,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,Hu(Zd(n),"float32"))}}}},{kernelName:ei,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return jl(e,n.shape)}}}},{kernelName:ri,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,E.Z)(t,1)[0]};return{images:function(){return xs.runKernel(ai,r,n)}}}},{kernelName:ti,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,E.Z)(t,1)[0]};return{images:function(){return xs.runKernel(ni,r,n)}}}},{kernelName:oi,gradFunc:function(e,t,n){var r=dn(n.dims,e.shape);return{x:function(){return bd(e,r)}}}},{kernelName:si,gradFunc:function(e){return{x:function(){return uc(e)}}}},{kernelName:ui,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return gp(ac(e,ic(yc(n,1.5),2)))}}}},{kernelName:pi,inputsToSave:["condition"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{condition:function(){return Hu(uc(n),"float32")},t:function(){return ic(e,Hu(n,e.dtype))},e:function(){return ic(e,Hu(Sp(n),e.dtype))}}}},ty,{kernelName:yi,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,ic(n,bc(lc(1),n)))}}}},{kernelName:gi,gradFunc:function(e){return{x:function(){return uc(e)}}}},{kernelName:mi,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(kh(Hu(n,"float32")),e)}}}},{kernelName:vi,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(wh(Hu(n,"float32")),e)}}}},{kernelName:fi,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=(0,E.Z)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=fl(r,a,i),u=(0,E.Z)(s,2),c=u[0],l=u[1],h=[],p=0;p<e.rank;p++)h.push([c[p],o[p]-c[p]-l[p]]);return{x:function(){return Zp(e,h)}}}},{kernelName:Ii,outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=n.dim,i=ic(e,r);return{logits:function(){return bc(i,ic(Kh(i,[a],true),r))}}}},{kernelName:bi,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,Xl(n))}}}},ny,ny,ry,ry,{kernelName:xi,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,ic(oc(Hu(n,"float32")),2))}}}},{kernelName:Ai,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=lc(2);return{a:function(){return ic(e,ic(i,bc(r,a)))},b:function(){return ic(e,ic(i,bc(a,r)))}}}},{kernelName:_i,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(e,ic(Hu(n,"float32"),2))}}}},{kernelName:qi,gradFunc:function(e){return{x:function(){return uc(e)}}}},{kernelName:Li,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,E.Z)(t,2),r=n[0],a=n[1],i=Ic(r.shape,a.shape);return{a:function(){var t=e,n=Sc(r.shape,i);return n.length>0&&(t=Kh(t,n)),jl(t,r.shape)},b:function(){var t=e,n=Sc(a.shape,i);return n.length>0&&(t=Kh(t,n)),jl(gp(t),a.shape)}}}},{kernelName:ki,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,E.Z)(t,1)[0],a=r.shape.slice();dn(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=jl(e,a),o=ic(i,Dp(r.shape,"float32"));return{x:function(){return o}}}},{kernelName:zi,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ac(e,sc(kh(n)))}}}},{kernelName:Bi,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return ic(bc(lc(1),sc(n)),e)}}}},ay,{kernelName:Gi,gradFunc:function(e,t,n){var r=Gh(n.perm);return{x:function(){return vf(e,r)}}}},{kernelName:Hi,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return Hd(e,r)}}}},{kernelName:Zi,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=(0,E.Z)(t,1)[0];return{x:function(){return function(e,t){for(var n=Cc(t,uc(t)),r=rp(e,n),a=ip(t,lc(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Jh(a,o+1);a=wp(a,Dp(r.shape,"bool"));var s=uc(r);return _h(a,r,s)}(e,n)}}}},{kernelName:Ki,gradFunc:function(e){return{x:function(){return uc(e)}}}}];iy<oy.length;iy++){so(oy[iy])}function sy(e,t,n){return sy=Lo()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&(0,Do.Z)(a,n.prototype),a},sy.apply(null,arguments)}function uy(e){var t="function"===typeof Map?new Map:void 0;return uy=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return sy(e,arguments,Po(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),(0,Do.Z)(n,e)},uy(e)}$o().prototype.abs=function(){return this.throwIfDisposed(),kc(this)},$o().prototype.acos=function(){return this.throwIfDisposed(),gl(this)},$o().prototype.acosh=function(){return this.throwIfDisposed(),yl(this)},$o().prototype.add=function(e){return this.throwIfDisposed(),nc(this,e)},$o().prototype.all=function(e,t){return this.throwIfDisposed(),xl(this,e,t)},$o().prototype.any=function(e,t){return this.throwIfDisposed(),kl(this,e,t)},$o().prototype.argMax=function(e){return this.throwIfDisposed(),wl(this,e)},$o().prototype.argMin=function(e){return this.throwIfDisposed(),Sl(this,e)},$o().prototype.asScalar=function(){return this.throwIfDisposed(),nn(1===this.size,(function(){return"The array must have only 1 element."})),jl(this,[])},$o().prototype.asType=function(e){return this.throwIfDisposed(),Hu(this,e)},$o().prototype.as1D=function(){return this.throwIfDisposed(),jl(this,[this.size])},$o().prototype.as2D=function(e,t){return this.throwIfDisposed(),jl(this,[e,t])},$o().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),jl(this,[e,t,n])},$o().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),jl(this,[e,t,n,r])},$o().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),jl(this,[e,t,n,r,a])},$o().prototype.asin=function(){return this.throwIfDisposed(),Il(this)},$o().prototype.asinh=function(){return this.throwIfDisposed(),Cl(this)},$o().prototype.atan=function(){return this.throwIfDisposed(),Tl(this)},$o().prototype.atan2=function(e){return this.throwIfDisposed(),Nl(this,e)},$o().prototype.atanh=function(){return this.throwIfDisposed(),El(this)},$o().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Hl(this,e,t,n,r)},$o().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),$l(this,e,t)},$o().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),eh(this,e,t,n,r,a)},$o().prototype.broadcastTo=function(e){return this.throwIfDisposed(),sh(this,e)},$o().prototype.cast=function(e){return this.throwIfDisposed(),Hu(this,e)},$o().prototype.ceil=function(){return this.throwIfDisposed(),uh(this)},$o().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ch(this,e,t)},$o().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Jo&&(e=[e]),Kl([this].concat((0,Lt.Z)(e)),t)},$o().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),mh(this,e,t,n,r,a,i)},$o().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),gh(this,e,t,n,r,a)},$o().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),fh(this,e,t,n,r,a,i)},$o().prototype.cos=function(){return this.throwIfDisposed(),kh(this)},$o().prototype.cosh=function(){return this.throwIfDisposed(),wh(this)},$o().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Sh(this,e,t,n)},$o().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Ih(this,e,t,n)},$o().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Th(this,e,t)},$o().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Nh(this,e,t,n,r,a,i)},$o().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),Rh(this,e,t,n,r,a)},$o().prototype.divNoNan=function(e){return this.throwIfDisposed(),Oh(this,e)},$o().prototype.div=function(e){return this.throwIfDisposed(),ac(this,e)},$o().prototype.dot=function(e){return this.throwIfDisposed(),Fh(this,e)},$o().prototype.elu=function(){return this.throwIfDisposed(),Mh(this)},$o().prototype.equal=function(e){return this.throwIfDisposed(),Ah(this,e)},$o().prototype.erf=function(){return this.throwIfDisposed(),Lh(this)},$o().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Yh(this,e,t)},$o().prototype.exp=function(){return this.throwIfDisposed(),Qh(this)},$o().prototype.expandDims=function(e){return this.throwIfDisposed(),Jh(this,e)},$o().prototype.expm1=function(){return this.throwIfDisposed(),$h(this)},$o().prototype.fft=function(){return this.throwIfDisposed(),zd(this)},$o().prototype.flatten=function(){return this.throwIfDisposed(),jl(this,[this.size])},$o().prototype.floor=function(){return this.throwIfDisposed(),np(this)},$o().prototype.floorDiv=function(e){return this.throwIfDisposed(),rc(this,e)},$o().prototype.gather=function(e,t,n){return this.throwIfDisposed(),rp(this,e,t,n)},$o().prototype.greaterEqual=function(e){return this.throwIfDisposed(),ip(this,e)},$o().prototype.greater=function(e){return this.throwIfDisposed(),ap(this,e)},$o().prototype.ifft=function(){return this.throwIfDisposed(),Bd(this)},$o().prototype.irfft=function(){return this.throwIfDisposed(),Ud(this)},$o().prototype.isFinite=function(){return this.throwIfDisposed(),sp(this)},$o().prototype.isInf=function(){return this.throwIfDisposed(),up(this)},$o().prototype.isNaN=function(){return this.throwIfDisposed(),cp(this)},$o().prototype.leakyRelu=function(e){return this.throwIfDisposed(),lp(this,e)},$o().prototype.lessEqual=function(e){return this.throwIfDisposed(),pp(this,e)},$o().prototype.less=function(e){return this.throwIfDisposed(),hp(this,e)},$o().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),fp(this,e,t,n,r)},$o().prototype.logSigmoid=function(){return this.throwIfDisposed(),bp(this)},$o().prototype.logSoftmax=function(e){return this.throwIfDisposed(),xp(this,e)},$o().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),kp(this,e,t)},$o().prototype.log=function(){return this.throwIfDisposed(),mp(this)},$o().prototype.log1p=function(){return this.throwIfDisposed(),vp(this)},$o().prototype.logicalAnd=function(e){return this.throwIfDisposed(),wp(this,e)},$o().prototype.logicalNot=function(){return this.throwIfDisposed(),Sp(this)},$o().prototype.logicalOr=function(e){return this.throwIfDisposed(),Ip(this,e)},$o().prototype.logicalXor=function(e){return this.throwIfDisposed(),Cp(this,e)},$o().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),ql(this,e,t,n)},$o().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Rp(this,e,t,n,r)},$o().prototype.max=function(e,t){return this.throwIfDisposed(),Hh(this,e,t)},$o().prototype.maximum=function(e){return this.throwIfDisposed(),Cc(this,e)},$o().prototype.mean=function(e,t){return this.throwIfDisposed(),Op(this,e,t)},$o().prototype.min=function(e,t){return this.throwIfDisposed(),Zh(this,e,t)},$o().prototype.minimum=function(e){return this.throwIfDisposed(),Pp(this,e)},$o().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Lp(this,e,t)},$o().prototype.mod=function(e){return this.throwIfDisposed(),zp(this,e)},$o().prototype.mul=function(e){return this.throwIfDisposed(),ic(this,e)},$o().prototype.neg=function(){return this.throwIfDisposed(),gp(this)},$o().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Xh(this,e,t,n)},$o().prototype.notEqual=function(e){return this.throwIfDisposed(),Vp(this,e)},$o().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Gp(this,e,t,n)},$o().prototype.onesLike=function(){return this.throwIfDisposed(),jp(this)},$o().prototype.pad=function(e,t){return this.throwIfDisposed(),Zp(this,e,t)},$o().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),Jp(this,e,t,n,r,a,i)},$o().prototype.pow=function(e){return this.throwIfDisposed(),yc(this,e)},$o().prototype.prelu=function(e){return this.throwIfDisposed(),$p(this,e)},$o().prototype.prod=function(e,t){return this.throwIfDisposed(),ed(this,e,t)},$o().prototype.reciprocal=function(){return this.throwIfDisposed(),vd(this)},$o().prototype.relu=function(){return this.throwIfDisposed(),gd(this)},$o().prototype.relu6=function(){return this.throwIfDisposed(),yd(this)},$o().prototype.reshapeAs=function(e){return this.throwIfDisposed(),jl(this,e.shape)},$o().prototype.reshape=function(e){return this.throwIfDisposed(),jl(this,e)},$o().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),cm(this,e,t,n)},$o().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),lm(this,e,t,n)},$o().prototype.reverse=function(e){return this.throwIfDisposed(),bd(this,e)},$o().prototype.rfft=function(){return this.throwIfDisposed(),Vd(this)},$o().prototype.round=function(){return this.throwIfDisposed(),Id(this)},$o().prototype.rsqrt=function(){return this.throwIfDisposed(),Cd(this)},$o().prototype.selu=function(){return this.throwIfDisposed(),Td(this)},$o().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Nd(this,e,t,n,r,a,i)},$o().prototype.sigmoid=function(){return this.throwIfDisposed(),Xl(this)},$o().prototype.sign=function(){return this.throwIfDisposed(),Ad(this)},$o().prototype.sin=function(){return this.throwIfDisposed(),_d(this)},$o().prototype.sinh=function(){return this.throwIfDisposed(),Od(this)},$o().prototype.slice=function(e,t){return this.throwIfDisposed(),Yl(this,e,t)},$o().prototype.softmax=function(e){return this.throwIfDisposed(),Ld(this,e)},$o().prototype.softplus=function(){return this.throwIfDisposed(),yp(this)},$o().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Qp(this,e,t)},$o().prototype.split=function(e,t){return this.throwIfDisposed(),Wd(this,e,t)},$o().prototype.sqrt=function(){return this.throwIfDisposed(),oc(this)},$o().prototype.square=function(){return this.throwIfDisposed(),sc(this)},$o().prototype.squaredDifference=function(e){return this.throwIfDisposed(),Gd(this,e)},$o().prototype.squeeze=function(e){return this.throwIfDisposed(),jd(this,e)},$o().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof Jo?[this,e]:[this].concat((0,Lt.Z)(e));return Hd(n,t)},$o().prototype.step=function(e){return this.throwIfDisposed(),Zd(this,e)},$o().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),Kd(this,e,t,n,r,a,i,o,s)},$o().prototype.sub=function(e){return this.throwIfDisposed(),bc(this,e)},$o().prototype.sum=function(e,t){return this.throwIfDisposed(),Kh(this,e,t)},$o().prototype.tan=function(){return this.throwIfDisposed(),qd(this)},$o().prototype.tanh=function(){return this.throwIfDisposed(),Ql(this)},$o().prototype.tile=function(e){return this.throwIfDisposed(),ep(this,e)},$o().prototype.toBool=function(){return this.throwIfDisposed(),Hu(this,"bool")},$o().prototype.toFloat=function(){return this.throwIfDisposed(),Hu(this,"float32")},$o().prototype.toInt=function(){return this.throwIfDisposed(),Hu(this,"int32")},$o().prototype.topk=function(e,t){return this.throwIfDisposed(),rf(this,e,t)},$o().prototype.transpose=function(e){return this.throwIfDisposed(),vf(this,e)},$o().prototype.unique=function(e){return this.throwIfDisposed(),of(this,e)},$o().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),sf(this,e,t)},$o().prototype.unstack=function(e){return this.throwIfDisposed(),uf(this,e)},$o().prototype.where=function(e,t){return this.throwIfDisposed(),_h(e,this,t)},$o().prototype.zerosLike=function(){return this.throwIfDisposed(),uc(this)};var cy=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,e),Object.setPrototypeOf(zo(r),n.prototype),r}return Re(n)}(uy(Error)),ly=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,e),Object.setPrototypeOf(zo(r),n.prototype),r}return Re(n)}(uy(Error)),hy=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,e),Object.setPrototypeOf(zo(r),n.prototype),r}return Re(n)}(uy(Error)),py=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,e),Object.setPrototypeOf(zo(r),n.prototype),r}return Re(n)}(uy(Error)),dy=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,e),Object.setPrototypeOf(zo(r),n.prototype),r}return Re(n)}(uy(Error)),fy=function(){function e(t){Te(this,e),this.maxEntries=t||100,this.cache=new Map}return Re(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function my(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function vy(e,t){if(!e)throw new dy(t)}function gy(e,t){var n,r=0,a=Kt(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch($Q){a.e($Q)}finally{a.f()}return r}function yy(e){return 1===e.length?e[0]:e}function by(e){return Array.isArray(e)?e:[e]}function xy(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function ky(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var wy={};function Sy(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Iy(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return Iy(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?Iy(a):e[r]=a.value)}}function Cy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in wy)i=wy[o];else if(null==(i=t[o]))throw new hy("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new hy("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,c,l=s.className;if(l in n){var h=(0,E.Z)(n[l],2);u=h[0],c=h[1]}else if(l in wy){var p=(0,E.Z)(wy.className,2);u=p[0],c=p[1]}else if(l in t){var d=(0,E.Z)(t[l],2);u=d[0],c=d[1]}if(null==u)throw new hy("Unknown ".concat(r,": ").concat(l,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){for(var f={},m=0,v=Object.keys(wy);m<v.length;m++){var g=v[m];f[g]=wy[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var x=b[y];f[x]=n[x]}s.config.customObjects=f;for(var k=Object.assign({},wy),w=0,S=Object.keys(n);w<S.length;w++){var I=S[w];wy[I]=n[I]}Iy(s.config);var C=c(u,s.config,n,a);return wy=Object.assign({},k),C}for(var T=Object.assign({},wy),N=0,R=Object.keys(n);N<R.length;N++){var A=R[N];wy[A]=n[A]}var _=new u(s.config);return wy=Object.assign({},T),_}function Ty(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Ny(e){if(null==e)return e;var t,n=[],r=Kt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch($Q){r.e($Q)}finally{r.f()}return n}function Ey(e){if(null==e)throw new hy("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Ry(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new hy("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Ay(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return vy(n>=0),vy(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function _y(e,t){Array.isArray(e)?(nn(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return _y(e,"element ".concat(n+1," of ").concat(t))}))):nn(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(Oy(e),".")}))}function Oy(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return Oy(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function Fy(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var Dy=0;function My(){return Dy++}var Py={};function Ly(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in Py||(Py[e]=0),Py[e]+=1,e+Py[e].toString()}var zy=["channelsFirst","channelsLast"],By=["nearest","bilinear"],Uy=["valid","same","causal"],Wy=["max","avg"],Vy=["sum","mul","concat","ave"],Gy=new Map;function jy(e){Ry(zy,"DataFormat",e)}function Hy(e){Ry(Uy,"PaddingMode",e)}function Zy(e){Ry(Wy,"PoolMode",e)}var Ky=[],qy="/";function Xy(e,t){Ky.push(e);try{var n=t();return Ky.pop(),n}catch(JG){throw Ky.pop(),JG}}function Yy(e){if(!eb(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Ky.length?"":Ky.join(qy)+qy)+e}function Qy(e){if(!eb(e))throw new Error("Not a valid tensor name: '"+e+"'");Gy.has(e)||Gy.set(e,0);var t=Gy.get(e);if(Gy.set(e,Gy.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return Gy.set(n,1),n}return e}var Jy,$y=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function eb(e){return!!e.match($y)}function tb(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function nb(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function rb(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function ab(e,t){if(t<e)throw new hy("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function ib(){return null==Jy&&(Jy=tc().epsilon()),Jy}function ob(e,t){return Hu(e,t)}function sb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),jl(e,n)}function ub(e,t,n){return Yu((function(){switch(e.rank){case 1:return Fd(e,t,n);case 2:return Dd(e,[t,0],[n,e.shape[1]]);case 3:return Md(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Pd(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Yl(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Yl(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new hy("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function cb(e,t,n){return Yu((function(){switch(e.rank){case 1:return Fd(e,t,n);case 2:return Dd(e,[0,t],[e.shape[0],n]);case 3:return Md(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Pd(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new hy("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function lb(e,t,n,r){return Yu((function(){switch(e.rank){case 1:return Fd(e,t,n);case 2:switch(r){case 1:return ub(e,t,n);case 2:return cb(e,t,n);default:throw new hy("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return ub(e,t,n);case 2:return Md(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return cb(e,t,n);default:throw new hy("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return ub(e,t,n);case 2:return Pd(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Pd(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return cb(e,t,n);default:throw new hy("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new hy("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function hb(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Kl(e,n)}function pb(e,t){switch(e.rank){case 1:return lh([e,t]);case 2:return hh([e,t],0);case 3:return ph([e,t],0);case 4:return dh([e,t],0);default:throw new hy("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function db(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new hy("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return ep(e,t)}function fb(e){return ld(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function mb(e,t,n,r){if(e.rank<2||t.rank<2)throw new py("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new py("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return Mf({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?yb(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=jl(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat((0,Lt.Z)(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=jl(vf(t,l),[u,-1]);var h=[].concat((0,Lt.Z)(a),(0,Lt.Z)(c));return jl(Mf({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?yb(e.rank,r,"channelsLast"):null,activation:n}),h)}function vb(e,t,n){return Yu((function(){return t=Array.isArray(t)?Xd(t,"int32"):Hu(t,"int32"),rp(e,t,n)}))}function gb(e){return ic(e,e)}function yb(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new hy("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?jl(t,[1,r[0],1,1,1]):jl(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?jl(t,[1,1,1,1,r[0]]):jl(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?jl(t,[1,r[0],1,1]):jl(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?jl(t,[1,1,1,r[0]]):jl(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?jl(t,[1,r[0],1]):jl(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?jl(t,[1,1,r[0]]):jl(t,[1].concat(r))}else if(e<3)return t;throw new hy("Unsupported input rank by biasAdd: ".concat(t.rank))}function bb(e,t,n){return Yu((function(){return null==n&&(n="channelsLast"),jy(n),nc(e,yb(e.rank,t,n))}))}function xb(e,t,n,r){return Yu((function(){return kf(e,t,n,r)}))}function kb(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var wb=["fanIn","fanOut","fanAvg"],Sb=["normal","uniform","truncatedNormal"];var Ib=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(hc),Cb=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e,t){return Fp(e,t)}}]),n}(Ib);Cb.className="Zeros",dc(Cb);var Tb=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e,t){return Dp(e,t)}}]),n}(Ib);Tb.className="Ones",dc(Tb);var Nb=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),r=t.call(this),"object"!==typeof e)throw new hy("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new hy("config must have value set but got ".concat(e));return r.value=e.value,r}return Re(n,[{key:"apply",value:function(e,t){var n=this;return Yu((function(){return ic(lc(n.value),Dp(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(Ib);Nb.className="Constant",dc(Nb);var Eb=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return Re(n,[{key:"apply",value:function(e,t){return pd(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(Ib);Eb.className="RandomUniform",dc(Eb);var Rb=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Re(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new py("randomNormal does not support dType ".concat(t,"."));return fb(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Ib);Rb.className="RandomNormal",dc(Rb);var Ab=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Re(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new py("truncatedNormal does not support dType ".concat(t,"."));return af(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Ib);Ab.className="TruncatedNormal",dc(Ab);var _b=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return Re(n,[{key:"apply",value:function(e,t){var n=this;return Yu((function(){if(2!==e.length||e[0]!==e[1])throw new hy("Identity matrix initializer can only be used for 2D square matrices.");return ic(n.gain,tp(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(Ib);_b.className="Identity",dc(_b);var Ob=function(e){Mo(n,e);var t=Uo(n);function n(e){var r,a;if(Te(this,n),r=t.call(this),e.scale<0)throw new hy("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,Ry(wb,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Ry(Sb,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return Re(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(jy(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=tb(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=tb(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=tb(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new py("".concat(this.getClassName()," does not support dType ").concat(t,"."));return af(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return pd(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(Ib);Ob.className="VarianceScaling",dc(Ob);var Fb=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return Re(n,[{key:"getClassName",value:function(){return Ob.className}}]),n}(Ob);Fb.className="GlorotUniform",dc(Fb);var Db=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return Re(n,[{key:"getClassName",value:function(){return Ob.className}}]),n}(Ob);Db.className="GlorotNormal",dc(Db);var Mb=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Re(n,[{key:"getClassName",value:function(){return Ob.className}}]),n}(Ob);Mb.className="HeNormal",dc(Mb);var Pb=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Re(n,[{key:"getClassName",value:function(){return Ob.className}}]),n}(Ob);Pb.className="HeUniform",dc(Pb);var Lb=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Re(n,[{key:"getClassName",value:function(){return Ob.className}}]),n}(Ob);Lb.className="LeCunNormal",dc(Lb);var zb=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Re(n,[{key:"getClassName",value:function(){return Ob.className}}]),n}(Ob);zb.className="LeCunUniform",dc(zb);var Bb=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.ELEMENTS_WARN_SLOW=2e3,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,r}return Re(n,[{key:"apply",value:function(e,t){var n=this;return Yu((function(){if(e.length<2)throw new py("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));var r=on(e.slice(0,-1)),a=e[e.length-1],i=r*a;i>n.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(n.ELEMENTS_WARN_SLOW," (").concat(i,") elements: ")+"Slowness may result.");var o=fb([Math.max(a,r),Math.min(a,r)],0,1,t,n.seed),s=Bm.qr(o,!1),u=s[0],c=s[1].flatten().stridedSlice([0],[Math.min(a,r)*Math.min(a,r)],[Math.min(a,r)+1]);return u=ic(u,c.sign()),r<a&&(u=u.transpose()),ic(lc(n.gain),u.reshape(e))}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(Ib);Bb.className="Orthogonal",dc(Bb);var Ub={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Wb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Cy(e,pc.getMap().classNameMap,t,"initializer")}function Vb(e){return Sy(e)}function Gb(e){if("string"===typeof e){var t=e in Ub?Ub[e]:e;if("GlorotNormal"===t)return new Db;if("GlorotUniform"===t)return new Fb;if("HeNormal"===t)return new Mb;if("HeUniform"===t)return new Pb;if("LeCunNormal"===t)return new Lb;if("LeCunUniform"===t)return new zb;var n={};return n.className=t,n.config={},Wb(n)}return e instanceof Ib?e:Wb(e)}function jb(e){return Array.isArray(e)&&Array.isArray(e[0])}function Hb(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Zb(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new hy("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Kb(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new hy("Expected exactly 1 Shape; got ".concat(e.length))}return e}function qb(e){var t,n=0,r=Kt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch($Q){r.e($Q)}finally{r.f()}return n}var Xb="Variable",Yb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xb,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Te(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=My(),r=null==r?Xb:r,this.originalName=Yy(r),this.name=Qy(this.originalName),this.trainable_=a,this.constraint=i,this.val=lf(t,this.trainable_,this.name,this.dtype)}return Re(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function Qb(e){return e.map((function(e){return e.read()}))}function Jb(e){e.forEach((function(e){e[0].write(e[1])}))}var $b=Re((function e(t){Te(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),ex=Re((function e(t,n,r,a,i,o,s){Te(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=My(),null!=o&&(this.originalName=Yy(o),this.name=Qy(this.originalName)),this.rank=n.length})),tx=0,nx=function(){function e(t,n){Te(this,e),this.callArgs=n,this.id=tx++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=Kt(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch($Q){a.e($Q)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return Re(e,[{key:"getConfig",value:function(){var e,t=[],n=Kt(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch($Q){n.e($Q)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),rx=0,ax=function(e){Mo(n,e);var t=Uo(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Te(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=rx++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=xy(i)+"_"+Ly(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return Re(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new ly("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new hy("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return yy(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return yy(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new cy("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new cy("Layer ".concat(this.name)+" is not connected, no input to return.");return yy(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new cy("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new cy("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return yy(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=by(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=by(this.inputSpec);if(e.length!==t.length)throw new hy("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new hy("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new hy("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new hy("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new hy("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new hy("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var p=a.shape[h],d=r.shape[h];if(null!=p&&null!=d&&p!==d)throw new hy("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=by(e),i=!0,o=Kt(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof ex)){i=!1;break}}}catch($Q){o.e($Q)}finally{o.f()}var s,u=!0,c=Kt(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof ex){u=!1;break}}}catch($Q){c.e($Q)}finally{c.f()}if(i===u)throw new hy("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xy(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=Kt(by(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch($Q){o.e($Q)}finally{o.f()}n.build(yy(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),h=[],p=Kt(by(l));try{for(p.s();!(c=p.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),h.push(d)}}catch($Q){p.e($Q)}finally{p.f()}if(l=yy(h),null!=n.activityRegularizer)throw new py("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var f,m=function(e){e=by(e);var t,n=[],r=Kt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch($Q){r.e($Q)}finally{r.f()}return yy(n)}(e),v=n.computeOutputShape(m),g="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?m[0]:m),f=null!=v&&v.length>0&&Array.isArray(v[0])?v.map((function(r,a){return new ex(g,r,n,by(e),t,n.name,a)})):new ex(g,v,n,by(e),t,n.name),n.addInboundNode(e,f,null,null,m,v,t),n._refCount++,null!=n.activityRegularizer)throw new py("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return f}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new cy("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=Kt(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch($Q){n.e($Q)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new cy("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new ly("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return qb(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return Qb(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Yu((function(){var n=t.weights;if(n.length!==e.length)throw new hy('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=Qb(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!sn(o.shape,u.shape))throw new hy("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}Jb(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new hy("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Gb("zeros"));var u=r.apply(t,n),c=new Yb(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=by(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,(0,Lt.Z)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=by(e);t=by(t),n=by(n),r=by(r),a=Hb(a),i=Hb(i);var u,c=[],l=[],h=[],p=Kt(s);try{for(p.s();!(u=p.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),h.push(d.tensorIndex)}}catch($Q){p.e($Q)}finally{p.f()}new nx({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(hc);function ix(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=Kt(ix(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch($Q){s.e($Q)}finally{s.f()}}return a}var ox=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:Ly("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new hy("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new hy("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new hy("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new ex(r.dtype,r.batchInputShape,zo(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new nx({outboundLayer:zo(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return Re(n,[{key:"apply",value:function(e,t){throw new hy("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(ax);ox.className="InputLayer",dc(ox);var sx=function(){function e(t){if(Te(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=Kt(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch($Q){a.e($Q)}finally{a.f()}}}return Re(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new hy("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Hu(t,e.dtype)}catch($Q){throw new hy("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof ex){if(null==this.id2Value[e.id])throw new hy("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new hy("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof ex){if(null==this.id2Value[e.id])throw new hy("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new hy("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Qu(this.id2Mask)}}]),e}(),ux=new fy,cx=new fy;function lx(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),h=Kt(u);try{for(h.s();!(a=h.n()).done;){var p=a.value;-1!==l.indexOf(p)?c.push(t.getValue(p)):c.push(null)}}catch($Q){h.e($Q)}finally{h.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,f=u.join(",")+"|"+t.names().sort().join(","),m=ux.get(f);if(null==m){var v=function(e,t){nn(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=px(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=Kt(e);try{for(s.s();!(i=s.n()).done;){var u,c=px(i.value,t),l=c.sorted,h=c.recipientMap,p=Kt(l);try{for(p.s();!(u=p.n()).done;){var d=u.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch($Q){p.e($Q)}finally{p.f()}var f=function(e){null==r[e]&&(r[e]=new Set),h[e].forEach((function(t){return r[e].add(t)}))};for(var m in h)f(m)}}catch($Q){s.e($Q)}finally{s.f()}}return{sorted:n,recipientCounts:hx(r)}}(s,t);m=v.sorted,d=v.recipientCounts,ux.put(f,m),cx.put(f,d)}d={},i||Object.assign(d,cx.get(f));for(var g=new sx(t),y=0;y<m.length;++y){if(null!=r){var b=Xu().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=m[y],k=x.sourceLayer;if(!(k instanceof ox)){var w,S=[],I=[],C=[],T=!1,N=Kt(x.inputs);try{for(N.s();!(w=N.n()).done;){var E=w.value,R=g.getValue(E),A=g.getMask(E);S.push(R),I.push(A),null!=A&&(T=!0),i||(d[E.name]--,0!==d[E.name]||t.hasKey(E)||-1!==u.indexOf(E.name)||R.isDisposed||!0===E.sourceLayer.stateful||C.push(R))}}catch($Q){N.e($Q)}finally{N.f()}T&&((n=n||{}).mask=I[0]);var _=by(k.apply(S,n)),O=null;k.supportsMasking&&(O=k.computeMask(S,I));for(var F=dx(x),D=Array.isArray(F)?F:[F],M=0;M<D.length;++M){g.hasKey(D[M])||g.add(D[M],_[M],Array.isArray(O)?O[0]:O);var P=u.indexOf(D[M].name);-1!==P&&(c[P]=_[M])}i||Qu(C)}}return g.disposeMasks(),o?c:c[0]}function hx(e){var t={};for(var n in e)t[n]=e[n].size;return t}function px(e,t){var n,r=new Set,a=[],i={},o=Kt(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch($Q){o.e($Q)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var h=c[c.length-1]===u.length-1;if(0===l.inputs.length||h)u.pop(),a.push(l),r.add(l.name),h&&c.pop();else{c.push(u.length-1);var p,d=Kt(l.inputs);try{for(d.s();!(p=d.n()).done;){var f=p.value;null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),r.has(f.name)||u.push(f)}}catch($Q){d.e($Q)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function dx(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=Kt(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch($Q){i.e($Q)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function fx(e,t){return Yu((function(){return oc(Kh(ic(e,e),t,!0))}))}zn().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=ux&&ux.setMaxEntries(e),null!=cx&&cx.setMaxEntries(e)}));var mx=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"getConfig",value:function(){return{}}}]),n}(hc),vx=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Re(n,[{key:"apply",value:function(e){var t=this;return Yu((function(){var n=fx(e,t.axis),r=ch(n,0,t.maxValue);return ic(e,ac(r,nc(ib(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(mx);vx.className="MaxNorm",dc(vx);var gx=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Re(n,[{key:"apply",value:function(e){var t=this;return Yu((function(){return ac(e,nc(ib(),fx(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(mx);gx.className="UnitNorm",dc(gx);var yx=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return gd(e)}}]),n}(mx);yx.className="NonNeg",dc(yx);var bx=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Re(n,[{key:"apply",value:function(e){var t=this;return Yu((function(){var n=fx(e,t.axis),r=nc(ic(t.rate,ch(n,t.minValue,t.maxValue)),ic(1-t.rate,n));return ic(e,ac(r,nc(ib(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(mx);bx.className="MinMaxNorm",dc(bx);var xx,kx={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function wx(e){return Sy(e)}function Sx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Cy(e,pc.getMap().classNameMap,t,"constraint")}function Ix(e){return null==e?null:"string"===typeof e?Sx({className:e in kx?kx[e]:e,config:{}}):e instanceof mx?e:Sx(e)}function Cx(e){return Tx.apply(this,arguments)}function Tx(){return(Tx=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,u,c;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Qu(a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nx(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(xx||(xx={}));var Ex=function(){function e(){Te(this,e),this.validationData=null}return Re(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),Rx=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Te(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return Re(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=Kt(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch($Q){n.e($Q)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=Kt(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch($Q){n.e($Q)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Kt(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Kt(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Kt(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Kt(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Kt(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Kt(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ax=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.call(this)}return Re(n,[{key:"onEpochBegin",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i,o=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=Gt().mark((function e(t){var a,i,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"===typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=Yu((function(){return nc(o.totals[t],ic(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=Gt().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i,o=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=20;break}r=Kt(this.params.metrics),e.prev=2,i=Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.value,null!=o.totals[t]){e.next=3;break}return e.abrupt("return","continue");case 3:"number"===typeof o.totals[t]?n[t]=o.totals[t]/o.seen:Yu((function(){var e=ic(ac(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),Ju(n[t])}));case 4:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=12;break}return e.delegateYield(i(),"t0",7);case 7:if("continue"!==e.t0){e.next=10;break}return e.abrupt("continue",10);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(2),r.e(e.t1);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[2,14,17,20]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Ex),_x=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"onTrainBegin",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s,u,c;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Ex),Ox=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;if(Te(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||Zm,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return xn(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():No();return function(){var i=null!=n?n():No();return i-a<t?r:(a=i,r=e.apply(void 0,arguments))}}(a.maybeWait.bind(zo(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return Re(n,[{key:"maybeWait",value:function(){var e=Ht(Gt().mark((function e(t,n,r){var a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,Cx(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,Cx(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,Cx(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,Cx(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Ht(Gt().mark((function e(t,n){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,Cx(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):xn(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,Cx(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,Cx(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Ex);function Fx(e,t){return null==e&&(e={}),e instanceof Ex?[e]:Array.isArray(e)&&e[0]instanceof Ex?e:by(e).map((function(e){return new Ox(e,t)}))}var Dx=function(){function e(){Te(this,e)}return Re(e,null,[{key:"registerCallbackConstructor",value:function(t,n){nn(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new hy("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,(0,Lt.Z)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Mx(e,t,n,r,a,i,o,s,u){var c=new _x,l=[new Ax].concat((0,Lt.Z)(Dx.createCallbacks(t)));null!=e&&l.push.apply(l,(0,Lt.Z)(e)),l.push(c);var h=new Rx(l);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:c}}function Px(){return Px="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Po(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Px.apply(this,arguments)}function Lx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Cy(e,pc.getMap().classNameMap,t,"layer",n)}function zx(e,t){return Yu((function(){"float32"!==e.dtype&&(e=Hu(e,"float32"));var n=Kh(gb(e),t,!0),r=vc(n.shape,ib()),a=oc(Cc(n,r));return ac(e,a)}))}function Bx(e,t){return Yu((function(){return Op(gb(bc(t,e)),-1)}))}function Ux(e,t){return Yu((function(){return Op(kc(bc(t,e)),-1)}))}function Wx(e,t){return Yu((function(){var n=bc(e,t),r=ch(kc(e),ib(),Number.MAX_VALUE),a=kc(ac(n,r));return ic(100,Op(a,-1))}))}function Vx(e,t){return Yu((function(){var n=ch(t,ib(),Number.MAX_VALUE),r=mp(nc(1,n)),a=ch(e,ib(),Number.MAX_VALUE),i=mp(nc(1,a));return Op(gb(bc(r,i)),-1)}))}function Gx(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Yu((function(){if(n)t=Ld(t);else{var r=Kh(t,t.shape.length-1,!0);t=ac(t,r)}return t=ch(t,ib(),1-ib()),gp(Kh(ic(Hu(e,"float32"),mp(t)),t.shape.length-1))}))}function jx(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Yu((function(){var r=Hu(np(function(e){var t=[tb(e.shape)];return jl(e,t)}(e)),"int32"),a=(t=ch(t,ib(),1-ib())).shape;return Gx(jl(Gp(r,a[a.length-1]),a),t,n)}))}function Hx(e,t){return Yu((function(){var n;return n=ch(t,ib(),1-ib()),n=mp(ac(n,bc(1,n))),Op(function(e,t){if(!sn(e.shape,t.shape))throw new hy("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Yu((function(){var n=gd(t),r=gp(kc(t));return nc(bc(n,ic(t,e)),vp(Qh(r)))}))}(e,n),-1)}))}function Zx(e,t){return Yu((function(){var n=ch(e,ib(),1),r=ch(t,ib(),1);return Kh(ic(e,mp(ac(n,r))),-1)}))}function Kx(e,t){return Yu((function(){var n=zx(e,-1),r=zx(t,-1),a=ic(n,r);return gp(Kh(a,-1))}))}Dx.constructors={};var qx={meanSquaredError:Bx,meanAbsoluteError:Ux,meanAbsolutePercentageError:Wx,meanSquaredLogarithmicError:Vx,squaredHinge:function(e,t){return Yu((function(){var n=Cc(0,bc(1,ic(e,t)));return Op(gb(n),-1)}))},hinge:function(e,t){return Yu((function(){var n=Cc(0,bc(1,ic(e,t)));return Op(n,-1)}))},categoricalHinge:function(e,t){return Yu((function(){var n=Kh(ic(e,t),-1),r=Hh(ic(bc(1,e),t),-1);return Cc(0,nc(1,bc(r,n)))}))},logcosh:function(e,t){return Yu((function(){var n=Math.log(2),r=bc(t,e),a=bc(nc(r,yp(ic(-2,r))),n);return Op(a,-1)}))},categoricalCrossentropy:Gx,sparseCategoricalCrossentropy:jx,binaryCrossentropy:Hx,kullbackLeiblerDivergence:Zx,poisson:function(e,t){return Yu((function(){var n=mp(nc(ib(),t));return Op(bc(t,ic(e,n)),-1)}))},cosineProximity:Kx};function Xx(e){if("string"===typeof e){if(e in qx)return qx[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new hy(t)}return e}function Yx(e,t){return Yu((function(){var n=ic(.5,jp(t)),r=ob(ap(t,n),e.dtype);return Op(Ah(e,r),-1)}))}function Qx(e,t){return Yu((function(){return ob(Ah(wl(e,-1),wl(t,-1)),"float32")}))}function Jx(e,t){return Yu((function(){return Hu(Kh(wp(Ah(e,1),Ah(t,1))),"float32")}))}function $x(e,t){return Hx(e,t)}function ek(e,t){return e.rank===t.rank&&(e=jd(e,[e.rank-1])),(t=wl(t,-1)).dtype!==e.dtype&&(t=Hu(t,e.dtype)),Hu(Ah(e,t),"float32")}var tk=Gx,nk=jx,rk={binaryAccuracy:Yx,categoricalAccuracy:Qx,precision:function(e,t){return Yu((function(){var n=Jx(e,t),r=function(e,t){return Yu((function(){return Hu(Kh(wp(Ah(e,0),Ah(t,1))),"float32")}))}(e,t),a=nc(n,r);return Hu(_h(ap(a,0),ac(n,a),0),"float32")}))},categoricalCrossentropy:tk,sparseCategoricalCrossentropy:nk,mse:Bx,MSE:Bx,mae:Ux,MAE:Ux,mape:Wx,MAPE:Wx,cosine:Kx};function ak(e){if(vy(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(qx);n<r.length;n++){var a=r[n];if(qx[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(rk);i<o.length;i++){var s=o[i];if(rk[s]===e){t=s;break}}return void 0!==t?t:e.name}var ik=1048576;function ok(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!sk(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>ik&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(ik,"."))}}function sk(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!sk(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=Kt(e);try{for(i.s();!(a=i.n()).done;){if(!sk(a.value))return!1}}catch($Q){i.e($Q)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function uk(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,(0,Lt.Z)(s))}if(t){var u,c=Kt(e.layers);try{for(c.s();!(u=c.n()).done;){var l,h=u.value,p=!1,d=Kt(h.inboundNodes);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(-1!==r.indexOf(f)){if(p){t=!1;break}p=!0}}}catch($Q){d.e($Q)}finally{d.f()}if(!t)break}}catch($Q){c.e($Q)}finally{c.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,(0,Lt.Z)(e.nodesByDepth[s]))}a("_".repeat(t)),ck(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?lk(c[l],n,a):hk(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=function(e){var t;t=null!=e.collectedTrainableWeights?qb(e.collectedTrainableWeights):qb(e.trainableWeights);return t}(e),p=qb(e.nonTrainableWeights);a("Total params: ".concat(h+p)),a("Trainable params: ".concat(h)),a("Non-trainable params: ".concat(p)),a("_".repeat(t))}function ck(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function lk(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch($Q){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch($Q){r="multiple"}var i=e.name,o=e.getClassName();ck(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function hk(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch($Q){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch($Q){a="multiple"}var o,s=[],u=Kt(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var h=c.inboundLayers[l].name,p=c.nodeIndices[l],d=c.tensorIndices[l];s.push("".concat(h,"[").concat(p,"][").concat(d,"]"))}}}catch($Q){u.e($Q)}finally{u.f()}var f=e.name,m=e.getClassName(),v=0===s.length?"":s[0];ck(["".concat(f," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)ck(["","","","",s[g]],t,r)}function pk(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function dk(e,t){if(null===e)return null;if("string"===typeof e)return ky(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];pk(t,a,i)?n.push(i):n.push(dk(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var h=ky(c);o[h]=dk(l,h)}}return o}function fk(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return xy(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];pk(t,a,i)?n.push(i):n.push(fk(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],h=xy(c);o[h]="name"!==c&&"className"!==c||"string"!==typeof l?fk(l,c):l}return o}var mk="4.7.0",vk=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=Ly(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],Ny(r.inputs).length!==r.inputs.length)throw new hy("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));Ny(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=Kt(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch($Q){o.e($Q)}finally{o.f()}var h,p=Kt(r.inputs);try{for(p.s();!(h=p.n()).done;){var d=h.value,f=d.sourceLayer,m=d.nodeIndex,v=d.tensorIndex;vy(0===m,"input layer has >1 nodes"),vy(0===v,"input layer has >1 tensors"),r.inputLayers.push(f),r.inputLayersNodeIndices.push(m),r.inputLayersTensorIndices.push(v)}}catch($Q){p.e($Q)}finally{p.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof ox))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=Kt(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var k=b.value;r.outputNames.push(k.name)}}catch($Q){x.e($Q)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,S={},I={},C={},T={},N={},E=[],R=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new ly("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in N||(N[o.id]=Object.keys(N).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++){e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},A=[],_=[],O=Kt(r.outputs);try{for(O.s();!(w=O.n()).done;){R(w.value,A,_)}}catch($Q){O.e($Q)}finally{O.f()}var F,D=Kt(E.slice().reverse());try{for(D.s();!(F=D.n()).done;){var M=F.value;I[M.id]=M,M.id in S||(S[M.id]=0);var P=S[M.id],L=null==C[M.outboundLayer.id]?0:C[M.outboundLayer.id];P=Math.max(P,L),C[M.outboundLayer.id]=P,T[M.outboundLayer.id]=M.outboundLayer,S[M.id]=P;for(var z=0;z<M.inboundLayers.length;z++){var B=M.inboundLayers[z],U=M.nodeIndices[z],W=B.inboundNodes[U],V=null==S[W.id]?0:S[W.id];S[W.id]=Math.max(P+1,V),I[W.id]=W}}}catch($Q){D.e($Q)}finally{D.f()}var G={};for(var j in S){var H=S[j];H in G||(G[H]=[]),G[H].push(I[j])}var Z={};for(var K in C){var q=C[K];q in Z||(Z[q]=[]),Z[q].push(T[K])}var X=Object.keys(Z).map((function(e){return parseInt(e,10)})).sort(Ty);r.layers=[];var Y,Q=Kt(X);try{for(Q.s();!(Y=Q.n()).done;){var J=Z[Y.value];J.sort((function(e,t){var n=N[e.id],r=N[t.id];return n<r?-1:n>r?1:0}));var $,ee=Kt(J);try{for(ee.s();!($=ee.n()).done;){var te=$.value;te instanceof n&&r.internalContainerRefs.push(te),r.layers.push(te)}}catch($Q){ee.e($Q)}finally{ee.f()}}}catch($Q){Q.e($Q)}finally{Q.f()}r.layersByDepth=Z,X=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(Ty);var ne,re=r.inputs.slice(),ae=[],ie=Kt(X);try{for(ie.s();!(ne=ie.n()).done;){var oe,se=Kt(G[ne.value]);try{for(se.s();!(oe=se.n()).done;){var ue=oe.value,ce=ue.outboundLayer;if(null!=ce){var le,he=Kt(ue.inputTensors);try{for(he.s();!(le=he.n()).done;){var pe=le.value;if(-1===re.indexOf(pe))throw new ly("Graph disconnected: cannot obtain value for tensor ".concat(pe)+' at layer "'.concat(ce.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ae))}}catch($Q){he.e($Q)}finally{he.f()}var de,fe=Kt(ue.outputTensors);try{for(fe.s();!(de=fe.n()).done;){var me=de.value;re.push(me)}}catch($Q){fe.e($Q)}finally{fe.f()}ae.push(ce.name)}}}catch($Q){se.e($Q)}finally{se.f()}}}catch($Q){ie.e($Q)}finally{ie.f()}r.nodesByDepth=G;var ve,ge=r.layers.map((function(e){return e.name})),ye=Kt(ge);try{var be=function(){var e=ve.value,t=ge.filter((function(t){return t===e})).length;if(1!==t)throw new ly('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(ge))};for(ye.s();!(ve=ye.n()).done;)be()}catch($Q){ye.e($Q)}finally{ye.f()}return r.outboundNodes=[],r.inboundNodes=[],new nx({outboundLayer:zo(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return Re(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=Kt(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch($Q){n.e($Q)}finally{n.f()}var a,i=Kt(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch($Q){i.e($Q)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new hy("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=Kt(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch($Q){n.e($Q)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Kt(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Lt.Z)(r.nonTrainableWeights))}}catch($Q){n.e($Q)}finally{n.f()}if(!this.trainable){var a,i=[],o=Kt(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,Lt.Z)(s.trainableWeights))}}catch($Q){o.e($Q)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=Kt(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=Kt(t.value.weights);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(null!=r[u.originalName])throw new hy("Duplicate weight name: ".concat(u.originalName));r[u.originalName]=u,a++}}catch($Q){s.e($Q)}finally{s.f()}}}catch($Q){i.e($Q)}finally{i.f()}var c=[];for(var l in e){var h=l;if(null==r[l]){var p=l.split("/");h=p.slice(0,-2).concat([p[p.length-1]]).join("/")}if(null!=r[h])c.push([r[h],e[l]]);else if(n)throw new hy("Provided weight data has no target variable: ".concat(l));delete r[h]}if(n){var d=[];for(var f in r)d.push(f);if(d.length>0)throw new hy("".concat(d.length," of ").concat(a," weights are not set: ")+"".concat(d))}Jb(c)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(mk),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=fk(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Yu((function(){e=by(e);for(var r=new sx,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return lx(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return Yu((function(){var r;return e=by(e),r=null==t?my(null,e.length):by(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Hb(e);if(t.length!==this.inputLayers.length)throw new hy("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ty);if(o.length>1){var s,u=Kt(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,h=Kt(this.nodesByDepth[l]);try{for(h.s();!(c=h.n()).done;){var p=c.value,d=p.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(d.id)){for(var f=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=n["".concat(v.name,"_").concat(g,"_").concat(y)];f.push(b)}for(var x=Hb(d.computeOutputShape(yy(f))),k=d.inboundNodes.indexOf(p),w=0;w<x.length;w++){n["".concat(d.name,"_").concat(k,"_").concat(w)]=x[w]}}}}catch($Q){h.e($Q)}finally{h.f()}}}catch($Q){u.e($Q)}finally{u.f()}}for(var S=[],I=[],C=0;C<this.outputLayers.length;C++){var T=this.outputLayers[C],N=this.outputLayersNodeIndices[C],E=this.outputLayersTensorIndices[C],R="".concat(T.name,"_").concat(N,"_").concat(E);I.push(R)}for(var A=0;A<I.length;A++){var _=I[A];vy(_ in n),S.push(n[_])}return yy(S)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=my(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ty),c=Kt(u);try{for(c.s();!(s=c.n()).done;){var l,h=s.value,p=Kt(this.nodesByDepth[h]);try{for(p.s();!(l=p.n()).done;){var d,f=l.value,m=f.outboundLayer,v=f.inputTensors,g=f.outputTensors,y=new Array,b=Kt(v);try{for(b.s();!(d=b.n()).done;){var x=d.value;x.id in n&&y.push(n[x.id])}}catch($Q){b.e($Q)}finally{b.f()}if(y.length===v.length){var k={},w=void 0,S=void 0,I=void 0,C=void 0;if(null!=f.callArgs&&(k=f.callArgs),1===y.length){var T=(0,E.Z)(y[0],2),N=T[0],R=T[1];null==k.mask&&(k.mask=R),I=by(m.call(N,k)),C=by(m.computeMask(N,R)),w=[N],S=[R]}else w=y.map((function(e){return e[0]})),S=y.map((function(e){return e[1]})),null==k.mask&&(k.mask=S),I=by(m.call(w,k)),C=by(m.computeMask(w,S));if(m.activityRegularizer)throw new py("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<g.length;++A){var _=g[A],O=I[A],F=C[A];n[_.id]=[O,F]}}}}catch($Q){p.e($Q)}finally{p.f()}}}catch($Q){c.e($Q)}finally{c.f()}var D,M=[],P=[],L=[],z=Kt(this.outputs);try{for(z.s();!(D=z.n()).done;){var B=D.value;vy(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var U=(0,E.Z)(n[B.id],2),W=U[0],V=U[1];L.push(W.shape),M.push(W),P.push(V)}}catch($Q){z.e($Q)}finally{z.f()}return[M,P,L]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=Kt(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch($Q){i.e($Q)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new hy("Provide either a layer name or layer index");if("number"===typeof e)return this.findLayer(e);var n,r=Kt(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch($Q){r.e($Q)}finally{r.f()}throw new hy("No such layer: ".concat(e))}},{key:"findLayer",value:function(e){if(this.layers.length<=e)throw new hy("Was asked to retrieve layer at index ".concat(e,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[e]}},{key:"calculateLosses",value:function(){var e=this;return Yu((function(){var t,r=[],a=Kt(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,(0,Lt.Z)(i.calculateLosses()))}}catch($Q){a.e($Q)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=Kt(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var h=o.inboundNodes[l],p=n.nodeKey(o,l),d={};if(this.containerNodes.has(p)){if(h.callArgs)try{JSON.stringify(h.callArgs),d=h.callArgs}catch($Q){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(h.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),d={}}if(h.inboundLayers.length>0){for(var f=[],m=0;m<h.inboundLayers.length;m++){var v=h.inboundLayers[m],g=h.nodeIndices[m],y=h.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),f.push([v.name,b,y,d])}c.push(f)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch($Q){i.e($Q)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var S=this.inputLayers[w],I=this.inputLayersNodeIndices[w],C=n.nodeKey(S,I);if(this.containerNodes.has(C)){var T=r[C];null!==T&&void 0!==T||(T=0);var N=this.inputLayersTensorIndices[w];k.push([S.name,T,N])}}t.inputLayers=k;for(var E=[],R=0;R<this.outputLayers.length;R++){var A=this.outputLayers[R],_=this.outputLayersNodeIndices[R],O=n.nodeKey(A,_);if(this.containerNodes.has(O)){var F=r[O];null!==F&&void 0!==F||(F=0);var D=this.outputLayersTensorIndices[R];E.push([A.name,F,D])}}return t.outputLayers=E,t}},{key:"stateful",get:function(){if(this._stateful)throw new hy("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=Kt(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch($Q){t.e($Q)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;Yu((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=Kt(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var p=r[c];if(p.inboundNodes.length<=l)return void i(e,t);var d=p.inboundNodes[l];o.push(d.outputTensors[h])}}catch($Q){s.e($Q)}finally{s.f()}o.length>0&&e.apply(yy(o),n)}function s(e){var a=e.name,o=Lx(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new hy("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,h=Kt(l);try{for(h.s();!(u=h.n()).done;){s(u.value)}}catch($Q){h.e($Q)}finally{h.f()}for(;!Ey(a);){var p,d=Kt(l);try{for(d.s();!(p=d.n()).done;){var f=p.value,m=r[f.name];if(m.name in a){var v=a[m.name];delete a[m.name];var g,y=Kt(v);try{for(y.s();!(g=y.n()).done;){o(m,g.value)}}catch($Q){y.e($Q)}finally{y.f()}}}}catch($Q){d.e($Q)}finally{d.f()}}var b,x=[],k=[],w=Kt(t.inputLayers);try{for(w.s();!(b=w.n()).done;){var S=b.value,I=S[0],C=S[1],T=S[2];vy(I in r);var N=r[I].inboundNodes[C].outputTensors;x.push(N[T])}}catch($Q){w.e($Q)}finally{w.f()}var E,R=Kt(t.outputLayers);try{for(R.s();!(E=R.n()).done;){var A=E.value,_=A[0],O=A[1],F=A[2];vy(_ in r);var D=r[_].inboundNodes[O].outputTensors;k.push(D[F])}}catch($Q){R.e($Q)}finally{R.f()}return new e({inputs:x,outputs:k,name:c})}}]),n}(ax);function gk(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function yk(e,t){return gk(e,t,"classWeight")}function bk(e,t,n,r){return xk.apply(this,arguments)}function xk(){return(xk=Ht(Gt().mark((function e(t,n,r,a){var i,o,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=Yu((function(){if(1===t.shape.length)return Zu(t);if(2===t.shape.length){if(t.shape[1]>1){return wl(t,1)}if(1===t.shape[1])return jl(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Qu(i),s=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),e.abrupt("return",Xd(s,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kk(e,t){return ic(e,t)}var wk=32;function Sk(e,t){var n,r,a=t;n=a.xs,r=a.ys,nn(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=Ik("input",e.inputNames,n),o=Ik("output",e.outputNames,r),s=i[0].shape[0];nn(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),nn(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){nn(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){nn(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)l(h);return{xs:i,ys:o}}function Ik(e,t,n){if(n instanceof Jo)return[n];if(Array.isArray(n))return nn(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=Kt(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new hy("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch($Q){i.e($Q)}finally{i.f()}return a}function Ck(e){if(3===e.length)throw new py("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function Tk(e,t,n){return Nk.apply(this,arguments)}function Nk(){return Nk=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S,I,C,T,N,E,R,A,_,O,F,D,M,P;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,nn(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),nn(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),nn(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),nn(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),nn(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(Rk(r.validationData)?nn(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(u=Ck(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),h=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),p=Fx(r.callbacks,r.yieldEvery),d=null==r.verbose?1:r.verbose,f=Mx(p,d,r.epochs,null,null,Ek(n,r),null,i,h),m=f.callbackList,v=f.history,m.setModel(t),t.history=v,e.next=22,m.onTrainBegin();case 22:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:y=e.sent;case 27:if(!(g<r.epochs)){e.next=98;break}return b={},e.next=31,m.onEpochBegin(g);case 31:if(x=0,k=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:y=e.sent;case 37:if(a&&!(x<r.batchesPerEpoch)){e.next=91;break}return e.next=40,y.next();case 40:if(w=e.sent,!a||!w.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(x," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==w.value){e.next=73;break}return S=Sk(t,w.value),I=S.xs,C=S.ys,(T={}).batch=k,T.size=I[0].shape[0],e.next=51,m.onBatchBegin(k,T);case 51:if(N=[],null==r.classWeight){e.next=64;break}E=yk(r.classWeight,t.outputNames),R=0;case 55:if(!(R<E.length)){e.next=64;break}return e.t0=N,e.next=59,bk(C[R],null,E[R]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++R,e.next=55;break;case 64:for(A=I.concat(C).concat(N),_=c(A),Qu(A),O=0;O<l.length;++O)F=l[O],D=_[O],T[F]=D,Ju(D);return e.next=70,m.onBatchEnd(k,T);case 70:Nx(T),k++,x++;case 73:if(!(a?x>=r.batchesPerEpoch:w.done)){e.next=87;break}if(!i){e.next=86;break}if(M=void 0,!Rk(r.validationData)){e.next=84;break}return e.t2=by,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,M=(0,e.t2)(e.t3),e.next=85;break;case 84:M=by(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?wk:r.validationBatchSize,verbose:0}));case 85:for(P=0;P<t.metricsNames.length;++P)b["val_".concat(t.metricsNames[P])]=M[P];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,m.onEpochEnd(g,b);case 93:if(g++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,m.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),Nk.apply(this,arguments)}function Ek(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function Rk(e){return"function"===typeof e.iterator}function Ak(e,t,n){return _k.apply(this,arguments)}function _k(){return _k=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new py("Verbose mode is not implemented yet.");case 6:if(nn(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),"function"!==typeof n.next){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:s=e.t0,u=0,c=0,l=Gt().mark((function e(){var n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=Yu((function(){if(n.value){var e=Sk(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=Yu((function(){return i(s)}));if(Qu(s),0===c)for(var h=0;h<l.length;++h)o.push(lc(0));for(var p=s[0].shape[0],d=function(e){var t=l[e],n=o[e];o[e]=Yu((function(){return nc(o[e],ic(p,t))})),c>0&&Qu(n)},f=0;f<l.length;++f)d(f);Qu(l),u+=p,++c}return o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(c<r.batches)){e.next=25;break}return e.delegateYield(l(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(h=0;h<o.length;++h)p=o[h],o[h]=ac(o[h],u),Qu(p);return e.abrupt("return",yy(o));case 27:case"end":return e.stop()}}),e)}))),_k.apply(this,arguments)}function Ok(e){nn(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function Fk(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return ub(e,t,n-t)})):ub(e,t,n-t)}function Dk(e,t){return Yu((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return Dk(e,t)})):vb(e,"int32"===t.dtype?t:Hu(t,"int32"))}))}function Mk(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function Pk(e){var t=[];e instanceof Jo&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(sb(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Lk(e,t){if(null!=e){var n=[];if(t instanceof Jo)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof Jo)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function zk(e){return Array.isArray(e)}function Bk(e){return!function(e){return e instanceof Jo}(e)&&!zk(e)}function Uk(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(zk(e)&&e.length>0)o=!0;else if(Bk(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new hy("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(Bk(e)){r=[];var u,c=Kt(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new hy('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch($Q){c.e($Q)}finally{c.f()}}else if(zk(e)){if(e.length!==t.length)throw new hy("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new hy("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=Pk(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var p=r[h];if(p.shape.length!==n[h].length)throw new hy("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have ".concat(n[h].length," dimension(s). but got array with ")+"shape ".concat(p.shape));for(var d=0;d<n[h].length;++d)if(0!==d||a){var f=p.shape[d],m=n[h][d];if(null!=m&&m>=0&&f!==m)throw new hy("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[h].slice(1,n[h].length),"] ")+"(i.e.,tensor shape [*,".concat(n[h].slice(1,n[h].length),"])")+" but the ".concat(i," received an input with ").concat(p.shape[0])+" examples, each with shape [".concat(p.shape.slice(1,p.shape.length),"]")+" (tensor shape [".concat(p.shape,"])"))}}return r}function Wk(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new hy("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new hy("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new hy("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new hy("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var Vk=function(t){Mo(r,t);var n=Uo(r);function r(e){var t;return Te(this,r),(t=n.call(this,e)).isTraining=!1,t}return Re(r,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new hy("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");uk(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return jm.adagrad(.01)},Adadelta:function(){return jm.adadelta(1,.95,ib())},Adam:function(){return jm.adam(.001,.9,.999,ib())},Adamax:function(){return jm.adamax(.002,.9,.999,ib(),0)},RMSProp:function(){return jm.rmsprop(.001,.9,0,ib())},SGD:function(){return jm.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new hy("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof fc))throw new hy("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new hy("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return Xx(e)}))}else{var a=Xx(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new hy('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=Kt(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(Xx(e.loss[u]))}}catch($Q){s.e($Q)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var l=this.internalOutputShapes[c],h=this.outputNames[c];this.feedOutputNames.push(h),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[c])}var p=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xy("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===p.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=Kt(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch($Q){i.e($Q)}finally{i.f()}return a}(e.metrics,this.outputNames);Xy("metric",(function(){for(var e=function(e){if(-1!==p.indexOf(e))return"continue";!function(n){var r,a,i,o,s=Kt(n);try{var u=function(){var n,s=o.value;if("string"===typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===Hx?-1!==["accuracy","acc"].indexOf(s)?a=Yx:-1!==["crossentropy","ce"].indexOf(s)&&(a=$x):t.lossFunctions[e]===jx?-1!==["accuracy","acc"].indexOf(s)?a=ek:-1!==["crossentropy","ce"].indexOf(s)&&(a=nk):-1!==["accuracy","acc"].indexOf(s)?a=Qx:-1!==["crossentropy","ce"].indexOf(s)&&(a=tk),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else{var l=function(e){if("string"===typeof e&&e in rk)return rk[e];if("string"!==typeof e&&null!=e)return e;throw new hy("Unknown metric ".concat(e))}(s);i=l,r=""+ak(s)}Xy(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch($Q){s.e($Q)}finally{s.f()}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;Ok(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return yy(this.testLoop(o,i,r,n.verbose,n.steps))}finally{Lk(a[0],e),Lk(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",Ak(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new hy("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new hy("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new hy("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new sx;if(e instanceof Jo&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new hy("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=Kt(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new hy("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch($Q){u.e($Q)}finally{u.f()}}var h=lx(a,i);return n?h:h[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=my(null,e.length),r=e.length,a=Kt(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch($Q){a.e($Q)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new hy("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Yu((function(){var a=t.checkNumSamples(e);if(r)throw new py("Verbose predictLoop() is not implemented yet.");for(var i=Mk(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){Yu((function(){var r=i[n][0],a=i[n][1],o=Fk(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new sx(s);return lx(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return yy(o.map((function(e){return Kl(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Pk(e);Wk(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return Ok(r),this.predictLoop(n,r)}finally{Lk(n,e)}}},{key:"predictOnBatch",value:function(e){Wk(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new ly("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===jx?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=Ny(e.map((function(e){return e.shape[0]})));r.sort();var a=Ny(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new hy("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new hy("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!sn(r,a))throw new hy("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}(e=Uk(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Uk(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[Bx,Hx,Gx],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===Gx&&1===i.shape[i.shape.length-1])throw new hy("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],p=c[l];if(null!=p&&h!==p)throw new hy("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new hy("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=Ht(Gt().mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(f.length>4&&void 0!==f[4])||f[4],o=f.length>5?f[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=(0,E.Z)(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(h=null,null==a){e.next=19;break}p=yk(a,this.outputNames),h=[],d=0;case 10:if(!(d<p.length)){e.next=19;break}return e.t0=h,e.next=14,bk(l[d],null,p[d]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++d,e.next=10;break;case 19:return e.abrupt("return",[c,l,h]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Yu((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new py("Verbose mode is not implemented yet.");if(null!=i)throw new py("steps mode in testLoop() is not implemented yet");for(var u=Mk(o,n),c=Xd(ab(0,o)),l=0;l<u.length;++l){var h=u[l][0],p=u[l][1],d=ub(c,h,p-h),f=Dk(t,d),m=e(f);if(0===l)for(var v=0;v<m.length;++v)s.push(lc(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=nc(s[g],ic(p-h,y))}}for(var b=0;b<s.length;++b)s[b]=ac(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(gy(e,r)>1){var i=gy(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new sx(t),l=lx(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var p=(0,e.lossFunctions[h])(a[h],l[h]);null!=i[h]&&(p=kk(p,i[h]));var d=Op(p);n.push(d),u=0===h?p:nc(u,p)}for(var f=0;f<e.metricsTensors.length;++f){var m=void 0;if(e.outputs.length>1&&f<e.outputs.length)m=n[f];else{var v=e.metricsTensors[f][0],g=e.metricsTensors[f][1];m=Op(v(a[g],l[g]))}Ju(m),o.push(m)}return u=Op(u),e.calculateLosses().forEach((function(e){u=nc(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return Yu((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new sx(o),c=lx(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=e.lossFunctions[l],p=Op(h(i[l],c[l]));n=0===l?p:nc(n,p),r.push(n)}for(var d=0;d<e.metricsTensors.length;++d){var f=e.metricsTensors[d][0],m=e.metricsTensors[d][1],v=Op(f(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S,I,C,T,N=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=N.length>2&&void 0!==N[2]?N[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,Ok(d=null==r.batchSize?32:r.batchSize),!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,false,d);case 10:if(f=e.sent,a=f[0],i=f[1],p=f[2],m=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=36;break}if(m=!0,2!==r.validationData.length){e.next=22;break}u=r.validationData[0],c=r.validationData[1],e.next=27;break;case 22:if(3!==r.validationData.length){e.next=26;break}throw new py("validationData including sample weights is not supported yet.");case 26:throw new hy("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(r.validationData," is invalid."));case 27:return!0,e.next=30,this.standardizeUserData(u,c,null,null,true,d);case 30:g=e.sent,l=g[0],h=g[1],v=l.concat(h),e.next=37;break;case 36:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(m=!0,y=Math.floor(a[0].shape[0]*(1-r.validationSplit)),b=a[0].shape[0],l=Fk(a,y,b),o=a,a=Fk(a,0,y),h=Fk(i,y,b),s=i,i=Fk(i,0,y),v=l.concat(h)):null!=r.validationSteps&&(m=!0);case 37:return x=a.concat(i).concat(p),this.checkTrainableWeightsConsistency(),k=this.makeTrainFunction(),w=this.getDedupedMetricsNames(),m?(this.makeTestFunction(),S=this.testFunction,I=w.slice().concat(w.map((function(e){return"val_"+e})))):(S=null,v=[],I=w.slice()),C=Fx(r.callbacks,r.yieldEvery),e.next=45,this.fitLoop(k,x,w,d,r.epochs,r.verbose,C,S,v,r.shuffle,I,r.initialEpoch,null,null);case 45:return T=e.sent,e.abrupt("return",T);case 47:return e.prev=47,this.isTraining=!1,Lk(a,t),Lk(i,n),Lk(o,t),Lk(s,n),Lk(l,u),Lk(h,c),null!=p&&Qu(p),e.finish(47);case 57:case"end":return e.stop()}}),e,this,[[4,,47,57]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=Ht(Gt().mark((function e(t,n,r,a,i,o,s,u,c,l,h,p,d,f){var m,v,g,y,b,x,k,w,S=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==l&&(l=!0),null==p&&(p=0),m=!1,null!=u&&null!=c&&(m=!0),null==f){e.next=10;break}if(m=!0,null!=d){e.next=10;break}throw new hy("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(v=this.checkNumSamples(n,a,d,"steps_per_epoch"))&&(g=ab(0,v)),null==o&&(o=1),y=Mx(s,o,i,p,v,d,a,m,h),b=y.callbackList,x=y.history,b.setModel(this),this.history=x,e.next=18,b.onTrainBegin();case 18:this.stopTraining_=!1,k=Gt().mark((function e(){var i,o,s,h,p;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.onEpochBegin(w);case 2:if(i={},null==d){e.next=7;break}throw new py("stepsPerEpoch mode is not implemented yet.");case 7:if("batch"!==l){e.next=11;break}throw new py("batch shuffling is not implemneted yet");case 11:l&&Qt(g);case 12:o=Xd(g),s=Mk(v,a),h=Gt().mark((function e(l){var h;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h={},e.next=3,b.onBatchBegin(l,h);case 3:return Yu((function(){var e=s[l][0],p=s[l][1],d=ub(o,e,p-e);h.batch=l,h.size=p-e;for(var f=Dk(n,d),v=t(f),g=0;g<r.length;++g){var y=r[g],b=v[g];h[y]=b,Ju(b)}if(l===s.length-1&&m)for(var x=S.testLoop(u,c,a),k=0;k<r.length;++k){var w=r[k],I=x[k];Ju(I),i["val_"+w]=I}})),e.next=6,b.onBatchEnd(l,h);case 6:if(Nx(h),!S.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),p=0;case 16:if(!(p<s.length)){e.next=24;break}return e.delegateYield(h(p),"t0",18);case 18:if("break"!==e.t0){e.next=21;break}return e.abrupt("break",24);case 21:++p,e.next=16;break;case 24:o.dispose();case 25:return e.next=27,b.onEpochEnd(w,i);case 27:if(!S.stopTraining_){e.next=29;break}return e.abrupt("return","break");case 29:case"end":return e.stop()}}),e)})),w=p;case 21:if(!(w<i)){e.next=29;break}return e.delegateYield(k(),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++w,e.next=21;break;case 29:return e.next=31,b.onTrainEnd();case 31:return e.next=33,this.history.syncData();case 33:return e.abrupt("return",this.history);case 34:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,c,l,h,p,d,f){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Tk(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),s=o(a.concat(i)),u=[],c=Kt(s),e.prev=9,c.s();case 11:if((l=c.n()).done){e.next=19;break}return h=l.value,e.next=15,h.data();case 15:p=e.sent,u.push(p[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return Qu(s),Lk(r[0],t),Lk(r[1],n),e.abrupt("return",yy(u));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=Px(Po(r.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=Xu().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Xu().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=xy(this.loss);else if(Array.isArray(this.loss)){var t,n=Kt(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch($Q){n.e($Q)}finally{n.f()}e=this.loss.map((function(e){return xy(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=xy(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[xy(ak(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return xy(ak(e))}));var e={};for(var t in this.metrics)e[t]=xy(ak(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Lx(dk(e.optimizer_config));if("string"===typeof e.loss)t=ky(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return ky(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=ky(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return ky(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=ky(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var t=Ht(Gt().mark((function t(n,r){var a,i,o,s,u,c,l,h,p;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof n){t.next=9;break}if(0!==(a=au(n)).length){t.next=6;break}throw new hy("Cannot find any save handlers for URL '".concat(n,"'"));case 6:if(!(a.length>1)){t.next=8;break}throw new hy("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(n,"'"));case 8:n=a[0];case 9:if(null!=n.save){t.next=11;break}throw new hy("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return t.next=13,zs(this.getNamedWeights(r));case 13:if(i=t.sent,!1,null,o=this.toJSON(null,false),s={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(mk),convertedBy:null},!(null!=r&&r.includeOptimizer)||null==this.optimizer){t.next=34;break}return s.trainingConfig=this.getTrainingConfig(),c="optimizer",t.t0=e,t.next=25,this.optimizer.getWeights();case 25:return t.t1=t.sent,t.t2=c,t.next=29,t.t0.encodeWeights.call(t.t0,t.t1,t.t2);case 29:l=t.sent,h=l.data,p=l.specs,(u=i.specs).push.apply(u,(0,Lt.Z)(p)),i.data=Zs([i.data,h]);case 34:return null!=this.userDefinedMetadata&&(!0,ok(this.userDefinedMetadata,this.name,true),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=i.data,s.weightSpecs=i.specs,t.abrupt("return",n.save(s));case 38:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){ok(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),r}(vk);Vk.className="Model",dc(Vk);var Gk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n)}(Vk);Gk.className="Functional",dc(Gk);var jk=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:Ly("sequential_"),null!=e.layers){var a,i=Kt(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch($Q){i.e($Q)}finally{i.f()}}return r}return Re(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new hy("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof Vk;if(r){if(1!==(t=e).outputs.length)throw new hy("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new hy("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new hy("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new hy("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new ox({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new hy("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new hy("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=ix(this.outputs[0])}this.inboundNodes=[],new nx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:my(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Kb(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Vk({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),Px(Po(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),Px(Po(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new ly("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new ly("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new ly("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new ly("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new hy("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new hy("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=Kt(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch($Q){n.e($Q)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new hy("Legacy serialization format not supported yet.");r=t}else nn(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new py("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=Kt(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=Lx(c,undefined,a);a&&l.setFastWeightInitDuringBuild(!0),o.add(l)}}catch($Q){u.e($Q)}finally{u.f()}return o}}]),n}(Vk);jk.className="Sequential",dc(jk);var Hk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"getConfig",value:function(){return{}}}]),n}(hc),Zk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new py("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Mh(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(Hk);Zk.className="elu",dc(Zk);var Kk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return Td(e)}}]),n}(Hk);Kk.className="selu",dc(Kk);var qk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return gd(e)}}]),n}(Hk);qk.className="relu",dc(qk);var Xk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return Yu((function(){return Pp(6,gd(e))}))}}]),n}(Hk);Xk.className="relu6",dc(Xk);var Yk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return e}}]),n}(Hk);Yk.className="linear",dc(Yk);var Qk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return Xl(e)}}]),n}(Hk);Qk.className="sigmoid",dc(Qk);var Jk=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return function(e){return Yu((function(){var t=nc(.5,ic(.2,e));return ch(t,0,1)}))}(e)}}]),n}(Hk);Jk.className="hardSigmoid",dc(Jk);var $k=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return yp(e)}}]),n}(Hk);$k.className="softplus",dc($k);var ew=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return function(e){return Yu((function(){return ac(e,nc(kc(e),1))}))}(e)}}]),n}(Hk);ew.className="softsign",dc(ew);var tw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return Ql(e)}}]),n}(Hk);tw.className="tanh",dc(tw);var nw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return Ld(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(Hk);nw.className="softmax",dc(nw);var rw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return xp(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(Hk);rw.className="logSoftmax",dc(rw);var aw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Yu((function(){return ic(Xl(ic(e,t)),e)}))}}]),n}(Hk);aw.className="swish",dc(aw);var iw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e){return Yu((function(){return ic(e,Ql(yp(e)))}))}}]),n}(Hk);function ow(e){return e.getClassName()}function sw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Cy(e,pc.getMap().classNameMap,t,"activation")}function uw(e){if(null==e){var t={className:"linear",config:{}};return sw(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},sw(n)}return e instanceof Hk?e:sw(e)}function cw(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}iw.className="mish",dc(iw);var lw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n)}(hc),hw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this),cw(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return Re(n,[{key:"apply",value:function(e){var t=this;return Yu((function(){var n=Fp([1]);return t.hasL1&&(n=nc(n,Kh(ic(t.l1,kc(e))))),t.hasL2&&(n=nc(n,Kh(ic(t.l2,gb(e))))),jl(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(lw);hw.className="L1L2",dc(hw);var pw={l1l2:"L1L2"};function dw(e){return Sy(e)}function fw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Cy(e,pc.getMap().classNameMap,t,"regularizer")}function mw(e){return null==e?null:"string"===typeof e?fw({className:e in pw?pw[e]:e,config:{}}):e instanceof lw?e:fw(e)}var vw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return Re(n,[{key:"call",value:function(e,t){e=Zb(e);var n=gd(e);return null!=this.maxValue&&(n=ch(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);vw.className="ReLU",dc(vw);var gw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Re(n,[{key:"call",value:function(e,t){var n=Zb(e);return lp(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);gw.className="LeakyReLU",dc(gw);var yw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Gb(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=mw(e.alphaRegularizer),r.alphaConstraint=Ix(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new hy("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return Re(n,[{key:"build",value:function(e){var t=(e=Kb(e)).slice(1);if(null!=this.sharedAxes){var n,r=Kt(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch($Q){r.e($Q)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new $b({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Zb(e),$p(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Vb(this.alphaInitializer),alphaRegularizer:dw(this.alphaRegularizer),alphaConstraint:wx(this.alphaConstraint),sharedAxes:this.sharedAxes},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);yw.className="PReLU",dc(yw);var bw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new py("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Re(n,[{key:"call",value:function(e,t){var n=Zb(e);return Mh(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);bw.className="ELU",dc(bw);var xw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return Re(n,[{key:"call",value:function(e,t){var n=Zb(e);return ic(n,Hu(ap(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);xw.className="ThresholdedReLU",dc(xw);var kw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new nw).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return Re(n,[{key:"call",value:function(e,t){var n=Zb(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);function ww(e,t,n){if("number"===typeof e)return my(e,t);if(e.length!==t)throw new hy("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new hy("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e;var i}function Sw(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function Iw(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+rb([n-t,0]);else{if("same"!==r)throw new hy("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function Cw(e,t){return Yu((function(){return jy(t),"channelsFirst"===t?vf(e,[0,2,3,1]):e}))}function Tw(e,t){return Yu((function(){return jy(t),"channelsFirst"===t?vf(e,[0,2,3,4,1]):e}))}function Nw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Yu((function(){if(null==i&&(i="channelsLast"),jy(i),3!==e.shape.length)throw new hy("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new hy("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new hy("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=vf(e,[0,2,1])),"causal"===a)throw new py("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=mh(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=bb(s,n)),s}))}function Ew(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Yu((function(){if(null==i&&(i="channelsLast"),jy(i),3!==e.rank&&4!==e.rank)throw new hy("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new hy("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=Cw(e,i);if("causal"===a)throw new py("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=_f({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=vf(u,[0,3,1,2])),u}))}function Rw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return Yu((function(){if(null==i&&(i="channelsLast"),jy(i),4!==e.rank&&5!==e.rank)throw new hy("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new hy("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=Tw(e,i);if("causal"===a)throw new py("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=yh(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=bb(s,n)),"channelsFirst"===i&&(s=vf(s,[0,4,1,2,3])),s}))}kw.className="Softmax",dc(kw);var Aw=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;if(Te(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,_y(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new py("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=ww(r.kernelSize,e,"kernelSize"),a.strides=ww(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Hy(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,jy(a.dataFormat),a.activation=uw(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Gb(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Ix(r.biasConstraint),a.biasRegularizer=mw(r.biasRegularizer),a.activityRegularizer=mw(r.activityRegularizer),a.dilationRate=ww(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new hy("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new hy("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new hy("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return Re(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ow(this.activation),useBias:this.useBias,biasInitializer:Vb(this.biasInitializer),biasRegularizer:dw(this.biasRegularizer),activityRegularizer:dw(this.activityRegularizer),biasConstraint:wx(this.biasConstraint)},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(vy("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Ay(e.kernelSize,"number",1,3))throw new hy("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(ax),_w=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,_y(a.filters,"filters"),a.kernelInitializer=Gb(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Ix(r.kernelConstraint),a.kernelRegularizer=mw(r.kernelRegularizer),a}return Re(n,[{key:"build",value:function(e){e=Kb(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new hy("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(0,C.Z)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t;e=Zb(e);var r=null==n.bias?null:n.bias.read(),a=Fy(n.activation.getClassName());if(null!=a&&2===n.rank)t=Ew(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=Nw(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=Ew(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new py("convolutions greater than 3D are not implemented yet.");t=Rw(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Kb(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=Sw(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Vb(this.kernelInitializer),kernelRegularizer:dw(this.kernelRegularizer),kernelConstraint:wx(this.kernelConstraint)},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new hy("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(Aw),Ow=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return Re(n,[{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Ay(e.kernelSize,"number",1,2))throw new hy("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(_w);Ow.className="Conv2D",dc(Ow);var Fw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return Re(n,[{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new hy("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(_w);Fw.className="Conv3D",dc(Fw);var Dw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,e)).inputSpec=[new $b({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new hy("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return Re(n,[{key:"build",value:function(e){if(4!==(e=Kb(e)).length)throw new hy("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new hy("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new $b({ndim:4,axes:(0,C.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e);if(4!==t.shape.length)throw new hy("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],h=n.strides[0],p=n.strides[1],d=[o,Iw(s,h,c,n.padding),Iw(u,p,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=vf(t,[0,2,3,1]));var f=gh(t,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(f=vf(f,[0,3,1,2])),null!=n.bias&&(f=bb(f,n.bias.read(),n.dataFormat)),null!=n.activation&&(f=n.activation.apply(f)),f}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Kb(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=Iw(a[n],s,i,this.padding),a[r]=Iw(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(Ow);Dw.className="Conv2DTranspose",dc(Dw);var Mw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,e)).inputSpec=[new $b({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new hy("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return Re(n,[{key:"build",value:function(e){if(5!==(e=Kb(e)).length)throw new hy("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new hy("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new $b({ndim:5,axes:(0,C.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e);if(5!==t.shape.length)throw new hy("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],h=n.kernelSize[0],p=n.kernelSize[1],d=n.kernelSize[2],f=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,Iw(u,f,h,n.padding),Iw(c,m,p,n.padding),Iw(l,v,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=vf(t,[0,2,3,4,1]));var y=xh(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=vf(y,[0,4,1,2,3])),null!==n.bias&&(y=bb(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Kb(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],h=this.strides[2];return i[t]=this.filters,i[n]=Iw(i[n],c,o,this.padding),i[r]=Iw(i[r],l,s,this.padding),i[a]=Iw(i[a],h,u,this.padding),i}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(Fw);Mw.className="Conv3DTranspose",dc(Mw);var Pw=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;if(Te(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new hy("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new hy("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new hy("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Gb(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=mw(r.depthwiseRegularizer),a.depthwiseConstraint=Ix(r.depthwiseConstraint),a.pointwiseInitializer=Gb(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=mw(r.pointwiseRegularizer),a.pointwiseConstraint=Ix(r.pointwiseConstraint),a}return Re(n,[{key:"build",value:function(e){if((e=Kb(e)).length<this.rank+2)throw new hy("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new hy("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new $b({ndim:this.rank+2,axes:(0,C.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t;if(e=Zb(e),1===n.rank)throw new py("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=vf(e,[0,2,3,1])),t=Nd(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=bb(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=vf(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Vb(this.depthwiseInitializer),e.pointwiseInitializer=Vb(this.pointwiseInitializer),e.depthwiseRegularizer=dw(this.depthwiseRegularizer),e.pointwiseRegularizer=dw(this.pointwiseRegularizer),e.depthwiseConstraint=wx(this.depthwiseConstraint),e.pointwiseConstraint=wx(this.pointwiseConstraint),e}}]),n}(_w);Pw.className="SeparableConv";var Lw=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,2,e)}return Re(n)}(Pw);Lw.className="SeparableConv2D",dc(Lw);var zw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return Re(n,[{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Ay(e.kernelSize,"number",1,1))throw new hy("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(_w);zw.className="Conv1D",dc(zw);var Bw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return Re(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){if(e=Zb(e),"channelsLast"===n.dataFormat){var t=lb(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return lb(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=lb(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return lb(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);Bw.className="Cropping2D",dc(Bw);var Uw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r,a;return Te(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,jy(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,Ry(By,"InterpolationFormat",a),r}return Re(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=vf(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?zm.resizeNearestNeighbor(t,[a,i]):zm.resizeBilinear(t,[a,i]);return vf(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?zm.resizeNearestNeighbor(t,[s,u]):zm.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);Uw.className="UpSampling2D",dc(Uw);var Ww=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Gb(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Ix(e.depthwiseConstraint),r.depthwiseRegularizer=mw(e.depthwiseRegularizer),r}return Re(n,[{key:"build",value:function(e){if((e=Kb(e)).length<4)throw new hy("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new hy("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return Yu((function(){null==a&&(a="channelsLast"),jy(a);var o=Cw(e,a);if(4!==e.rank)throw new hy("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new hy("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=Nh(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=vf(o,[0,3,1,2])),o}))}(e=Zb(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=bb(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Kb(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=Sw(t,this.kernelSize[0],this.padding,this.strides[0]),i=Sw(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Vb(this.depthwiseInitializer),e.depthwiseRegularizer=dw(this.depthwiseRegularizer),e.depthwiseConstraint=wx(this.depthwiseRegularizer),e}}]),n}(Aw);function Vw(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new hy("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function Gw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Yu((function(){var u=t.shape.length;if(u<3)throw new hy("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(ab(2,u));if(t=vf(t,c),null!=i)throw new py("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=Hu(Hu(a,"bool"),"float32")).rank===u-1&&(a=Jh(a,-1)),a=vf(a,c)),r&&(t=bd(t,0),null!=a&&(a=bd(a,0)));var l,h,p=[],d=n,f=t.shape[0],m=uf(t);null!=a&&(h=uf(a));for(var v,g=function(t){var n=m[t],r=Yu((function(){return e(n,d)}));if(null==a)l=r[0],d=r[1];else{var i=Yu((function(){var e=h[t],n=bc(jp(e),e);return{output:nc(ic(r[0],e),ic(d[0],n)),newStates:d.map((function(t,a){return nc(ic(r[1][a],e),ic(t,n))}))}}));l=i.output,d=i.newStates}s&&p.push(l)},y=0;y<f;++y)g(y);if(s){v=Hd(p,1)}return[l,v,d]}))}Ww.className="DepthwiseConv2D",dc(Ww);var jw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r,a;if(Te(this,n),r=t.call(this,e),null==e.cell)throw new hy("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new Jw({cells:e.cell}):e.cell).stateSize)throw new hy("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new $b({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return Re(n,[{key:"getStates",value:function(){return null==this.states_?ab(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){jb(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=Kt(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch($Q){o.e($Q)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return Yu((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new py("Constants support is not implemented in RNN yet.");jb(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new $b({shape:[t,null].concat((0,Lt.Z)(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!sn(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new hy("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new $b({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Yu((function(){if(!t.stateful)throw new cy("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new hy("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Fp([r,e])})):t.states_=[Fp([r,t.cell.stateSize])];else if(null==e)Qu(t.states_),null!=t.keptStates&&(Qu(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Fp([r,e])})):t.states_[0]=Fp([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new hy("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):Qu(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!sn(i.shape,s))throw new hy("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Ju(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=Vw(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=Kt(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new $b({shape:l.shape}))}}catch($Q){c.e($Q)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof ex){var h=[e].concat(o),p=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=p;var f=Px(Po(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=d,f}return Px(Po(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Zb(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new hy("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=Gw((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var p=n.returnSequences?l:c;return n.returnState?[p].concat(h):p}))}},{key:"getInitialState",value:function(e){var t=this;return Yu((function(){var n=Fp(e.shape);return n=sb(n=Kh(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?db(n,[1,e]):n})):t.cell.stateSize>1?[db(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){Px(Po(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Lx(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(ax);jw.className="RNN",dc(jw);var Hw=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n)}(ax),Zw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,_y(r.units,"units"),r.activation=uw(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Gb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Gb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Gb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=mw(e.kernelRegularizer),r.recurrentRegularizer=mw(e.recurrentRegularizer),r.biasRegularizer=mw(e.biasRegularizer),r.kernelConstraint=Ix(e.kernelConstraint),r.recurrentConstraint=Ix(e.recurrentConstraint),r.biasConstraint=Ix(e.biasConstraint),r.dropout=nb([1,rb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=nb([1,rb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Re(n,[{key:"build",value:function(e){e=Kb(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){if(2!==e.length)throw new hy("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=$w({ones:function(){return jp(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=$w({ones:function(){return jp(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=mb(null!=o?ic(e,o):e,n.kernel.read()),null!=n.bias&&(a=bb(a,n.bias.read())),null!=s&&(r=ic(r,s));var u=nc(a,mb(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:ow(this.activation),useBias:this.useBias,kernelInitializer:Vb(this.kernelInitializer),recurrentInitializer:Vb(this.recurrentInitializer),biasInitializer:Vb(this.biasInitializer),kernelRegularizer:dw(this.kernelRegularizer),recurrentRegularizer:dw(this.recurrentRegularizer),biasRegularizer:dw(this.biasRegularizer),activityRegularizer:dw(this.activityRegularizer),kernelConstraint:wx(this.kernelConstraint),recurrentConstraint:wx(this.recurrentConstraint),biasConstraint:wx(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(Hw);Zw.className="SimpleRNNCell",dc(Zw);var Kw=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),e.cell=new Zw(e),t.call(this,e)}return Re(n,[{key:"call",value:function(e,t){var r=this;return Yu((function(){null!=r.cell.dropoutMask&&(Qu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Qu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Px(Po(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(jw);Kw.className="SimpleRNN",dc(Kw);var qw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new hy("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,_y(r.units,"units"),r.activation=uw(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=uw(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Gb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Gb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Gb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=mw(e.kernelRegularizer),r.recurrentRegularizer=mw(e.recurrentRegularizer),r.biasRegularizer=mw(e.biasRegularizer),r.kernelConstraint=Ix(e.kernelConstraint),r.recurrentConstraint=Ix(e.recurrentConstraint),r.biasConstraint=Ix(e.biasConstraint),r.dropout=nb([1,rb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=nb([1,rb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Re(n,[{key:"build",value:function(e){var t=(e=Kb(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){if(2!==e.length)throw new hy("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=$w({ones:function(){return jp(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=$w({ones:function(){return jp(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=ic(e,u[0]));var l=mb(e,n.kernel.read());n.useBias&&(l=bb(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=ic(a,c[0]));var h=n.recurrentKernel.read(),p=Wd(h,[2*n.units,n.units],h.rank-1),d=(0,E.Z)(p,2),f=d[0],m=d[1],v=mb(a,f),g=Wd(l,3,l.rank-1),y=(0,E.Z)(g,3),b=y[0],x=y[1],k=y[2],w=Wd(v,2,v.rank-1),S=(0,E.Z)(w,2),I=S[0],C=S[1];i=n.recurrentActivation.apply(nc(b,I)),o=n.recurrentActivation.apply(nc(x,C));var T=mb(ic(o,a),m);s=n.activation.apply(nc(k,T));var N=nc(ic(i,a),ic(nc(1,gp(i)),s));return[N,N]}))}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:ow(this.activation),recurrentActivation:ow(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Vb(this.kernelInitializer),recurrentInitializer:Vb(this.recurrentInitializer),biasInitializer:Vb(this.biasInitializer),kernelRegularizer:dw(this.kernelRegularizer),recurrentRegularizer:dw(this.recurrentRegularizer),biasRegularizer:dw(this.biasRegularizer),activityRegularizer:dw(this.activityRegularizer),kernelConstraint:wx(this.kernelConstraint),recurrentConstraint:wx(this.recurrentConstraint),biasConstraint:wx(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(Hw);qw.className="GRUCell",dc(qw);var Xw=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qw(e),t.call(this,e)}return Re(n,[{key:"call",value:function(e,t){var r=this;return Yu((function(){null!=r.cell.dropoutMask&&(Qu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Qu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Px(Po(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(jw);Xw.className="GRU",dc(Xw);var Yw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,_y(r.units,"units"),r.activation=uw(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=uw(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Gb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Gb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Gb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=mw(e.kernelRegularizer),r.recurrentRegularizer=mw(e.recurrentRegularizer),r.biasRegularizer=mw(e.biasRegularizer),r.kernelConstraint=Ix(e.kernelConstraint),r.recurrentConstraint=Ix(e.recurrentConstraint),r.biasConstraint=Ix(e.biasConstraint),r.dropout=nb([1,rb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=nb([1,rb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Re(n,[{key:"build",value:function(e){var t,n,r=(e=Kb(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new Tb).apply([i]),o=a.apply([2*i]);return pb(pb(n,r),o)}}]),n}(Ib),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new hy("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=$w({ones:function(){return jp(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=$w({ones:function(){return jp(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,h=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=ic(e,l[0]));var p=mb(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=ic(a,h[0])),p=nc(p,mb(a,n.recurrentKernel.read())),n.useBias&&(p=bb(p,n.bias.read()));var d=Wd(p,4,p.rank-1),f=(0,E.Z)(d,4),m=f[0],v=f[1],g=f[2],y=f[3];o=n.recurrentActivation.apply(m),s=n.recurrentActivation.apply(v),u=nc(ic(s,i),ic(o,n.activation.apply(g))),c=n.recurrentActivation.apply(y);var b=ic(c,n.activation.apply(u));return[b,b,u]}))}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:ow(this.activation),recurrentActivation:ow(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Vb(this.kernelInitializer),recurrentInitializer:Vb(this.recurrentInitializer),biasInitializer:Vb(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:dw(this.kernelRegularizer),recurrentRegularizer:dw(this.recurrentRegularizer),biasRegularizer:dw(this.biasRegularizer),activityRegularizer:dw(this.activityRegularizer),kernelConstraint:wx(this.kernelConstraint),recurrentConstraint:wx(this.recurrentConstraint),biasConstraint:wx(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(Hw);Yw.className="LSTMCell",dc(Yw);var Qw=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Yw(e),t.call(this,e)}return Re(n,[{key:"call",value:function(e,t){var r=this;return Yu((function(){null!=r.cell.dropoutMask&&(Qu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Qu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Px(Po(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(jw);Qw.className="LSTM",dc(Qw);var Jw=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).cells=e.cells,r}return Re(n,[{key:"stateSize",get:function(){var e,t=[],n=Kt(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,(0,Lt.Z)(r.stateSize)):t.push(r.stateSize)}}catch($Q){n.e($Q)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var r,a=e.slice(1),i=[],o=Kt(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch($Q){o.e($Q)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var h=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),c.push(u.slice(1))}a=[];var p,d=Kt(c.slice().reverse());try{for(d.s();!(p=d.n()).done;){var f,m=p.value;(f=a).push.apply(f,(0,Lt.Z)(m))}}catch($Q){d.e($Q)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;jb(e)&&(e=e[0]),this.cells.forEach((function(n,r){Xy("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=Kt(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Lt.Z)(r.trainableWeights))}}catch($Q){n.e($Q)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Kt(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Lt.Z)(r.nonTrainableWeights))}}catch($Q){n.e($Q)}finally{n.f()}if(!this.trainable){var a,i=[],o=Kt(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,Lt.Z)(s.trainableWeights))}}catch($Q){o.e($Q)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=Kt(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Lt.Z)(r.weights))}}catch($Q){n.e($Q)}finally{n.f()}return Qb(t)}},{key:"setWeights",value:function(e){var t,n=[],r=Kt(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch($Q){r.e($Q)}finally{r.f()}Jb(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=Kt(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(Lx(o,r))}}catch($Q){i.e($Q)}finally{i.f()}return new e({cells:a})}}]),n}(Hw);function $w(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):xb(t(),n)},c=function(){return kb(u,t,a)};return!o||o<=1?Ju(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Ju(e.clone())}))}Jw.className="StackedRNNCells",dc(Jw);var eS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},tS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),e.unroll)throw new py("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new py("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new $b({ndim:5})],r}return Re(n,[{key:"call",value:function(e,t){var r=this;return Yu((function(){if(null!=r.cell.dropoutMask&&(Qu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Qu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new hy("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Px(Po(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat((0,Lt.Z)(t.slice(2)))),this.returnState&&(t=[t].concat((0,Lt.Z)(Array(2).fill([e[0]].concat((0,Lt.Z)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return Yu((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Fp([a[0]].concat((0,Lt.Z)(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Yu((function(){if(!t.stateful)throw new cy("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat((0,Lt.Z)(a.slice(2)));if(null==r[0])throw new hy("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Fp(i)})):t.states_=[Fp(i)];else if(null==e)Qu(t.states_),null!=t.keptStates&&(Qu(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Fp(i)})):t.states_[0]=Fp(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new hy("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):Qu(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!sn(s.shape,u))throw new hy("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Ju(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],h=Sw(c,a[0],i,o[0],s[0]),p=Sw(l,a[1],i,o[1],s[1]);return[].concat((0,Lt.Z)(e.slice(0,2)),(0,Lt.Z)(u?[r,h,p]:[h,p,r]))}}]),n}(jw);tS.className="ConvRNN2D";var nS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;Te(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,_y(r.filters,"filters"),r.kernelSize=ww(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return _y(e,"kernelSize")})),r.strides=ww(o||1,2,"strides"),r.strides.forEach((function(e){return _y(e,"strides")})),r.padding=s||"valid",Hy(r.padding),r.dataFormat=u||"channelsLast",jy(r.dataFormat),r.dilationRate=ww(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return _y(e,"dilationRate")})),r}return Re(n,[{key:"build",value:function(e){var t;e=Kb(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new hy("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"apply",value:function(e,t){return hb([s.apply([u]),Dp([u]),s.apply([2*u])])}}]),n}(Ib),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){if(3!==e.length)throw new hy("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=$w({ones:function(){return jp(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?ic(t[n],e):e},c=u(a,s,0),l=u(a,s,1),h=u(a,s,2),p=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=$w({ones:function(){return jp(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var d=n.recurrentDropoutMask,f=u(i,d,0),m=u(i,d,1),v=u(i,d,2),g=u(i,d,3),y=Wd(n.kernel.read(),4,3),b=(0,E.Z)(y,4),x=b[0],k=b[1],w=b[2],S=b[3],I=n.useBias?Wd(n.bias.read(),4):[null,null,null,null],C=(0,E.Z)(I,4),T=C[0],N=C[1],R=C[2],A=C[3];c=n.inputConv(c,x,T,n.padding),l=n.inputConv(l,k,N,n.padding),h=n.inputConv(h,w,R,n.padding),p=n.inputConv(p,S,A,n.padding);var _=Wd(n.recurrentKernel.read(),4,3),O=(0,E.Z)(_,4),F=O[0],D=O[1],M=O[2],P=O[3];f=n.recurrentConv(f,F),m=n.recurrentConv(m,D),v=n.recurrentConv(v,M),g=n.recurrentConv(g,P);var L=n.recurrentActivation.apply(nc(c,f)),z=n.recurrentActivation.apply(nc(l,m)),B=nc(ic(z,o),ic(L,n.activation.apply(nc(h,v)))),U=ic(n.recurrentActivation.apply(nc(p,g)),n.activation.apply(B));return[U,U,B]}))}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t=(e.units,eS(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=fh(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?bb(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return fh(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(Yw);nS.className="ConvLSTM2DCell",dc(nS);var rS=function(e){Mo(n,e);var t=Uo(n);function n(e){Te(this,n);var r=new nS(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return Re(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(tS);rS.className="ConvLSTM2D",dc(rS);var aS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return Re(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return kb((function(){return xb(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return Px(Po(n.prototype),"dispose",this).call(this)}}]),n}(ax);aS.className="Dropout",dc(aS);var iS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return Re(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(aS);iS.className="SpatialDropout1D",dc(iS);var oS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,_y(r.units,"units"),r.activation=uw(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Gb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Gb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Ix(e.kernelConstraint),r.biasConstraint=Ix(e.biasConstraint),r.kernelRegularizer=mw(e.kernelRegularizer),r.biasRegularizer=mw(e.biasRegularizer),r.activityRegularizer=mw(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return Re(n,[{key:"build",value:function(e){var t=(e=Kb(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(0,C.Z)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Kb(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r,a=Zb(e),i=Fy(n.activation.getClassName());return null!=i?r=mb(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=mb(a,n.kernel.read()),null!=n.bias&&(r=bb(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:ow(this.activation),useBias:this.useBias,kernelInitializer:Vb(this.kernelInitializer),biasInitializer:Vb(this.biasInitializer),kernelRegularizer:dw(this.kernelRegularizer),biasRegularizer:dw(this.biasRegularizer),activityRegularizer:dw(this.activityRegularizer),kernelConstraint:wx(this.kernelConstraint),biasConstraint:wx(this.biasConstraint)},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);oS.className="Dense",dc(oS);var sS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return Re(n,[{key:"computeOutputShape",value:function(e){var t,n=Kt((e=Kb(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new hy('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch($Q){n.e($Q)}finally{n.f()}return[e[0],tb(e,1)]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=vf(r,a)}return function(e){if(e.rank<=1)throw new hy("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],tb(e.shape,1)];return jl(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);sS.className="Flatten",dc(sS);var uS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=uw(e.activation),r}return Re(n,[{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:ow(this.activation)},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);uS.className="Activation",dc(uS);var cS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return Re(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){return e=Zb(e),t=e,r=n.n,Yu((function(){if(2!==t.shape.length)throw new hy("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(t.shape.length," tensor."));return db(sb(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);cS.className="RepeatVector",dc(cS);var lS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;Te(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return Re(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new hy("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=tb(e);if(null!==i){if(0===a||u%a!==0)throw new hy(n);r[i]=u/a}else if(u!==a)throw new hy(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return jl(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);lS.className="Reshape",dc(lS);var hS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=ab(1,e.dims.length+1);if(!sn(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new $b({ndim:r.dims.length+1})],r}return Re(n,[{key:"computeOutputShape",value:function(e){var t=(e=Kb(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return vf(Zb(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);hS.className="Permute",dc(hS);var pS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return Re(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Zb(e);return kl(Vp(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e),a=kl(Vp(r,n.maskValue),-1,!0);return ic(r,Hu(a,r.dtype))}))}}]),n}(ax);pS.className="Masking",dc(pS);var dS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(by(e.inputLength))}return r.inputDim=e.inputDim,_y(r.inputDim,"inputDim"),r.outputDim=e.outputDim,_y(r.outputDim,"outputDim"),r.embeddingsInitializer=Gb(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=mw(e.embeddingsRegularizer),r.activityRegularizer=mw(e.activityRegularizer),r.embeddingsConstraint=Ix(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return Re(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Yu((function(){return n.maskZero?(e=Zb(e),Vp(e,uc(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Kb(e),null==this.inputLength)return[].concat((0,Lt.Z)(e),[this.outputDim]);var t=by(this.inputLength);if(t.length!==e.length-1)throw new hy('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new hy('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat((0,Lt.Z)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e);"int32"!==r.dtype&&(r=ob(r,"int32"));var a=vb(n.embeddings.read(),jl(r,[r.size]));return jl(a,Kb(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Vb(this.embeddingsInitializer),embeddingsRegularizer:dw(this.embeddingsRegularizer),activityRegularizer:dw(this.activityRegularizer),embeddingsConstraint:wx(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);dS.className="Embedding",dc(dS);var fS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return Re(n,[{key:"mergeFunction",value:function(e){throw new py}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new hy("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Kb(e)]),e.length<2)throw new hy("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=Kt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch($Q){r.e($Q)}finally{r.f()}if((n=Ny(n)).length>1)throw new hy("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===Ny(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=rb(r),o=Kt(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=sb(s,1);t.push(s)}}catch($Q){o.e($Q)}finally{o.f()}return n.mergeFunction(t)}var l,h=!1,p=Kt(e);try{for(p.s();!(l=p.n()).done;){var d=l.value,f=d.rank;if(null==f){var m=d.shape,v=m[0],g=m.slice(1).concat([v]),y=jl(d,[v].concat(tb(m.slice(1))));y=vf(y,[1,0]),y=jl(y,g),t.push(y),h=!0}else if(f>1){var b=ab(1,f).concat([0]);t.push(vf(d,b)),h=!0}else t.push(d)}}catch($Q){p.e($Q)}finally{p.f()}var x=n.mergeFunction(t),k=x.rank;if(h)if(null==k){var w=x.shape,S=w[w.length-1],I=[S].concat(w.slice(0,w.length-1));x=jl(vf(jl(x,[-1,S]),[1,0]),I)}else if(k>1){var C=[k-1].concat(ab(0,k-1));x=vf(x,C)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=Kt(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch($Q){o.e($Q)}finally{o.f()}return t=1===(i=Ny(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return Yu((function(){if(null==t)return null;if(!Array.isArray(t))throw new hy("`mask` should be an Array");if(!Array.isArray(e))throw new hy("`inputs` should be an Array");if(t.length!==e.length)throw new hy("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:Jh(e,0)})))[0],r=1;r<t.length-1;++r)n=wp(n,t[r]);return n}))}}]),n}(ax),mS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"mergeFunction",value:function(e){return Yu((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=nc(t,e[n]);return t}))}}]),n}(fS);mS.className="Add",dc(mS);var vS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"mergeFunction",value:function(e){return Yu((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ic(t,e[n]);return t}))}}]),n}(fS);vS.className="Multiply",dc(vS);var gS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"mergeFunction",value:function(e){return Yu((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=nc(t,e[n]);return ic(1/e.length,t)}))}}]),n}(fS);gS.className="Average",dc(gS);var yS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"mergeFunction",value:function(e){return Yu((function(){for(var t=e[0],n=1;n<e.length;++n)t=Cc(t,e[n]);return t}))}}]),n}(fS);yS.className="Maximum",dc(yS);var bS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"mergeFunction",value:function(e){return Yu((function(){for(var t=e[0],n=1;n<e.length;++n)t=Pp(t,e[n]);return t}))}}]),n}(fS);bS.className="Minimum",dc(bS);var xS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Re(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new hy("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=Kt(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch($Q){r.e($Q)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=Kt(a);try{for(c.s();!(s=c.n()).done;){if(sn(s.value,o)){u=!0;break}}}catch($Q){c.e($Q)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new hy("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Yu((function(){return hb(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new hy("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=Kt(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch($Q){i.e($Q)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new hy("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new hy("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new hy("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return Yu((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(Hu(jp(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Jh(t[i],-1)):a.push(t[i]);var o=Kl(a,n.axis);return xl(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(fS);function kS(e,t){for(;e<0;)e+=t;return e}xS.className="Concatenate",dc(xS);var wS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Re(n,[{key:"build",value:function(e){nn(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new py("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new hy("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new hy("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return kS(t,e[n].shape.length)})):[kS(this.axes,n.shape.length),kS(this.axes,r.shape.length)],this.normalize&&(n=zx(n,t[0]),r=zx(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new py("batchDot is not implemented for tensors of 4D or higher rank yet");if(nn(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),nn(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new py("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return Yu((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=jl(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=jl(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Kh(ic(e,t),i[0]):Kh(ic(vf(e,[1,0]),t),i[1]);else{var h=i[0]!==e.shape.length-1,p=i[1]===t.shape.length-1;o=ql(e,t,h,p)}if(n>0){for(var d,f=[],m=d=r>a?r+a-3:r-1;m<d+n;++m)f.push(m);o=jd(o,f)}return 1===o.shape.length&&(o=Jh(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[kS(this.axes,e.length),kS(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){nn(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new py("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(fS);wS.className="Dot",dc(wS);var SS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return Re(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e);return kb((function(){return nc(fb(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(ax);SS.className="GaussianNoise",dc(SS);var IS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return Re(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t);var r=Zb(e);if(n.rate>0&&n.rate<1){return kb((function(){var e=Math.sqrt(n.rate/(1-n.rate));return ic(r,fb(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(ax);IS.className="GaussianDropout",dc(IS);var CS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return Re(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Zb(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Px(Po(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Yu((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return kb((function(){var t=Zb(e),a=-1.7580993408473766,i=ip(pd(r),n.rate);i=ob(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=nc(ic(t,i),ic(nc(i,-1),a));return nc(ic(u,o),s)}),(function(){return Zb(e)}),t.training||!1)}return e}))}}]),n}(ax);function TS(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=th(e,t,n,r,a,o);else if(3===e.rank)i=nh(e,t,n,r,a,o);else{if(4!==e.rank)throw new py("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=rh(e,t,n,r,a,o)}return i}function NS(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return sn(r.slice().sort(),ab(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Yu((function(){var i=Bp(e,r),o=i.mean,s=i.variance;return[TS(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Yu((function(){var i,o=Bp(e,r),s=o.mean,u=o.variance,c=[],l=Kt(ab(0,e.rank));try{for(l.s();!(i=l.n()).done;){var h=i.value;-1!==r.indexOf(h)?c.push(1):c.push(e.shape[h])}}catch($Q){l.e($Q)}finally{l.f()}var p=jl(s,c),d=jl(u,c),f=null==t?null:jl(t,c),m=null==n?null:jl(n,c);return[TS(e,p,d,m,f,a),s,u]}))}(e,t,n,r,a)}CS.className="AlphaDropout",dc(CS);var ES=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Gb(e.betaInitializer||"zeros"),r.gammaInitializer=Gb(e.gammaInitializer||"ones"),r.movingMeanInitializer=Gb(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Gb(e.movingVarianceInitializer||"ones"),r.betaConstraint=Ix(e.betaConstraint),r.gammaConstraint=Ix(e.gammaConstraint),r.betaRegularizer=mw(e.betaRegularizer),r.gammaRegularizer=mw(e.gammaRegularizer),r}return Re(n,[{key:"build",value:function(e){e=Kb(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new hy("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new $b({ndim:e.length,axes:(0,C.Z)({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var r=null!=t.training&&t.training,a=Zb(e),i=a.shape,o=i.length,s=ab(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=my(1,o);c[u]=i[u];var l=s.slice();l.sort();var h=!sn(l,ab(0,o).slice(0,o-1));if(!r)return function(){if(h){var e=jl(n.movingMean.read(),c),t=jl(n.movingVariance.read(),c),r=n.center?jl(n.beta.read(),c):null,i=n.scale?jl(n.gamma.read(),c):null;return TS(a,e,t,r,i,n.epsilon)}return TS(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var p=NS(a,n.gamma.read(),n.beta.read(),s,n.epsilon),d=(0,E.Z)(p,3),f=d[0],m=d[1],v=d[2],g=function(e,t,n){Yu((function(){var r=1-n,a=e.read(),i=ic(bc(a,t),r);e.write(bc(a,i))}))};return g(n.movingMean,m,n.momentum),g(n.movingVariance,v,n.momentum),f}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Vb(this.betaInitializer),gammaInitializer:Vb(this.gammaInitializer),movingMeanInitializer:Vb(this.movingMeanInitializer),movingVarianceInitializer:Vb(this.movingVarianceInitializer),betaRegularizer:dw(this.betaRegularizer),gammaRegularizer:dw(this.gammaRegularizer),betaConstraint:wx(this.betaConstraint),gammaConstraint:wx(this.gammaConstraint)},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);ES.className="BatchNormalization",dc(ES);var RS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=Kt(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch($Q){i.e($Q)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Gb(e.betaInitializer||"zeros"),r.gammaInitializer=Gb(e.gammaInitializer||"ones"),r.betaRegularizer=mw(e.betaRegularizer),r.gammaRegularizer=mw(e.gammaRegularizer),r.supportsMasking=!0,r}return Re(n,[{key:"build",value:function(e){var t=(e=Kb(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=Kt(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch($Q){a.e($Q)}finally{a.f()}if(this.axis.length!==Ny(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Zb(e),a=r.shape,i=a.length;return Yu((function(){var e,t=Bp(r,n.axis,!0),o=t.mean,s=t.variance,u=my(1,i),c=Kt(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch($Q){c.e($Q)}finally{c.f()}for(var h=function(e){return null!=e&&e.shape.length!==i?jl(e,u):e},p=n.scale?h(n.gamma.read()):null,d=n.center?h(n.beta.read()):null,f=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(f.push(a[v]),m.push(1)):(f.push(1),m.push(a[v]));return o=ep(o,f),s=ep(s,f),null!=p&&(p=ep(p,m)),null!=d&&(d=ep(d,m)),TS(r,o,s,d,p,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Vb(this.betaInitializer),gammaInitializer:Vb(this.gammaInitializer),betaRegularizer:dw(this.betaRegularizer),gammaRegularizer:dw(this.gammaRegularizer)},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);RS.className="LayerNormalization",dc(RS);var AS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new hy("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new hy("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new hy("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new $b({ndim:4})],r}return Re(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Kb(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Yu((function(){return t=Zb(e),r=n.padding,a=n.dataFormat,Yu((function(){if(4!==t.rank)throw new hy("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(t.rank,"-D tensor."));if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new hy("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new hy("Unknown data format: ".concat(a,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],Zp(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);function _S(e,t,n,r,a,i){return Yu((function(){var o;jy(a),Zy(i),Hy(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=Cw(e,a);var s="same"===r?"same":"valid";return o="max"===i?Rp(e,t,n,s):Hl(e,t,n,s),"channelsFirst"===a&&(o=vf(o,[0,3,1,2])),o}))}function OS(e,t,n,r,a,i){return Yu((function(){var o;jy(a),Zy(i),Hy(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=Tw(e,a);var s="same"===r?"same":"valid";return o="max"===i?Ap(e,t,n,s):Zl(e,t,n,s),"channelsFirst"===a&&(o=vf(o,[0,4,1,2,3])),o}))}AS.className="ZeroPadding2D",dc(AS);var FS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new hy("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(_y(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new hy("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return _y(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Hy(r.padding),r.inputSpec=[new $b({ndim:3})],r}return Re(n,[{key:"computeOutputShape",value:function(e){var t=Sw((e=Kb(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){n.invokeCallHook(e,t),e=sb(Zb(e),2);var r=n.poolingFunction(Zb(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return jd(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax),DS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return jy(a),Hy(r),_S(e,t,n,r,a,"max")}}]),n}(FS);DS.className="MaxPooling1D",dc(DS);var MS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return jy(a),Hy(r),_S(e,t,n,r,a,"avg")}}]),n}(FS);MS.className="AveragePooling1D",dc(MS);var PS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new hy("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return _y(r.poolSize,"poolSize"),_y(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,jy(r.dataFormat),Hy(r.padding),r.inputSpec=[new $b({ndim:4})],r}return Re(n,[{key:"computeOutputShape",value:function(e){e=Kb(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=Sw(t,this.poolSize[0],this.padding,this.strides[0]),n=Sw(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){return n.invokeCallHook(e,t),n.poolingFunction(Zb(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax),LS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return jy(a),Hy(r),_S(e,t,n,r,a,"max")}}]),n}(PS);LS.className="MaxPooling2D",dc(LS);var zS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return jy(a),Hy(r),_S(e,t,n,r,a,"avg")}}]),n}(PS);zS.className="AveragePooling2D",dc(zS);var BS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new hy("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return _y(r.poolSize,"poolSize"),_y(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,jy(r.dataFormat),Hy(r.padding),r.inputSpec=[new $b({ndim:5})],r}return Re(n,[{key:"computeOutputShape",value:function(e){e=Kb(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=Sw(t,this.poolSize[0],this.padding,this.strides[0]),n=Sw(n,this.poolSize[1],this.padding,this.strides[1]),r=Sw(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){return n.invokeCallHook(e,t),n.poolingFunction(Zb(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax),US=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return jy(a),Hy(r),OS(e,t,n,r,a,"max")}}]),n}(BS);US.className="MaxPooling3D",dc(US);var WS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e)}return Re(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return jy(a),Hy(r),OS(e,t,n,r,a,"avg")}}]),n}(BS);WS.className="AveragePooling3D",dc(WS);var VS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).inputSpec=[new $b({ndim:3})],r}return Re(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new py}}]),n}(ax),GS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e||{})}return Re(n,[{key:"call",value:function(e,t){return Yu((function(){var t=Zb(e);return Op(t,1)}))}}]),n}(VS);GS.className="GlobalAveragePooling1D",dc(GS);var jS=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,e||{})}return Re(n,[{key:"call",value:function(e,t){return Yu((function(){var t=Zb(e);return Hh(t,1)}))}}]),n}(VS);jS.className="GlobalMaxPooling1D",dc(jS);var HS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,jy(r.dataFormat),r.inputSpec=[new $b({ndim:4})],r}return Re(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new py}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax),ZS=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e);return"channelsLast"===n.dataFormat?Op(t,[1,2]):Op(t,[2,3])}))}}]),n}(HS);ZS.className="GlobalAveragePooling2D",dc(ZS);var KS=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.apply(this,arguments)}return Re(n,[{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e);return"channelsLast"===n.dataFormat?Hh(t,[1,2]):Hh(t,[2,3])}))}}]),n}(HS);KS.className="GlobalMaxPooling2D",dc(KS);var qS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).layer=e.layer,r}return Re(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){Px(Po(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Lx(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(ax),XS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return Re(n,[{key:"build",value:function(e){if((e=Kb(e)).length<3)throw new hy("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),Px(Po(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Kb(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Yu((function(){return Gw((function(e,r){return[Zb(n.layer.call(e,t)),[]]}),e=Zb(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(qS);XS.className="TimeDistributed",dc(XS);var YS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;Te(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=Lx(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=Lx(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,Ry(Vy,"BidirectionalMergeMode",o),e.weights)throw new py("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return Re(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):yy(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=Vw(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return Px(Po(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new hy("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,(0,Lt.Z)(r));var c=r.map((function(e){return new $b({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,(0,Lt.Z)(c))}if(null!=a)throw new py("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof ex,h=0,p=o;h<p.length;h++){if(p[h]instanceof ex!==l)throw new hy("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),f=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=f;var v=Px(Po(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=m,v}return Px(Po(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=bd(a,1)),"concat"===n.mergeMode?o=hb([r,a]):"sum"===n.mergeMode?o=nc(r,a):"ave"===n.mergeMode?o=ic(.5,nc(r,a)):"mul"===n.mergeMode?o=ic(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Xy(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Xy(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){Px(Po(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=Lx(t.layer);if(delete t.layer,null!=t.numConstants)throw new py("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(qS);YS.className="Bidirectional",dc(YS);var QS=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return Re(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Yu((function(){return"float32"!==(e=Zb(e)).dtype&&(e=ob(e,"float32")),nc(ic(e,n.scale),n.offset)}))}}]),n}(ax);QS.className="Rescaling",dc(QS);var JS=zm.resizeBilinear,$S=zm.cropAndResize,eI=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return Re(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return Yu((function(){var u,c=!1,l=[t/i,n/o,(r+t)/i,(a+n)/o],h=[];3===e.rank?(c=!0,u=Hd([e])):u=e;for(var p=0;p<u.shape[0];p++)h.push(l);var d=Ds(h,[h.length,4]),f=fd(0,h.length,1,"int32"),m=$S(u,d,f,[r,a],"nearest");return ob(c?Zb(uf(m)):m,s)}))}},{key:"upsize",value:function(e,t,n,r){return Yu((function(){return ob(JS(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&0===(u=Math.floor((o-n.width)/2))&&(u=1),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Kb(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(ax);eI.className="CenterCrop",dc(eI);var tI=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return Re(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=Kb(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var r;if("int32"!==(e=Zb(e)).dtype&&(e=ob(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==n.outputMode)throw new hy("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=Zb(t.countWeights)}var a=Hh(e),i=Zh(e),o=ap(n.numTokens,a).bufferSync().get(0),s=ip(i,0).bufferSync().get(0);if(!o||!s)throw new hy("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=Zb(e);if("int32"!==a.dtype&&(a=ob(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=Jh(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=Jh(a,-1)),a.rank>2)throw new hy("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=Ch(u,"undefined"!==typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return ic(o,r);throw new hy("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(ax);tI.className="CategoryEncoding",dc(tI);var nI=new Set(["bilinear","nearest"]),rI=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;if(Te(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!nI.has(e.interpolation))throw new hy("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(e.cropToAspectRatio),r}return Re(n,[{key:"computeOutputShape",value:function(e){var t=(e=Kb(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return zm.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return zm.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat((0,Lt.Z)(nI)," are supported"))}))}}]),n}(ax);rI.className="Resizing",dc(rI);var aI=function(){function e(t){Te(this,e),this.seed=t}return Re(e,[{key:"next",value:function(){if(void 0!==this.seed)return this.seed++}}]),e}();aI.className="RandomSeed";var iI=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this,e)).randomGenerator=new aI(e.seed),r}return Re(n,[{key:"getConfig",value:function(){var e={seed:this.randomGenerator.seed},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ax);iI.className="BaseRandomLayer";var oI=new Set(["bilinear","nearest"]),sI=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;Te(this,n),r=t.call(this,e);var a=e.factor,i=e.interpolation,o=void 0===i?"bilinear":i;if(r.factor=a,Array.isArray(r.factor)&&2===r.factor.length)r.widthLower=r.factor[0],r.widthUpper=r.factor[1];else{if(Array.isArray(r.factor)||!(r.factor>0))throw new hy("Invalid factor: ".concat(r.factor,". Must be positive number or tuple of 2 numbers"));r.widthLower=-r.factor,r.widthUpper=r.factor}if(r.widthLower<-1||r.widthUpper<-1)throw new hy("factor must have values larger than -1. Got: ".concat(r.factor));if(r.widthUpper<r.widthLower)throw new hy("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(r.widthUpper,".\n        Got lower bound: ").concat(r.widthLower,"\n      "));if(o){if(!oI.has(o))throw new hy("Invalid interpolation parameter: ".concat(o," is not implemented"));r.interpolation=o}return r}return Re(n,[{key:"getConfig",value:function(){var e={factor:this.factor,interpolation:this.interpolation},t=Px(Po(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Kb(e))[2];return[this.imgHeight,-1,t]}},{key:"call",value:function(e,t){var n=this;return Yu((function(){var t=Zb(e);n.imgHeight=t.shape[t.shape.length-3];var r=t.shape[t.shape.length-2];n.widthFactor=pd([1],1+n.widthLower,1+n.widthUpper,"float32",n.randomGenerator.next());var a=n.widthFactor.dataSync()[0]*r;a=Math.round(a);var i=[n.imgHeight,a];switch(n.interpolation){case"bilinear":return zm.resizeBilinear(e,i);case"nearest":return zm.resizeNearestNeighbor(e,i);default:throw new Error("Interpolation is ".concat(n.interpolation,"\n          but only ").concat((0,Lt.Z)(oI)," are supported"))}}))}}]),n}(iI);sI.className="RandomWidth",dc(sI);var uI,cI;zn().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(uI||(uI={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(cI||(cI={}));var lI={};function hI(e){return lI[e]}function pI(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd,u=o<0?t.inputNames.length+o:o;if("tensor"===i.type)return dI(t.inputNames[u],n,r,a);if("tensors"===i.type){var c=t.inputs.slice(o,s),l=t.inputNames.slice(o,s).filter((function(e,t){var n;return"NoOp"!==(null===(n=c[t])||void 0===n?void 0:n.op)}));return l.map((function(e){return dI(e,n,r,a)}))}var h=dI(t.inputNames[u],n,r,a),p=h.dataSync();return"number"===i.type?p[0]:Tn(h.shape,p)}var d=t.attrParams[e];return d&&d.value}function dI(e,t,n,r){var a=gI(e,n),i=(0,E.Z)(a,2),o=i[0],s=i[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[vI(o,e)]}));return void 0!==c?t[vI(o,c)][s]:void 0}function fI(e,t,n){return t[vI(e,n.currentContextId)]}function mI(e,t){var n=gI(e,t),r=(0,E.Z)(n,3),a=r[0],i=r[1],o=r[2];return[vI(a,t&&t.currentContextId),i,o]}function vI(e,t){return t?"".concat(e,"-").concat(t):e}function gI(e,t){if(""===e)return["",0,void 0];var n=null!=t&&null!=t.parseNodeNameCache;if(n){var r=t.parseNodeNameCache.get(e);if(null!=r)return r}var a,i=e.split(":");if(1===i.length)a=[e,0,void 0];else{var o=i[0],s=3===i.length?i[1]:void 0;a=[o,Number(i[i.length-1]),s]}return n&&t.parseNodeNameCache.set(e,a),a}function yI(e,t,n){var r=pI("pad",e,t,n);if("explicit"===r){r=pI("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function bI(e){return e.kept?e:Zu(e)}var xI=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],kI=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],wI=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],SI=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],II=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],CI=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],TI=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],NI=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],EI=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],RI=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],AI=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],_I=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],OI=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],FI=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],DI=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],MI=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],PI=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],LI=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],zI=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],BI=function(){function e(){var t;Te(this,e);var n=[r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k],w=(t=[]).concat.apply(t,(0,Lt.Z)(n.map((function(e){return e.json}))));this.opMappers=w.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Re(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):null!=n.input&&0!==n.input.length||o.push(e[n.name]),e}),{}),u=[],c=[],l={},h={};null!=n&&(l=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));var p=Object.keys(s);p.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=mI(e),a=(0,E.Z)(r,3),i=a[0],o=a[2],u=s[i];if(null!=u.outputs){var c=u.outputs.indexOf(o);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))})),0===Object.keys(h).length?p.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(h).forEach((function(e){var t=mI(e),n=(0,E.Z)(t,1)[0],r=s[n];null!=r&&(r.signatureKey=h[e],c.push(r))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=mI(e),n=(0,E.Z)(t,1)[0],r=s[n];r&&(r.signatureKey=l[e],u.push(r))})):u=a;var d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var f={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:d};return o.length>0&&(f.initNodes=o),f}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=hI(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=WI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=WI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=QI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=QI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=GI(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=GI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=YI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=YI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=VI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=VI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=$I(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=$I(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=XI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=XI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=JI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=JI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=ZI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ZI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=KI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=KI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=HI(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=HI(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=mI(e.name),n=(0,E.Z)(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:jI(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,i.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=mI(e),i=(0,E.Z)(r,3),o=i[0],s=i[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=mI(s[e.name]),n=(0,E.Z)(t,2),r=n[0],i=n[1],u=a[r];null!=u&&(u.defaultOutput=i,o.push(u))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function UI(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=zn().global;if("undefined"!==typeof t.atob)return t.atob(e);if("undefined"!==typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function WI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?UI(a.s,r):n}function VI(e,t,n){var r=e[t];return r?r.b:n}function GI(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof a?a:parseInt(a,10)}function jI(e){switch("string"===typeof e&&(e=uI[e]),e){case uI.DT_FLOAT:case uI.DT_HALF:return"float32";case uI.DT_INT32:case uI.DT_INT64:case uI.DT_INT8:case uI.DT_UINT8:return"int32";case uI.DT_BOOL:return"bool";case uI.DT_DOUBLE:return"float32";case uI.DT_STRING:return"string";default:return null}}function HI(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function ZI(e,t,n){var r=e[t];return r&&r.type?jI(r.type):n}function KI(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return jI(e)})):n}function qI(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"===typeof e.size?e.size:parseInt(e.size,10)})):[]}function XI(e,t,n){var r=e[t];return r&&r.shape?qI(r.shape):n}function YI(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"===typeof e?e:parseInt(e,10)})):n}function QI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return UI(e,r)})):n}function JI(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return qI(e)})):n}function $I(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var eC=function(){function e(t,n,r){var a=this;Te(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return Re(e,[{key:"getInput",value:function(e){return dI(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return dI(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return GI(this.node.rawAttrs,e,t);if(null!=n.s)return WI(this.node.rawAttrs,e,t);if(null!=n.b)return VI(this.node.rawAttrs,e,t);if(null!=n.shape)return XI(this.node.rawAttrs,e,t);if(null!=n.type)return ZI(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return YI(this.node.rawAttrs,e,t);if(null!=n.list.s)return QI(this.node.rawAttrs,e,t);if(null!=n.list.shape)return JI(this.node.rawAttrs,e,t);if(null!=n.list.b)return $I(this.node.rawAttrs,e,t);if(null!=n.list.type)return KI(this.node.rawAttrs,e,t)}return t}}]),e}();function tC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!==typeof e&&"number"!==typeof t){nn(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];nn(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function nC(e){return"number"!==typeof e&&!e.some((function(e){return e<0}))}function rC(e,t,n){var r=aC(e,n),a=!nC(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=aC(e.shape,r)})),!nC(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function aC(e,t){if("number"===typeof e)return t;if("number"===typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var iC=function(){function e(t,n,r,a,i,o,s){Te(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=lc(0),Ju(this.idTensor)}return Re(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),tC(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Ju(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Ds([],[0].concat(this.elementShape));var r=this.readMany(e);return tC(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),Hd(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Ds([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return tC(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Kl(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,(0,Lt.Z)(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,uf(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:t.size/r,o=[];Yu((function(){t=jl(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=jl(Yl(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),oC=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;Te(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));tC(n,e.shape,"TensorList shape mismatch: "),Ju(e)})),this.idTensor=lc(0),this.maxNumElements=a,Ju(this.idTensor)}return Re(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e((0,Lt.Z)(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));tC(e,this.elementShape,"TensorList shape mismatch: ");var a=rC(this.elementShape,this.tensors,e);return Yu((function(){var e=n.tensors.map((function(e){return jl(e,a)}));return Hd(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=rC(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,tC(r.shape,e,"TensorList shape mismatch: "),jl(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(tC(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Ju(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));tC(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=rC(this.elementShape,this.tensors,t);return jl(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));tC(this.elementShape,t.shape,"TensorList shape mismatch: "),Ju(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));tC(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=rC(this.elementShape,this.tensors,n);return 0===e.length?Ds([],[0].concat(a)):Yu((function(){var t=e.map((function(e){return jl(r.tensors[e],a)}));return Hd(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));tC(this.elementShape,t,"TensorList shape mismatch: ");var r=rC(this.elementShape,this.tensors,t);return 0===this.size()?Ds([],[0].concat(r)):Yu((function(){var e=n.tensors.map((function(e){return jl(e,r)}));return Kl(e,0)}))}}]),e}();function sC(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));tC(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=uf(e);return new oC(a,t,r)}function uC(e,t,n,r){return new oC([],e,t,r)}function cC(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,(0,Lt.Z)(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new oC([],n,e.dtype,r),o=uf(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function lC(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=aC(e.shape.slice(1),n),o=0===r?0:e.size/r,s=Yu((function(){var n=[];e=jl(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=jl(Yl(e,u,c),i)}return e.dispose(),n})),u=new oC([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var hC=function(){var e=Ht(Gt().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S,I,C,T,N,E,R,A,_,O,F,D,M,P,L,z,B,U,W,V,G,j,H,Z,K,q,X,Y,Q,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,he,pe,de,fe,me,ve,ge,ye,be,xe,ke,we,Se,Ie,Ce,Te,Ne,Ee,Re,Ae,_e,Oe,Fe,De,Me,Pe,Le,ze,Be,Ue,We,Ve,Ge,je,He,Ze,Ke,qe,Xe,Ye,Qe,Je,$e,et,tt,nt,rt,at,it;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?15:"LoopCond"===e.t0?33:"Switch"===e.t0?35:"Merge"===e.t0?46:"Enter"===e.t0?51:"Exit"===e.t0?55:"NextIteration"===e.t0?58:"TensorArrayV3"===e.t0?61:"TensorArrayWriteV3"===e.t0?71:"TensorArrayReadV3"===e.t0?77:"TensorArrayGatherV3"===e.t0?81:"TensorArrayScatterV3"===e.t0?86:"TensorArrayConcatV3"===e.t0?92:"TensorArraySplitV3"===e.t0?96:"TensorArraySizeV3"===e.t0?102:"TensorArrayCloseV3"===e.t0?105:"TensorListSetItem"===e.t0?109:"TensorListGetItem"===e.t0?115:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?121:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?128:"TensorListGather"===e.t0?136:"TensorListStack"===e.t0?142:"TensorListFromTensor"===e.t0?148:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?154:"TensorListPushBack"===e.t0?159:"TensorListPopBack"===e.t0?164:"TensorListSplit"===e.t0?169:"TensorListLength"===e.t0?175:"TensorListResize"===e.t0?178:184;break;case 3:return a=pI("thenBranch",t,n,r),i=pI("elseBranch",t,n,r),o=pI("cond",t,n,r),s=pI("args",t,n,r),e.next=9,o.data();case 9:if(!e.sent[0]){e.next=14;break}return e.abrupt("return",r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 14:return e.abrupt("return",r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 15:return u=pI("body",t,n,r),c=pI("cond",t,n,r),l=pI("args",t,n,r),e.next=20,r.functionMap[c].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 20:return h=e.sent,p=l.map((function(e){return e.id})),e.next=24,h[0].data();case 24:d=e.sent,h.forEach((function(e){e.kept||-1!==p.indexOf(e.id)||e.dispose()})),f=l,m=Gt().mark((function e(){var t,n,a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f,e.next=3,r.functionMap[u].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 3:return f=e.sent,n=f.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==p.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[c].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:d=e.sent,a.forEach((function(e){e.kept||-1!==p.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 28:if(!d[0]){e.next=32;break}return e.delegateYield(m(),"t1",30);case 30:e.next=28;break;case 32:return e.abrupt("return",f);case 33:return v=pI("pred",t,n,r),e.abrupt("return",[bI(v)]);case 35:return g=pI("pred",t,n,r),(y=pI("data",t,n,r)).kept||(y=bI(y)),e.next=40,g.data();case 40:if(!e.sent[0]){e.next=44;break}e.t2=[void 0,y],e.next=45;break;case 44:e.t2=[y,void 0];case 45:return e.abrupt("return",e.t2);case 46:if(b=t.inputNames.find((function(e){return void 0!==dI(e,n,r)})),!b){e.next=50;break}return x=dI(b,n,r),e.abrupt("return",[bI(x)]);case 50:return e.abrupt("return",void 0);case 51:return k=pI("frameName",t,n,r),w=pI("tensor",t,n,r),r.enterFrame(k),e.abrupt("return",[bI(w)]);case 55:return S=pI("tensor",t,n,r),r.exitFrame(),e.abrupt("return",[bI(S)]);case 58:return I=pI("tensor",t,n,r),r.nextIteration(),e.abrupt("return",[bI(I)]);case 61:return C=pI("size",t,n,r),T=pI("dtype",t,n,r),N=pI("elementShape",t,n,r),E=pI("dynamicSize",t,n,r),R=pI("clearAfterRead",t,n,r),A=pI("identicalElementShapes",t,n,r),_=pI("name",t,n,r),O=new iC(_,T,C,N,A,E,R),r.addTensorArray(O),e.abrupt("return",[O.idTensor,lc(1)]);case 71:return F=pI("tensorArrayId",t,n,r),D=pI("index",t,n,r),M=pI("tensor",t,n,r),(P=r.getTensorArray(F.id)).write(D,M),e.abrupt("return",[P.idTensor]);case 77:return L=pI("tensorArrayId",t,n,r),z=pI("index",t,n,r),B=r.getTensorArray(L.id),e.abrupt("return",[B.read(z)]);case 81:return U=pI("tensorArrayId",t,n,r),W=pI("indices",t,n,r),V=pI("dtype",t,n,r),G=r.getTensorArray(U.id),e.abrupt("return",[G.gather(W,V)]);case 86:return j=pI("tensorArrayId",t,n,r),H=pI("indices",t,n,r),Z=pI("tensor",t,n,r),(K=r.getTensorArray(j.id)).scatter(H,Z),e.abrupt("return",[K.idTensor]);case 92:return q=pI("tensorArrayId",t,n,r),X=r.getTensorArray(q.id),Y=pI("dtype",t,n,r),e.abrupt("return",[X.concat(Y)]);case 96:return Q=pI("tensorArrayId",t,n,r),J=pI("tensor",t,n,r),$=pI("lengths",t,n,r),(ee=r.getTensorArray(Q.id)).split($,J),e.abrupt("return",[ee.idTensor]);case 102:return te=pI("tensorArrayId",t,n,r),ne=r.getTensorArray(te.id),e.abrupt("return",[lc(ne.size(),"int32")]);case 105:return re=pI("tensorArrayId",t,n,r),(ae=r.getTensorArray(re.id)).clearAndClose(),e.abrupt("return",[ae.idTensor]);case 109:return ie=pI("tensorListId",t,n,r),oe=pI("index",t,n,r),se=pI("tensor",t,n,r),(ue=r.getTensorList(ie.id)).setItem(oe,se),e.abrupt("return",[ue.idTensor]);case 115:return ce=pI("tensorListId",t,n,r),le=pI("index",t,n,r),he=pI("elementShape",t,n,r),pe=pI("elementDType",t,n,r),de=r.getTensorList(ce.id),e.abrupt("return",[de.getItem(le,he,pe)]);case 121:return fe=pI("indices",t,n,r),me=pI("tensor",t,n,r),ve=pI("elementShape",t,n,r),ge=pI("numElements",t,n,r),ye=cC(me,fe,ve,ge),r.addTensorList(ye),e.abrupt("return",[ye.idTensor]);case 128:return be=pI("elementShape",t,n,r),xe=pI("elementDType",t,n,r),ke="TensorListReserve"===t.op?"numElements":"maxNumElements",we=pI(ke,t,n,r),Se="TensorListReserve"===t.op?-1:we,Ie=uC(be,xe,0,Se),r.addTensorList(Ie),e.abrupt("return",[Ie.idTensor]);case 136:return Ce=pI("tensorListId",t,n,r),Te=pI("indices",t,n,r),Ne=pI("elementShape",t,n,r),Ee=pI("elementDType",t,n,r),Re=r.getTensorList(Ce.id),e.abrupt("return",[Re.gather(Te,Ee,Ne)]);case 142:return Ae=pI("tensorListId",t,n,r),_e=pI("elementShape",t,n,r),Oe=pI("elementDType",t,n,r),Fe=pI("numElements",t,n,r),De=r.getTensorList(Ae.id),e.abrupt("return",[De.stack(_e,Oe,Fe)]);case 148:return Me=pI("tensor",t,n,r),Pe=pI("elementShape",t,n,r),Le=pI("elementDType",t,n,r),ze=sC(Me,Pe,Le),r.addTensorList(ze),e.abrupt("return",[ze.idTensor]);case 154:return Be=pI("tensorListId",t,n,r),Ue=r.getTensorList(Be.id),We=pI("dtype",t,n,r),Ve=pI("elementShape",t,n,r),e.abrupt("return",[Ue.concat(We,Ve)]);case 159:return Ge=pI("tensorListId",t,n,r),je=pI("tensor",t,n,r),(He=r.getTensorList(Ge.id)).pushBack(je),e.abrupt("return",[He.idTensor]);case 164:return Ze=pI("tensorListId",t,n,r),Ke=pI("elementShape",t,n,r),qe=pI("elementDType",t,n,r),Xe=r.getTensorList(Ze.id),e.abrupt("return",[Xe.popBack(Ke,qe)]);case 169:return Ye=pI("tensor",t,n,r),Qe=pI("elementShape",t,n,r),Je=pI("lengths",t,n,r),$e=lC(Ye,Je,Qe),r.addTensorList($e),e.abrupt("return",[$e.idTensor]);case 175:return et=pI("tensorListId",t,n,r),tt=r.getTensorList(et.id),e.abrupt("return",[lc(tt.size(),"int32")]);case 178:return nt=pI("tensorListId",t,n,r),rt=pI("size",t,n,r),at=r.getTensorList(nt.id),it=at.resize(rt),r.addTensorList(it),e.abrupt("return",[it.idTensor]);case 184:throw TypeError("Node type ".concat(t.op," is not implemented"));case 185:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function pC(e,t,n){var r=pI("fusedOps",e,t,n),a=(0,E.Z)(r,2),i=a[0],o=a[1],s="biasadd"===i,u=!s,c="prelu"===o,l="fusedbatchnorm"===i,h=pI("numArgs",e,t,n);if(s){if(c&&2!==h)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==h)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var p=pI("strides",e,t,n),d=yI(e,t,n),f=pI("dataFormat",e,t,n).toUpperCase(),m=pI("dilations",e,t,n),v=pI("args",e,t,n),g=(0,E.Z)(v,2),y=g[0],b=g[1];return u&&(b=y,y=void 0),{stride:p,pad:d,dataFormat:f,dilations:m,biasArg:y,preluArg:b,activationFunc:o,leakyreluAlpha:pI("leakyreluAlpha",e,t,n)}}function dC(e,t,n){return{boxes:pI("boxes",e,t,n),scores:pI("scores",e,t,n),maxOutputSize:pI("maxOutputSize",e,t,n),iouThreshold:pI("iouThreshold",e,t,n),scoreThreshold:pI("scoreThreshold",e,t,n),softNmsSigma:pI("softNmsSigma",e,t,n)}}var fC=function(){var e=Ht(Gt().mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,S,I,C,T,N,E,R,A,_=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=_.length>4&&void 0!==_[4]?_[4]:w,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?9:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?15:"Where"===e.t0?20:"ListDiff"===e.t0?27:28;break;case 4:return o=dC(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,h=o.scoreThreshold,p=o.softNmsSigma,e.next=7,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,h,p);case 7:return d=e.sent,e.abrupt("return",[d.selectedIndices,d.selectedScores]);case 9:return f=dC(t,n,r),m=f.boxes,v=f.scores,g=f.maxOutputSize,y=f.iouThreshold,b=f.scoreThreshold,x=pI("padToMaxOutputSize",t,n,r),e.next=13,i.image.nonMaxSuppressionPaddedAsync(m,v,g,y,b,x);case 13:return k=e.sent,e.abrupt("return",[k.selectedIndices,k.validOutputs]);case 15:return S=dC(t,n,r),I=S.boxes,C=S.scores,T=S.maxOutputSize,N=S.iouThreshold,E=S.scoreThreshold,e.next=18,i.image.nonMaxSuppressionAsync(I,C,T,N,E);case 18:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 20:return R=i.cast(pI("condition",t,n,r),"bool"),e.next=23,i.whereAsync(R);case 23:return e.t2=e.sent,A=[e.t2],R.dispose(),e.abrupt("return",A);case 27:return e.abrupt("return",i.setdiff1dAsync(pI("x",t,n,r),pI("y",t,n,r)));case 28:throw TypeError("Node type ".concat(t.op," is not implemented"));case 29:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),mC=function(){function e(t,n){Te(this,e),this.keyDType=t,this.valueDType=n,this.handle=lc(0),this.tensorMap=new Map,Ju(this.handle)}return Re(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return lc(this.size(),"int32")}},{key:"import",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),e.abrupt("return",Yu((function(){var e=uf(n),t=r.length,i=e.length;nn(t===i,(function(){return"The number of elements doesn't match, keys has "+"".concat(t," elements, the values has ").concat(i," ")+"elements."}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Ju(u),a.tensorMap.set(s,u)}return a.handle})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",Yu((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return Hd(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}}]),e}(),vC=function(){var e=Ht(Gt().mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f,m,v,g,y;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"InitializeTable"===e.t0||"InitializeTableV2"===e.t0||"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?13:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?21:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?29:32;break;case 3:if(null==(i=a.getHashTableHandleByName(t.name))){e.next=8;break}return e.abrupt("return",[i]);case 8:return o=pI("keyDType",t,n,r),s=pI("valueDType",t,n,r),u=new mC(o,s),a.addHashTable(t.name,u),e.abrupt("return",[u.handle]);case 13:return c=pI("tableHandle",t,n,r,a),l=pI("keys",t,n,r),h=pI("values",t,n,r),p=a.getHashTableById(c.id),e.next=19,p.import(l,h);case 19:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 21:return d=pI("tableHandle",t,n,r,a),f=pI("keys",t,n,r),m=pI("defaultValue",t,n,r),v=a.getHashTableById(d.id),e.next=27,v.find(f,m);case 27:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 29:return g=pI("tableHandle",t,n,r,a),y=a.getHashTableById(g.id),e.abrupt("return",[y.tensorSize()]);case 32:throw TypeError("Node type ".concat(t.op," is not implemented"));case 33:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();function gC(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Yu,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(pI("a",e,t,n),pI("b",e,t,n))];case"AddN":return[r.addN(pI("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(pI("a",e,t,n),pI("b",e,t,n))];case"Mul":return[r.mul(pI("a",e,t,n),pI("b",e,t,n))];case"RealDiv":case"Div":return[r.div(pI("a",e,t,n),pI("b",e,t,n))];case"DivNoNan":return[r.divNoNan(pI("a",e,t,n),pI("b",e,t,n))];case"FloorDiv":return[r.floorDiv(pI("a",e,t,n),pI("b",e,t,n))];case"Sub":return[r.sub(pI("a",e,t,n),pI("b",e,t,n))];case"Minimum":return[r.minimum(pI("a",e,t,n),pI("b",e,t,n))];case"Maximum":return[r.maximum(pI("a",e,t,n),pI("b",e,t,n))];case"Pow":return[r.pow(pI("a",e,t,n),pI("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(pI("a",e,t,n),pI("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(pI("x",e,t,n))];case"Acos":return[r.acos(pI("x",e,t,n))];case"Acosh":return[r.acosh(pI("x",e,t,n))];case"Asin":return[r.asin(pI("x",e,t,n))];case"Asinh":return[r.asinh(pI("x",e,t,n))];case"Atan":return[r.atan(pI("x",e,t,n))];case"Atan2":return[r.atan2(pI("x",e,t,n),pI("y",e,t,n))];case"Atanh":return[r.atanh(pI("x",e,t,n))];case"Ceil":return[r.ceil(pI("x",e,t,n))];case"Complex":return[r.complex(pI("real",e,t,n),pI("imag",e,t,n))];case"Cos":return[r.cos(pI("x",e,t,n))];case"Cosh":return[r.cosh(pI("x",e,t,n))];case"Elu":return[r.elu(pI("x",e,t,n))];case"Erf":return[r.erf(pI("x",e,t,n))];case"Exp":return[r.exp(pI("x",e,t,n))];case"Expm1":return[r.expm1(pI("x",e,t,n))];case"Floor":return[r.floor(pI("x",e,t,n))];case"Log":return[r.log(pI("x",e,t,n))];case"Log1p":return[r.log1p(pI("x",e,t,n))];case"Imag":return[r.imag(pI("x",e,t,n))];case"Neg":return[r.neg(pI("x",e,t,n))];case"Reciprocal":return[r.reciprocal(pI("x",e,t,n))];case"Real":return[r.real(pI("x",e,t,n))];case"Relu":return[r.relu(pI("x",e,t,n))];case"Round":return[r.round(pI("x",e,t,n))];case"Selu":return[r.selu(pI("x",e,t,n))];case"Sigmoid":return[r.sigmoid(pI("x",e,t,n))];case"Sin":return[r.sin(pI("x",e,t,n))];case"Sign":return[r.sign(pI("x",e,t,n))];case"Sinh":return[r.sinh(pI("x",e,t,n))];case"Softplus":return[r.softplus(pI("x",e,t,n))];case"Sqrt":return[r.sqrt(pI("x",e,t,n))];case"Square":return[r.square(pI("x",e,t,n))];case"Tanh":return[r.tanh(pI("x",e,t,n))];case"Tan":return[r.tan(pI("x",e,t,n))];case"ClipByValue":return[r.clipByValue(pI("x",e,t,n),pI("clipValueMin",e,t,n),pI("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(pI("x",e,t,n))];case"Rsqrt":return[r.rsqrt(dI(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(pI("x",e,t,n),pI("alpha",e,t,n))];case"Prelu":return[r.prelu(pI("x",e,t,n),pI("alpha",e,t,n))];case"IsNan":return[r.isNaN(dI(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(dI(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(dI(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return hC(e,t,n);case"convolution":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Conv1D":var a=pI("stride",e,t,n),i=pI("pad",e,t,n),o=pI("dataFormat",e,t,n).toUpperCase(),s=pI("dilation",e,t,n);return[r.conv1d(pI("x",e,t,n),pI("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=pI("strides",e,t,n),c=yI(e,t,n),l=pI("dataFormat",e,t,n).toUpperCase(),h=pI("dilations",e,t,n);return[r.conv2d(pI("x",e,t,n),pI("filter",e,t,n),[u[1],u[2]],c,l,[h[1],h[2]])];case"_FusedConv2D":var p=pC(e,t,n),d=p.stride,f=p.pad,m=p.dataFormat,v=p.dilations,g=p.biasArg,y=p.preluArg,b=p.activationFunc,x=p.leakyreluAlpha;return[r.fused.conv2d({x:pI("x",e,t,n),filter:pI("filter",e,t,n),strides:[d[1],d[2]],pad:f,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=pC(e,t,n),S=k.stride,I=k.pad,C=k.dataFormat,T=k.dilations,N=k.biasArg,E=k.preluArg,R=k.activationFunc,A=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:pI("x",e,t,n),filter:pI("filter",e,t,n),strides:[S[1],S[2]],pad:I,dataFormat:C,dilations:[T[1],T[2]],bias:N,activation:R,preluActivationWeights:E,leakyreluAlpha:A})];case"Conv2DBackpropInput":case"Conv2dTranspose":var _=pI("outputShape",e,t,n),O=pI("strides",e,t,n),F=yI(e,t,n);return[r.conv2dTranspose(pI("x",e,t,n),pI("filter",e,t,n),_,[O[1],O[2]],F)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=pI("strides",e,t,n),M=yI(e,t,n),P=pI("dilations",e,t,n),L=pI("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(pI("input",e,t,n),pI("filter",e,t,n),[D[1],D[2]],M,L,[P[1],P[2]])];case"Conv3D":var z=pI("strides",e,t,n),B=pI("pad",e,t,n),U=pI("dataFormat",e,t,n).toUpperCase(),W=pI("dilations",e,t,n);return[r.conv3d(pI("x",e,t,n),pI("filter",e,t,n),[z[1],z[2],z[3]],B,U,[W[1],W[2],W[3]])];case"AvgPool":var V=pI("strides",e,t,n),G=pI("pad",e,t,n),j=pI("kernelSize",e,t,n);return[r.avgPool(pI("x",e,t,n),[j[1],j[2]],[V[1],V[2]],G)];case"MaxPool":var H=pI("strides",e,t,n),Z=pI("pad",e,t,n),K=pI("kernelSize",e,t,n);return[r.maxPool(pI("x",e,t,n),[K[1],K[2]],[H[1],H[2]],Z)];case"MaxPoolWithArgmax":var q=pI("strides",e,t,n),X=pI("pad",e,t,n),Y=pI("kernelSize",e,t,n),Q=pI("includeBatchInIndex",e,t,n),J=r.maxPoolWithArgmax(pI("x",e,t,n),[Y[1],Y[2]],[q[1],q[2]],X,Q);return[J.result,J.indexes];case"AvgPool3D":var $=pI("strides",e,t,n),ee=pI("pad",e,t,n),te=pI("kernelSize",e,t,n);return[r.avgPool3d(pI("x",e,t,n),[te[1],te[2],te[3]],[$[1],$[2],$[3]],ee)];case"MaxPool3D":var ne=pI("strides",e,t,n),re=pI("pad",e,t,n),ae=pI("kernelSize",e,t,n);return[r.maxPool3d(pI("x",e,t,n),[ae[1],ae[2],ae[3]],[ne[1],ne[2],ne[3]],re)];case"Dilation2D":var ie=pI("strides",e,t,n),oe=pI("pad",e,t,n),se=pI("dilations",e,t,n),ue=ie[1],ce=ie[2],le=se[1],he=se[2];return[r.dilation2d(pI("x",e,t,n),pI("filter",e,t,n),[ue,ce],oe,[le,he],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Fill":var a=pI("shape",e,t,n),i=pI("dtype",e,t,n),o=pI("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=pI("start",e,t,n),u=pI("stop",e,t,n),c=pI("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=pI("logits",e,t,n),h=pI("numSamples",e,t,n),p=pI("seed",e,t,n);return[r.multinomial(l,h,p)];case"OneHot":var d=pI("indices",e,t,n),f=pI("depth",e,t,n),m=pI("onValue",e,t,n),v=pI("offValue",e,t,n),g=pI("dtype",e,t,n);return[r.oneHot(d,f,m,v,g)];case"Ones":return[r.ones(pI("shape",e,t,n),pI("dtype",e,t,n))];case"OnesLike":return[r.onesLike(pI("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(pI("shape",e,t,n),pI("dtype",e,t,n),pI("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(pI("shape",e,t,n),pI("minval",e,t,n),pI("maxval",e,t,n),pI("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(pI("shape",e,t,n),pI("minval",e,t,n),pI("maxval",e,t,n),pI("seed",e,t,n))];case"Range":var y=pI("start",e,t,n),b=pI("stop",e,t,n),x=pI("step",e,t,n);return[r.range(y,b,x,pI("dtype",e,t,n))];case"TruncatedNormal":var k=pI("shape",e,t,n),S=pI("mean",e,t,n),I=pI("stdDev",e,t,n),C=pI("seed",e,t,n);return[r.truncatedNormal(k,S,I,pI("dtype",e,t,n),C)];case"Zeros":return[r.zeros(pI("shape",e,t,n),pI("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(pI("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return fC(e,t,n);case"evaluation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"LowerBound":var a=pI("sortedSequence",e,t,n),i=pI("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=pI("x",e,t,n),s=pI("k",e,t,n),u=pI("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=pI("sortedSequence",e,t,n),h=pI("values",e,t,n);return[r.upperBound(l,h)];case"Unique":var p=pI("x",e,t,n),d=r.unique(p);return[d.values,d.indices];case"UniqueV2":var f=pI("x",e,t,n),m=pI("axis",e,t,n),v=r.unique(f,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"ResizeBilinear":var a=pI("images",e,t,n),i=pI("size",e,t,n),o=pI("alignCorners",e,t,n),s=pI("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=pI("images",e,t,n),c=pI("size",e,t,n),l=pI("alignCorners",e,t,n),h=pI("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,h)];case"CropAndResize":var p=pI("image",e,t,n),d=pI("boxes",e,t,n),f=pI("boxInd",e,t,n),m=pI("cropSize",e,t,n),v=pI("method",e,t,n),g=pI("extrapolationValue",e,t,n);return[r.image.cropAndResize(p,d,f,m,v,g)];case"ImageProjectiveTransformV3":var y=pI("images",e,t,n),b=pI("transforms",e,t,n),x=pI("outputShape",e,t,n),k=pI("fillValue",e,t,n),S=pI("interpolation",e,t,n),I=pI("fillMode",e,t,n);return[r.image.transform(y,b,S.toLowerCase(),I.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=pI("default",e,t,n);return[dI(e.name,t,n)||a];case"Placeholder":return[dI(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[bI(pI("x",e,t,n))];case"IdentityN":return pI("x",e,t,n).map((function(e){return bI(e)}));case"Shape":return[r.tensor1d(pI("x",e,t,n).shape,"int32")];case"ShapeN":return pI("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(pI("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(pI("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var i=pI("x",e,t,n),o=pI("data",e,t,n),s=pI("message",e,t,n),u=pI("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Equal":return[r.equal(pI("a",e,t,n),pI("b",e,t,n))];case"NotEqual":return[r.notEqual(pI("a",e,t,n),pI("b",e,t,n))];case"Greater":return[r.greater(pI("a",e,t,n),pI("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(pI("a",e,t,n),pI("b",e,t,n))];case"Less":return[r.less(pI("a",e,t,n),pI("b",e,t,n))];case"LessEqual":return[r.lessEqual(pI("a",e,t,n),pI("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(pI("a",e,t,n),pI("b",e,t,n))];case"LogicalNot":return[r.logicalNot(pI("a",e,t,n))];case"LogicalOr":return[r.logicalOr(pI("a",e,t,n),pI("b",e,t,n))];case"Select":case"SelectV2":return[r.where(pI("condition",e,t,n),pI("a",e,t,n),pI("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(pI("a",e,t,n),pI("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(pI("a",e,t,n),pI("b",e,t,n),pI("transposeA",e,t,n),pI("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[pI("equation",e,t,n)].concat((0,Lt.Z)(pI("tensors",e,t,n))))];case"Transpose":return[r.transpose(pI("x",e,t,n),pI("perm",e,t,n))];case"_FusedMatMul":var a=pI("fusedOps",e,t,n),i=(0,E.Z)(a,2),o=i[0],s=i[1],u="biasadd"===o,c="prelu"===s,l=pI("numArgs",e,t,n),h=pI("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var p=pI("args",e,t,n),d=(0,E.Z)(p,2),f=d[0],m=d[1];return[r.fused.matMul({a:pI("a",e,t,n),b:pI("b",e,t,n),transposeA:pI("transposeA",e,t,n),transposeB:pI("transposeB",e,t,n),bias:f,activation:s,preluActivationWeights:m,leakyreluAlpha:h})];case"MatrixBandPart":return[r.linalg.bandPart(pI("a",e,t,n),pI("numLower",e,t,n),pI("numUpper",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(pI("x",e,t,n),pI("axis",e,t,n),pI("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(pI("x",e,t,n),pI("mean",e,t,n),pI("variance",e,t,n),pI("offset",e,t,n),pI("scale",e,t,n),pI("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(pI("x",e,t,n),pI("radius",e,t,n),pI("bias",e,t,n),pI("alpha",e,t,n),pI("beta",e,t,n))];case"Softmax":return[r.softmax(pI("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(pI("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"ragged":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"RaggedGather":var a=r.raggedGather(pI("paramsNestedSplits",e,t,n),pI("paramsDenseValues",e,t,n),pI("indices",e,t,n),pI("outputRaggedRank",e,t,n)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o);case"RaggedRange":var s=r.raggedRange(pI("starts",e,t,n),pI("limits",e,t,n),pI("splits",e,t,n));return[s.rtNestedSplits,s.rtDenseValues];case"RaggedTensorToTensor":return[r.raggedTensorToTensor(pI("shape",e,t,n),pI("values",e,t,n),pI("defaultValue",e,t,n),pI("rowPartitionTensors",e,t,n),pI("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Max":var a=pI("axis",e,t,n),i=pI("keepDims",e,t,n);return[r.max(pI("x",e,t,n),a,i)];case"Mean":var o=pI("axis",e,t,n),s=pI("keepDims",e,t,n);return[r.mean(pI("x",e,t,n),o,s)];case"Min":var u=pI("axis",e,t,n),c=pI("keepDims",e,t,n);return[r.min(pI("x",e,t,n),u,c)];case"Sum":var l=pI("axis",e,t,n),h=pI("keepDims",e,t,n);return[r.sum(pI("x",e,t,n),l,h)];case"All":var p=pI("axis",e,t,n),d=pI("keepDims",e,t,n);return[r.all(pI("x",e,t,n),p,d)];case"Any":var f=pI("axis",e,t,n),m=pI("keepDims",e,t,n);return[r.any(pI("x",e,t,n),f,m)];case"ArgMax":var v=pI("axis",e,t,n);return[r.argMax(pI("x",e,t,n),v)];case"ArgMin":var g=pI("axis",e,t,n);return[r.argMin(pI("x",e,t,n),g)];case"Prod":var y=pI("axis",e,t,n),b=pI("keepDims",e,t,n);return[r.prod(pI("x",e,t,n),y,b)];case"Cumprod":var x=pI("axis",e,t,n),k=pI("exclusive",e,t,n),S=pI("reverse",e,t,n);return[r.cumprod(pI("x",e,t,n),x,k,S)];case"Cumsum":var I=pI("axis",e,t,n),C=pI("exclusive",e,t,n),T=pI("reverse",e,t,n);return[r.cumsum(pI("x",e,t,n),I,C,T)];case"Bincount":var N=pI("x",e,t,n),E=pI("weights",e,t,n),R=pI("size",e,t,n);return[r.bincount(N,E,R)];case"DenseBincount":var A=pI("x",e,t,n),_=pI("weights",e,t,n),O=pI("size",e,t,n),F=pI("binaryOutput",e,t,n);return[r.denseBincount(A,_,O,F)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"ConcatV2":case"Concat":var a=pI("n",e,t,n),i=pI("axis",e,t,n),o=pI("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=pI("x",e,t,n),u=pI("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=pI("axis",e,t,n),l=pI("batchDims",e,t,n),h=pI("x",e,t,n),p=pI("indices",e,t,n);return[r.gather(h,r.cast(p,"int32"),c,l)];case"Reverse":for(var d=pI("dims",e,t,n),f=[],m=0;m<d.length;m++)d[m]&&f.push(m);var v=pI("x",e,t,n);return[r.reverse(v,f)];case"ReverseV2":var g=pI("axis",e,t,n),y=pI("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=pI("begin",e,t,n),x=pI("size",e,t,n);return[r.slice(pI("x",e,t,n),b,x)];case"StridedSlice":var k=pI("begin",e,t,n),S=pI("end",e,t,n),I=pI("strides",e,t,n),C=pI("beginMask",e,t,n),T=pI("endMask",e,t,n),N=pI("ellipsisMask",e,t,n),E=pI("newAxisMask",e,t,n),R=pI("shrinkAxisMask",e,t,n),A=pI("x",e,t,n);return[r.stridedSlice(A,k,S,I,C,T,N,E,R)];case"Pack":return Yu((function(){var a=pI("axis",e,t,n),i=pI("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=sn(e.shape,o);if(!t&&!sn(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var _=pI("axis",e,t,n),O=pI("tensor",e,t,n);return r.unstack(O,_);case"Tile":var F=pI("reps",e,t,n);return[r.tile(pI("x",e,t,n),F)];case"Split":case"SplitV":var D=pI("axis",e,t,n),M=pI("numOrSizeSplits",e,t,n),P=pI("x",e,t,n);return r.split(P,M,D);case"ScatterNd":var L=pI("indices",e,t,n),z=pI("values",e,t,n),B=pI("shape",e,t,n);return[r.scatterND(L,z,B)];case"GatherNd":var U=pI("x",e,t,n),W=pI("indices",e,t,n);return[r.gatherND(U,W)];case"SparseToDense":var V=pI("sparseIndices",e,t,n),G=pI("outputShape",e,t,n),j=pI("sparseValues",e,t,n),H=pI("defaultValue",e,t,n);return[r.sparseToDense(V,j,G,j.dtype===H.dtype?H:r.cast(H,j.dtype))];case"TensorScatterUpdate":var Z=pI("indices",e,t,n),K=pI("values",e,t,n),q=pI("tensor",e,t,n);return[r.tensorScatterUpdate(q,Z,K)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"sparse":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(pI("indices",e,t,n),pI("values",e,t,n),pI("denseShape",e,t,n),pI("defaultValue",e,t,n));return[a.outputIndices,a.outputValues,a.emptyRowIndicator,a.reverseIndexMap];case"SparseReshape":var i=r.sparse.sparseReshape(pI("inputIndices",e,t,n),pI("inputShape",e,t,n),pI("newShape",e,t,n));return[i.outputIndices,i.outputShape];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(pI("data",e,t,n),pI("indices",e,t,n),pI("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(pI("data",e,t,n),pI("indices",e,t,n),pI("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"FFT":return[r.fft(pI("x",e,t,n))];case"IFFT":return[r.ifft(pI("x",e,t,n))];case"RFFT":return[r.rfft(pI("x",e,t,n))];case"IRFFT":return[r.irfft(pI("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"string":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(pI("input",e,t,n),pI("pattern",e,t,n),pI("rewrite",e,t,n),pI("replaceGlobal",e,t,n))];case"StringNGrams":var a=r.string.stringNGrams(pI("data",e,t,n),pI("dataSplits",e,t,n),pI("separator",e,t,n),pI("nGramWidths",e,t,n),pI("leftPad",e,t,n),pI("rightPad",e,t,n),pI("padWidth",e,t,n),pI("preserveShortSequences",e,t,n));return[a.nGrams,a.nGramsSplits];case"StringSplit":var i=r.string.stringSplit(pI("input",e,t,n),pI("delimiter",e,t,n),pI("skipEmpty",e,t,n));return[i.indices,i.values,i.shape];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(pI("input",e,t,n),pI("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Cast":return[r.cast(pI("x",e,t,n),pI("dtype",e,t,n))];case"ExpandDims":var a=pI("axis",e,t,n);return[r.expandDims(pI("x",e,t,n),a)];case"Squeeze":var i=pI("axis",e,t,n);return[r.squeeze(pI("x",e,t,n),i)];case"Reshape":return[r.reshape(pI("x",e,t,n),pI("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(pI("x",e,t,n),pI("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(pI("x",e,t,n),pI("padding",e,t,n),pI("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(pI("x",e,t,n),pI("padding",e,t,n),pI("constantValue",e,t,n))];case"SpaceToBatchND":var o=pI("blockShape",e,t,n),s=pI("paddings",e,t,n);return[r.spaceToBatchND(pI("x",e,t,n),o,s)];case"BatchToSpaceND":var u=pI("blockShape",e,t,n),c=pI("crops",e,t,n);return[r.batchToSpaceND(pI("x",e,t,n),u,c)];case"DepthToSpace":var l=pI("blockSize",e,t,n),h=pI("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(pI("x",e,t,n),l,h)];case"BroadcastTo":return[r.broadcastTo(pI("x",e,t,n),pI("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(pI("s0",e,t,n),pI("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return vC(e,t,n,r);case"custom":var i=hI(e.op);if(i&&i.customExecutor)return i.customExecutor(new eC(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return Dn(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var yC=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0;Te(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return Re(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function bC(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(e).map((function(e){return gI(e)[0]})));r=r||[];for(var l=new Set(r.map((function(e){return gI(e.name)[0]}))),h=(0,Lt.Z)(t);h.length>0;){var p=h.pop();(CC(p)||TC(p)||NC(p))&&null==o&&(s=(o=p).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(p.name),null==n[p.name]&&(c.has(p.name)||l.has(p.name)||(0!==p.inputs.length?p.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),h.push(e))})):i.push(p.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function xC(e,t){var n=t.usedNodes,r=t.inputs,a=Object.keys(r).map((function(e){return gI(e)[0]})).map((function(t){return e.nodes[t]})),i=e.initNodes||[],o=function(e){return n.has("string"===typeof e?e:e.name)};function s(e){return(0,Lt.Z)(new Map(e.map((function(e){return[e.name,e]}))).values())}var u,c=s([].concat((0,Lt.Z)(a),(0,Lt.Z)(e.weights),(0,Lt.Z)(i))).filter(o),l=s([].concat((0,Lt.Z)(c),(0,Lt.Z)(Object.values(e.nodes)))).filter(o),h=new Map(l.map((function(e){return[e.name,e]}))),p={},d=Kt(l);try{for(d.s();!(u=d.n()).done;){var f=u.value;p[f.name]=p[f.name]||0;var m,v=Kt(f.children);try{for(v.s();!(m=v.n()).done;){var g=m.value;o(g)||(p[g.name]=Number.POSITIVE_INFINITY),p[g.name]=(p[g.name]||0)+1}}catch($Q){v.e($Q)}finally{v.f()}}}catch($Q){d.e($Q)}finally{d.f()}for(var y=Object.entries(p).filter((function(e){return 0===(0,E.Z)(e,2)[1]})).map((function(e){return(0,E.Z)(e,1)[0]})),b=(0,Lt.Z)(y);y.length>0;){var x,k=y.pop(),w=Kt(h.get(k).children.filter(o));try{for(w.s();!(x=w.n()).done;){var S=x.value;0===--p[S.name]&&(b.push(S.name),y.push(S.name))}}catch($Q){w.e($Q)}finally{w.f()}}var I=function(e,t){var n=new Map(e.map((function(e){return[e.name,e]}))),r=t.map((function(e){return e.name})),a=new Set(r);for(;r.length>0;){var i,o=r.pop(),s=Kt(n.get(o).children);try{for(s.s();!(i=s.n()).done;){var u=i.value;n.has(u.name)&&!a.has(u.name)&&(a.add(u.name),r.push(u.name))}}catch($Q){s.e($Q)}finally{s.f()}}var c=e.filter((function(e){return a.has(e.name)}));return c}(b.map((function(e){return h.get(e)})),c);return function(e,t){var n,r=new Map(e.map((function(e,t){return[e.name,t]}))),a=new Set(t.map((function(e){return e.name}))),i=function(e){return a.has("string"===typeof e?e:e.name)},o=new Set(e.map((function(e){return e.name}))),s=function(e){return o.has("string"===typeof e?e:e.name)},u=Kt(e);try{for(u.s();!(n=u.n()).done;){var c,l=n.value,h=Kt(l.children.filter(s));try{for(h.s();!(c=h.n()).done;){var p=c.value;if(!r.has(p.name))throw new kC("Child ".concat(p.name," of node ").concat(l.name," is unreachable."));if(r.get(l.name)>r.get(p.name))throw new kC("Node ".concat(l.name," is scheduled to run after its child ").concat(p.name,"."))}}catch($Q){h.e($Q)}finally{h.f()}if(!i(l)){var d,f=Kt(l.inputs);try{for(f.s();!(d=f.n()).done;){var m=d.value;if(!r.has(m.name))throw new kC("Input ".concat(m.name," of node ").concat(l.name," is unreachable."));if(r.get(m.name)>r.get(l.name))throw new kC("Node ".concat(l.name," is scheduled to run before its input ").concat(m.name,"."))}}catch($Q){f.e($Q)}finally{f.f()}}}}catch($Q){u.e($Q)}finally{u.f()}}(I,c),I}var kC=function(e){Mo(n,e);var t=Uo(n);function n(e){return Te(this,n),t.call(this,"NodesExecutionOrderError: ".concat(e))}return Re(n)}(uy(Error));var wC=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),SC=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),IC=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function CC(e){return wC.has(e.op)}function TC(e){return SC.has(e.op)}function NC(e){return IC.has(e.op)}var EC=function(){function e(t,n){var r=this;Te(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return Re(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,(0,Lt.Z)(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}},{key:"compile",value:function(e,t){var n=bC(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has ")+"the dynamic op '".concat(a.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs ")+"[".concat(s,"]. Missing the following inputs: [").concat(r,"]"))}var u=xC(this.graph,n),c=function(e){for(var t=new Map(e.map((function(e,t){return[e.name,t]}))),n=Number.MAX_SAFE_INTEGER,r=e.map((function(e,t){return CC(e)?n:t})),a=function(e){var n=r[t.get(e.name)];return null==n?-1:n},i=e.map((function(e,t){return e.children.map(a).reduce((function(e,t){return Math.max(e,t)}),r[t])})),o=new Map,s=0;s<e.length;++s){var u=i[s];if(u!==n){var c=e[s],l=e[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}(u);return{orderedNodes:u,nodeLiveUntilMap:c}}},{key:"cloneAndKeepTensor",value:function(e){if(null==e)return null;var t=e.clone();return Ju(t),t}},{key:"cloneTensorList",value:function(e){var t=this;return e?e.map((function(e){return t.cloneAndKeepTensor(e)})):null}},{key:"cloneTensorMap",value:function(e){var t=this;return Object.fromEntries(Object.entries(e).map((function(e){var n=(0,E.Z)(e,2),r=n[0],a=n[1];return[r,t.cloneTensorList(a)]})))}},{key:"execute",value:function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[gI(e)[0]]})),i=t.map((function(e){return gI(e)[0]})),o=new Set(i),s=i.map((function(e){return n.graph.nodes[e]}));0===s.length&&(s=this._outputs);var u=this.getCompilationKey(a,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=zn().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(JG){this.keepIntermediateTensors=!1,console.warn(JG.message)}var l={},h={};return Yu((function(){var r=new yC(n.weightMap,l,h,n.functionExecutorMap,n.parseNodeNameCache),a=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach((function(t){var i=gI(t,r),o=(0,E.Z)(i,2),s=o[0],u=[];u[o[1]]=e[t],a[s]=u,n.keepIntermediateTensors&&(n.clonedTensorsMap[s]=n.cloneTensorList(u))}));var i,s=n.getFrozenTensorIds(a),u=c,p=u.orderedNodes,d=u.nodeLiveUntilMap,f=Kt(p);try{for(f.s();!(i=f.n()).done;){var m=i.value;if(!a[m.name]){var v=gC(m,a,r,n._resourceManager);if(Dn(v))throw new Error("The execution of the op '".concat(m.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");a[m.name]=v,n.keepIntermediateTensors&&(n.clonedTensorsMap[m.name]=n.cloneTensorList(v)),n.checkTensorForDisposalWithNodeLiveUntilInfo(m,a,r,s,o,d.get(m.name))}}}catch($Q){f.e($Q)}finally{f.f()}return null==n.parent&&r.dispose(s),t.map((function(e){return dI(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){if(!CC(t)&&!i.has(e)){var s,u=Kt(n[e]);try{for(u.s();!(s=u.n()).done;){var c=s.value;null!=c&&(o[c.id]=(o[c.id]||0)+t.children.length)}}catch($Q){u.e($Q)}finally{u.f()}var l,h=Kt(t.inputs);try{for(h.s();!(l=h.n()).done;){var p=l.value;if(!CC(p)){var d=fI(p.name,n,r);if(null!=d){var f,m=Kt(d);try{for(m.s();!(f=m.n()).done;){var v=f.value;if(v&&!v.kept&&!a.has(v.id)){var g=o[v.id];1===g?(v.dispose(),delete o[v.id]):null!=g&&o[v.id]--}}}catch($Q){m.e($Q)}finally{m.f()}}}}}catch($Q){h.e($Q)}finally{h.f()}}}},{key:"checkTensorForDisposalWithNodeLiveUntilInfo",value:function(e,t,n,r,a,i){function o(e){return CC(e)||a.has(e.name)}if(!CC(e)&&null!=i){var s,u=Kt(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(!o(c)){var l,h=Kt(fI(c.name,t,n));try{for(h.s();!(l=h.n()).done;){var p=l.value;!p||p.kept||r.has(p.id)||p.dispose()}}catch($Q){h.e($Q)}finally{h.f()}}}}catch($Q){u.e($Q)}finally{u.f()}}}},{key:"executeAsync",value:function(){var e=Ht(Gt().mark((function e(t,n){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((function(e){var t,n=Kt(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&!r.isDisposed&&r.dispose()}}catch($Q){n.e($Q)}finally{n.f()}})),this.clonedTensorsMap=null)}},{key:"getIntermediateTensors",value:function(){return this.clonedTensorsMap}},{key:"_executeAsync",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,p=arguments;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]?p[3]:{},i=p.length>4&&void 0!==p[4]?p[4]:{},this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=zn().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(JG){this.keepIntermediateTensors=!1,console.warn(JG.message)}return o=new yC(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),e.next=10,this.executeWithControlFlow(t,o,n,r);case 10:return s=e.sent,u=n.map((function(e){return dI(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),h=new Set([].concat((0,Lt.Z)(c),(0,Lt.Z)(l),(0,Lt.Z)(this.weightIds))),Object.values(s).forEach((function(e){e.forEach((function(e){!e||e.isDisposed||h.has(e.id)||e.dispose()}))})),null==this.parent&&o.dispose(h),e.abrupt("return",u);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=Ht(Gt().mark((function e(t,n,r){var a,i=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=Ht(Gt().mark((function e(t,n,r,a){var i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return S.graph.nodes[gI(e)[0]]})),s=r.map((function(e){return gI(e)[0]})),u=new Set(s),0===(c=s.map((function(e){return S.graph.nodes[e]}))).length&&(c=this._outputs),l=bC(t,c,this.weightMap,this._initNodes),h=l.usedNodes,p=l.missingInputs,d=l.dynamicNode,f=l.syncInputs,m=[].concat((0,Lt.Z)(o),(0,Lt.Z)(this.graph.weights),(0,Lt.Z)(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),v=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=gI(e),r=(0,E.Z)(n,2),a=r[0],i=[];i[r[1]]=t[e],v[a]=i})),g={},y=this.getFrozenTensorIds(v),b={};case 13:if(!(m.length>0)){e.next=19;break}return x=this.processStack(o,m,n,v,b,y,u,g,h),e.next=17,Promise.all(x);case 17:e.next=13;break;case 19:if(null!=d||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((k=c.filter((function(e){return!CC(e)&&!dI(e.name,v,n)})).map((function(e){return e.name}))).length>0)){e.next=25;break}throw w="",null!=d&&(w="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(f,"]")),new Error("Cannot compute the outputs [".concat(k,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(p,"]. ").concat(w));case 25:return e.abrupt("return",v);case 26:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],h=function(){var e=t.pop();n.currentContext=e.contexts;var h="";if("Enter"===e.node.op&&pI("isConstant",e.node,r,n)){var p=mI(e.node.name,n),d=(0,E.Z)(p,1);h=d[0]}if(null==r[e.node.name]){var f=gC(e.node,r,n,c._resourceManager);if(!h){var m=mI(e.node.name,n),v=(0,E.Z)(m,1);h=v[0]}var g=n.currentContext;Dn(f)?l.push(f.then((function(l){return r[h]=l,c.keepIntermediateTensors&&(c.clonedTensorsMap[h]=c.cloneTensorList(l)),n.currentContext=g,c.checkTensorForDisposal(h,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u),l}))):(r[h]=f,c.keepIntermediateTensors&&(c.clonedTensorsMap[h]=c.cloneTensorList(f)),c.checkTensorForDisposal(h,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u))}else c.processChildNodes(e.node,t,n,r,a,u)};t.length>0;)h();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=mI(e.name,n),s=(0,E.Z)(o,1)[0];!a[s]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!dI(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!dI(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=gI(n),i=(0,E.Z)(a,1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value;nn(s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e})),(function(){return"The shape of dict['".concat(o.name,"'] provided in ")+"model.execute(dict) must be [".concat(s,"], but was ")+"[".concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&nn(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t,n,r={};for(var a in e){var i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=gI(e),r=(0,E.Z)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){var n,r,a=null===(r=null===(n=t._signature)||void 0===n?void 0:n.outputs)||void 0===r?void 0:r[e];return null!=a?a.name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=gI(e),r=(0,E.Z)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),RC=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Te(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return Re(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),AC="?tfjs-format=file",_C="model.json",OC=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;Te(this,t),this.modelUrl=n,this.loadOptions=r,this.version="n/a",this.io=a,null==r&&(this.loadOptions={}),this.resourceManager=new RC}return Re(t,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Dn(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new EC(BI.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=BI.Instance.transformGraph(e.modelInitializer);this.initializer=new EC(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}},{key:"save",value:function(){var e=Ht(Gt().mark((function e(t,n){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=6;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.abrupt("return",t.save(this.artifacts));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addStructuredOutputNames",value:function(e){var t=this;if(this.structuredOutputKeys){var n={};return(e instanceof Jo?[e]:e).forEach((function(e,r){return n[t.structuredOutputKeys[r]]=e})),n}return e}},{key:"predict",value:function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}},{key:"predictAsync",value:function(){var e=Ht(Gt().mark((function e(t,n){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeAsync(t,this.outputNodes);case 2:return r=e.sent,e.abrupt("return",this.addStructuredOutputNames(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"normalizeInputs",value:function(e){var t,n=this;if(!(e instanceof Jo)&&!Array.isArray(e)){var r=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=r)for(var a in r){var i=r[a];null!=i.resourceId&&(e[a]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];var o=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+o!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-o," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var s=0;return this.inputNodes.reduce((function(t,r){var a,i,o,u=null===(o=null===(i=null===(a=n.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[r])||void 0===o?void 0:o.resourceId;return t[r]=null!=u?n.resourceIdToCapturedInput[u]:e[s++],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"executeInitializerGraph",value:function(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}},{key:"executeInitializerGraphAsync",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.initializer){e.next=2;break}return e.abrupt("return",[]);case 2:if(null!=this.initializerSignature){e.next=6;break}return e.abrupt("return",this.initializer.executeAsync({},[]));case 6:return e.abrupt("return",this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs)));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setResourceIdToCapturedInput",value:function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),r=0;r<n.length;r++){var a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}},{key:"execute",value:function(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=Ht(Gt().mark((function e(t,n){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.resourceIdToCapturedInput){e.next=6;break}return e.t0=this,e.next=4,this.executeInitializerGraphAsync();case 4:e.t1=e.sent,e.t0.setResourceIdToCapturedInput.call(e.t0,e.t1);case 6:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=10,this.executor.executeAsync(t,n);case 10:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Qu(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}]),t}();function FC(e){return DC.apply(this,arguments)}function DC(){return DC=Ht(Gt().mark((function t(n){var r,a,i,o=arguments;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:{},a=o.length>2&&void 0!==o[2]?o[2]:e,null!=n){t.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==r&&(r={}),r.fromTFHub&&"string"===typeof n&&(n=MC(n)),i=new OC(n,r,a),t.next=9,i.load();case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),t)}))),DC.apply(this,arguments)}function MC(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat(_C).concat(AC)}function PC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(UC(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=PC(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function LC(e){return zC(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:BC)}function zC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(UC(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=zC(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function BC(e){return null===e?null:UC(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function UC(e){var t=!1;zn().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(6401).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof Jo)&&!(e instanceof Promise)&&!t)}function WC(e){return function(e,t){return PC(e,t)}(e,VC)}function VC(e){return e instanceof Jo?{value:e.clone(),recurse:!1}:UC(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var GC=function(){function e(t){if(Te(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return Re(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=Kt(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch($Q){n.e($Q)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),jC=function(e){Mo(n,e);var t=Uo(n);function n(){return Te(this,n),t.call(this,n.INITIAL_CAPACITY)}return Re(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){Px(Po(n.prototype),"isFull",this).call(this)&&this.expand(),Px(Po(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){Px(Po(n.prototype),"isFull",this).call(this)&&this.expand(),Px(Po(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(GC);function HC(e){return new YC(e)}function ZC(e,t){return new sT(e,t)}jC.INITIAL_CAPACITY=32;var KC,qC=function(){function e(){Te(this,e)}return Re(e,[{key:"toArray",value:function(){var e=Ht(Gt().mark((function e(){var t,n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new rT(this,e)}},{key:"filter",value:function(e){return new tT(this,e)}},{key:"map",value:function(e){return new nT(this,e)}},{key:"mapAsync",value:function(e){return new aT(this,e)}},{key:"serialMapAsync",value:function(e){return new aT(this,e).serial()}},{key:"flatmap",value:function(e){return new oT(this,e)}},{key:"forEachAsync",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new eT(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:BC;return this.rowMajorBatch(e,t).map((function(e){return LC(e,n)}))}},{key:"concatenate",value:function(e,t){return new sT(new XC([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new $C(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new JC(this,e)}},{key:"prefetch",value:function(e){return new uT(this,e)}},{key:"shuffle",value:function(e,t){return new cT(this,e,t)}},{key:"serial",value:function(){return new QC(this)}}]),e}(),XC=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).items=e,r.trav=0,r}return Re(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:WC(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),YC=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).nextFn=e,r}return Re(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),QC=function(e){Mo(n,e);var t=Uo(n);function n(e){var r;return Te(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),JC=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Qu(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),$C=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),eT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Te(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){var t,n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),tT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){var t;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:Qu(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),nT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=ds(t.value),r=this.transform(t.value),a=ds(r),i=Kt(n);try{for(i.s();!(o=i.n()).done;)ps(s=o.value,a)||s.dispose()}catch($Q){i.e($Q)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),rT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),aT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=ds(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=ds(r),i=Kt(n);try{for(i.s();!(o=i.n()).done;)ps(s=o.value,a)||s.dispose()}catch($Q){i.e($Q)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),iT=function(e){Mo(n,e);var t=Uo(n);function n(){var e;return Te(this,n),(e=t.call(this)).outputQueue=new jC,e.lastRead=Promise.resolve({value:null,done:!1}),e}return Re(n,[{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qC),oT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=ds(t.value),r=this.transform(t.value),a=ds(r),this.outputQueue.pushAll(r),i=Kt(n);try{for(i.s();!(o=i.n()).done;)ps(s=o.value,a)||s.dispose()}catch($Q){i.e($Q)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(iT),sT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return Re(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(qC);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(KC||(KC={}));var uT=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;return Te(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new GC(r),a}return Re(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(qC),cT=function(e){Mo(n,e);var t=Uo(n);function n(e,r,a){var i;return Te(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=id.alea(a||No().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return Re(n,[{key:"next",value:function(){var e=Ht(Gt().mark((function e(){var t=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=Ht(Gt().mark((function e(){var t,n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uT),lT=function(){function e(){Te(this,e),this.size=null}return Re(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return nn(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),hT(Ht(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,pT));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,hT(Ht(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,hT(Ht(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return Yu((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return hT(Ht(Gt().mark((function n(){return Gt().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return Yu((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return hT(Ht(Gt().mark((function n(){return Gt().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return hT(Ht(Gt().mark((function n(){return Gt().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,hT(Ht(Gt().mark((function t(){var r;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=HC(Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",ZC(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,hT(Ht(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=id.alea(t||No().toString());return hT(Ht(Gt().mark((function t(){var i;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,hT(Ht(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=Ht(Gt().mark((function e(){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function hT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){Mo(a,n);var r=Uo(a);function a(){var e;return Te(this,a),(e=r.apply(this,arguments)).size=t,e}return Re(a,[{key:"iterator",value:function(){var t=Ht(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(lT))}function pT(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof Jo||Ao(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Jo?Hd(e):Ds(e)}(e),recurse:!1}:{value:null,recurse:!0}}lT.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function dT(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&nn("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var fT=hf,mT=function(e){Mo(n,e);var t=Uo(n);function n(){var e;return Te(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new qt(zo(e),qu()),e}return Re(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,zn().get("IS_NODE")&&eo("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&bn(n[0])){var a=n.map((function(e){return Eo(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?vv(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):Nn(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Ro(e)}));return ju(e.shape,e.dtype,n)}catch(OK){throw new Error("Failed to decode encoded string bytes into utf-8")}return ju(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return qu().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=Ht(Gt().mark((function e(t){var n,r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=No(),t(),r=No()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){dT([e],"where");var t=this.readSync(e.dataId);return fT(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return Px(Po(n.prototype),"epsilon",this).call(this)}}]),n}(Xt);mT.nextDataId=0;function vT(e){return function(t,n,r){for(var a=vn(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function gT(e,t,n){return yT(e,vT(t),n)}function yT(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;dT(s,e);var u,c=o,l=c.data.get(s.dataId).values;if("string"===s.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Wv(l)}else u=l;var h=n||s.dtype,p=t(u,h,i);return c.makeTensorInfo(s.shape,h,p)}}ec("cpu",(function(){return new mT}),1);var bT=gT(Wr,(function(e){return e>=0?e:Math.exp(e)-1})),xT={kernelName:Wr,backendName:"cpu",kernelFunc:bT};function kT(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var wT={kernelName:aa,backendName:"cpu",kernelFunc:kT};function ST(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;dT([a],"leakyRelu");for(var o=on(a.shape),s=n.data.get(a.dataId).values,u=mn("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var IT={kernelName:la,backendName:"cpu",kernelFunc:ST};function CT(e){return function(t,n,r,a,i){var o=Ic(t,n),s=o.length,u=In(o),c=mn(i,on(o)),l=t.length,h=n.length,p=In(t),d=In(n),f=wc(t,o),m=wc(n,o);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],a[v%a.length]);else for(var g=function(){var t=Fn(y,s,u),n=t.slice(-l);f.forEach((function(e){return n[e]=0}));var i=On(n,l,p),o=t.slice(-h);m.forEach((function(e){return o[e]=0}));var v=On(o,h,d);c[y]=e(r[i],a[v])},y=0;y<c.length;++y)g();return[c,o]}}var TT=CT((function(e,t){return e<0?t*e:e}));function NT(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;dT([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=TT(r.shape,a.shape,i,o,"float32"),u=(0,E.Z)(s,2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var ET={kernelName:Ha,backendName:"cpu",kernelFunc:NT},RT=gT($a,(function(e){return Math.max(0,e)})),AT={kernelName:$a,backendName:"cpu",kernelFunc:RT},_T=gT(ii,(function(e){return Math.min(Math.max(0,e),6)})),OT={kernelName:ii,backendName:"cpu",kernelFunc:_T},FT=vT((function(e){return 1/(1+Math.exp(-e))})),DT=gT(yi,(function(e){return 1/(1+Math.exp(-e))})),MT={kernelName:yi,backendName:"cpu",kernelFunc:DT};function PT(e,t,n,r,a){if("linear"===n)return kT({inputs:{x:t},backend:e});if("relu"===n)return RT({inputs:{x:t},backend:e});if("elu"===n)return bT({inputs:{x:t},backend:e});if("relu6"===n)return _T({inputs:{x:t},backend:e});if("prelu"===n)return NT({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return ST({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return DT({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function LT(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var zT={kernelName:mr,backendName:"cpu",kernelFunc:LT};function BT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return LT({inputs:{real:BT(e,t,"float32"),imag:BT(e,t,"float32")},backend:e});var r=Rn(on(t),n);return e.makeTensorInfo(t,n,r)}function UT(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var WT={kernelName:Qa,backendName:"cpu",kernelFunc:UT};function VT(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=To([0],n),i=CT((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),o=(0,E.Z)(i,2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function GT(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return kT({inputs:{x:a},backend:n});var o=BT(n,a.shape,a.dtype),s=GT({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=LT({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=UT({inputs:{input:a},backend:n}),l=GT({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!gn(a.dtype,i)){var h=kT({inputs:{x:a},backend:n});return{dataId:h.dataId,shape:h.shape,dtype:i}}var p=VT(n.data.get(a.dataId).values,a.shape,a.dtype,i),d=(0,E.Z)(p,3),f=d[0],m=d[1],v=d[2];return n.makeTensorInfo(f,m,v)}var jT={kernelName:pr,backendName:"cpu",kernelFunc:GT};function HT(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;dT([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,h="string"===o.dtype?Wv(c):c,p="string"===o.dtype?Wv(l):l,d=r||o.dtype,f=t(o.shape,s.shape,h,p,d),m=(0,E.Z)(f,2),v=m[0],g=m[1];return u.makeTensorInfo(g,d,v)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=GT({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),h=l.complexTensorInfos.real,p=l.complexTensorInfos.imag,d=u.data.get(h.dataId).values,f=u.data.get(p.dataId).values,m=GT({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(m.dataId),g=v.complexTensorInfos.real,y=v.complexTensorInfos.imag,b=u.data.get(g.dataId).values,x=u.data.get(y.dataId).values,k=n(o.shape,s.shape,d,f,b,x),w=(0,E.Z)(k,3),S=w[0],I=w[1],C=w[2],T=u.makeTensorInfo(C,"float32",S),N=u.makeTensorInfo(C,"float32",I),R=LT({inputs:{real:T,imag:N},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(T),u.disposeIntermediateTensorInfo(N),R}var A=u.data.get(o.dataId).values,_=u.data.get(s.dataId).values,O=r||o.dtype,F=t(o.shape,s.shape,A,_,O),D=(0,E.Z)(F,2),M=D[0],P=D[1];return u.makeTensorInfo(P,O,M)}}function ZT(e){return function(t,n,r,a,i,o){var s=Ic(t,n),u=on(s),c=s.length,l=In(s),h=mn("float32",u),p=mn("float32",u),d=wc(t,s),f=wc(n,s),m=vv(r,a),v=vv(i,o),g=t.length,y=In(t),b=n.length,x=In(n);if(d.length+f.length===0)for(var k=0;k<h.length;k++){var w=k%m.length,S=k%v.length,I=e(m[2*w],m[2*w+1],v[2*S],v[2*S+1]);h[k]=I.real,p[k]=I.imag}else for(var C=function(){var t=Fn(T,c,l),n=t.slice(-g);d.forEach((function(e){return n[e]=0}));var r=On(n,g,y),a=t.slice(-b);f.forEach((function(e){return a[e]=0}));var i=On(a,b,x),o=e(m[2*r],m[2*r+1],v[2*i],v[2*i+1]);h[T]=o.real,p[T]=o.imag},T=0;T<h.length;T++)C();return[h,p,s]}}var KT=CT((function(e,t){return e+t})),qT=ZT((function(e,t,n,r){return{real:e+n,imag:t+r}})),XT=HT(Zn,KT,qT),YT={kernelName:Zn,backendName:"cpu",kernelFunc:XT};function QT(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=on(a.shape),s=pn(i,o),u=on(s);nn(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,h=c.complexTensorInfos.imag;l.shape=s,h.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var JT={kernelName:ei,backendName:"cpu",kernelFunc:QT};function $T(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;dT([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],h=s?i.shape[c-1]:i.shape[c-2],p=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],f=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=on(f),g=on(m),y=Ic(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,d]);nn(l===h,(function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(h,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var b=s?[g,d,h]:[g,h,d],x=QT({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,p]:[v,p,l]}}),k=QT({inputs:{x:i},backend:n,attrs:{shape:b}}),w=o?x.shape[1]:x.shape[2],S=o?x.shape[2]:x.shape[1],I=s?k.shape[1]:k.shape[2],C=Math.max(v,g),T=n.data.get(x.dataId).values,N=n.data.get(k.dataId).values,R=In(x.shape),A=In(k.shape),_=o?[R[0],1,R[1]]:[R[0],R[1],1],O=(0,E.Z)(_,3),F=O[0],D=O[1],M=O[2],P=s?[1,A[1],A[0]]:[A[1],1,A[0]],L=(0,E.Z)(P,3),z=L[0],B=L[1],U=L[2],W=S*I,V=ju([C,S,I],x.dtype),G=V.values,j=n.blockSize,H=0;H<C;H++)for(var Z=H%v,K=H%g,q=0;q<S;q+=j)for(var X=Math.min(q+j,S),Y=0;Y<I;Y+=j)for(var Q=Math.min(Y+j,I),J=0;J<w;J+=j)for(var $=Math.min(J+j,w),ee=q;ee<X;ee++)for(var te=Y;te<Q;te++){for(var ne=0,re=J;re<$;re++){ne+=T[Z*F+ee*D+re*M]*N[re*z+te*B+K*U]}G[H*W+(ee*I+te)]+=ne}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(y,V.dtype,V.values)}var eN={kernelName:sr,backendName:"cpu",kernelFunc:$T};var tN={kernelName:Qi,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,h=o.transposeA,p=o.transposeB,d=o.activation,f=o.leakyreluAlpha,m=[];t=$T({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:p},backend:i}),c&&(n=XT({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),d&&(r=PT(i,t,d,l,f),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}};function nN(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var rN={kernelName:Gn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;dT(t,"abs");var r=new Float32Array(on(t.shape));return r=nN(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},aN=gT(jn,(function(e){return Math.acos(e)})),iN={kernelName:jn,backendName:"cpu",kernelFunc:aN},oN=gT(Hn,(function(e){return Math.acosh(e)})),sN={kernelName:Hn,backendName:"cpu",kernelFunc:oN};var uN={kernelName:Kn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;dT(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=ju(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function cN(e,t,n,r,a){for(var i=t.length,o=on(t),s=In(t),u=In(a),c=mn(n,on(a)),l=0;l<o;++l){for(var h=Fn(l,i,s),p=new Array(h.length),d=0;d<p.length;d++)p[d]=h[r[d]];c[On(p,i,u)]=e[l]}return c}function lN(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;dT(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=cN(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var hN={kernelName:Gi,backendName:"cpu",kernelFunc:lN};var pN={kernelName:qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dT(a,"all");var s=dn(i,a.shape),u=s,c=Vh(u,a.shape.length),l=a;null!=c&&(l=lN({inputs:{x:a},backend:n,attrs:{perm:c}}),u=jh(u.length,a.shape.length)),Wh("all",u,l.shape.length);for(var h=Bh(l.shape,u),p=(0,E.Z)(h,2),d=p[0],f=on(p[1]),m=Rn(on(d),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var k=v[y+x];b=b&&k}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(d,l.dtype,m);if(o){var S=QT({inputs:{x:w},backend:n,attrs:{shape:Uh(d,s)}});return n.disposeIntermediateTensorInfo(w),S}return w}};var dN={kernelName:Xn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dT(a,"any");var s=dn(i,a.shape),u=s,c=Vh(u,a.shape.length),l=a;null!=c&&(l=lN({inputs:{x:a},backend:n,attrs:{perm:c}}),u=jh(u.length,a.shape.length)),Wh("any",u,l.shape.length);for(var h=Bh(l.shape,u),p=(0,E.Z)(h,2),d=p[0],f=on(p[1]),m=Rn(on(d),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var k=v[y+x];b=b||k}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(d,l.dtype,m);if(o){var S=QT({inputs:{x:w},backend:n,attrs:{shape:Uh(d,s)}});return n.disposeIntermediateTensorInfo(w),S}return w}};var fN={kernelName:Yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;dT(a,"argMax");var o=dn(i,a.shape),s=Vh(o,a.shape.length),u=a,c=[];null!=s&&(u=lN({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=jh(o.length,u.shape.length)),Wh("argMax",o=[o[0]],u.shape.length);for(var l=Bh(u.shape,o),h=(0,E.Z)(l,2),p=h[0],d=h[1],f=Rn(on(p),"int32"),m=on(d),v=n.data.get(u.dataId).values,g=0;g<f.length;++g){for(var y=g*m,b=v[y],x=0,k=0;k<m;++k){var w=v[y+k];w>b&&(b=w,x=k)}f[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",f)}};var mN={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;dT(a,"argMin");var o=dn(i,a.shape),s=Vh(o,a.shape.length),u=a,c=[];null!=s&&(u=lN({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=jh(o.length,u.shape.length)),Wh("argMin",o=[o[0]],u.shape.length);for(var l=Bh(u.shape,o),h=(0,E.Z)(l,2),p=h[0],d=h[1],f=Rn(on(p),"int32"),m=on(d),v=n.data.get(u.dataId).values,g=0;g<f.length;++g){for(var y=g*m,b=v[y],x=0,k=0;k<m;++k){var w=v[y+k];w<b&&(b=w,x=k)}f[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",f)}},vN=gT(Jn,(function(e){return Math.asin(e)})),gN={kernelName:Jn,backendName:"cpu",kernelFunc:vN},yN=gT($n,(function(e){return Math.asinh(e)})),bN={kernelName:$n,backendName:"cpu",kernelFunc:yN},xN=gT(er,(function(e){return Math.atan(e)})),kN={kernelName:er,backendName:"cpu",kernelFunc:xN},wN=CT((function(e,t){return Math.atan2(e,t)})),SN=HT(nr,wN),IN={kernelName:nr,backendName:"cpu",kernelFunc:SN},CN=gT(tr,(function(e){return Math.atanh(e)})),TN={kernelName:tr,backendName:"cpu",kernelFunc:CN};function NN(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,p=a.padInfo.top,d=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=ju(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],S=0;S<a.inChannels;++S)for(var I=0;I<a.outHeight;++I)for(var C=I*o-p,T=Math.max(0,C),N=Math.min(a.inHeight,l+C),E=k+I*y,R=0;R<a.outWidth;++R){for(var A=R*s-d,_=Math.max(0,A),O=Math.min(a.inWidth,h+A),F=f,D=0,M=0,P=T;P<N;P+=u){for(var L=w+P*r[1],z=_;z<O;z+=c){var B=e[L+z*r[2]+S];"max"===i&&B>F?F=B:"avg"===i&&(D+=B,M++)}if(isNaN(F))break}v[E+R*b+S]="avg"===i?D/M:F}return m}function EN(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=ju(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,m=ju(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,h+b),w=0;w<r.outWidth;++w){for(var S=w*u-f,I=S;I<0;)I+=l;for(var C=Math.min(r.inWidth,p+S),T=Number.NEGATIVE_INFINITY,N=-1,E=x;E<k;E+=c)for(var R=E-b,A=I;A<C;A+=l){var _=A-S,O=m.get(v,E,A,g);O>T&&(T=O,N=a?i?((v*r.inHeight+E)*r.inWidth+A)*r.inChannels+g:(E*r.inWidth+A)*r.inChannels+g:R*p+_)}o.set(N,v,y,w,g)}}return o}function RN(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,h=a.dilationWidth,p=a.effectiveFilterDepth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=ju(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],I=a.outShape[4],C=0;C<a.batchSize;++C)for(var T=C*k,N=C*r[0],E=0;E<a.inChannels;++E)for(var R=0;R<a.outDepth;++R){for(var A=R*o-m,_=A;_<0;)_+=c;for(var O=Math.min(a.inDepth,p+A),F=T+R*w,D=0;D<a.outHeight;++D){for(var M=D*s-v,P=M;P<0;)P+=l;for(var L=Math.min(a.inHeight,d+M),z=F+D*S,B=0;B<a.outWidth;++B){for(var U=B*u-g,W=U;W<0;)W+=h;for(var V=Math.min(a.inWidth,f+U),G=z+B*I,j=y,H=0,Z=0,K=_;K<O;K+=c){for(var q=N+K*r[1],X=P;X<L;X+=l){for(var Y=q+X*r[2],Q=W;Q<V;Q+=h){var J=e[Y+Q*r[3]+E];if("max"===i&&J>j?j=J:"avg"===i&&(H+=J,Z++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}x[G+E]="avg"===i?H/Math.max(Z,1):j}}}return b}var AN={kernelName:rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;dT(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;nn(Ul(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Al(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&sn(l.inShape,l.outShape))c=kT({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,p=In(a.shape),d=NN(h,a.shape,a.dtype,p,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var _N={kernelName:ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;dT(a,"avgPool3d");var l=_l(a.shape,i,o,1,s,u,c),h=RN(n.data.get(a.dataId).values,a.shape,a.dtype,In(a.shape),l,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};var ON={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;dT([a,i],"avgPool3DGrad");for(var l=_l(i.shape,o,s,1,u,c),h=l.strideDepth,p=l.strideHeight,d=l.strideWidth,f=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,S=x-1-l.padInfo.front,I=w-1-l.padInfo.left,C=k-1-l.padInfo.top,T=ju(i.shape,"float32"),N=1/(f*m*v),E=n.bufferSync(a),R=0;R<l.batchSize;++R)for(var A=0;A<l.inChannels;++A)for(var _=0;_<l.inDepth;++_)for(var O=0;O<l.inHeight;++O)for(var F=0;F<l.inWidth;++F){for(var D=_-S,M=O-C,P=F-I,L=0,z=0;z<x;z+=g){var B=(D+z)/h;if(!(B<0||B>=l.outDepth||Math.floor(B)!==B))for(var U=0;U<k;U+=y){var W=(M+U)/p;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var V=0;V<w;V+=b){var G=(P+V)/d;if(!(G<0||G>=l.outWidth||Math.floor(G)!==G))L+=E.get(R,B,W,G,A)}}}T.set(L*N,R,_,O,F,A)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var FN={kernelName:ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;dT([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Al(o.shape,s,u,1,c),h=l.strideHeight,p=l.strideWidth,d=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=ju(o.shape,"float32"),w=1/(d*f),S=n.data.get(a.dataId).values,I=ju(a.shape,"float32",S),C=0;C<l.batchSize;++C)for(var T=0;T<l.inChannels;++T)for(var N=0;N<l.inHeight;++N)for(var E=0;E<l.inWidth;++E){for(var R=N-x,A=E-b,_=0,O=0;O<g;O+=m){var F=(R+O)/h;if(!(F<0||F>=l.outHeight||Math.floor(F)!==F))for(var D=0;D<y;D+=v){var M=(A+D)/p;if(!(M<0||M>=l.outWidth||Math.floor(M)!==M))_+=I.get(C,F,M,T)}}k.set(_*w,C,N,E,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var DN={kernelName:$r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;nn(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),nn(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),nn(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),dT([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,p=n.data.get(u.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=f.length,g=d.length,y=p.length,b=h.length,x=0,k=0,w=0,S=0,I=0;I<l.length;++I)m[I]=f[x++]+(l[I]-h[k++])*d[w++]/Math.sqrt(p[S++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),S>=y&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};function MN(e,t,n,r,a){var i=pl(r,t,n),o=on(n),s=In(r);if(i){var u=dl(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=ju(r,a,"string"===a?Wv(e):e),l=ju(n,a),h=0;h<l.size;++h){var p=l.indexToLoc(h),d=p.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,(0,Lt.Z)(d))].concat((0,Lt.Z)(p)))}return"string"===a?Vv(l.values):l.values}function PN(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;dT(a,"slice");var s=fl(a,i,o),u=(0,E.Z)(s,2),c=u[0],l=u[1];ll(a,c,l);var h=MN(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,h)}var LN={kernelName:fi,backendName:"cpu",kernelFunc:PN};var zN={kernelName:ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;dT([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=nv(a.shape,i,s),c=rv(u.length,i.length),l=av(a.shape,i,s),h=iv(o,i.length),p=ov(l,o,i.length),d=QT({inputs:{x:a},backend:n,attrs:{shape:u}}),f=lN({inputs:{x:d},backend:n,attrs:{perm:c}}),m=QT({inputs:{x:f},backend:n,attrs:{shape:l}}),v=PN({inputs:{x:m},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};function BN(e,t,n,r,a){for(var i=on(r),o=Rn(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function UN(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=ju([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var WN={kernelName:cr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=BN(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}},VN=CT((function(e,t){return e&t})),GN=HT(lr,VN),jN={kernelName:lr,backendName:"cpu",kernelFunc:GN};var HN={kernelName:hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=Ic(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},ZN=vT((function(e){return Math.ceil(e)})),KN=yT(dr,ZN),qN={kernelName:dr,backendName:"cpu",kernelFunc:KN},XN=gT(fr,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),YN={kernelName:fr,backendName:"cpu",kernelFunc:XN},QN={kernelName:vr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(on(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],h=u[c];r[c]=Math.hypot(l,h)}return n.makeOutput(r,t.shape,"float32")}};function JN(e,t,n,r){var a=vn(n,on(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=on(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Wv(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}function $N(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var eE={kernelName:oa,backendName:"cpu",kernelFunc:$N};function tE(e){var t=e.inputs,n=e.backend,r=dn(e.attrs.axis,t[0].shape)[0];Km(t.map((function(e){return e.shape})),r);var a=qm(t.map((function(e){return e.shape})),r);if(0===on(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return on(e.shape)>0}));if(1===i.length)return kT({inputs:{x:i[0]},backend:n});if("complex64"===i[0].dtype){var o=i.map((function(e){return UT({inputs:{input:e},backend:n})})),s=i.map((function(e){return $N({inputs:{input:e},backend:n})})),u=tE({inputs:o,backend:n,attrs:{axis:r}}),c=tE({inputs:s,backend:n,attrs:{axis:r}}),l=LT({inputs:{real:u,imag:c},backend:n});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}var h=i.map((function(e){var t=on(e.shape.slice(r));return QT({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),p=h.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));a=qm(h.map((function(e){return e.shape})),1);var d=1===h[0].shape[0],f=JN(p,a,t[0].dtype,d),m=qm(i.map((function(e){return e.shape})),r),v=n.makeTensorInfo(m,t[0].dtype,f);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var nE={kernelName:gr,backendName:"cpu",kernelFunc:tE};function rE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;dT([a,i],"conv2d");for(var h=Vl(u),p=Ol(a.shape,i.shape,o,c,s,l,!1,h),d=p.filterHeight,f=p.filterWidth,m=p.dilationHeight,v=p.dilationWidth,g=p.padInfo.left,y=p.padInfo.top,b="channelsLast"===p.dataFormat,x=new Xo(p.outShape,a.dtype),k=In(a.shape),w=In(i.shape),S=k[0],I=b?k[1]:k[2],C=b?k[2]:1,T=b?1:k[1],N=x.strides[0],E=b?x.strides[1]:x.strides[2],R=b?x.strides[2]:1,A=b?1:x.strides[1],_=n.data.get(a.dataId).values,O=n.data.get(i.dataId).values,F=x.values,D=0;D<p.batchSize;++D)for(var M=D*S,P=D*N,L=0;L<p.outHeight;++L)for(var z=P+L*E,B=L*p.strideHeight-y,U=0;U<d;++U){var W=B+U*m;if(!(W<0||W>=p.inHeight))for(var V=U*w[0],G=M+W*I,j=0;j<p.outWidth;++j)for(var H=z+j*R,Z=j*p.strideWidth-g,K=0;K<f;++K){var q=Z+K*v;if(!(q<0||q>=p.inWidth))for(var X=G+q*C,Y=V+K*w[1],Q=0;Q<p.inChannels;++Q){for(var J=_[X+Q*T],$=0;$<p.outChannels;++$)F[H+$*A]+=J*O[Y+$];Y+=p.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,F)}var aE={kernelName:yr,backendName:"cpu",kernelFunc:rE};var iE={kernelName:br,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;dT([a,i],"conv2dBackpropFilter");for(var h=Vl(u),p=Ol(a.shape,l,o,1,s,c,!1,h),d=p.strideHeight,f=p.strideWidth,m=p.filterHeight,v=p.filterWidth,g="channelsLast"===p.dataFormat,y=new Xo(p.filterShape,"float32"),b=p.padInfo.left,x=p.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,S=new Xo(a.shape,a.dtype,k),I=new Xo(i.shape,i.dtype,w),C=0;C<m;++C)for(var T=Math.max(0,Math.ceil((x-C)/d)),N=Math.min(p.outHeight,(p.inHeight+x-C)/d),E=0;E<v;++E)for(var R=Math.max(0,Math.ceil((b-E)/f)),A=Math.min(p.outWidth,(p.inWidth+b-E)/f),_=0;_<p.inChannels;++_)for(var O=0;O<p.outChannels;++O){for(var F=0,D=0;D<p.batchSize;++D)for(var M=T;M<N;++M)for(var P=C+M*d-x,L=R;L<A;++L){var z=E+L*f-b;F+=g?S.get(D,P,z,_)*I.get(D,M,L,O):S.get(D,_,P,z)*I.get(D,O,M,L)}y.set(F,C,E,_,O)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var oE={kernelName:xr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;dT([a,i],"conv2dBackpropInput");var h=In(i.shape),p=In(a.shape),d=Vl(c),f=Ol(o,i.shape,s,1,u,l,!1,d),m=new Xo(f.inShape,"float32"),v=m.values,g=n.data.get(a.dataId).values,y=n.data.get(i.dataId).values,b=(0,E.Z)(h,3),x=b[0],k=b[1],w=b[2],S=f.batchSize,I=f.filterHeight,C=f.filterWidth,T=f.inChannels,N=f.inHeight,R=f.inWidth,A=f.outChannels,_=f.outHeight,O=f.outWidth,F=f.strideHeight,D=f.strideWidth;d=f.dataFormat;for(var M=I-1-f.padInfo.top,P=C-1-f.padInfo.left,L="channelsLast"===d,z=m.strides[0],B=L?m.strides[1]:m.strides[2],U=L?m.strides[2]:1,W=L?1:m.strides[1],V=p[0],G=L?p[1]:p[2],j=L?p[2]:1,H=L?1:p[1],Z=0;Z<S;++Z)for(var K=0;K<T;++K)for(var q=0;q<N;++q)for(var X=q-M,Y=Math.max(0,Math.ceil(X/F)),Q=Math.min(_,(I+X)/F),J=0;J<R;++J){for(var $=J-P,ee=Math.max(0,Math.ceil($/D)),te=Math.min(O,(C+$)/D),ne=0,re=Y;re<Q;++re)for(var ae=re*F-X,ie=ee;ie<te;++ie)for(var oe=V*Z+G*re+j*ie,se=x*(I-1-ae)+k*(C-1-(ie*D-$))+w*K,ue=0;ue<A;++ue){ne+=g[oe+H*ue]*y[se+ue]}v[z*Z+B*q+U*J+W*K]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var sE={kernelName:kr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;dT([a,i],"conv3d");for(var c=Fl(a.shape,i.shape,o,u,s),l=c.filterDepth,h=c.filterHeight,p=c.filterWidth,d=c.dilationDepth,f=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new Xo(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,S=x.values,I=In(a.shape),C=In(i.shape),T=0;T<c.batchSize;++T)for(var N=T*I[0],E=T*x.strides[0],R=0;R<c.outDepth;++R)for(var A=E+R*x.strides[1],_=R*c.strideDepth-g,O=0;O<l;++O){var F=_+O*d;if(!(F<0||F>=c.inDepth))for(var D=O*C[0],M=N+F*I[1],P=0;P<c.outHeight;++P)for(var L=A+P*x.strides[2],z=P*c.strideHeight-b,B=0;B<h;++B){var U=z+B*f;if(!(U<0||U>=c.inHeight))for(var W=D+B*C[1],V=M+U*I[2],G=0;G<c.outWidth;++G)for(var j=L+G*c.outChannels,H=G*c.strideWidth-y,Z=0;Z<p;++Z){var K=H+Z*m;if(!(K<0||K>=c.inWidth))for(var q=W+Z*C[2],X=V+K*c.inChannels,Y=q,Q=0;Q<c.inChannels;++Q){for(var J=k[X+Q],$=0;$<c.outChannels;++$)S[j+$]+=J*w[Y+$];Y+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var uE={kernelName:wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;dT([a,i],"conv3dBackpropFilterV2");for(var c=In(a.shape),l=In(i.shape),h=Fl(a.shape,u,o,1,s),p=h.strideDepth,d=h.strideHeight,f=h.strideWidth,m=h.filterDepth,v=h.filterHeight,g=h.filterWidth,y=new Xo(h.filterShape,"float32"),b=y.values,x=(0,E.Z)(y.strides,4),k=x[0],w=x[1],S=x[2],I=x[3],C=n.data.get(i.dataId).values,T=(0,E.Z)(l,4),N=T[0],R=T[1],A=T[2],_=T[3],O=n.data.get(a.dataId).values,F=(0,E.Z)(c,4),D=F[0],M=F[1],P=F[2],L=F[3],z=h.padInfo.front,B=h.padInfo.left,U=h.padInfo.top,W=0;W<m;++W)for(var V=Math.max(0,Math.ceil((z-W)/p)),G=Math.min(h.outDepth,(h.inDepth+z-W)/p),j=W*k,H=0;H<v;++H)for(var Z=Math.max(0,Math.ceil((U-H)/d)),K=Math.min(h.outHeight,(h.inHeight+U-H)/d),q=H*w+j,X=0;X<g;++X)for(var Y=Math.max(0,Math.ceil((B-X)/f)),Q=Math.min(h.outWidth,(h.inWidth+B-X)/f),J=X*S+q,$=0;$<h.inChannels;++$)for(var ee=$*I+J,te=0;te<h.outChannels;++te){for(var ne=0,re=0;re<h.batchSize;++re)for(var ae=re*D,ie=re*N,oe=V;oe<G;++oe)for(var se=(W+oe*p-z)*M+ae,ue=oe*R+ie,ce=Z;ce<K;++ce)for(var le=(H+ce*d-U)*P+se,he=ce*A+ue,pe=Y;pe<Q;++pe){var de=pe*_+he;ne+=O[(X+pe*f-B)*L+le+$]*C[de+te]}b[ee+te]=ne}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var cE={kernelName:Sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;dT([a],"conv3dBackpropInputV2");for(var c=In(a.shape),l=In(i.shape),h=Fl(u,i.shape,s,1,o),p=new Xo(h.inShape,"float32"),d=p.values,f=(0,E.Z)(p.strides,4),m=f[0],v=f[1],g=f[2],y=f[3],b=n.data.get(a.dataId).values,x=(0,E.Z)(c,4),k=x[0],w=x[1],S=x[2],I=x[3],C=n.data.get(i.dataId).values,T=(0,E.Z)(l,4),N=T[0],R=T[1],A=T[2],_=T[3],O=h.batchSize,F=h.filterDepth,D=h.filterHeight,M=h.filterWidth,P=h.inChannels,L=h.inDepth,z=h.inHeight,B=h.inWidth,U=h.outChannels,W=h.outDepth,V=h.outHeight,G=h.outWidth,j=h.strideDepth,H=h.strideHeight,Z=h.strideWidth,K=F-1-h.padInfo.front,q=D-1-h.padInfo.top,X=M-1-h.padInfo.left,Y=0;Y<O;++Y)for(var Q=0;Q<P;++Q)for(var J=0;J<L;++J)for(var $=J-K,ee=Math.max(0,Math.ceil($/j)),te=Math.min(W,(F+$)/j),ne=0;ne<z;++ne)for(var re=ne-q,ae=Math.max(0,Math.ceil(re/H)),ie=Math.min(V,(D+re)/H),oe=0;oe<B;++oe){for(var se=oe-X,ue=Math.max(0,Math.ceil(se/Z)),ce=Math.min(G,(M+se)/Z),le=0,he=ee;he<te;++he)for(var pe=he*j-$,de=ae;de<ie;++de)for(var fe=de*H-re,me=ue;me<ce;++me)for(var ve=k*Y+w*he+S*de+I*me,ge=N*(F-1-pe)+R*(D-1-fe)+A*(M-1-(me*Z-se))+_*Q,ye=0;ye<U;++ye){le+=b[ve+ye]*C[ge+ye]}d[m*Y+v*J+g*ne+y*oe+Q]=le}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},lE=gT(Ir,(function(e){return Math.cos(e)})),hE={kernelName:Ir,backendName:"cpu",kernelFunc:lE},pE=gT(Cr,(function(e){return Math.cosh(e)})),dE={kernelName:Cr,backendName:"cpu",kernelFunc:pE};var fE={kernelName:Er,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=(0,E.Z)(a.shape,4),h=l[0],p=l[1],d=l[2],f=l[3],m=i.shape[0],v=(0,E.Z)(s,2),g=v[0],y=v[1],b=ju([m,g,y,f],"float32"),x=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,w=n.data.get(a.dataId).values,S=In(a.shape),I=In(b.shape),C=0;C<m;C++){var T=4*C,N=x[T],R=x[T+1],A=x[T+2],_=x[T+3],O=k[C];if(!(O>=h))for(var F=g>1?(A-N)*(p-1)/(g-1):0,D=y>1?(_-R)*(d-1)/(y-1):0,M=0;M<g;M++){var P=g>1?N*(p-1)+M*F:.5*(N+A)*(p-1);if(P<0||P>p-1)for(var L=0;L<y;L++)for(var z=0;z<f;z++){var B=z+L*I[2]+M*I[1]+C*I[0];b.values[B]=c}else if("bilinear"===u)for(var U=Math.floor(P),W=Math.ceil(P),V=P-U,G=0;G<y;G++){var j=y>1?R*(d-1)+G*D:.5*(R+_)*(d-1);if(j<0||j>d-1)for(var H=0;H<f;H++){var Z=H+G*I[2]+M*I[1]+C*I[0];b.values[Z]=c}else for(var K=Math.floor(j),q=Math.ceil(j),X=j-K,Y=0;Y<f;Y++){var Q=Y+K*S[2]+U*S[1]+O*S[0],J=w[Q],$=w[Q=Y+q*S[2]+U*S[1]+O*S[0]],ee=w[Q=Y+K*S[2]+W*S[1]+O*S[0]],te=J+($-J)*X,ne=ee+(w[Q=Y+q*S[2]+W*S[1]+O*S[0]]-ee)*X;Q=Y+G*I[2]+M*I[1]+C*I[0],b.values[Q]=te+(ne-te)*V}}else for(var re=0;re<y;++re){var ae=y>1?R*(d-1)+re*D:.5*(R+_)*(d-1);if(ae<0||ae>d-1)for(var ie=0;ie<f;ie++){var oe=ie+re*I[2]+M*I[1]+C*I[0];b.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(P),ce=0;ce<f;ce++){var le=ce+se*S[2]+ue*S[1]+O*S[0],he=ce+re*I[2]+M*I[1]+C*I[0];b.values[he]=w[le]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var mE={kernelName:Tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;dT(a,"cumprod");var u=Vh([i],a.shape.length),c=a;null!=u&&(c=lN({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=jh(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var h=ss(c.dtype,"int32"),p=En(on(c.shape),h),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)p[y]=o?1:d[y];else{var b=m(v,g-1);p[y]=o?d[b]*p[b]:d[y]*p[b]}}var x=n.makeTensorInfo(c.shape,h,p);if(null!=u){var k=lN({inputs:{x:x},backend:n,attrs:{perm:Gh(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var vE={kernelName:Nr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;dT(a,"cumsum");var u=Vh([i],a.shape.length),c=a;null!=u&&(c=lN({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=jh(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var h=ss(c.dtype,"int32"),p=Rn(on(c.shape),h),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)p[y]=o?0:d[y];else{var b=m(v,g-1);p[y]=o?d[b]+p[b]:d[y]+p[b]}}var x=n.makeTensorInfo(c.shape,h,p);if(null!=u){var k=lN({inputs:{x:x},backend:n,attrs:{perm:Gh(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var gE={kernelName:Rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=BN(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=UN(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var yE={kernelName:Ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;nn("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],h=u*i,p=c*i,d=l/(i*i),f=n.data.get(a.dataId).values,m=new Float32Array(s*h*p*d),v=0,g=0;g<s;++g)for(var y=0;y<h;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<p;++k)for(var w=Math.floor(k/i),S=(x*i+k%i)*d,I=0;I<d;++I){var C=I+S+l*(w+c*(b+u*g));m[v++]=f[C]}return n.makeTensorInfo([s,h,p,d],a.dtype,m)}};function bE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;dT([a,i],"depthwiseConv2DNative");var l=In(a.shape),h=In(i.shape),p=u;null==p&&(p=[1,1]),nn(Ul(o,p),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(p,"'")}));for(var d=Ol(a.shape,i.shape,o,p,s,c,!0),f=d.filterHeight,m=d.filterWidth,v=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,x=y.top,k=d.outChannels/d.inChannels,w=new Xo(d.outShape,a.dtype),S=n.data.get(a.dataId).values,I=n.data.get(i.dataId).values,C=w.values,T=0;T<d.batchSize;++T)for(var N=T*l[0],E=T*w.strides[0],R=0;R<d.outHeight;++R)for(var A=E+R*w.strides[1],_=R*d.strideHeight-x,O=0;O<f;++O){var F=_+O*v;if(!(F<0||F>=d.inHeight))for(var D=O*h[0],M=N+F*l[1],P=0;P<d.outWidth;++P)for(var L=A+P*w.strides[2],z=P*d.strideWidth-b,B=0;B<m;++B){var U=z+B*g;if(!(U<0||U>=d.inWidth))for(var W=D+B*h[1],V=M+U*d.inChannels,G=L,j=W,H=0;H<d.inChannels;++H){for(var Z=S[V+H],K=0;K<k;++K)C[G+K]+=Z*I[j+K];G+=k,j+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var xE={kernelName:_r,backendName:"cpu",kernelFunc:bE};var kE={kernelName:Or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;dT([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=Ol(a.shape,l,o,s,u,c,!0),p=h.strideHeight,d=h.strideWidth,f=h.filterHeight,m=h.filterWidth,v=new Xo(h.filterShape,"float32"),g=h.padInfo.left,y=h.padInfo.top,b=h.outChannels/h.inChannels,x=n.data.get(a.dataId).values,k=new Xo(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,S=new Xo(i.shape,i.dtype,w),I=0;I<f;++I)for(var C=Math.max(0,Math.ceil((y-I)/p)),T=Math.min(h.outHeight,(h.inHeight+y-I)/p),N=0;N<m;++N)for(var E=Math.max(0,Math.ceil((g-N)/d)),R=Math.min(h.outWidth,(h.inWidth+g-N)/d),A=0;A<h.outChannels;++A){for(var _=Math.trunc(A/b),O=A%b,F=0,D=0;D<h.batchSize;++D)for(var M=C;M<T;++M)for(var P=I+M*p-y,L=E;L<R;++L){var z=N+L*d-g;F+=k.get(D,P,z,_)*S.get(D,M,L,A)}v.set(F,I,N,_,O)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var wE={kernelName:Fr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;dT([a,i],"depthwiseConv2DNativeBackpropInput");for(var h=In(a.shape),p=In(i.shape),d=Ol(l,i.shape,o,s,u,c,!0),f=new Xo(d.inShape,"float32"),m=f.values,v=(0,E.Z)(f.strides,3),g=v[0],y=v[1],b=v[2],x=n.data.get(a.dataId).values,k=(0,E.Z)(h,3),w=k[0],S=k[1],I=k[2],C=n.data.get(i.dataId).values,T=(0,E.Z)(p,3),N=T[0],R=T[1],A=T[2],_=d.batchSize,O=d.filterHeight,F=d.filterWidth,D=d.inChannels,M=d.inHeight,P=d.inWidth,L=d.outChannels,z=d.outHeight,B=d.outWidth,U=d.strideHeight,W=d.strideWidth,V=O-1-d.padInfo.top,G=F-1-d.padInfo.left,j=L/D,H=0;H<_;++H)for(var Z=0;Z<D;++Z)for(var K=0;K<M;++K)for(var q=K-V,X=Math.max(0,Math.ceil(q/U)),Y=Math.min(z,(O+q)/U),Q=0;Q<P;++Q){for(var J=Q-G,$=Math.max(0,Math.ceil(J/W)),ee=Math.min(B,(F+J)/W),te=0,ne=X;ne<Y;++ne)for(var re=ne*U-q,ae=$;ae<ee;++ae)for(var ie=w*H+S*ne+I*ae,oe=N*(O-1-re)+R*(F-1-(ae*W-J))+A*Z,se=0;se<j;++se){te+=x[ie+(Z*j+se)]*C[oe+se]}m[g*H+y*K+b*Q+Z]=te}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};var SE={kernelName:Dr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=on(r.shape),i=n.data.get(r.dataId).values,o=ju([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat((0,Lt.Z)(r.shape),(0,Lt.Z)(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},IE={kernelName:Mr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,h=a.shape.length,p=c.data.get(i.dataId).values,d=i.shape.length,f=Rl(a.shape,i.shape,o,s,"NHWC",u),m=f.batchSize,v=f.inHeight,g=f.inWidth,y=f.inChannels,b=f.outHeight,x=f.outWidth,k=f.padInfo,w=f.strideHeight,S=f.strideWidth,I=f.filterHeight,C=f.filterWidth,T=f.dilationHeight,N=f.dilationWidth,E=f.outShape,R=on(E),A=E.length,_=vn(a.dtype,R),O=0;O<m;++O)for(var F=0;F<b;++F)for(var D=F*w-k.top,M=0;M<x;++M)for(var P=M*S-k.left,L=0;L<y;++L){for(var z=Number.MIN_SAFE_INTEGER,B=0;B<I;++B){var U=D+B*T;if(U>=0&&U<v)for(var W=0;W<C;++W){var V=P+W*N;if(V>=0&&V<g){var G=On([O,U,V,L],h,In(a.shape)),j=On([B,W,L],d,In(i.shape)),H=l[G]+p[j];H>z&&(z=H)}}}_[On([O,F,M,L],A,In(E))]=z}return{dataId:c.write(To(_,a.dtype),E,a.dtype),shape:E,dtype:a.dtype}}},CE={kernelName:Lr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=Tn(a.shape,l.data.get(a.dataId).values),p=Tn(i.shape,l.data.get(i.dataId).values),d=Rl(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,S=d.filterHeight,I=d.filterWidth,C=d.dilationHeight,T=d.dilationWidth,N=d.outShape;nn(o.rank===N.length,(function(){return"Error in ".concat(Lr,", dy ")+"must have the same rank as output ".concat(N.length,", but got ")+"".concat(o.rank)}));for(var E=Tn(N,l.data.get(o.dataId).values),R=An(i.shape,i.dtype),A=0;A<f;++A)for(var _=0;_<y;++_)for(var O=_*k-x.top,F=0;F<b;++F)for(var D=F*w-x.left,M=0;M<g;++M){for(var P=Number.MIN_SAFE_INTEGER,L=0,z=0,B=0;B<S;++B){var U=O+B*C;if(U>=0&&U<m)for(var W=0;W<I;++W){var V=D+W*T;if(V>=0&&V<v){var G=h[A][U][V][M]+p[B][W][M];G>P&&(P=G,L=B,z=W)}}}R[L][z][M]+=E[A][_][F][M]}return{dataId:l.write(To(R,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},TE={kernelName:Pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=Tn(a.shape,l.data.get(a.dataId).values),p=Tn(i.shape,l.data.get(i.dataId).values),d=Rl(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,S=d.filterHeight,I=d.filterWidth,C=d.dilationHeight,T=d.dilationWidth,N=d.outShape;nn(o.rank===N.length,(function(){return"Error in ".concat(Pr,", dy ")+"must have the same rank as output ".concat(N.length,", but got ")+"".concat(o.rank)}));for(var E=Tn(N,l.data.get(o.dataId).values),R=An(a.shape,a.dtype),A=0;A<f;++A)for(var _=0;_<y;++_)for(var O=_*k-x.top,F=0;F<b;++F)for(var D=F*w-x.left,M=0;M<g;++M){for(var P=Number.MIN_SAFE_INTEGER,L=O<0?0:O,z=D<0?0:D,B=0;B<S;++B){var U=O+B*C;if(U>=0&&U<m)for(var W=0;W<I;++W){var V=D+W*T;if(V>=0&&V<v){var G=h[A][U][V][M]+p[B][W][M];G>P&&(P=G,L=U,z=V)}}}R[A][L][z][M]+=E[A][_][F][M]}return{dataId:l.write(To(R,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};var NE={kernelName:zr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.canvas,o=r.options||{},s=o.contextOptions,u=o.imageOptions,c=(null===u||void 0===u?void 0:u.alpha)||1,l=(null===s||void 0===s?void 0:s.contextType)||"2d";if("2d"!==l)throw new Error("Context type ".concat(s.contextType," is not supported by the CPU backend."));var h=i.getContext(l,(null===s||void 0===s?void 0:s.contextAttributes)||{});if(null==h)throw new Error("Could not get the context with ".concat(l," type."));for(var p=a.shape.slice(0,2),d=(0,E.Z)(p,2),f=d[0],m=d[1],v=2===a.shape.length?1:a.shape[2],g=n.data.get(a.dataId).values,y="float32"===a.dtype?255:1,b=new Uint8ClampedArray(m*f*4),x=0;x<f*m;++x){for(var k=[0,0,0,255*c],w=0;w<v;w++){var S=g[x*v+w];if("float32"===a.dtype){if(S<0||S>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(S,"."))}else if("int32"===a.dtype&&(S<0||S>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(S,"."));1===v?(k[0]=S*y,k[1]=S*y,k[2]=S*y):k[w]=S*y}var I=4*x;b[I+0]=Math.round(k[0]),b[I+1]=Math.round(k[1]),b[I+2]=Math.round(k[2]),b[I+3]=Math.round(k[3])}i.width=m,i.height=f;var C=new ImageData(b,m,f);return h.putImageData(C,0,0),a}},EE=CT((function(e,t){return e*t})),RE=ZT((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),AE=HT(Da,EE,RE),_E={kernelName:Da,backendName:"cpu",kernelFunc:AE};function OE(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;dT(i,"sum");var u=(t="bool"===i.dtype?GT({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):kT({inputs:{x:i},backend:r})).shape.length,c=dn(o,t.shape),l=Vh(c,u),h=c,p=t;null!=l&&(p=lN({inputs:{x:t},backend:r,attrs:{perm:l}}),h=jh(h.length,u)),Wh("sum",h,p.shape.length);for(var d=Bh(p.shape,h),f=(0,E.Z)(d,2),m=f[0],v=f[1],g=BT(r,m,ss(p.dtype,"int32")),y=on(v),b=r.data.get(g.dataId).values,x=r.data.get(p.dataId).values,k=0;k<b.length;++k){for(var w=k*y,S=0,I=0;I<y;++I)S+=x[w+I];b[k]=S}if(s){var C=g;g=QT({inputs:{x:g},backend:r,attrs:{shape:Uh(g.shape,c)}}),r.disposeIntermediateTensorInfo(C)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(p),g}var FE={kernelName:ki,backendName:"cpu",kernelFunc:OE};var DE={kernelName:Ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Iv(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;Tv(i.length,s,r);for(var u=Nv(o,s),c=u.path,l=u.steps,h=l.length,p=null,d=i.length,f=[],m=0;m<h;++m){var v,g=Kt(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Cv(d,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;Ev(x)?w=r[y]:(w=lN({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),f.push(w));for(var S=w.shape.slice(),I=0;I<k.length;++I)S.splice(k[I],0,1);sn(w.shape,S)||(w=QT({inputs:{x:w},backend:n,attrs:{shape:S}}),f.push(w)),null===p?p=w:(p=AE({inputs:{a:w,b:p},backend:n}),f.push(p))}}catch($Q){g.e($Q)}finally{g.f()}m<h-1&&(c[m]>=0&&(p=OE({inputs:{x:p},backend:n,attrs:{axis:c[m]-(i.length-d),keepDims:!1}}),f.push(p)),d--)}for(var C=0,T=f;C<T.length;C++){var N=T[C];N!==p&&n.disposeIntermediateTensorInfo(N)}return p}};var ME={kernelName:Vr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;dT([r,a],"eluGrad");for(var i=new Float32Array(on(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=0?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},PE=CT((function(e,t){return e===t?1:0})),LE=HT(jr,PE,null,"bool"),zE={kernelName:jr,backendName:"cpu",kernelFunc:LE},BE=gT(Gr,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),UE={kernelName:Gr,backendName:"cpu",kernelFunc:BE},WE=vT((function(e){return Math.exp(e)})),VE=yT(Hr,WE,"float32"),GE={kernelName:Hr,backendName:"cpu",kernelFunc:VE};function jE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(nn(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),QT({inputs:{x:a},backend:n,attrs:{shape:s}})}var HE={kernelName:Zr,backendName:"cpu",kernelFunc:jE},ZE=vT((function(e){return Math.expm1(e)})),KE=yT(Kr,ZE),qE={kernelName:Kr,backendName:"cpu",kernelFunc:KE},XE=CT((function(e,t){return e/t})),YE=HT(Br,XE),QE={kernelName:Br,backendName:"cpu",kernelFunc:YE},JE=CT((function(e,t){return e-t})),$E=ZT((function(e,t,n,r){return{real:e-n,imag:t-r}})),eR=HT(Li,JE,$E),tR={kernelName:Li,backendName:"cpu",kernelFunc:eR};function nR(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=on(c),h=mn("float32",l),p=mn("float32",l),d=0;d<a;d++){for(var f=PN({inputs:{x:s},backend:n,attrs:{begin:[d,0],size:[1,i]}}),m=PN({inputs:{x:u},backend:n,attrs:{begin:[d,0],size:[1,i]}}),v=LT({inputs:{real:f,imag:m},backend:n}),g=rR(v,t,n),y=vv(g.real,g.imag),b=0;b<i;b++){var x=gv(y,b);h[d*i+b]=x.real,p[d*i+b]=x.imag}n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var k=n.makeTensorInfo(c,"float32",h),w=n.makeTensorInfo(c,"float32",p),S=LT({inputs:{real:k,imag:w},backend:n});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),S}function rR(e,t,n){var r=on(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var s=aR(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),h=n.makeTensorInfo([],"float32",Co(r,"float32")),p=kT({inputs:{x:h},backend:n}),d=QE.kernelFunc({inputs:{a:c,b:h},backend:n}),f=QE.kernelFunc({inputs:{a:l,b:p},backend:n}),m=n.data.get(d.dataId).values,v=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),{real:m,imag:v}}return s}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=bv(a*s,t,n),c=gv(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),yv(r,i,o,a)}return r}(vv(i,o),r,t);return function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(y)}function aR(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=vv(e,t),o=n/2,s=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),u=s.real,c=s.imag,l=[u.length],h=a.makeTensorInfo(l,"float32",u),p=a.makeTensorInfo(l,"float32",c),d=LT({inputs:{real:h,imag:p},backend:a}),f=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),m=f.real,v=f.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=LT({inputs:{real:y,imag:b},backend:a}),k=aR(u,c,o,r,a),w=k.real,S=k.imag,I=[w.length],C=a.makeTensorInfo(I,"float32",w),T=a.makeTensorInfo(I,"float32",S),N=LT({inputs:{real:C,imag:T},backend:a}),E=aR(m,v,o,r,a),R=E.real,A=E.imag,_=[R.length],O=a.makeTensorInfo(_,"float32",R),F=a.makeTensorInfo(_,"float32",A),D=LT({inputs:{real:O,imag:F},backend:a}),M=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(n,r),P=[M.real.length],L=a.makeTensorInfo(P,"float32",M.real),z=a.makeTensorInfo(P,"float32",M.imag),B=LT({inputs:{real:L,imag:z},backend:a}),U=AE({inputs:{a:B,b:D},backend:a}),W=XT({inputs:{a:N,b:U},backend:a}),V=eR({inputs:{a:N,b:U},backend:a}),G=UT({inputs:{input:W},backend:a}),j=UT({inputs:{input:V},backend:a}),H=$N({inputs:{input:W},backend:a}),Z=$N({inputs:{input:V},backend:a}),K=tE({inputs:[G,j],backend:a,attrs:{axis:0}}),q=tE({inputs:[H,Z],backend:a,attrs:{axis:0}}),X=a.data.get(K.dataId).values,Y=a.data.get(q.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(q),{real:X,imag:Y}}var iR={kernelName:qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=on(r.shape),i=r.shape[r.shape.length-1],o=QT({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=nR(o,!1,n),u=QT({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function oR(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||kn(a),o=vn(i,on(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var sR={kernelName:Xr,backendName:"cpu",kernelFunc:oR};var uR={kernelName:Yr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=mn(r.dtype,on(r.shape)),o=(0,E.Z)(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],h=a.data.get(r.dataId).values,p=0;p<s;p++)for(var d=p*c*u*l,f=0;f<u;f++)for(var m=f*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var b=Math.round(c-v-1),x=d+m+g+y,k=h[x];if(b>=0&&b<c)k=h[d+m+b*l+y];i[x]=k}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},cR=vT((function(e){return Math.floor(e)})),lR=yT(Qr,cR),hR={kernelName:Qr,backendName:"cpu",kernelFunc:lR},pR=CT((function(e,t){return Math.floor(e/t)})),dR=HT(Jr,pR,null,"int32"),fR={kernelName:Jr,backendName:"cpu",kernelFunc:dR};var mR={kernelName:Ji,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=rE({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=QT({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=XT({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=XT({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(d){var y=m;if("NCHW"===l&&"prelu"===d&&1===s.shape.length&&1!==s.shape[0]){var b=QT({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=PT(n,m,d,b,f),n.disposeIntermediateTensorInfo(b)}else m=PT(n,m,d,s,f);n.disposeIntermediateTensorInfo(y)}return m}};var vR={kernelName:$i,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=bE({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){var v=m;m=XT({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){var g=m;m=PT(n,m,d,s,f),n.disposeIntermediateTensorInfo(g)}return m}};function gR(e,t,n,r,a,i,o,s,u){for(var c=ju([r,i],n),l=0;l<r;l++){for(var h=[],p=0,d=0;d<a;d++){var f=e[l*a+d];p+=f*o[d],h.push(f)}if(p<0||p>=u/i)throw new Error("Invalid indices: ".concat(h," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,(0,Lt.Z)(t.indexToLoc(p*i+m)))}return c}var yR={kernelName:ta,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=on(r.shape),o=a.shape,s=o[o.length-1],u=sv(r,a),c=(0,E.Z)(u,4),l=c[0],h=c[1],p=c[2],d=c[3];if(0===h)return n.makeTensorInfo(l,r.dtype,[]);var f=gR(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,h,s,p,d,r.shape,i);return n.makeTensorInfo(l,r.dtype,f.values)}};function bR(e,t,n){for(var r=ju(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var xR={kernelName:ea,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;dT([a,i],"gatherV2");for(var u=dn(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],h=function(){var e=c[p];nn(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},p=0;p<c.length;++p)h();var d=s;null==s&&(d=0);var f=on(i.shape),m=Uv(a,i,u,d),v=QT({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=QT({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),y=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=bR(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}},kR=CT((function(e,t){return e>t?1:0})),wR=HT(na,kR,null,"bool"),SR={kernelName:na,backendName:"cpu",kernelFunc:wR},IR=CT((function(e,t){return e>=t?1:0})),CR=HT(ra,IR,null,"bool"),TR={kernelName:ra,backendName:"cpu",kernelFunc:CR};var NR={kernelName:ia,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=on(r.shape),i=r.shape[r.shape.length-1],o=QT({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=nR(o,!0,n),u=QT({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},ER=gT(sa,(function(e){return Number.isFinite(e)?1:0}),"bool"),RR={kernelName:sa,backendName:"cpu",kernelFunc:ER},AR=gT(ua,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),_R={kernelName:ua,backendName:"cpu",kernelFunc:AR},OR=gT(ca,(function(e){return Number.isNaN(e)?1:0}),"bool"),FR={kernelName:ca,backendName:"cpu",kernelFunc:OR},DR=CT((function(e,t){return e<t?1:0})),MR=HT(ha,DR,null,"bool"),PR={kernelName:ha,backendName:"cpu",kernelFunc:MR},LR=CT((function(e,t){return e<=t?1:0})),zR=HT(pa,LR,null,"bool"),BR={kernelName:pa,backendName:"cpu",kernelFunc:zR};function UR(e,t,n){var r=(t-e)/(n-1),a=Rn(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var WR={kernelName:da,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=UR(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},VR=vT((function(e){return Math.log(e)})),GR=yT(fa,VR),jR={kernelName:fa,backendName:"cpu",kernelFunc:GR},HR=gT(ma,(function(e){return Math.log1p(e)})),ZR={kernelName:ma,backendName:"cpu",kernelFunc:HR},KR=CT((function(e,t){return e&&t})),qR=HT(va,KR,null,"bool"),XR={kernelName:va,backendName:"cpu",kernelFunc:qR},YR=gT(ga,(function(e){return e?0:1}),"bool"),QR={kernelName:ga,backendName:"cpu",kernelFunc:YR},JR=CT((function(e,t){return e||t})),$R=HT(ya,JR,null,"bool"),eA={kernelName:ya,backendName:"cpu",kernelFunc:$R};var tA={kernelName:ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;dT(a,"LRN");var c=a.shape[3],l=c-1,h=n.data.get(a.dataId).values,p=on(a.shape),d=new Float32Array(p);function f(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=h[n];a+=o*o}return a}for(var m=0;m<p;m++){var v=f(m),g=h[m]*Math.pow(o+s*v,-u);d[m]=g}return n.makeTensorInfo(a.shape,a.dtype,d)}};var nA={kernelName:xa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;dT(o,"LRNGrad");for(var h=on(o.shape),p=o.shape[3],d=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(h),g=h,y=0;y<g;y++){for(var b=y%p,x=y-b+Math.max(0,b-s),k=y-b+Math.min(p,b+s+1),w=0,S=x;S<k;S++)w+=Math.pow(f[S],2);w=c*w+u;for(var I=x;I<k;I++){var C=-2*c*l*f[I]*m[y]/w;y===I&&(C+=Math.pow(w,-l)),C*=d[y],v[I]+=C}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function rA(e,t,n,r){for(var a=mn(r,on(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}function aA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=dn(i,u),h=l,p=Vh(h,c),d=s.data.get(a.dataId).values;if(null!=p){for(var f=new Array(c),m=0;m<f.length;m++)f[m]=u[p[m]];d=cN(d,u,a.dtype,p,f),h=jh(h.length,c),u=f}dT(a,"max"),Wh("max",h,c);var v=Bh(u,h),g=(0,E.Z)(v,2),y=g[0],b=rA(d,on(g[1]),y,a.dtype),x=s.write(b,y,a.dtype),k=y;o&&(k=Uh(y,l));return{dataId:x,shape:k,dtype:a.dtype}}var iA={kernelName:ka,backendName:"cpu",kernelFunc:aA},oA=CT((function(e,t){return Math.max(e,t)})),sA=HT(wa,oA),uA={kernelName:wa,backendName:"cpu",kernelFunc:sA};var cA={kernelName:Sa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;dT(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;nn(Ul(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Al(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&sn(l.inShape,l.outShape))c=kT({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,p=In(a.shape),d=NN(h,a.shape,a.dtype,p,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var lA={kernelName:Ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;dT(a,"maxPool3d");var l=_l(a.shape,i,o,1,s,u,c),h=RN(n.data.get(a.dataId).values,a.shape,a.dtype,In(a.shape),l,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};var hA={kernelName:Ta,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;dT([a,i],"maxPool3DGrad");for(var l=_l(i.shape,o,s,1,u,c),h=function(e,t){for(var n=ju(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,d=t.padInfo.top,f=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-p,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-d,S=w;S<0;)S+=s;for(var I=Math.min(t.inHeight,l+w),C=0;C<t.outWidth;++C){for(var T=C*i-f,N=T;N<0;)N+=u;for(var E=Math.min(t.inWidth,h+T),R=Number.NEGATIVE_INFINITY,A=-1,_=b;_<x;_+=o)for(var O=_-y,F=S;F<I;F+=s)for(var D=F-w,M=N;M<E;M+=u){var P=M-T,L=e.get(m,_,F,M,v);L>=R&&(R=L,A=O*l*h+D*l+P)}n.set(A,m,g,k,C,v)}}}return n}(n.bufferSync(i),l),p=l.strideDepth,d=l.strideHeight,f=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,S=b-1-l.padInfo.top,I=ju(i.shape,"float32"),C=n.bufferSync(a),T=0;T<l.batchSize;++T)for(var N=0;N<l.inChannels;++N)for(var E=0;E<l.inDepth;++E)for(var R=0;R<l.inHeight;++R)for(var A=0;A<l.inWidth;++A){for(var _=E-k,O=R-S,F=A-w,D=0,M=0;M<y;M+=m){var P=(_+M)/p;if(!(P<0||P>=l.outDepth||Math.floor(P)!==P))for(var L=0;L<b;L+=v){var z=(O+L)/d;if(!(z<0||z>=l.outHeight||Math.floor(z)!==z))for(var B=0;B<x;B+=g){var U=(F+B)/f;if(!(U<0||U>=l.outWidth||Math.floor(U)!==U)){var W=y*b*x-1-h.get(T,P,z,U,N)===M*b*x+L*x+B?1:0;if(0!==W)D+=C.get(T,P,z,U,N)*W}}}}I.set(D,T,E,R,A,N)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var pA={kernelName:Ia,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;dT([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=Al(o.shape,s,u,1,c,l),p=n.data.get(o.dataId).values,d=ju(h.outShape,o.dtype,EN(p,o.shape,o.dtype,h).values),f=h.strideHeight,m=h.strideWidth,v=h.dilationHeight,g=h.dilationWidth,y=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,k=y-1-h.padInfo.top,w=ju(o.shape,"float32"),S=n.data.get(a.dataId).values,I=ju(a.shape,"float32",S),C=0;C<h.batchSize;++C)for(var T=0;T<h.inChannels;++T)for(var N=0;N<h.inHeight;++N)for(var E=0;E<h.inWidth;++E){for(var R=N-k,A=E-x,_=0,O=0;O<y;O+=v){var F=(R+O)/f;if(!(F<0||F>=h.outHeight||Math.floor(F)!==F))for(var D=0;D<b;D+=g){var M=(A+D)/m;if(!(M<0||M>=h.outWidth||Math.floor(M)!==M)){var P=y*b-1-d.get(C,F,M,T)===O*b+D?1:0;if(0!==P)_+=I.get(C,F,M,T)*P}}}w.set(_,C,N,E,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var dA={kernelName:Na,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;dT(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,h=Al(a.shape,i,o,[1,1],s),p=function(e,t,n,r,a){var i=NN(e,0,n,In(t),a,"max"),o=EN(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,h),d=(0,E.Z)(p,2),f=d[0],m=d[1],v=c.write(f,h.outShape,a.dtype),g=c.write(m,h.outShape,a.dtype);return[{dataId:v,shape:h.outShape,dtype:a.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}};var fA={kernelName:Ea,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=dn(i,a.shape),u=on(Bh(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var h=GT({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(h);var p=YE({inputs:{a:h,b:l},backend:n});c.push(p);var d=OE({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}};var mA={kernelName:Ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dT(a,"min");var s=dn(i,a.shape),u=s,c=Vh(u,a.shape.length),l=a;null!=c&&(l=lN({inputs:{x:a},backend:n,attrs:{perm:c}}),u=jh(u.length,a.shape.length)),Wh("min",u,l.shape.length);for(var h=Bh(l.shape,u),p=(0,E.Z)(h,2),d=p[0],f=on(p[1]),m=Rn(on(d),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var k=v[y+x];(Number.isNaN(k)||k<b)&&(b=k)}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(d,l.dtype,m);if(o){var S=QT({inputs:{x:w},backend:n,attrs:{shape:Uh(d,s)}});return n.disposeIntermediateTensorInfo(w),S}return w}},vA=CT((function(e,t){return Math.min(e,t)})),gA=HT(Aa,vA),yA={kernelName:Aa,backendName:"cpu",kernelFunc:gA};var bA={kernelName:_a,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;dT(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,h=n.data.get(a.dataId).values,p=a.shape.length,d=In(a.shape),f=on(s),m=s.length,v=In(s),g=mn(a.dtype,f),y=0;y<f;y++){for(var b=Fn(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=On(b,p,d);g[y]=h[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},xA=CT((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),kA=HT(Oa,xA),wA={kernelName:Oa,backendName:"cpu",kernelFunc:kA};function SA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=dn([s],a.shape),c=aA({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=Uh(c.shape,u),h=QT({inputs:{x:c},backend:n,attrs:{shape:l}}),p=eR({inputs:{a:a,b:h},backend:n}),d=VE({inputs:{x:p},backend:n}),f=OE({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),m=QT({inputs:{x:f},backend:n,attrs:{shape:l}}),v=YE({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}var IA={kernelName:Ii,backendName:"cpu",kernelFunc:SA};var CA={kernelName:Fa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;dT(a,"multinomial");for(var u=s?a:SA({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],h=n.data.get(u.dataId).values,p=[c,i],d=Rn(on(p),"int32"),f=0;f<c;++f){var m=f*l,v=new Float32Array(l-1);v[0]=h[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+h[m+g];for(var y=id.alea(o.toString()),b=f*i,x=0;x<i;++x){var k=y();d[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){d[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",d)}};function TA(e,t,n){var r=Co(-1,n);return EE([],t,r,e,n)}var NA={kernelName:Ma,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;dT(r,"neg");var a=TA(n.data.get(r.dataId).values,r.shape,r.dtype),i=(0,E.Z)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},EA=qf;var RA={kernelName:La,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;dT(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,h=EA(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},AA=Xf;var _A={kernelName:za,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;dT(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,p=AA(l,h,o,s,u,c),d=p.selectedIndices,f=p.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},OA=Yf;var FA={kernelName:Ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;dT(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,p=OA(l,h,o,s,u,c),d=p.selectedIndices,f=p.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},DA=CT((function(e,t){return e!==t?1:0})),MA=HT(Pa,DA,null,"bool"),PA={kernelName:Pa,backendName:"cpu",kernelFunc:MA};var LA={kernelName:Wa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;dT(a,"oneHot");var c=on(a.shape),l=new Float32Array(c*o);l.fill(u);for(var h=n.data.get(a.dataId).values,p=0;p<c;++p)h[p]>=0&&h[p]<o&&(l[p*o+h[p]]=s);return n.makeTensorInfo([].concat((0,Lt.Z)(a.shape),[o]),i,l)}};function zA(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=UT({inputs:{input:r},backend:n}),i=zA({inputs:{x:a},backend:n}),o=$N({inputs:{input:r},backend:n}),s=zA({inputs:{x:o},backend:n}),u=LT({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return oR({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var BA={kernelName:Ki,backendName:"cpu",kernelFunc:zA};var UA={kernelName:Ua,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=UT({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=$N({inputs:{input:a},backend:r}),u=zA({inputs:{x:s},backend:r}),c=LT({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return oR({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function WA(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return jE({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){rn(a,e.shape,"All tensors passed to stack must have matching shapes"),nn(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=tE({inputs:t.map((function(e){var t=jE({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var VA={kernelName:Va,backendName:"cpu",kernelFunc:WA};var GA={kernelName:Ga,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;dT(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=on(a.shape),h=a.shape.length,p=In(a.shape),d=on(s),f=s.length,m=In(s),v=mn(a.dtype,d);0!==o&&v.fill(o);for(var g=0;g<l;g++){var y=Fn(g,h,p).map((function(e,t){return e+u[t]}));v[On(y,f,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},jA=CT((function(e,t){return Math.pow(e,t)})),HA=HT(ja,jA),ZA={kernelName:ja,backendName:"cpu",kernelFunc:HA};function KA(e,t,n,r){for(var a=Bh(e,r),i=(0,E.Z)(a,2),o=i[0],s=i[1],u=ss(t,"int32"),c=Rn(on(o),u),l=on(s),h=0;h<c.length;++h){for(var p=h*l,d=1,f=0;f<l;++f)d*=n[p+f];c[h]=d}return{outVals:c,outShape:o,outDtype:u}}var qA={kernelName:Za,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;dT(a,"prod");var s=a.shape.length,u=dn(i,a.shape),c=Vh(u,s),l=u,h=a,p=[];null!=c&&(h=lN({inputs:{x:a},backend:n,attrs:{perm:c}}),p.push(h),l=jh(l.length,s));var d=n.data.get(h.dataId).values,f=KA(h.shape,h.dtype,d,l),m=f.outVals,v=f.outShape,g=f.outDtype,y=v;return o&&(y=Uh(v,u)),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function XA(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],h=1;h<u+1;++h)s[c].push(h*l)}for(var p=0;p<e.length;++p){for(var d=e[p],f=e[p]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[d],x=d;x<f;++x)s[g].push(v[x+1]+b);d=v[d],f=v[f]}f!==d&&(a.push([d,f]),i+=f-d)}return{outSplits:s,valueSlices:a,numValues:i}}function YA(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function QA(e,t,n,r,a){var i=t.slice();i[0]=a;var o=vn(n,on(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=YA(t,2)[1],u=YA(i,2)[1],c=0,l=Kt(n);try{for(l.s();!(o=l.n()).done;)for(var h=o.value,p=h[0];p<h[1];++p){for(var d=0;d<r;++d)a[c*u+d]=e[p*s+d];++c}}catch($Q){l.e($Q)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function JA(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Fn(r,t.length,In(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=XA(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,h=u.numValues,p=function(e){for(var t=[],n=function(){var n=vn("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(c),d=QA(n,r,a,l,h);return[p,d[0],d[1]]}var $A={kernelName:Ka,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),u=a.map((function(e){return e.shape})),c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,h=JA(s,u,c,i.shape,i.dtype,l,o.shape),p=(0,E.Z)(h,3),d=p[0],f=p[1],m=p[2],v=d.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(m,i.dtype,f);return v.concat([g])}},e_=2147483647;function t_(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var h=1;h<l.length;++h)if(l[h]!==l[h-1])throw new Error("starts, limits, and deltas must have the same shape");var p=0===l.length?1:l[0],d=vn("int32",p+1);d[0]=0;for(var f=0;f<p;++f){var m=s?e[0]:e[f],v=u?r[0]:r[f],g=c?i[0]:i[f];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if((y=Math.ceil(Math.abs((v-m)/g)))>e_)throw new Error("Requires ((limit - start) / delta) <= ".concat(e_));d[f+1]=d[f]+y}for(var b=vn(n,d[p]),x=0,k=0;k<p;++k)for(var w=d[k+1]-d[k],S=s?e[0]:e[k],I=c?i[0]:i[k],C=0;C<w;++C)b[x++]=S,S+=I;return[d,b]}var n_={kernelName:qa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=t_(o,r.shape,r.dtype,s,a.shape,u,i.shape),l=(0,E.Z)(c,2),h=l[0],p=l[1];return[n.makeTensorInfo([h.length],"int32",h),n.makeTensorInfo([p.length],r.dtype,p)]}},r_=Dm,a_=function(){function e(t,n,r,a,i,o,s,u,c,l){Te(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Ym(l),this.raggedRank=Qm(this.rowPartitionTypes)}return Re(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===r_.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===r_.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case r_.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case r_.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(r_[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return o_(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;Jm(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=Xm(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(var a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return nn(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var h=0;h<s-u;++h)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case r_.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case r_.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(r_[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case r_.FIRST_DIM_SIZE:return e[0];case r_.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case r_.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(r_[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=o_(t,!1),i=vn(this.valuesDType,on(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s){o=this.calculateOutputIndex(s-1,o,n[s],t[s])}this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=on(o=o.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;Yu((function(){var e=jl(c,l),t=sh(e,o);c=t.dataSync()}))}for(var h=0,p=0,d=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==d){if(p<d){var v=a.subarray(h*s);i_(i.subarray(p*s),v,(d-p)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>d)if(1===this.defaultValue.length)i.subarray(d*s,m*s).fill(this.defaultValue[0]),d=m;else for(;m>d;){i_(i.slice(d*s),c,s),++d}m<0?(h=f+1,p=d):(h=f,d=(p=d)+1)}else++d}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function i_(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function o_(e,t){var n,r=[],a=Kt(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch($Q){a.e($Q)}finally{a.f()}return r}function s_(e,t,n,r,a,i,o,s,u,c){return new a_(e,t,n,r,a,i,o,s,u,c).compute()}var u_={kernelName:Xa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,p=s.map((function(e){return n.data.get(e.dataId).values})),d=s.map((function(e){return e.shape})),f=s_(c,a.shape,l,i.shape,i.dtype,h,o.shape,p,d,u),m=(0,E.Z)(f,2),v=m[0],g=m[1];return n.makeTensorInfo(v,i.dtype,g)}};function c_(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Rn(0,r);var a=Rn(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var l_={kernelName:Ya,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=c_(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},h_=gT(Ja,(function(e){return 1/e})),p_={kernelName:Ja,backendName:"cpu",kernelFunc:h_};var d_={kernelName:ri,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;dT(a,"resizeBilinear");for(var u=In(a.shape),c=(0,E.Z)(s,2),l=c[0],h=c[1],p=(0,E.Z)(a.shape,4),d=p[0],f=p[1],m=p[2],v=p[3],g=n.data.get(a.dataId).values,y=new Float32Array(on([d,l,h,v])),b=[i&&l>1?f-1:f,i&&h>1?m-1:m],x=[i&&l>1?l-1:l,i&&h>1?h-1:h],k=0,w=b[0]/x[0],S=b[1]/x[1],I=0;I<d;I++)for(var C=0;C<l;C++){var T=void 0;T=o?w*(C+.5)-.5:w*C;for(var N=Math.max(0,Math.floor(T)),R=T-N,A=Math.min(f-1,Math.ceil(T)),_=I*u[0]+N*u[1],O=I*u[0]+A*u[1],F=0;F<h;F++){var D=void 0;D=o?S*(F+.5)-.5:S*F;for(var M=Math.max(0,Math.floor(D)),P=D-M,L=Math.min(m-1,Math.ceil(D)),z=_+M*u[2],B=O+M*u[2],U=_+L*u[2],W=O+L*u[2],V=0;V<v;V++){var G=g[z+V],j=g[B+V],H=G+(g[U+V]-G)*P,Z=H+(j+(g[W+V]-j)*P-H)*R;y[k++]=Z}}}return n.makeTensorInfo([d,l,h,v],"float32",y)}};var f_={kernelName:ai,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;dT([i,a],"resizeBilinearGrad");for(var s=In(a.shape),u=(0,E.Z)(a.shape,4),c=u[0],l=u[1],h=u[2],p=u[3],d=(0,E.Z)(i.shape,3),f=d[1],m=d[2],v=new Float32Array(c*l*h*p),g=[o&&f>1?l-1:l,o&&m>1?h-1:h],y=[o&&f>1?f-1:f,o&&m>1?m-1:m],b=g[0]/y[0],x=g[1]/y[1],k=n.data.get(i.dataId).values,w=0,S=0;S<c;S++)for(var I=S*s[0],C=0;C<f;C++)for(var T=C*b,N=Math.floor(T),R=Math.min(Math.ceil(T),l-1),A=I+N*s[1],_=I+R*s[1],O=T-N,F=1-O,D=0;D<m;D++)for(var M=D*x,P=Math.floor(M),L=Math.min(Math.ceil(M),h-1),z=M-P,B=1-z,U=A+P*s[2],W=A+L*s[2],V=_+P*s[2],G=_+L*s[2],j=F*B,H=F*z,Z=O*B,K=O*z,q=0;q<p;q++){var X=k[w++];v[U+q]+=X*j,v[W+q]+=X*H,v[V+q]+=X*Z,v[G+q]+=X*K}return n.makeTensorInfo([c,h,l,p],"float32",v)}};var m_={kernelName:ti,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;dT(a,"resizeNearestNeighbor");for(var u=In(a.shape),c=(0,E.Z)(s,2),l=c[0],h=c[1],p=(0,E.Z)(a.shape,4),d=p[0],f=p[1],m=p[2],v=p[3],g=n.data.get(a.dataId).values,y=new Float32Array(d*l*h*v),b=[i&&l>1?f-1:f,i&&h>1?m-1:m],x=[i&&l>1?l-1:l,i&&h>1?h-1:h],k=b[0]/x[0],w=b[1]/x[1],S=0,I=0;I<d;I++)for(var C=I*u[0],T=0;T<l;T++){var N=o?k*(T+.5):k*T,R=Math.min(f-1,i?Math.round(N):Math.floor(N));o&&(R=Math.max(0,R));for(var A=C+R*u[1],_=0;_<h;_++){var O=o?w*(_+.5):w*_,F=Math.min(m-1,i?Math.round(O):Math.floor(O));o&&(F=Math.max(0,F));for(var D=A+F*u[2],M=0;M<v;M++){var P=g[D+M];y[S++]=P}}}return n.makeTensorInfo([d,l,h,v],a.dtype,y)}};var v_={kernelName:ni,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;dT([i,a],"resizeNearestNeighborGrad");for(var s=In(a.shape),u=In(i.shape),c=(0,E.Z)(a.shape,4),l=c[0],h=c[1],p=c[2],d=c[3],f=(0,E.Z)(i.shape,3),m=f[1],v=f[2],g=new Float32Array(l*h*p*d),y=n.data.get(i.dataId).values,b=[o&&m>1?h-1:h,o&&v>1?p-1:p],x=[o&&m>1?m-1:m,o&&v>1?v-1:v],k=b[0]/x[0],w=b[1]/x[1],S=1/k,I=1/w,C=2*Math.ceil(S)+2,T=2*Math.ceil(I)+2,N=0;N<l;N++)for(var R=N*s[0],A=0;A<h;A++)for(var _=R+A*s[1],O=Math.floor(A*S),F=Math.floor(O-C/2),D=0;D<p;D++)for(var M=_+D*s[2],P=Math.floor(D*I),L=Math.floor(P-T/2),z=0;z<d;z++){for(var B=0,U=0;U<C;U++){var W=U+F;if(!(W<0||W>=m)){var V=R+W*u[1],G=W*k;if(A===Math.min(h-1,o?Math.round(G):Math.floor(G)))for(var j=0;j<T;j++){var H=j+L;if(!(H<0||H>=v)){var Z=V+H*u[2],K=H*w;D===Math.min(p-1,o?Math.round(K):Math.floor(K))&&(B+=y[Z+z])}}}}g[M+z]=B}return n.makeTensorInfo(a.shape,a.dtype,g)}};var g_={kernelName:oi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;dT(a,"reverse");var o=a.shape.length,s=dn(i,a.shape);if(0===o)return kT({inputs:{x:a},backend:n});for(var u=new Xo(a.shape,a.dtype),c=n.bufferSync(a),l=function(){var e=u.indexToLoc(h),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[c.get.apply(c,(0,Lt.Z)(t))].concat((0,Lt.Z)(e)))},h=0;h<u.size;h++)l();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},y_={kernelName:Yi,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=mn(a.dtype,on(a.shape)),l=(0,E.Z)(a.shape,4),h=l[0],p=l[1],d=l[2],f=l[3],m=tv(s,p,d),v=(0,E.Z)(m,2),g=v[0],y=v[1],b=Math.sin(i),x=Math.cos(i),k=u.data.get(a.dataId).values,w=0;w<h;w++)for(var S=w*d*p*f,I=0;I<p;I++)for(var C=I*(d*f),T=0;T<d;T++)for(var N=T*f,R=0;R<f;R++){var A=[h,I,T,R],_=A[2],O=A[1],F=(_-g)*x-(O-y)*b,D=(_-g)*b+(O-y)*x;F=Math.round(F+g),D=Math.round(D+y);var M=o;if("number"!==typeof o&&(M=3===R?255:o[R]),F>=0&&F<d&&D>=0&&D<p)M=k[S+D*(d*f)+F*f+R];c[S+C+N+R]=M}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},b_=gT(si,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),x_={kernelName:si,backendName:"cpu",kernelFunc:b_},k_=vT((function(e){return 1/Math.sqrt(e)})),w_=yT(ui,k_),S_={kernelName:ui,backendName:"cpu",kernelFunc:w_};function I_(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=e.values,p=t.values;if(0===r)return ju(n,t.dtype);var d=u instanceof Xo?u:ju(l,t.dtype);"string"===typeof u||"number"===typeof u?d.values.fill(u):"boolean"===typeof u&&d.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=h[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[v*a+b]+=p[f*a+b]:d.values[v*a+b]=0===t.rank?p[0]:p[f*a+b]}return d}var C_={kernelName:ci,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=tf(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,d=I_(n.bufferSync(a),n.bufferSync(i),o,p,l,c,u,h,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function T_(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function N_(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var E_={kernelName:hi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=vn("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?T_(u,t[l+c]):N_(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var R_={kernelName:pi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;dT([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=ss(a.dtype,i.dtype),h=Rn(on(a.shape),l),p=0,d=0===o||o>1||1===a.shape.length?1:on(a.shape.slice(1)),f=0;f<s.length;f++)for(var m=0;m<d;m++)1===s[f]?h[p++]=u[f]:h[p++]=c[f];return n.makeTensorInfo(a.shape,l,h)}},A_=gT(di,(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)})),__={kernelName:di,backendName:"cpu",kernelFunc:A_},O_=gT(gi,(function(e){return e<0?-1:e>0?1:0})),F_={kernelName:gi,backendName:"cpu",kernelFunc:O_},D_=gT(mi,(function(e){return Math.sin(e)})),M_={kernelName:mi,backendName:"cpu",kernelFunc:D_},P_=gT(vi,(function(e){return Math.sinh(e)})),L_={kernelName:vi,backendName:"cpu",kernelFunc:P_},z_=Math.log(1.1920928955078125e-7)+2,B_=gT(bi,(function(e){var t=e>-z_,n=e<z_,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),U_={kernelName:bi,backendName:"cpu",kernelFunc:B_};var W_={kernelName:wi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;dT([a],"spaceToBatchND");var s=on(i),u=[[0,0]];u.push.apply(u,(0,Lt.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=GA.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=nv(l.shape,i,s,!1),p=rv(h.length,i.length,!1),d=av(l.shape,i,s,!1),f=QT({inputs:{x:l},backend:n,attrs:{shape:h}}),m=lN({inputs:{x:f},backend:n,attrs:{perm:p}}),v=QT({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};function V_(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),h=t[1];if(0===u){if(0!==s)throw new Error(_v(s));return[vn(n,0),[0,h],vn(a,0),c,l]}for(var p=!0,d=0,f=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*h];if(v<0)throw new Error(Ov(m,v));if(v>=u)throw new Error(Fv(m,v,u));++f[v],p=p&&v>=d,d=v}for(var g=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,g=g&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(g&&p){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,h],k,c,l]}for(var S=f[u-1],I=vn(n,S*h),C=vn(a,S),T=new Array(u).fill(0),N=0;N<s;++N){var E=e[N*h],R=T[E],A=(0===E?0:f[E-1])+R;T[E]++;for(var _=0;_<h;++_)I[A*h+_]=e[N*h+_];C[A]=r[N],l[N]=A}for(var O=0;O<u;++O){if(0===T[O]){var F=0===O?0:f[O-1];I[F*h+0]=O;for(var D=1;D<h;++D)I[F*h+D]=0;C[F]=o}}return[I,[S,h],C,c,l]}var G_={kernelName:Ci,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],h=V_(s,r.shape,r.dtype,u,a.dtype,c,l),p=(0,E.Z)(h,5),d=p[0],f=p[1],m=p[2],v=p[3],g=p[4];return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([f[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};function j_(e,t,n,r,a){for(var i=on(r),o=t[0],s=a.length,u=[],c=1,l=-1,h=0;h<s;++h){var p=a[h];if(-1===p){if(-1!==l)throw new Error(Dv(l,h));l=h,u.push(1)}else{if(p<0)throw new Error(Mv(h,p));c*=p,u.push(p)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var d=Math.trunc(i/c);if(c*d!==i)throw new Error(Pv(r,u));u[l]=d}if(on(u)!==i)throw new Error(Lv(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var v=f-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=vn(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<f;++w)k+=e[x*f+w]*m[w];for(var S=0;S<s;++S)b[x*s+S]=Math.trunc(k/g[S]),k%=g[S]}return[b,[o,s],u]}var H_={kernelName:Ti,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=j_(s,r.shape,r.dtype,o,u),l=(0,E.Z)(c,3),h=l[0],p=l[1],d=l[2];return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}};function Z_(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");var h=t.slice();h[0]=l;var p=vn(n,h.reduce((function(e,t){return e*t}),1));if(0===s)return l>0&&p.fill(o),[p,h];if(l<=0)throw new Error("segment ids must be >= 0");for(var d=0,f=1,m=0,v=a[d];;){var g=0;if(f<s){if(v===(g=a[f])){++f;continue}if(v>=g)throw new Error("segment ids are not increasing")}if(v<0||v>=l)throw new Error(zv(v,l));v>m&&p.fill(o,m*c,v*c);for(var y=d;y<f;++y){var b=r[y];if(b<0||b>=u[0])throw new Error(Bv(y,r[y],u[0]));for(var x=0;x<c;x++)p[v*c+x]+=e[b*c+x]}if(i)for(var k=0;k<c;k++)p[v*c+k]/=f-d;if(d=f,m=v+1,v=g,++f>s)break}return m<l&&p.fill(o,m*c,l*c),[p,h]}var K_={kernelName:Ni,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=Z_(o,r.shape,r.dtype,s,u,!0),l=(0,E.Z)(c,2),h=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,h)}};var q_={kernelName:Ei,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=Z_(o,r.shape,r.dtype,s,u),l=(0,E.Z)(c,2),h=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,h)}};var X_={kernelName:Ri,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=tf(0,i,u),l=c.sliceRank,h=c.numUpdates,p=c.sliceSize,d=c.strides,f=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=I_(v,r.bufferSync(o),u,f,p,h,l,d,Boolean(r.data.get(s.dataId).values[0]),m);break;case"float32":t=I_(v,r.bufferSync(o),u,f,p,h,l,d,r.data.get(s.dataId).values[0],m);break;case"int32":t=I_(v,r.bufferSync(o),u,f,p,h,l,d,r.data.get(s.dataId).values[0],m);break;case"string":t=I_(v,r.bufferSync(o),u,f,p,h,l,d,Ro(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var Y_={kernelName:Si,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=dn(r.axis,a.shape)[0],s=Av(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return s.map((function(e){var t=(0,Lt.Z)(c);t[o]=e;var r=PN({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},Q_=vT((function(e){return Math.sqrt(e)})),J_=gT(xi,(function(e){return Math.sqrt(e)})),$_={kernelName:xi,backendName:"cpu",kernelFunc:J_},eO={kernelName:_i,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;dT(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},tO=CT((function(e,t){var n=e-t;return n*n})),nO=HT(Ai,tO),rO={kernelName:Ai,backendName:"cpu",kernelFunc:nO},aO=vT((function(e,t){var n=t.pattern,r=t.replaceGlobal,a=t.rewrite;return e.replace(new RegExp(n,r?"g":""),a)})),iO=yT(Oi,aO),oO={kernelName:Oi,backendName:"cpu",kernelFunc:iO},sO=gT(qi,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),uO={kernelName:qi,backendName:"cpu",kernelFunc:sO};function cO(e,t,n,r){for(var a=ju(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat((0,Lt.Z)(o)))}return a}var lO={kernelName:Fi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,h=r.newAxisMask,p=r.shrinkAxisMask;dT(a,"stridedSlice");var d,f=ml(a.shape,i,o,s,u,c,l,h,p),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)d=QT({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){nn(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var S=hl(x,k,w),I=PN({inputs:{x:a},backend:n,attrs:{begin:x,size:S}});d=QT({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(I)}else{var C=cO(m,n.bufferSync(a),w,x);d=n.makeTensorInfo(v,C.dtype,C.values)}return d}},hO=function(){function e(t,n,r,a,i,o){Te(this,e),this.separator=Eo(t),this.nGramWidths=n,this.leftPad=Eo(r),this.rightPad=Eo(a),this.padWidth=i,this.preserveShort=o}return Re(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),h=i-(c+l),p=t+(c>0?0:u-s),d=0;d+=c*o.leftPad.length;for(var f=0;f<h;++f)d+=e[p+f].length;d+=l*o.rightPad.length,d+=(c+l+h-1)*o.separator.length,n[r+u]=new Uint8Array(d);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<h-1;++b)g(e[p+b]),g(o.separator);if(h>0){g(e[p+h-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=vn("int32",a);if(0===r||0===a){for(var l=new Array(r),h=0;h<=u;++h)c[h]=0;return[l,c]}c[0]=0;for(var p=function(){var e=t[d]-t[d-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[d]=c[d-1]+r},d=1;d<=u;++d)p();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function pO(e,t,n,r,a,i,o,s){return new hO(n,r,a,i,o,s).compute(e,t)}var dO={kernelName:Di,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,h=t.dataSplits,p=pO(n.data.get(l.dataId).values,n.data.get(h.dataId).values,a,i,o,s,u,c),d=(0,E.Z)(p,2),f=d[0],m=d[1];return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}};function fO(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function mO(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;fO(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var h=vn("int32",2*i),p=new Array(i),d=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)h[2*f]=m,h[2*f+1]=v,p[f]=a[f],++f;return[h,p,d]}var vO={kernelName:Mi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=mO(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=(0,E.Z)(o,3),u=s[0],c=s[1],l=s[2],h=c.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};function gO(e,t){for(var n=vn("int32",e.length),r=0;r<e.length;++r)n[r]=Io(e[r]).modulo(t).getLowBitsUnsigned();return n}var yO={kernelName:Pi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=gO(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},bO=gT(zi,(function(e){return Math.tan(e)})),xO={kernelName:zi,backendName:"cpu",kernelFunc:bO},kO=gT(Bi,(function(e){return Math.tanh(e)}));var wO={kernelName:li,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.tensor,a=t.indices,i=t.updates,o=tf(0,a,r.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,h=o.outputSize,p=n.bufferSync(a),d=n.bufferSync(i),f=n.bufferSync(r),m=I_(p,d,r.shape,h,c,u,s,l,f,!1);return n.makeTensorInfo(r.shape,m.dtype,m.values)}};function SO(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=ju(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var IO={kernelName:Ui,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;dT(a,"tile");var o=SO(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},CO=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function TO(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);TO(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,h=r;for(en(e,n,t),CO(e[r],c)>0&&en(e,n,r);l<h;){for(en(e,l,h),l++,h--;CO(e[l],c)<0;)l+=1;for(;CO(e[h],c)>0;)h-=1}0===CO(e[n],c)?en(e,n,h):en(e,h+=1,r),h<=t&&(n=h+1),t<=h&&(r=h-1)}}function NO(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=mn(n,o*r),c=mn("int32",o*r),l=function(){var t=h*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(TO(i,r),i=i.slice(0,r)),a&&i.sort(CO);for(var o=h*r,l=u.subarray(o,o+r),p=c.subarray(o,o+r),d=0;d<r;d++)l[d]=i[d].value,p[d]=i[d].index},h=0;h<o;h++)l();var p=t.slice();return p[p.length-1]=r,[ju(p,n,u),ju(p,"int32",c)]}var EO={kernelName:Wi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;dT(a,"topk");var s=NO(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=(0,E.Z)(s,2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var RO={kernelName:Vi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=(0,E.Z)(a.shape,4),h=l[0],p=l[1],d=l[2],f=l[3],m=null!=c?c:[p,d],v=(0,E.Z)(m,2),g=v[0],y=v[1],b=[h,g,y,f],x=In(a.shape),k=x[0],w=x[1],S=x[2],I=In(b),C=I[0],T=I[1],N=I[2],R=mn(a.dtype,on(b));R.fill(u);for(var A=r.data.get(a.dataId).values,_=r.data.get(i.dataId).values,O=0;O<h;++O){for(var F=1===i.shape[0]?_:_.subarray(8*O,8*O+8),D=0;D<g;++D)for(var M=0;M<y;++M)for(var P=0;P<f;++P){var L=void 0,z=F[6]*M+F[7]*D+1;if(0!==z){var B=(F[0]*M+F[1]*D+F[2])/z,U=(F[3]*M+F[4]*D+F[5])/z,W=AO(B,d,s),V=AO(U,p,s);switch(o){case"nearest":L=OO(A,p,d,k,w,S,O,V,W,P,u);break;case"bilinear":L=FO(A,p,d,k,w,S,O,V,W,P,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}R[O*C+D*T+M*N+P]=L}}return r.makeTensorInfo(b,a.dtype,R)}return{dataId:r.write(R,b,a.dtype),shape:a.shape,dtype:a.dtype}}};function AO(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Jt(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Jt(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Jt(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function _O(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function OO(e,t,n,r,a,i,o,s,u,c,l){return _O(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function FO(e,t,n,r,a,i,o,s,u,c,l){var h=Math.floor(s),p=Math.floor(u),d=h+1,f=p+1;return(d-s)*((f-u)*_O(e,t,n,r,a,i,o,h,p,c,l)+(u-p)*_O(e,t,n,r,a,i,o,h,f,c,l))+(s-h)*((f-u)*_O(e,t,n,r,a,i,o,d,p,c,l)+(u-p)*_O(e,t,n,r,a,i,o,d,f,c,l))}function DO(e,t,n,r){for(var a=dn(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u=new Map,c=new Int32Array(n[a]),l=new Xo(i,r,e),h=[],p=1===i[0]&&1===i[2],d=0;d<n[a];d++){var f=void 0;if(p)f=e[d].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,d,g));f=m.join(",")}var y=u.get(f);if(null!=y)c[d]=y;else{var b=u.size;u.set(f,b),c[d]=b,h.push(d)}}var x=i.slice();x[1]=u.size;var k=new Xo(x,r);h.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=x[1],{outputValues:k.values,outputShape:w,indices:c}}var MO={kernelName:ji,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;dT(i,"unique");var o=DO(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var PO={kernelName:Hi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var h=new Array(o).fill(0),p=a.shape.slice();p[i]=1;for(var d=new Array(s),f=0;f<d.length;f++){h[i]=f;var m=PN({inputs:{x:a},backend:n,attrs:{begin:h,size:p}});d[f]=QT({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return d}};for(var LO={kernelName:Zi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;dT(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,h=0;h<c;++h){var p=jE({inputs:{input:l},backend:n,attrs:{dim:h+1}});l=p,u.push(p)}for(var d=0;d<o;++d){var f=Co(d,"int32"),m=n.makeTensorInfo([],"int32",f),v=LE({inputs:{a:m,b:l},backend:n}),g=GT({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=AE({inputs:{a:g,b:a},backend:n}),b=OE({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=WA({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},zO=0,BO=[tN,rN,iN,sN,YT,uN,pN,dN,fN,mN,gN,bN,kN,IN,TN,AN,_N,ON,FN,eN,DN,zN,WN,jN,HN,jT,qN,YN,zT,QN,nE,aE,iE,oE,sE,uE,cE,hE,dE,fE,mE,vE,gE,yE,xE,kE,wE,SE,IE,CE,TE,NE,DE,xT,ME,zE,UE,GE,HE,qE,iR,sR,uR,hR,fR,mR,vR,yR,xR,SR,TR,wT,NR,eE,RR,_R,FR,IT,PR,BR,WR,jR,ZR,XR,QR,eA,tA,nA,iA,uA,cA,lA,hA,pA,dA,fA,mA,yA,bA,wA,CA,_E,NA,RA,_A,FA,PA,LA,UA,VA,GA,ZA,ET,qA,$A,n_,u_,l_,WT,QE,p_,AT,OT,JT,d_,f_,m_,v_,g_,y_,x_,S_,C_,E_,R_,__,MT,F_,M_,L_,LN,IA,U_,W_,G_,H_,K_,q_,X_,Y_,$_,eO,rO,oO,uO,lO,dO,vO,yO,tR,FE,xO,{kernelName:Bi,backendName:"cpu",kernelFunc:kO},wO,IO,EO,RO,hN,MO,PO,LO,BA];zO<BO.length;zO++){oo(BO[zO])}var UO,WO,VO,GO={},jO={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function HO(e,t){if(!(e in GO)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if(zn().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete GO[e]}),!1),zn().getBool("SOFTWARE_WEBGL_ENABLED")&&(jO.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",jO)||n.getContext("experimental-webgl",jO);return n.getContext("webgl2",jO)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;GO[e]=n}var r=GO[e];return null==r||r.isContextLost()?(delete GO[e],HO(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),GO[e])}function ZO(e,t){return[t,e]}function KO(e){var t=on(e);return cn(Math.ceil(t/4))}function qO(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function XO(e,t){var n,r,a,i,o,s,u,c,l,h,p=e;return 2===zn().getNumber("WEBGL_VERSION")?(n=p.R32F,r=p.R16F,a=p.RGBA16F,i=p.RGBA32F,o=p.RED,u=4,c=1,l=p.HALF_FLOAT,h=p.FLOAT,s=p.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=p.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:h}}function YO(e,t){var n=t();return zn().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(UO||(UO={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(WO||(WO={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(VO||(VO={}));function QO(e){return!!(zn().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function JO(e,t){return cF(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var $O,eF,tF=/ERROR: [0-9]+:([0-9]+):/g;function nF(e,t){var n=tF.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return ln((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),h=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(ln(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}function rF(e,t){if(YO(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function aF(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(YO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),YO(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),YO(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function iF(e,t,n,r){YO(e,(function(){return function(e,t,n){lF(e,n),YO(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),YO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),YO(e,(function(){return e.uniform1i(n,r)}))}function oF(e,t,n){YO(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),YO(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function sF(e,t){YO(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),YO(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function uF(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function cF(e,t,n){var r=YO(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function lF(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function hF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return on(e.slice(0,e.length-t))}function pF(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function dF(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[hF(e)].concat((0,Lt.Z)(pF(e)))),t}function fF(e){return e%2===0}function mF(e,t){if(sn(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(fF(n)&&fF(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&fF(e[0])&&fF(t[0])}function vF(e,t){return null!=e.getExtension(t)}function gF(e){try{if(null!=HO(e))return!0}catch(JG){return console.log("Error when getting WebGL context: ",JG),!1}return!1}function yF(e){if(0===e)return!1;var t=HO(e);if(1!==e){if(vF(t,"EXT_color_buffer_float"))return bF(t);var n="EXT_color_buffer_half_float";if(vF(t,n)){var r=t.getExtension(n);return function(e,t){var n=XO(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!vF(t,"OES_texture_float")&&(!!vF(t,"WEBGL_color_buffer_float")&&bF(t))}function bF(e){var t=XO(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function xF(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&nn("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var kF=zn();function wF(){var e,t,n,r,a,i,o,s,u,c;return 2===zn().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=zn().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function SF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=In(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function IF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=In(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function CF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(e.map((function(e,t){return t})),t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(r[a]),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(r[a]):"index -= ".concat(e[a]," * ").concat(r[a]);return"".concat(i,"; ").concat(o,";")})).join("")}function TF(e){var t=In(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}kF.registerFlag("HAS_WEBGL",(function(){return kF.getNumber("WEBGL_VERSION")>0})),kF.registerFlag("WEBGL_VERSION",(function(){return gF(2)?2:gF(1)?1:0})),kF.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),kF.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===kF.get("WEBGL_VERSION")})),kF.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),kF.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),kF.registerFlag("WEBGL_PACK",(function(){return kF.getBool("HAS_WEBGL")})),kF.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_CLIP",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_PACK_REDUCE",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_CONV_IM2COL",(function(){return kF.getBool("WEBGL_PACK")})),kF.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==$O){var t=HO(e);$O=t.getParameter(t.MAX_TEXTURE_SIZE)}return $O}(kF.getNumber("WEBGL_VERSION"))})),kF.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==eF){var t=HO(e);eF=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,eF)}(kF.getNumber("WEBGL_VERSION"))})),kF.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=kF.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=HO(e);return vF(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:vF(t,"EXT_disjoint_timer_query")?1:0}(e)})),kF.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return kF.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ws()})),kF.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=HO(e);if(1===e){if(!vF(t,"OES_texture_float"))return!1}else if(!vF(t,"EXT_color_buffer_float"))return!1;return bF(t)}(kF.getNumber("WEBGL_VERSION"))})),kF.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!kF.getBool("WEBGL_FORCE_F16_TEXTURES")&&kF.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),kF.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return yF(kF.getNumber("WEBGL_VERSION"))})),kF.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=kF.getNumber("WEBGL_VERSION"))&&null!=HO(e).fenceSync;var e})),kF.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return kF.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),kF.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),kF.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return ws()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),kF.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),kF.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),kF.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),kF.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),kF.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),kF.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return kF.getBool("IS_TEST")})),kF.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),kF.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),kF.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),kF.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var NF="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",EF=wc;function RF(e,t,n){var r=[];if(e.forEach((function(e){var t=on(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(BF(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?_F(e,r):AF(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=EF(e.shapeInfo.logicalShape,t.logicalShape),c=zF(s),l=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(h[e+l]," = 0;")})).join("\n");var p="";p=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+l])})).join(", ");var d="return outputValue;",f=1===on(e.shapeInfo.logicalShape),m=on(t.logicalShape),v=1===m;if(1!==o||f||v){if(f&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=o-2,y=o-1;u.indexOf(g)>-1&&u.indexOf(y)>-1?d="return vec4(outputValue.x);":u.indexOf(g)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(y)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(p,");\n      ").concat(d,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&sn(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=zF(u),h=EF(e.shapeInfo.logicalShape,t.logicalShape),p=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map((function(e){return"coords.".concat(d[e+p]," = 0;")})).join("\n");var f="";f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+p])})).join(", ");return"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=wF(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),h=function(e){var t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(OF,"\n    ").concat(FF,"\n    ").concat(DF,"\n  ");return t}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(sn(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(sn(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=IF(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=SF(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=IF(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=SF(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=SF(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=SF(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(h+=MF),[h,l,i,o,a,s,n.userCode].join("\n")}function AF(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=(0,E.Z)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=PF(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=(0,E.Z)(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(LF(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=PF(n);if(1===o)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===i)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&sn(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=fn(n),c=u.newShape,l=u.keptDims,h=c;if(h.length<n.length){var p=UF(e,h),d=["row","col"];return"\n      ".concat(AF(p,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(WF(d,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(LF(e),"\n      }\n    ");var f=i[0],m=i[1],v=PF(r);if(1===m)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===f)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=fn(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var h=UF(e,l),p=["row","col","depth"];return"\n        ".concat(AF(h,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(WF(p,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(LF(e),"\n      }\n    ");var d=e.shapeInfo.texShape,f=d[0],m=d[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=PF(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=fn(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=UF(e,c),p=["row","col","depth","depth2"];return"\n      ".concat(AF(h,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(WF(p,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(LF(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=PF(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=fn(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var h=UF(e,c),p=["row","col","depth","depth2","depth3"];return"\n      ".concat(AF(h),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(WF(p,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(LF(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1];if(v===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=PF(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=fn(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=UF(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(AF(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(WF(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,h=t[3]*l,p=t[2]*h,d=t[1]*p;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(p,", ").concat(h,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(LF(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===d&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(p,", ").concat(h,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=PF(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(p," + depth * ").concat(h," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function _F(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=wF();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=wF();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=wF();if(null!=i&&sn(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=UF(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(_F(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(WF(c,s),");\n        }\n      ")}var l=wF();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var h=o[0],p=o[1],d=Math.ceil(n[2]/2),f=d*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(h,", ").concat(p,", ").concat(f,", ").concat(d,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=wF();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],h=Math.ceil(i[o-1]/2),p=h*Math.ceil(i[o-2]/2),d="int b, int row, int col",f="b * ".concat(p," + (row / 2) * ").concat(h," + (col / 2)"),m=2;m<o-1;m++)d="int b".concat(m,", ")+d,p*=i[o-m-1],f="b".concat(m," * ").concat(p," + ")+f;return"\n    vec4 ".concat(r,"(").concat(d,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var OF="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",FF="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",DF="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",MF="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function PF(e){return"offset".concat(e)}function LF(e){var t=e.name,n=on(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function zF(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function BF(e,t,n){var r=fn(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!sn(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function UF(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function WF(e,t){return t.map((function(t){return e[t]})).join(", ")}function VF(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=RF(a,o,t),u=function(e,t){var n=cF(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(YO(e,(function(){return e.shaderSource(n,t)})),YO(e,(function(){return e.compileShader(n)})),zn().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw nF(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return zn().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},GF(e,t,c)))}function GF(e,t,n){var r,a,i,o,s=[],u=[],c=null;o=e.getUniformLocation(n,"NAN",!1),1===zn().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));var l,h=!1,p=Kt(t.variableNames);try{for(p.s();!(l=p.n()).done;){var d=l.value,f={name:d,uniform:e.getUniformLocation(n,d,h),offset:e.getUniformLocation(n,"offset".concat(d),h)};t.enableShapeUniforms&&(f.shape=e.getUniformLocation(n,"".concat(d,"Shape"),h),f.texShape=e.getUniformLocation(n,"".concat(d,"TexShape"),h)),s.push(f)}}catch($Q){p.e($Q)}finally{p.f()}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",h),i=e.getUniformLocation(n,"outShapeStrides",h),a=e.getUniformLocation(n,"outTexShape",h)),t.customUniforms){var m,v=Kt(t.customUniforms);try{for(v.s();!(m=v.n()).done;){var g=m.value;u.push(e.getUniformLocation(n,g.name,h))}}catch($Q){v.e($Q)}finally{v.f()}}return{variablesLocations:s,customUniformLocations:u,infLoc:c,nanLoc:o,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function jF(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!sn(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!sn(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function HF(e){return zn().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var ZF=Re((function e(t){Te(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=UO.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=wF();this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?IF(["r","c","d"],t):SF(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),KF=Re((function e(t){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=UO.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=wF();this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?IF(["r","c","d"],t):SF(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),qF=Re((function e(t){Te(this,e),this.variableNames=["A"],this.outTexUsage=WO.DOWNLOAD;var n=wF();this.outputShape=t,this.userCode="\n      ".concat(NF,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),XF=Re((function e(t){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=WO.DOWNLOAD;var n=wF();this.outputShape=t,this.userCode="\n      ".concat(NF,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),YF={R:0,G:1,B:2,A:3},QF=Re((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";Te(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=wF();this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(YF[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":TF(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")})),JF=Re((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Te(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=wF();this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":TF(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function $F(e){var t=wF();return function(e,t){var n=cF(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(YO(e,(function(){return e.shaderSource(n,t)})),YO(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function eD(e){return function(e,t){var n=cF(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return YO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),YO(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function tD(e){return function(e,t){var n=cF(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return YO(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),YO(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function nD(e,t,n,r,a,i){!function(e,t){var n=zn().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return cF(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return YO(e,(function(){return e.bindTexture(s,o)})),YO(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),YO(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),YO(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),YO(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===zn().getNumber("WEBGL_VERSION")?YO(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):YO(e,(function(){return e.texStorage2D(s,1,r,t,n)})),YO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function rD(e){return e.internalFormatFloat}function aD(e){return e.internalFormatHalfFloat}function iD(e){return e.downloadTextureFormat}function oD(e){return e.internalFormatPackedFloat}function sD(e){return e.internalFormatPackedHalfFloat}function uD(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=qO(e,t),r=(0,E.Z)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var cD=function(){function e(t){Te(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=zn().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,function(e,t){GO[e]=t}(n,t)):this.gl=HO(n),t=this.gl,2===zn().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return YO(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return YO(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return YO(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return YO(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return YO(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return YO(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return YO(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return YO(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===zn().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=JO(this.gl,"OES_texture_float"),vF(this.gl,s))this.textureHalfFloatExtension=JO(this.gl,s);else if(zn().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),vF(this.gl,o))this.colorBufferHalfFloatExtension=JO(this.gl,o);else if(zn().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",vF(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!vF(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=eD(this.gl),this.indexBuffer=tD(this.gl),this.framebuffer=function(e){return cF(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=XO(this.gl,this.textureHalfFloatExtension)}return Re(e,[{key:"debug",get:function(){return zn().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;YO(t,(function(){return t.finish()})),YO(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),YO(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),YO(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),YO(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),YO(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=ZO(t,n),i=(0,E.Z)(a,2);return nD(e,i[0],i[1],rD(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=ZO(t,n),i=(0,E.Z)(a,2);return nD(e,i[0],i[1],aD(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=ZO(t,n),i=(0,E.Z)(a,2);return nD(e,i[0],i[1],iD(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){YO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===zn().getNumber("WEBGL_VERSION")?YO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):YO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===zn().getNumber("WEBGL_VERSION")?YO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):YO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),YO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;YO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===zn().getNumber("WEBGL_VERSION")?YO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):YO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),YO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=qO(t,n),i=(0,E.Z)(a,2);return nD(e,i[0],i[1],sD(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=qO(t,n),i=(0,E.Z)(a,2);return nD(e,i[0],i[1],oD(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(sF(this.gl,this.framebuffer),this.outputTexture=null),YO(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=ZO(t,n),i=(0,E.Z)(a,2),o=i[0],s=i[1],u=new Uint8Array(t*n*4);return YO(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return uD(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();YO(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return YO(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),YO(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),YO(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(zn().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return YO(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=$F(n));var r=function(e){return cF(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);YO(n,(function(){return n.attachShader(r,t.vertexShader)})),YO(n,(function(){return n.attachShader(r,e)})),function(e,t){if(YO(e,(function(){return e.linkProgram(t)})),!zn().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r);var a=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&rF(n,a),a}},{key:"buildVao",value:function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;YO(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),function(e,t,n){YO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),aF(e,t,"clipSpacePos",n,3,20,0)&&aF(e,t,"uv",n,2,20,12)}(n,e,this.vertexBuffer)}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(YO(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&rF(this.gl,this.program),YO(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return cF(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),YO(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),iF(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=qO(t,n),a=(0,E.Z)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&rF(this.gl,this.program),uF(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}YO(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),YO(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=JO(this.gl,2===zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=Ht(Gt().mark((function e(t){var n=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn((function(){return n.disposed||n.isQueryAvailable(t,zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var r=void 0;"setTimeoutCustom"in zn().platform&&(r=zn().platform.setTimeoutCustom.bind(zn().platform)),hn((function(){return n.pollItems(),0===n.itemsToPoll.length}),(function(){return 0}),null,r)}}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),oF(this.gl,e,this.framebuffer),this.debug&&uF(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(oF(this.gl,this.outputTexture,this.framebuffer),this.debug&&uF(this.gl)):sF(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;oF(r,e,this.framebuffer),this.debug&&uF(r),this.outputTexture=e,YO(r,(function(){return r.viewport(0,0,t,n)})),YO(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),YO(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var lD=KT,hD=BN,pD=UN,dD=VN,fD=VT,mD=ZN,vD=JN,gD=PE,yD=WE,bD=ZE,xD=cR,kD=gR,wD=bR,SD=kR,ID=IR,CD=DR,TD=LR,ND=UR,ED=VR,RD=rA,AD=oA,_D=vA,OD=EE,FD=TA,DD=DA,MD=KA,PD=JA,LD=t_,zD=s_,BD=c_,UD=k_,WD=I_,VD=FT,GD=nN,jD=MN,HD=V_,ZD=j_,KD=Z_,qD=Q_,XD=aO,YD=cO,QD=pO,JD=mO,$D=gO,eM=JE,tM=SO,nM=NO,rM=cN,aM=DO;function iM(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function oM(e,t){return 1===t?[e]:iM(e,t)}var sM=function(){function e(t){if(Te(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=HF(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=oM("rc",this.rank),r=zF(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return Re(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),uM=Re((function e(t,n){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?CF(["r","c","d"],"inputShape"):SF(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":TF(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var cM=function(){function e(t){Te(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return Re(e,[{key:"acquireTexture",value:function(e,t,n){var r=hM(t,n),a=pM(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=lM(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].pop();return this.usedTextures[a].push(s),s}return r===VO.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===VO.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===VO.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===VO.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===VO.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=hM(n,r),i=pM(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=lM(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=zn().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u&&u.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function lM(e,t,n,r,a){var i,o=function(e,t){switch(e){case VO.PACKED_2X2_FLOAT32:return oD(t);case VO.PACKED_2X2_FLOAT16:return sD(t);case VO.UNPACKED_FLOAT32:return rD(t);case VO.UNPACKED_FLOAT16:return aD(t);case VO.PACKED_4X1_UNSIGNED_BYTE:return iD(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=qO(e[0],e[1]),u=(0,E.Z)(s,2);i=u[0]*u[1]}else{var c=ZO(e[0],e[1]),l=(0,E.Z)(c,2);i=l[0]*l[1]}var h=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*h}function hM(e,t){if(e===WO.UPLOAD)return VO.PACKED_2X2_FLOAT32;if(e===WO.RENDER||null==e)return function(e){return zn().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?VO.PACKED_2X2_FLOAT32:VO.UNPACKED_FLOAT32:e?VO.PACKED_2X2_FLOAT16:VO.UNPACKED_FLOAT16}(t);if(e===WO.DOWNLOAD||e===WO.PIXELS)return VO.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function pM(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var dM=Re((function e(t,n){Te(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),fM="if (isnan(x)) return x;",mM="return x;",vM="return abs(x);";var gM="return (x >= 0.0) ? x : (exp(x) - 1.0);",yM=fM+"\n  return (x < 0.0) ? 0.0 : x;\n",bM=fM+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",xM="return x;",kM="return 1.0 / (1.0 + exp(-1.0 * x));",wM="return x;",SM="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",IM="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",CM="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",TM="return 1.0 / (1.0 + exp(-1.0 * x));",NM=Re((function e(t,n){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),EM=Re((function e(t){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length);var n=t.length,r=oM("rc",n),a=zF(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),RM=hf,AM={};var _M=zn().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var OM=function(e){Mo(n,e);var t=Uo(n);function n(e){var r,a,i;if(Te(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!zn().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof cD)a=e;else{var o=HO(zn().getNumber("WEBGL_VERSION"),e);a=new cD(o)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=HO(zn().getNumber("WEBGL_VERSION"));a=new cD(s),r.binaryCache=((i=zn().getNumber("WEBGL_VERSION"))in AM||(AM[i]={}),AM[i]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new cM(r.gpgpu),r.numMBBeforeWarning=null==zn().global.screen?1024:zn().global.screen.height*zn().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new qt(zo(r),qu()),r}return Re(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=dF(t),c=new QF(u,!1,i),l=this.runWebGLProgram(c,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}},{key:"write",value:function(e,t,n){if((zn().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||zn().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:WO.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(zn().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:WO.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new NM(o,xM):new dM(o,xM);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,p,d=null!=this.activeTimers;(d&&(h=No()),"complex64"===r)?p=vv(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):p=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=No()-h),this.convertAndCacheOnCPU(e,p)}},{key:"read",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S,I;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return l=c?new NM(i,xM):new dM(i,xM),h=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),e.abrupt("return",p);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!zn().getBool("DEBUG")){e.next=16;break}if(zn().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==zn().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(d=null,"complex64"!==s&&zn().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),v=this.texData.get(f.dataId),d=(m=this.gpgpu).createBufferFromTexture.apply(m,[v.texture.texture].concat((0,Lt.Z)(KO(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==s){e.next=31;break}return e.next=25,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 25:y=e.sent,b=y[0],x=y[1],g=vv(b,x),e.next=32;break;case 31:null==d?g=this.getValuesFromTexture(t):(k=on(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,k));case 32:return null!=f&&this.disposeIntermediateTensorInfo(f),null!=d&&YO(w=this.gpgpu.gl,(function(){return w.deleteBuffer(d)})),S=this.convertAndCacheOnCPU(t,g),I=this.pendingRead.get(t),this.pendingRead.delete(t),I.forEach((function(e){return e(S)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&qu().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",S);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new NM(a,xM):new dM(a,xM);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),h=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),h}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var p=this.decode(e,t.customTexShape),d=qu().makeTensorFromTensorInfo(p),f=this.texData.get(p.dataId);return Object.assign({tensorRef:d},f.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Ro(e)}));return ju(e.shape,e.dtype,n)}catch(OK){throw new Error("Failed to decode encoded string bytes into utf-8")}return ju(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!QO(n)){if(zn().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=on(n);if(zn().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat((0,Lt.Z)(KO(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=zn().getBool("WEBGL_PACK")&&!0===a,h=l?dF(n):n,p=l?new XF(h):new qF(h),d=this.runWebGLProgram(p,[{shape:h,dtype:r,dataId:e}],"float32"),f=this.texData.get(d.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture.texture,f.texShape[0],f.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),m}},{key:"timerAvailable",value:function(){return zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=_o(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=_o(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return Ht(Gt().mark((function e(){var n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=tn(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:No(),endMs:null}}},{key:"endTimer",value:function(e){return zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=No(),e)}},{key:"getQueryTime",value:function(){var e=Ht(Gt().mark((function e(t){var n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(zn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_M;return zn().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&on(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){eo("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return RM(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new NM(e.shape,t),a=this.compileAndRun(r,[e],n);return qu().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=GD(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(zn().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,vM,e.dtype);var n=new dM(e.shape,vM),r=this.compileAndRun(n,[e]);return qu().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&bn(n[0])){var a=n.map((function(e){return Eo(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return qu().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new EM(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new sM(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[hF(e.shape)].concat((0,Lt.Z)(pF(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[hF(t)].concat((0,Lt.Z)(pF(t))),i=new uM(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;null!=t&&nn(on(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var o,s=dF(a);o=r?new KF(s):new ZF(s);var u=[null!=t?t:KO(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===UO.DENSE){var c=null!=o?o:KO(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===on(s.shape))return u.values=mn(s.dtype,0),s;var l=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&on(t.shape)<=zn().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!mF(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var p,d={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=BF(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",h="",p="";if(1===u.length&&e.packedInputs){var d=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(d[0]>1,"_").concat(d[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var f=In(u);p="".concat(f[0]===i[1],"_").concat(f[f.length-1]===i[1])}}else h="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&sn(t.shape,i),g=1===on(t.shape),y=wc(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&sn(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(h,"_").concat(p,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(zn().getNumber("WEBGL_VERSION"))}(e,h,d),m=this.getAndSaveBinary(f,(function(){return VF(a.gpgpu,e,h,d)})),v=null!=this.activeTimers;v&&(p=this.startTimer()),zn().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(jF(t.inShapeInfos,n),jF([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===zn().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(var s=0;s<n.length;++s){var u=n[s],c=t.variablesLocations[s],l=c.uniform,h=c.offset,p=c.shape,d=c.texShape;if(p){var f=BF(t.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(f.length){case 1:e.gl.uniform1iv(p,new Int32Array(f));break;case 2:e.gl.uniform2iv(p,new Int32Array(f));break;case 3:e.gl.uniform3iv(p,new Int32Array(f));break;case 4:e.gl.uniform4iv(p,new Int32Array(f))}}if(d&&e.gl.uniform2i(d,u.texData.texShape[0],u.texData.texShape[1]),null!=l)if(u.isUniform)if(on(u.shape)<2)e.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),e.gl.uniform1fv(l,m)}else null!=u.texData.slice&&null!=h&&e.gl.uniform1i(h,u.texData.slice.flatOffset),e.setInputMatrixTexture(u.texData.texture.texture,l,s)}var v=t.outShapeLocation;if(v)switch(r.shape.length){case 1:e.gl.uniform1iv(v,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(v,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(v,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(v,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var g=In(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(g));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(g));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(g))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(var y=0;y<t.program.customUniforms.length;++y){var b=t.program.customUniforms[y],x=t.customUniformLocations[y],k=a[y];if("float"===b.type)e.gl.uniform1fv(x,k);else if("vec2"===b.type)e.gl.uniform2fv(x,k);else if("vec3"===b.type)e.gl.uniform3fv(x,k);else if("vec4"===b.type)e.gl.uniform4fv(x,k);else if("int"===b.type)e.gl.uniform1iv(x,k);else if("ivec2"===b.type)e.gl.uniform2iv(x,k);else if("ivec3"===b.type)e.gl.uniform3iv(x,k);else{if("ivec4"!==b.type)throw Error("uniform type ".concat(b.type," is not supported yet."));e.gl.uniform4iv(x,k)}}e.executeProgram()}(this.gpgpu,m,h,d,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));var g=zn().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=No();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!zn().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!zn().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Yu((function(){if(!zn().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=zn().getBool("DEBUG");zn().set("DEBUG",!1);var n=e.abs(lc(1e-8)).dataSync()[0];if(zn().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=No());var l=t.texShape;if(null==l&&(l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=zn().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=zn().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&zn().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?$t(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=fn(e);e=a.newShape}var i=on(e),o=null;e.length<=1&&i<=n?o=[1,i]:2===e.length&&e[0]<=n&&e[1]<=n?o=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?o=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?o=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?o=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(o=[e[0],e[1]*e[2]*e[3]]);var s=null!=o&&Math.max.apply(Math,(0,Lt.Z)(o))>r&&Math.min.apply(Math,(0,Lt.Z)(o))<=(t?2:1)&&Math.min.apply(Math,(0,Lt.Z)(o))>0;if(null==o||s)if(t){var u=hF(e),c=2,l=2;if(e.length){var h=pF(e),p=(0,E.Z)(h,2);c=p[0],l=p[1]}o=cn(i=u*(c/2)*(l/2)).map((function(e){return 2*e}))}else o=cn(i);return o}(n,s),t.texShape=l),null!=a){var h,p=dF(n),d=l[1],f=l[0],m=a instanceof Uint8Array||a instanceof Uint8ClampedArray;if(s||!m){var v=qO(l[0],l[1]),g=(0,E.Z)(v,2);d=g[0],f=g[1]}h=s?new JF(p,m):new QF(p,m);var y=m?[f,d]:l,b=this.makeTensorInfo(y,r),x=this.texData.get(b.dataId);x.usage=m?WO.PIXELS:WO.UPLOAD,x.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),d,f,a);var k=[[f,d]],w=this.runWebGLProgram(h,[b],r,k,!0),S=this.texData.get(w.dataId);t.texShape=S.texShape,t.isPacked=S.isPacked,t.usage=S.usage,zn().get("ENGINE_COMPILE_ONLY")?this.disposeData(w.dataId):(t.texture=S.texture,t.values=null,this.texData.delete(w.dataId)),this.disposeIntermediateTensorInfo(b),c&&(this.uploadWaitMs+=No()-u)}else{var I=this.acquireTexture(l,o,r,s);t.texture=I}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*yn(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,E.Z)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=Ht(Gt().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=(0,E.Z)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:o=Gt().mark((function e(){var n,r,a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,E.Z)(u[s],2),r=n[1],a=new Promise((function(e){try{c.checkCompletion_(r),e(!0)}catch(t){throw t}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),s=0,u=Object.entries(this.binaryCache);case 8:if(!(s<u.length)){e.next=13;break}return e.delegateYield(o(),"t0",10);case 10:s++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,Zm();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw nF(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.values(this.binaryCache);e<t.length;e++){var n=t[e];this.gpgpu.buildVao(n.webGLProgram);var r=GF(this.gpgpu,n.program,n.webGLProgram),a=r.variablesLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.outShapeLocation,c=r.outShapeStridesLocation,l=r.outTexShapeLocation;n.variablesLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.outShapeLocation=u,n.outShapeStridesLocation=c,n.outTexShapeLocation=l}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=qu().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return qu().makeTensorFromDataId(u,t,n,s)}}]),n}(Xt);OM.nextDataId=0;Ss()&&ec("webgl",(function(){return new OM}),2);var FM="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",DM=Re((function e(t,n,r){Te(this,e),this.variableNames=["A","B"],this.outputShape=Ic(n,r),this.enableShapeUniforms=HF(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),MM="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",PM=Re((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Te(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ic(n,r);var i=this.outputShape.length;this.enableShapeUniforms=HF(i);var o="";if(a)if(0===i||1===on(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=zF(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=oM("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function LM(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var zM={kernelName:aa,backendName:"webgl",kernelFunc:LM};function BM(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=LM({inputs:{x:r},backend:n}),u=LM({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var UM={kernelName:mr,backendName:"webgl",kernelFunc:BM},WM="return (a < 0.) ? b * a : a;",VM="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var GM={kernelName:la,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Co(i,"float32")),s=zn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new PM(VM,a.shape,o.shape):new DM(WM,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},jM="return (a < 0.) ? b * a : a;",HM="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var ZM={kernelName:Ha,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=zn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new PM(HM,r.shape,a.shape):new DM(jM,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},KM="if (isnan(x)) return x;";function qM(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var h=c.texData.get(u.dataId),p=r(h.values,l);return c.makeTensorInfo(u.shape,l,p)}return i=zn().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new NM(u.shape,n):new dM(u.shape,t),c.runWebGLProgram(i,[u],l)}}function XM(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,h=i;if(o&&"complex64"===c.dtype){var p=h.texData.get(c.dataId),d=h.texData.get(l.dataId),f=[[p.complexTensorInfos.real,d.complexTensorInfos.real],[p.complexTensorInfos.imag,d.complexTensorInfos.imag]].map((function(e){var n=(0,E.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new DM(t,c.shape,l.shape);return h.runWebGLProgram(s,[i,o],ss(r.dtype,a.dtype))})),m=(0,E.Z)(f,2),v=m[0],g=m[1],y=BM({inputs:{real:v,imag:g},backend:h});return h.disposeIntermediateTensorInfo(v),h.disposeIntermediateTensorInfo(g),y}var b,x=u||ss(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||h.shouldExecuteOnCPU([c,l]))&&null!=s){var k=h.texData.get(c.dataId).values,w=h.texData.get(l.dataId).values,S="string"===c.dtype?Wv(k):k,I="string"===c.dtype?Wv(w):w,C=s(c.shape,l.shape,S,I,x),T=(0,E.Z)(C,2),N=T[0],R=T[1],A=h.makeTensorInfo(R,x);return h.texData.get(A.dataId).values=N,A}return b=zn().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new PM(n,c.shape,l.shape,a):new DM(t,c.shape,l.shape),h.runWebGLProgram(b,[c,l],x)}}function YM(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?wM:mM;if("relu"===e)return t?IM:yM;if("elu"===e)return t?SM:gM;if("relu6"===e)return t?CM:bM;if("prelu"===e)return t?HM:jM;if("leakyrelu"===e)return t?VM:WM;if("sigmoid"===e)return t?TM:kM;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var QM=Re((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];Te(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=HF(this.outputShape.length);var l=a?t[1]:t[2],h=Math.ceil(l/2),p=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(x="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(h,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(x,";\n        for (int i = 0; i < ").concat(h,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(p,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(m[0],");\n          result += (").concat(f[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),JM={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},$M=Re((function e(t,n,r){Te(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ic(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),eP="return a * b;";function tP(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=ss(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new $M(JM.REAL,a.shape,i.shape),l=new $M(JM.IMAG,a.shape,i.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],p=r.runWebGLProgram(c,h,"float32"),d=r.runWebGLProgram(l,h,"float32"),f=BM({inputs:{real:p,imag:d},backend:r});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(d),f}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),v=r.texData.get(i.dataId),g=OD(a.shape,i.shape,m.values,v.values,o),y=(0,E.Z)(g,2),b=y[0],x=y[1],k=r.makeTensorInfo(x,o);return r.texData.get(k.dataId).values=b,k}return t=zn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new PM(eP,a.shape,i.shape):new DM(eP,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var nP={kernelName:Da,backendName:"webgl",kernelFunc:tP};function rP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=on(a.shape),u=pn(i,s),c=on(u);nn(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var l=o.texData.get(a.dataId);return!l.isPacked||mF(a.shape,u)||null!==l.texture&&mF(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[hF(e.shape)].concat((0,Lt.Z)(pF(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[hF(t)].concat((0,Lt.Z)(pF(t))),o=new uM(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var aP={kernelName:ei,backendName:"webgl",kernelFunc:rP},iP=Re((function e(t,n){Te(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(un(l)?l.toPrecision(2):l,", ones);")}var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),oP=Re((function e(t,n){Te(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,p="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===n?(s="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(p,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(p,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function sP(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=ev(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,h=u.outSize,p=void 0;p="mean"===n?0===o?new iP({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},c):new iP({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h}):new oP({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},n),s=i,i=r.runWebGLProgram(p,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var uP=Re((function e(t,n){Te(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=zF(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var cP=Re((function e(t,n){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=zF(this.rank),o=iM("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function lP(e,t,n){var r=zn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cP(e.shape,t):new uP(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function hP(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=dn(a,e.shape),s=o,u=Vh(s,i),c=null!=u,l=e;c&&(l=lP(e,u,r),s=jh(s.length,i)),Wh("sum",s,i);var h=Bh(l.shape,s),p=(0,E.Z)(h,2),d=p[0],f=p[1],m=d;n&&(m=Uh(d,o));var v=on(f),g=rP({inputs:{x:l},attrs:{shape:[on(e.shape)/v,v]},backend:r}),y=sP(g,us(e.dtype),"sum",r),b=rP({inputs:{x:y},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(l),b}(t.x,r.axis,r.keepDims,n)}var pP={kernelName:ki,backendName:"webgl",kernelFunc:hP};function dP(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var h=s.texData.get(i.dataId).values,p=rM(h,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=p}else t=lP(i,o,s);return t}var fP={kernelName:Gi,backendName:"webgl",kernelFunc:dP},mP=1e3;function vP(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,p=e.activation,d=void 0===p?null:p,f=t.shape.length,m=n.shape.length,v=r?t.shape[f-2]:t.shape[f-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=on(x),S=on(k),I=Ic(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);nn(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var C,T=r?[w,v,y]:[w,y,v],N=a?[S,b,g]:[S,g,b],E=rP({inputs:{x:t},backend:i,attrs:{shape:T}}),R=rP({inputs:{x:n},backend:i,attrs:{shape:N}}),A=[E,R],_=Math.max(w,S),O=r?E.shape[1]:E.shape[2],F=null!=s,D=null!=c,M="leakyrelu"===d,P=null!=d?YM(d,!0):null;if((1===y||1===b)&&O>mP&&!1===(F||D||M||null!=P)){var L=E,z=R;r&&(L=dP({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(L)),a&&(z=dP({inputs:{x:R},backend:i,attrs:{perm:[0,2,1]}}),A.push(z));var B=1===b,U=L;1!==b&&(U=rP({inputs:{x:L},backend:i,attrs:{shape:[_,O,1]}}),A.push(U));var W=1===b?2:1,V=z;B&&(V=rP({inputs:{x:z},backend:i,attrs:{shape:[_,1,O]}}),A.push(V));var G=tP({inputs:{a:U,b:V},backend:i});C=hP({inputs:{x:G},backend:i,attrs:{axis:W,keepDims:!0}}),A.push(G)}else{var j=ss(t.dtype,n.dtype),H=new QM(T,N,[_,y,b],r,a,F,P,D,M),Z=[E,R];if(null!=s&&Z.push(s),D&&Z.push(c),M){var K=i.makeTensorInfo([],"float32",Co(h,"float32"));Z.push(K),A.push(K)}C=i.runWebGLProgram(H,Z,j)}var q=rP({inputs:{x:C},backend:i,attrs:{shape:I}});A.push(C);for(var X=0,Y=A;X<Y.length;X++){var Q=Y[X];i.disposeIntermediateTensorInfo(Q)}return q}var gP={kernelName:Qi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return vP({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},yP="return abs(x);";var bP={kernelName:Gn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=GD(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=zn().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new NM(a.shape,yP):new dM(a.shape,yP),r.runWebGLProgram(t,[a],a.dtype)}},xP=qM({opSnippet:fM+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),kP={kernelName:jn,backendName:"webgl",kernelFunc:xP},wP=qM({opSnippet:fM+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),SP={kernelName:Hn,backendName:"webgl",kernelFunc:wP},IP="return a + b;",CP=XM({opSnippet:IP,packedOpSnippet:IP,supportsComplex:!0,cpuKernelImpl:lD}),TP={kernelName:Zn,backendName:"webgl",kernelFunc:CP},NP=Re((function e(t,n){Te(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),EP=Re((function e(t,n){Te(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var RP={kernelName:Kn,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return LM({inputs:{x:a[0]},backend:r});if(a.length>zn().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return ss(e,t)})),c=a.map((function(e){return e.shape})),l=zn().getBool("WEBGL_PACK")?new EP(a[0].shape,c):new NP(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var AP={kernelName:qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=dn(i,a.shape),c=u,l=Vh(c,s),h=a;null!=l&&(h=dP({inputs:{x:a},backend:n,attrs:{perm:l}}),c=jh(c.length,s)),Wh("all",c,s);var p,d=Bh(h.shape,c),f=(0,E.Z)(d,2),m=f[0],v=rP({inputs:{x:h},backend:n,attrs:{shape:[-1,on(f[1])]}}),g=sP(v,v.dtype,"all",n);return p=rP(o?{inputs:{x:g},backend:n,attrs:{shape:Uh(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),p}};var _P={kernelName:Xn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=dn(i,a.shape),c=u,l=Vh(c,s),h=a;null!=l&&(h=dP({inputs:{x:a},backend:n,attrs:{perm:l}}),c=jh(c.length,s)),Wh("any",c,s);var p,d=Bh(h.shape,c),f=(0,E.Z)(d,2),m=f[0],v=rP({inputs:{x:h},backend:n,attrs:{shape:[-1,on(f[1])]}}),g=sP(v,v.dtype,"any",n);return p=rP(o?{inputs:{x:g},backend:n,attrs:{shape:Uh(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),p}},OP=Re((function e(t,n,r){Te(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),FP=Re((function e(t,n,r,a){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,nn(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=zF(l),p=oM("coords",l);if(1===o){var d=zF(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(p.join(),", 0);\n        ++").concat(p[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(p.join(),", 0);\n        ++").concat(p[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(p.join(),", 0);\n        --").concat(p[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(p.join(),", 0);\n        --").concat(p[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(p[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(p[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(p[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(p[l-2],";");var f=["x","y","z","w","u","v"].slice(0,u),m="."+f[u-1],v=f.map((function(e){return"int "+e})),g=oM("sourceLocR",u-1).concat("inIdx.r"),y=oM("sourceLocG",u-1).concat("inIdx.g"),b=oM("sourceLocB",u-1).concat("inIdx.b"),x=oM("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),S="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),I=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(I,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(p[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(p[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(S,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(S,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function DP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=ev(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new OP(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var h=DP(e,t,n,l);return e.disposeIntermediateTensorInfo(l),h}function MP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=ev(a[a.length-1]),o=new FP(a,i,n,null==r),s=null==r?[t]:[t,r],u=e.runWebGLProgram(o,s,"int32");if(u.shape.length===t.shape.length){var c=MP(e,t,n,u);return e.disposeIntermediateTensorInfo(u),c}return u}function PP(e,t,n,r){var a=[n];if(Wh("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!zn().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=Bh(s.shape,a),c=(0,E.Z)(u,2),l=c[0],h=on(c[1]),p=rP({inputs:{x:s},backend:e,attrs:{shape:[-1,h]}});i.push(p);var d=DP(e,p,r);i.push(d);var f=rP({inputs:{x:d},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),f}return MP(e,t,r)}var LP={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=dn(r.axis,a.shape),o=Vh(i,a.shape.length),s=a,u=[];null!=o&&(s=dP({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=jh(i.length,s.shape.length)),Wh("argMax",[i[0]],s.shape.length);var c=PP(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var zP={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=dn(r.axis,a.shape),o=Vh(i,a.shape.length),s=a,u=[];null!=o&&(s=dP({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=jh(i.length,s.shape.length)),Wh("argMin",[i[0]],s.shape.length);var c=PP(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},BP=qM({opSnippet:fM+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),UP={kernelName:Jn,backendName:"webgl",kernelFunc:BP},WP=qM({opSnippet:fM+"return log(x + sqrt(x * x + 1.0));"}),VP={kernelName:$n,backendName:"webgl",kernelFunc:WP},GP=qM({opSnippet:fM+"\n  return atan(x);\n"}),jP={kernelName:er,backendName:"webgl",kernelFunc:GP},HP=XM({opSnippet:FM+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+MM+"\n  return result;\n"}),ZP={kernelName:nr,backendName:"webgl",kernelFunc:HP},KP=qM({opSnippet:fM+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),qP={kernelName:tr,backendName:"webgl",kernelFunc:KP},XP=Re((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Te(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(p," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var b="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(b="avgValue / max(count, 1.0)");var x=4*Math.floor(o/4),k=o%4,w="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(w,"\n          }\n\n          int xC = xCCorner + ").concat(x,";\n          if (").concat(1===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(2===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(3===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(w,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}})),YP=Re((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Te(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,p=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(p,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(f," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / max(count, 1.0)");var w=4*Math.floor(o/4),S=o%4,I="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(p,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(p,", ch)\n              );\n\n              ").concat(I,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(I,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(I,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                initializationValue\n              );\n\n              ").concat(I,"\n            }\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}}));var QP={kernelName:rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;xF(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;nn(Ul(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Al(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&sn(c.inShape,c.outShape))return LM({inputs:{x:a},backend:n});var l=new XP(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var JP={kernelName:ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=_l(a.shape,i,o,[1,1,1],s,u,c),h=new YP(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},$P=Re((function e(t){Te(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,h=c-1-t.padInfo.left,p=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(h,");\n      const float avgMultiplier = float(").concat(p,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),eL=Re((function e(t){Te(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterDepth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=h-1-t.padInfo.front,m=p-1-t.padInfo.top,v=d-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(h,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var tL={kernelName:or,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=_l(i.shape,o,s,[1,1,1],u,c),h=new eL(l);return n.runWebGLProgram(h,[a],i.dtype)}};var nL={kernelName:ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;xF([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Al(o.shape,s,u,1,c),h=new $P(l);return n.runWebGLProgram(h,[a],o.dtype)}};var rL={kernelName:sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return vP({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},aL=Re((function e(t,n,r,a,i,o){Te(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Ic(t,n),Ic(t,r);var s="0.0";null!=a&&(Ic(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Ic(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),iL=Re((function e(t,n,r,a,i,o){Te(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ic(t,n),Ic(t,r);var s="vec4(0.0)";null!=a&&(Ic(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Ic(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),oL={kernelName:$r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;nn(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),nn(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),nn(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],h=null;null!=s&&(h=s.shape,l.push(s));var p=null;null!=u&&(p=u.shape,l.push(u));var d=zn().getBool("WEBGL_PACK_NORMALIZATION")?new iL(a.shape,i.shape,o.shape,h,p,c):new aL(a.shape,i.shape,o.shape,h,p,c);return n.runWebGLProgram(d,l,l[0].dtype)}},sL=Re((function e(t){Te(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=zF(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return uL.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(uL[t]," = start[").concat(t,"] + coords.").concat(uL[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),uL=["x","y","z","w","u","v"];var cL=Re((function e(t){Te(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=zF(this.rank),r=oM("coords",this.rank),a=oM("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function lL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=fl(a,r.begin,r.size),o=(0,E.Z)(i,2),s=o[0],u=o[1];if(ll(a,s,u),0===on(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var c=n.texData.get(a.dataId),l=jD(c.values,s,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}var h=n.texData.get(a.dataId).isPacked,p=pl(a.shape,s,u);if(h||!p){var d=zn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cL(u):new sL(u),f=[s];return n.runWebGLProgram(d,[a],a.dtype,f)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=dl(t,In(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,s,u,n)}var hL={kernelName:fi,backendName:"webgl",kernelFunc:lL},pL={kernelName:ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;nn(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=nv(a.shape,i,s),c=rv(u.length,i.length),l=av(a.shape,i,s),h=iv(o,i.length),p=ov(l,o,i.length),d=[],f=rP({inputs:{x:a},backend:n,attrs:{shape:u}}),m=dP({inputs:{x:f},backend:n,attrs:{perm:c}}),v=rP({inputs:{x:m},backend:n,attrs:{shape:l}}),g=lL({inputs:{x:v},backend:n,attrs:{begin:h,size:p}});return d.push(f),d.push(m),d.push(v),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var dL={kernelName:cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=hD(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var fL={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=zn().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=zn().getNumber("WEBGL_VERSION");if(r.shouldExecuteOnCPU([a,i])||1===s){var u=r.texData.get(a.dataId).values,c=r.texData.get(i.dataId).values,l=dD(a.shape,i.shape,u,c,a.dtype),h=(0,E.Z)(l,2),p=h[0],d=h[1],f=r.makeTensorInfo(d,a.dtype);return r.texData.get(f.dataId).values=p,f}return t=o?new PM("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",a.shape,i.shape,!1):new DM("\n  return float(int(a.r) & int(b.r));\n",a.shape,i.shape),r.runWebGLProgram(t,[a,i],a.dtype)}};var mL={kernelName:hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=Ic(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},vL=XM({opSnippet:"return float(a != b);",cpuKernelImpl:DD,dtype:"bool"}),gL={kernelName:Pa,backendName:"webgl",kernelFunc:vL};function yL(e){var t=e.inputs,n=e.backend,r=t.input;return LM({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var bL={kernelName:Qa,backendName:"webgl",kernelFunc:yL},xL="return float(int(x));";var kL={kernelName:pr,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return LM({inputs:{x:i},backend:r});var s=Fp(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=BM({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=yL({inputs:{input:i},backend:r}),h=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),h}if(!gn(i.dtype,o)){var p=LM({inputs:{x:i},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var d=r.texData.get(i.dataId).values,f=fD(d,i.shape,i.dtype,o),m=(0,E.Z)(f,3),v=m[0],g=m[1],y=m[2];return r.makeTensorInfo(v,g,y)}if("int32"===o)return function(e,t){var n=new dM(e.shape,xL),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var b=r.makeTensorInfo([],"bool",mn("bool",1)),x=vL({inputs:{a:i,b:b},backend:r});return r.disposeIntermediateTensorInfo(b),x}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},wL="return ceil(x);",SL=qM({opSnippet:wL,packedOpSnippet:wL,cpuKernelImpl:mD}),IL={kernelName:dr,backendName:"webgl",kernelFunc:SL},CL=Re((function e(t){Te(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),TL=Re((function e(t){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var NL={kernelName:fr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=zn().getBool("WEBGL_PACK_CLIP")?new TL(i.shape):new CL(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},EL=Re((function e(t){Te(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function RL(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var AL={kernelName:vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new EL(r.shape),o=[RL(r,a.complexTensorInfos.real),RL(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},_L=Re((function e(t){Te(this,e),this.outputShape=[],this.outputShape=qm(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),OL=Re((function e(t,n){Te(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=qm(t,n);var r=this.outputShape,a=r.length,i=zF(a),o=oM("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),p=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(p,"), vec2(").concat(h.join(),"));\n        }"),f=1;f<u.length;f++){var m=u[f-1];d+="\n        if (".concat(l," < ").concat(u[f],"  && ").concat(l," >= ").concat(u[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(FL(s,l,m),"),\n            vec2(").concat(FL(h,l,m),"));\n        }")}var v=u.length,g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(v,"(").concat(FL(s,l,g),"),\n          vec2(").concat(FL(h,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function FL(e,t,n){var r=e.indexOf(t),a=e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e}));return a.join()}function DL(e){var t=e.inputs,n=e.backend,r=t.input;return LM({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var ML={kernelName:oa,backendName:"webgl",kernelFunc:DL};function PL(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return yL({inputs:{input:e},backend:n})})),i=e.map((function(e){return DL({inputs:{input:e},backend:n})})),o=PL(a,t,n),s=PL(i,t,n),u=BM({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=on(e.shape.slice(t));return rP({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),h=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),p=qm(l.map((function(e){return e.shape})),1),d=1===l[0].shape[0],f=vD(h,p,r,d),m=qm(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,f);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=e.filter((function(e){return on(e.shape)>0})),y=zn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&g[0].shape.length>1;if(1===g.length){var b=y?new dM(e[0].shape,xM):new NM(e[0].shape,xM);return n.runWebGLProgram(b,e,r)}var x=zn().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(g.length>x){for(var k=[],w=0;w<g.length;w+=x){var S=g.slice(w,w+x);k.push(PL(S,t,n))}for(var I=PL(k,t,n),C=0,T=k;C<T.length;C++){var N=T[C];n.disposeIntermediateTensorInfo(N)}return I}if(y){var E=new OL(g.map((function(e){return e.shape})),t);return n.runWebGLProgram(E,g,r)}var R=function(e,t,n){var r=qm(e.map((function(e){return e.shape})),t),a=e.map((function(e){return rP({inputs:{x:e},attrs:{shape:[-1,on(e.shape.slice(t))]},backend:n})}));return{tensors2D:a,outShape:r}}(g,t,n),A=R.tensors2D,_=R.outShape,O=new _L(A.map((function(e){return e.shape}))),F=n.runWebGLProgram(O,A,r);A.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var D=rP({inputs:{x:F},attrs:{shape:_},backend:n});return n.disposeIntermediateTensorInfo(F),D}function LL(e){var t=e.inputs,n=e.backend,r=dn(e.attrs.axis,t[0].shape)[0];Km(t.map((function(e){return e.shape})),r);var a=qm(t.map((function(e){return e.shape})),r);if(0===on(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return on(e.shape)>0}));return 1===i.length?LM({inputs:{x:i[0]},backend:n}):PL(i,r,n)}var zL={kernelName:gr,backendName:"webgl",kernelFunc:LL},BL=Re((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Te(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,p=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),UL=Re((function e(t){Te(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,p=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),WL=Re((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Te(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=HF(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,h=l,p="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",d=0;d<l;d++)p+="\n           vec4 xTexelC".concat(2*d,";\n           int xTexelC").concat(2*d,"Ready;\n           vec4 xTexelC").concat(2*d+1,";\n           int xTexelC").concat(2*d+1,"Ready;\n           vec4 xC").concat(d,";");p+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var f=0;f<l;f++)p+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");p+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var m=0;m<(h+1)/2;m++){var v=2*m;if(p+="\n           xC = xCCorner + ".concat(v*u,";\n           "),1===s){if(v<l&&(o%2===1?(p+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n               "),p+=1===u&&v>0?"\n                 xC".concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(v," = vec4(previous.zw, xTexelC").concat(v,".xy);\n                   } else {\n                     xC").concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,".xy);\n                   }\n                   ")):p+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xC").concat(v," = xTexelC").concat(v,";\n                 "),v+1<l)){var g=o%2===0?$t(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(p+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                     xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(v+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(v+1,"Ready = 1;\n                   }\n                   "),p+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,".xy);\n                     } else {\n                      xC").concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,".xy);\n                     }\n                     "):"\n                     xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".xy);\n                     ")):p+=1===g?"\n                     xC".concat(v+1," = xTexelC").concat(v,";\n                     "):"\n                     xCOffset = xC + ".concat(g,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                       xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(v+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(v+1,"Ready = 1;\n                     }\n\n                     xC").concat(v+1," = xTexelC").concat(v+1,";\n                     ")}}else v<l&&(o%2===1?(p+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n               "),v+1<l&&(p+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(v+1," = vec4(xTexelC").concat(v+1,".xy, final.xy);\n                 "))):(p+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(\n                   xTexelC").concat(v,".xy, xTexelC").concat(v+1,".xy);\n               "),v+1<l&&(p+="\n                   xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n                 "))));v<l&&(p+="\n             wTexel = getW(r, ".concat(v,", d1, d2);\n             dotProd += xC").concat(v,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(v,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),v+1<l&&(p+="\n               wTexel = getW(r, ".concat(v+1,", d1, d2);\n               dotProd += xC").concat(v+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(v+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}p+="\n     }\n   ",p+="\n     }\n   ",p+="\n     }\n   ";var y="",b="";r&&(y=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),b="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(y,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(p,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(x,"\n         ").concat(b,"\n         setOutput(result);\n       }\n     ")})),VL=Re((function e(t,n){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=HF(this.outputShape.length);for(var r=n.dataFormat,a=wF(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var h=0;h<=1;h++)c+="\n          blockIndex = rc.z + ".concat(h,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+h,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+h,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function GL(e,t){var n=e.length;return n>=3?[].concat((0,Lt.Z)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function jL(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,p=e.activation,d=void 0===p?null:p,f=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=f[0]*f[1]*f[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=GL(c.shape,b);null!=k&&(c=rP({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=GL(s.shape,b);null!=w&&(s=rP({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if(!((1===g||1===y)&&v>mP)&&m.isPacked&&b&&null!=m.texture&&f[2]%2!==0&&sn(m.shape.slice(-3),f.slice(-3))){var S=f[0]*f[1]*(f[2]+1),I={dataId:n.dataId,shape:[1,S,a.inChannels],dtype:n.dtype},C=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,nn(mF(m.shape,I.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(I.shape," isn't free")}));var T=rP({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var N=vP({a:I,b:T,backend:i,transposeA:!1,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h}),E=i.texData.get(N.dataId);nn(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=C,E.shape=a.outShape,(t=LM({inputs:{x:N},backend:i})).shape=a.outShape,x.push(N)}else{var R=a.outHeight*a.outWidth,A=rP({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,R,a.inChannels]:[a.batchSize,a.inChannels,R]}}),_=rP({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),O=vP({a:b?A:_,b:b?_:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h});t=rP({inputs:{x:O},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(_),x.push(O)}for(var F=0,D=x;F<D.length;F++){var M=D[F];i.disposeIntermediateTensorInfo(M)}return t}function HL(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,p=void 0===h?null:h,d=r.filterWidth,f=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*f*m,x=g*v,k=[r.batchSize,b,x],w=[];if(null!=u){var S=GL(u.shape,y);null!=S&&(u=rP({inputs:{x:u},backend:a,attrs:{shape:S}}),w.push(u))}if(null!=o){var I=GL(o.shape,y);null!=I&&(o=rP({inputs:{x:o},backend:a,attrs:{shape:I}}),w.push(o))}var C=rP({inputs:{x:n},backend:a,attrs:{shape:[1,b,on(n.shape)/b]}});w.push(C);var T=new VL(k,r),N=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],E=a.runWebGLProgram(T,[t],"float32",N),R=rP({inputs:{x:E},backend:a,attrs:{shape:k}});w.push(E),w.push(R);var A=null!=o,_=null!=u,O="leakyrelu"===p,F=p?YM(p,!0):null,D=new QM(y?R.shape:C.shape,y?C.shape:R.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,F,_,O),M=y?[R,C]:[C,R];if(o&&M.push(o),_&&M.push(u),O){var P=a.makeTensorInfo([],"float32",Co(l,"float32"));M.push(P),w.push(P)}var L=a.runWebGLProgram(D,M,"float32"),z=rP({inputs:{x:L},backend:a,attrs:{shape:r.outShape}});w.push(L);for(var B=0,U=w;B<U.length;B++){var W=U[B];a.disposeIntermediateTensorInfo(W)}return z}var ZL={kernelName:yr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode,p=Vl(c),d=Ol(i.shape,o.shape,s,l,u,h,!1,p);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===p&&zn().getBool("WEBGL_EXP_CONV")){var f=new WL(d),m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];t=r.runWebGLProgram(f,[i,o],"float32",m)}else if(zn().getBool("WEBGL_CONV_IM2COL"))t=HL({x:i,filter:o,convInfo:d,backend:r});else{var v=new BL(d);t=r.runWebGLProgram(v,[i,o],"float32")}else t=jL({x:i,filter:o,convInfo:d,backend:r});var g=rP({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),g}},KL=Re((function e(t){Te(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              ").concat(o?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),qL=Re((function e(t){Te(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,h=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(h,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),XL=Re((function e(t){Te(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),YL=Re((function e(t){Te(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var QL={kernelName:br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=Vl(u),p=Ol(a.shape,l,o,1,s,c,!1,h),d=new KL(p);return n.runWebGLProgram(d,[a,i],"float32")}},JL=Re((function e(t){Te(this,e),this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=HF(this.outputShape.length);var n=t.filterHeight,r=t.filterWidth,a=n-1-t.padInfo.top,i=r-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(t.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(t.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}));var $L={kernelName:xr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,h=Vl(c),p=Ol(o,i.shape,s,1,u,l,!1,h);if(zn().getBool("WEBGL_PACK")&&"channelsLast"===h){var d=[[p.strideHeight,p.strideWidth]],f=new JL(p);return n.runWebGLProgram(f,[a,i],"float32",d)}var m=new qL(p);return n.runWebGLProgram(m,[a,i],"float32")}};var ez={kernelName:kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Fl(a.shape,i.shape,o,u,s),l=new UL(c);return n.runWebGLProgram(l,[a,i],"float32")}};var tz={kernelName:wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Fl(a.shape,u,o,1,s),l=new XL(c);return n.runWebGLProgram(l,[a,i],"float32")}};var nz,rz={kernelName:Sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=Fl(r.inputShape,i.shape,s,1,o),c=new YL(u);return n.runWebGLProgram(c,[a,i],"float32")}},az=qM({opSnippet:KM+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(MM,"\n  return result;\n")}),iz={kernelName:Ir,backendName:"webgl",kernelFunc:az},oz=qM({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),sz={kernelName:Cr,backendName:"webgl",kernelFunc:oz},uz=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=(0,E.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=(0,E.Z)(n,1)[0],p=(0,E.Z)(r,2),d=p[0],f=p[1];this.outputShape=[h,d,f,l];var m="bilinear"===a?1:0,v="".concat(u-1,".0"),g="".concat(c-1,".0"),y=d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(v)],b=(0,E.Z)(y,3),x=b[0],k=b[1],w=b[2],S=f>1?["".concat((c-1)/(f-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],I=(0,E.Z)(S,3),C=I[0],T=I[1],N=I[2];this.userCode="\n      const float height_ratio = float(".concat(x,");\n      const float width_ratio = float(").concat(C,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(k,";\n        float width_scale = ").concat(T,";\n\n        float in_y = ").concat(w,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(N,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),cz={kernelName:Er,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new uz(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(nz||(nz={}));var lz=Re((function e(t,n,r,a){Te(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===nz.Prod?"1.0":"0.0",s=r?o:"getX(".concat(hz(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(zF(i)," coords = getOutputCoords();\n        int end = ").concat(pz(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(pz(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(hz(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function hz(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function pz(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function dz(e,t,n,r,a,i){var o=t.shape.length,s=Vh([r],o),u=t;null!=s&&(u=dP({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=jh(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));for(var l=u.shape[c],h=LM({inputs:{x:u},backend:n}),p=0;p<=Math.ceil(Math.log2(l))-1;p++){var d=new lz(e,u.shape,!1,i),f=[[p]],m=h;h=n.runWebGLProgram(d,[h],h.dtype,f),n.disposeIntermediateTensorInfo(m)}if(a){var v=new lz(e,u.shape,a,i),g=h;h=n.runWebGLProgram(v,[h],h.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=dP({inputs:{x:h},backend:n,attrs:{perm:Gh(s)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(u),y}return h}var fz={kernelName:Tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return dz(nz.Prod,a,n,i,o,s)}};var mz={kernelName:Nr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return dz(nz.Sum,a,n,i,o,s)}};var vz={kernelName:Rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=hD(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var h=n.bufferSync(a),p=n.bufferSync(i),d=pD(h,p,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},gz=function(){function e(t,n,r){Te(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return Re(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var yz={kernelName:Ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),h=new gz("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(h,[a],a.dtype)}},bz=Re((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Te(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=HF(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(h,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),xz=Re((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Te(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=HF(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,p=h,d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",f=0;f<h;f++)d+="\n          vec4 xTexelC".concat(2*f,";\n          int xTexelC").concat(2*f,"Ready;\n          vec4 xTexelC").concat(2*f+1,";\n          int xTexelC").concat(2*f+1,"Ready;\n          vec4 xC").concat(f,";");d+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<h;m++)d+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(p+1)/2;v++){var g=2*v;if(d+="\n          xC = xCCorner + ".concat(g*c,";\n          "),1===u){if(g<h&&(s%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),d+=1===c&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<h)){var y=s%2===0?$t(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),d+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                    } else {\n                     xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                    }\n                    "):"\n                    xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                    ")):d+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<h&&(s%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<h&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<h&&(d+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<h&&(d+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<h&&(d+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(k,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}));var kz={kernelName:_r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),nn(Ul(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var h,p=Ol(a.shape,i.shape,o,l,s,c,!0);h=zn().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?new xz(p):new bz(p);var d=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return n.runWebGLProgram(h,[a,i],"float32",d)}},wz=Re((function e(t){Te(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Sz=Re((function e(t){Te(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var Iz={kernelName:Or,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,h=Ol(a.shape,l,o,s,u,c,!0),p=new wz(h);return n.runWebGLProgram(p,[a,i],"float32")}};var Cz={kernelName:Fr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=Ol(r.inputShape,i.shape,o,s,u,c,!0),h=new Sz(l);return n.runWebGLProgram(h,[a,i],"float32")}},Tz=Re((function e(t){Te(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var Nz={kernelName:Dr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat((0,Lt.Z)(r.shape),(0,Lt.Z)(r.shape)),i=on(r.shape),o=rP({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new Tz(i),u=n.runWebGLProgram(s,[o],o.dtype),c=rP({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},Ez=Re((function e(t){Te(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,h=a.top,p=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(p,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var Rz={kernelName:Mr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Rl(i.shape,o.shape,s,u,"NHWC",c),h=new Ez(l),p=rP({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),p}};var Az={kernelName:Ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Iv(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;Tv(i.length,s,r);for(var u=Nv(o,s),c=u.path,l=u.steps,h=l.length,p=null,d=i.length,f=[],m=0;m<h;++m){var v,g=Kt(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Cv(d,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;Ev(x)?w=r[y]:(w=dP({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),f.push(w));for(var S=w.shape.slice(),I=0;I<k.length;++I)S.splice(k[I],0,1);sn(w.shape,S)||(w=rP({inputs:{x:w},backend:n,attrs:{shape:S}}),f.push(w)),null===p?p=w:(p=tP({inputs:{a:w,b:p},backend:n}),f.push(p))}}catch($Q){g.e($Q)}finally{g.f()}m<h-1&&(c[m]>=0&&(p=hP({inputs:{x:p},backend:n,attrs:{axis:c[m]-(i.length-d),keepDims:!1}}),f.push(p)),d--)}for(var C=0,T=f;C<T.length;C++){var N=T[C];N!==p&&n.disposeIntermediateTensorInfo(N)}return p}},_z=qM({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),Oz={kernelName:Wr,backendName:"webgl",kernelFunc:_z},Fz={kernelName:Vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=zn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new PM("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new DM("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},Dz=XM({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:gD}),Mz={kernelName:jr,backendName:"webgl",kernelFunc:Dz},Pz=qM({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(lv,";\n  float a1 = ").concat(hv,";\n  float a2 = ").concat(pv,";\n  float a3 = ").concat(dv,";\n  float a4 = ").concat(fv,";\n  float a5 = ").concat(mv,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),Lz={kernelName:Gr,backendName:"webgl",kernelFunc:Pz},zz=qM({opSnippet:KM+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:yD,dtype:"float32"}),Bz={kernelName:Hr,backendName:"webgl",kernelFunc:zz};function Uz(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(nn(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),rP({inputs:{x:i},backend:r,attrs:{shape:s}})}var Wz={kernelName:Zr,backendName:"webgl",kernelFunc:Uz},Vz="return exp(x) - 1.0;",Gz=qM({opSnippet:Vz,packedOpSnippet:Vz,cpuKernelImpl:bD}),jz={kernelName:Kr,backendName:"webgl",kernelFunc:Gz},Hz=Re((function e(t,n,r){Te(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function Zz(e,t,n){var r=n.texData.get(e.dataId),a=on(e.shape),i=e.shape[e.shape.length-1],o=rP({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new Hz("real",s,t),c=new Hz("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),p=n.runWebGLProgram(c,l,"float32"),d=BM({inputs:{real:h,imag:p},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p);var f=rP({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),f}var Kz={kernelName:qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return Zz(t.input,!1,n)}},qz=Re((function e(t,n){Te(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function Xz(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||kn(a))){var o=vn(i,on(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new qz(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var Yz,Qz={kernelName:Xr,backendName:"webgl",kernelFunc:Xz},Jz=Re((function e(t){Te(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),$z={kernelName:Yr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new Jz(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},eB="return floor(x);",tB=qM({opSnippet:eB,packedOpSnippet:eB,cpuKernelImpl:xD}),nB={kernelName:Qr,backendName:"webgl",kernelFunc:tB},rB=XM({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),aB={kernelName:Jr,backendName:"webgl",kernelFunc:rB},iB=Re((function e(t){Te(this,e),this.variableNames=["A"];var n=wF(),r=(0,E.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),oB=Re((function e(t){Te(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=wF(),r=(0,E.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),sB={kernelName:Xi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=(0,E.Z)(u,2),l=c[0],h=c[1],p=[h,l],d=[h,l,i];if(s||o){var f=zn().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=Yz&&f===uB||(uB=f,Yz=document.createElement("canvas").getContext("2d",{willReadFrequently:uB})),Yz.canvas.width=l,Yz.canvas.height=h,Yz.drawImage(a,0,0,l,h),a=Yz.canvas}var m=n.makeTensorInfo(p,"int32");n.texData.get(m.dataId).usage=WO.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(m.dataId),a);var v=zn().getBool("WEBGL_PACK")?new oB(d):new iB(d),g=n.runWebGLProgram(v,[m],"int32");return n.disposeData(m.dataId),g}},uB=zn().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var cB={kernelName:Ji,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,h=a.dataFormat,p=a.dilations,d=a.dimRoundingMode,f=a.activation,m=a.leakyreluAlpha,v=Vl(h),g=Ol(i.shape,o.shape,c,p,l,d,!1,v),y=[],b=null!=s,x=null!=u,k="leakyrelu"===f,w=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=rP({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,h)),x&&e.push(t(u,h)),k){var n=r.makeTensorInfo([],"float32",Co(m,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===v&&zn().getBool("WEBGL_EXP_CONV")){var S=f?YM(f,!0):null,I=new WL(g,b,S,x,k),C=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=w();t=r.runWebGLProgram(I,T,"float32",C)}else if(zn().getBool("WEBGL_CONV_IM2COL"))t=HL({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});else{var N=f?YM(f,!1):null,E=new BL(g,b,N,x,k),R=w();t=r.runWebGLProgram(E,R,"float32")}else t=jL({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});var A=rP({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var lB={kernelName:$i,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,h=r.dimRoundingMode,p=r.activation,d=r.leakyreluAlpha,f=[],m=l;null==m&&(m=[1,1]),nn(Ul(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=Ol(a.shape,i.shape,u,m,c,h,!0),y=zn().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=p?YM(p,y):null,x=[a,i],k=null!=o,w=null!=s,S="leakyrelu"===p;if(k&&x.push(o),w&&x.push(s),S){var I=n.makeTensorInfo([],"float32",Co(d,"float32"));x.push(I),f.push(I)}v=y?new xz(g,k,b,w,S):new bz(g,k,b,w,S);var C=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(v,x,"float32",C);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},hB=Re((function e(t,n,r,a){Te(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=zF(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var pB={kernelName:ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=on(r.shape),u=sv(r,a),c=(0,E.Z)(u,4),l=c[0],h=c[1],p=c[2],d=c[3],f=rP({inputs:{x:a},backend:n,attrs:{shape:[h,o]}}),m=rP({inputs:{x:r},backend:n,attrs:{shape:[on(r.shape)/p,p]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),g=n.bufferSync(r),y=kD(v,g,r.dtype,h,o,p,d,r.shape,s);return n.makeTensorInfo(l,r.dtype,y.values)}var b=new hB(o,d,[h,p],r.shape),x=n.runWebGLProgram(b,[m,f],m.dtype),k=rP({inputs:{x:x},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),k}},dB=Re((function e(t,n){Te(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=zF(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function fB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=dn(o,a.shape)[0];if(zn().get("DEBUG"))for(var c=n.readSync(i.dataId),l=a.shape[u],h=function(){var e=c[p];nn(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},p=0;p<c.length;++p)h();var d=Uv(a,i,u,s),f=on(i.shape),m=[],v=rP({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=rP({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}});m.push(v),m.push(g);var y=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(v),k=wD(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d.outputShape,k.dtype,k.values)}var w=new dB(v.shape,y),S=n.runWebGLProgram(w,[v,g],v.dtype);m.push(S);var I=rP({inputs:{x:S},backend:n,attrs:{shape:d.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),I}var mB={kernelName:ea,backendName:"webgl",kernelFunc:fB},vB=XM({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:SD,dtype:"bool"}),gB={kernelName:na,backendName:"webgl",kernelFunc:vB},yB=XM({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:ID}),bB={kernelName:ra,backendName:"webgl",kernelFunc:yB};var xB={kernelName:ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return Zz(t.input,!0,n)}},kB=qM({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),wB={kernelName:sa,backendName:"webgl",kernelFunc:kB},SB=qM({opSnippet:"return float(isinf(x));",dtype:"bool"}),IB={kernelName:ua,backendName:"webgl",kernelFunc:SB},CB=qM({opSnippet:"return float(isnan(x));",dtype:"bool"}),TB={kernelName:ca,backendName:"webgl",kernelFunc:CB},NB=XM({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:CD,dtype:"bool"}),EB={kernelName:ha,backendName:"webgl",kernelFunc:NB},RB=XM({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:TD,dtype:"bool"}),AB={kernelName:pa,backendName:"webgl",kernelFunc:RB};var _B={kernelName:da,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=ND(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},OB=qM({opSnippet:KM+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:ED}),FB={kernelName:fa,backendName:"webgl",kernelFunc:OB},DB=qM({opSnippet:KM+"\n  return log(1.0 + x);\n"}),MB={kernelName:ma,backendName:"webgl",kernelFunc:DB},PB=XM({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),LB={kernelName:va,backendName:"webgl",kernelFunc:PB},zB=qM({opSnippet:"return float(!(x >= 1.0));"}),BB={kernelName:ga,backendName:"webgl",kernelFunc:zB},UB=XM({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),WB={kernelName:ya,backendName:"webgl",kernelFunc:UB},VB=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),GB=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),jB={kernelName:ba,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=zn().getBool("WEBGL_PACK_NORMALIZATION")?new GB(a.shape,i,o,s,u):new VB(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},HB=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),ZB={kernelName:xa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,h=new HB(a.shape,s,u,c,l);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function KB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=dn(i,a.shape),c=u,l=Vh(c,s),h=null!=l,p=n.shouldExecuteOnCPU([a]),d=a;if(h){if(p){for(var f=n.texData.get(d.dataId).values,m=new Array(s),v=0;v<m.length;v++)m[v]=a.shape[l[v]];var g=rM(f,a.shape,a.dtype,l,m);d=n.makeTensorInfo(m,a.dtype),n.texData.get(d.dataId).values=g}else d=lP(a,l,n);c=jh(c.length,s)}Wh("max",c,s);var y,b=Bh(d.shape,c),x=(0,E.Z)(b,2),k=x[0],w=x[1],S=k;if(o&&(S=Uh(k,u)),p){var I=n.texData.get(d.dataId).values,C=RD(I,on(w),S,a.dtype);y=n.makeTensorInfo(S,a.dtype),n.texData.get(y.dataId).values=C}else y=function(e,t,n,r){var a=on(t),i=rP({inputs:{x:e},attrs:{shape:[on(e.shape)/a,a]},backend:r}),o=sP(i,e.dtype,"max",r),s=rP({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(d,w,S,n);return h&&n.disposeIntermediateTensorInfo(d),y}var qB={kernelName:ka,backendName:"webgl",kernelFunc:KB},XB=XM({opSnippet:FM+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+MM+"\n  return result;\n",cpuKernelImpl:AD}),YB={kernelName:wa,backendName:"webgl",kernelFunc:XB};var QB={kernelName:Sa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;xF(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;nn(Ul(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Al(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&sn(c.inShape,c.outShape))return LM({inputs:{x:a},backend:n});var l=new XP(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var JB={kernelName:Ca,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=_l(a.shape,i,o,[1,1,1],s,c,u),h=new YP(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},$B=Re((function e(t){Te(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),eU=Re((function e(t){Te(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,h=u-1-t.padInfo.front,p=c-1-t.padInfo.top,d=l-1-t.padInfo.left,f=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(p,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var tU={kernelName:Ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=_l(i.shape,o,s,[1,1,1],u,c),h=new YP(l,"max",!0),p=n.runWebGLProgram(h,[i],i.dtype),d=new eU(l),f=n.runWebGLProgram(d,[a,p],i.dtype);return n.disposeIntermediateTensorInfo(p),f}};var nU={kernelName:Ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;xF([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=Al(o.shape,s,u,1,c,l),p=new XP(h,"max",!0),d=n.runWebGLProgram(p,[o],o.dtype),f=new $B(h),m=n.runWebGLProgram(f,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),m}};var rU={kernelName:Na,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;nn(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];nn(Ul(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")}));var h=Al(a.shape,i,o,l,s),p=function(e,t,n,r){var a=new XP(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new XP(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,h,c),d=(0,E.Z)(p,2);return[d[0],d[1]]}};var aU={kernelName:Ea,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=dn(o,a.shape),l=c,h=Vh(l,u),p=null!=h,d=s.shouldExecuteOnCPU([a]),f=[],m=a;if(p){if(d){for(var v=s.texData.get(m.dataId).values,g=new Array(u),y=0;y<g.length;y++)g[y]=a.shape[h[y]];var b=rM(v,a.shape,a.dtype,h,g);m=s.makeTensorInfo(g,a.dtype),s.texData.get(m.dataId).values=b}else m=lP(a,h,s);f.push(m),l=jh(l.length,u)}Wh("sum",l,u);var x=Bh(m.shape,l),k=(0,E.Z)(x,2),w=k[0],S=k[1],I=w;i&&(I=Uh(w,c));for(var C=function(e,t,n,r){var a=on(t),i=rP({inputs:{x:e},attrs:{shape:[on(e.shape)/a,a]},backend:r}),o=sP(i,"float32","mean",r),s=rP({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,S,I,s),T=0,N=f;T<N.length;T++){var R=N[T];s.disposeIntermediateTensorInfo(R)}return C}};var iU={kernelName:Ra,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=dn(i,a.shape),c=u,l=Vh(c,s),h=a;null!=l&&(h=dP({inputs:{x:a},backend:n,attrs:{perm:l}}),c=jh(c.length,a.shape.length)),Wh("min",c,s);var p,d=Bh(h.shape,c),f=(0,E.Z)(d,2),m=f[0],v=rP({inputs:{x:h},backend:n,attrs:{shape:[-1,on(f[1])]}}),g=sP(v,v.dtype,"min",n);return p=rP(o?{inputs:{x:g},backend:n,attrs:{shape:Uh(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),p}},oU=XM({opSnippet:FM+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+MM+"\n  return result;\n",cpuKernelImpl:_D}),sU={kernelName:Aa,backendName:"webgl",kernelFunc:oU},uU=Re((function e(t,n,r){Te(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=zF(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),cU=Re((function e(t,n,r){Te(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=zF(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=oM("rc",a),c=oM("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p="reflect"===r?0:1,d="";if(1===a){var f="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(p,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(p,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(f,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(f,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(p,") +\n                gte * ((end - 1) * 2 - source + ").concat(p,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),lU={kernelName:_a,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=zn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cU(a.shape,i,o):new uU(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},hU=XM({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+MM+"\n  return result;\n"}),pU={kernelName:Oa,backendName:"webgl",kernelFunc:hU},dU=Re((function e(t,n,r){Te(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),fU=XM({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),mU={kernelName:Br,backendName:"webgl",kernelFunc:fU},vU="return a - b;",gU=XM({opSnippet:vU,packedOpSnippet:vU,supportsComplex:!0,cpuKernelImpl:eM}),yU={kernelName:Li,backendName:"webgl",kernelFunc:gU};function bU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=dn([r.dim],a.shape),o=KB({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=Uh(o.shape,i),u=rP({inputs:{x:o},backend:n,attrs:{shape:s}}),c=gU({inputs:{a:a,b:u},backend:n}),l=zz({inputs:{x:c},backend:n}),h=hP({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),p=rP({inputs:{x:h},backend:n,attrs:{shape:s}}),d=fU({inputs:{a:l,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),d}var xU={kernelName:Ii,backendName:"webgl",kernelFunc:bU};var kU={kernelName:Fa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:bU({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],h=new dU(c,l,i),p=[[o]],d=n.runWebGLProgram(h,[u],"int32",p);return s||n.disposeIntermediateTensorInfo(u),d}},wU=fM+"\n  return -x;\n";var SU={kernelName:Ma,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=FD(i.values,a.shape,a.dtype),s=(0,E.Z)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=zn().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new NM(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new dM(a.shape,wU),r.runWebGLProgram(t,[a],a.dtype)}},IU=qf;var CU={kernelName:La,backendName:"webgl",kernelFunc:function(e){eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=IU(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},TU=Xf;var NU={kernelName:za,backendName:"webgl",kernelFunc:function(e){eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),h=n.readSync(i.dataId),p=TU(l,h,o,s,u,c),d=p.selectedIndices,f=p.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},EU=Yf;var RU={kernelName:Ba,backendName:"webgl",kernelFunc:function(e){eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),h=n.readSync(i.dataId),p=EU(l,h,o,s,u,c),d=p.selectedIndices,f=p.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},AU=Re((function e(t,n,r,a){Te(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),_U={kernelName:Wa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=on(a.shape),l=new AU(c,o,s,u),h=rP({inputs:{x:a},backend:n,attrs:{shape:[c]}}),p=n.runWebGLProgram(l,[h],i);n.disposeIntermediateTensorInfo(h);var d=rP({inputs:{x:p},backend:n,attrs:{shape:[].concat((0,Lt.Z)(a.shape),[o])}});return n.disposeIntermediateTensorInfo(p),d}};function OU(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=yL({inputs:{input:r},backend:n}),i=OU({inputs:{x:a},backend:n}),o=DL({inputs:{input:r},backend:n}),s=OU({inputs:{x:o},backend:n}),u=BM({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return Xz({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var FU={kernelName:Ki,backendName:"webgl",kernelFunc:OU};var DU={kernelName:Ua,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=yL({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=DL({inputs:{input:a},backend:r}),u=OU({inputs:{x:s},backend:r}),c=BM({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return Xz({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var MU={kernelName:Va,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Uz({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){rn(a,e.shape,"All tensors passed to stack must have matching shapes"),nn(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=LL({inputs:t.map((function(e){var t=Uz({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},PU=Re((function e(t,n,r){Te(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=zF(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),LU=Re((function e(t,n,r){Te(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=zF(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=oM("rc",a),c=oM("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,v=1===a?2:4;m<v;m++)f+="\n        ".concat(p[m],"\n        if (").concat(d,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");f+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),zU=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===on(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return Xz({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=zn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LU(a.shape,i,o):new PU(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},BU={kernelName:Ga,backendName:"webgl",kernelFunc:zU},UU=XM({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+MM+"\n  return result;\n"}),WU={kernelName:ja,backendName:"webgl",kernelFunc:UU};var VU={kernelName:Za,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=dn(o,i.shape),h=l,p=Vh(h,u),d=i;if(null!=p&&(d=dP({inputs:{x:i},backend:r,attrs:{perm:p}}),h=jh(h.length,u),c.push(d)),Wh("prod",h,u),r.shouldExecuteOnCPU([d])){var f=r.texData.get(d.dataId).values,m=MD(d.shape,d.dtype,f,h),v=m.outVals,g=m.outShape,y=m.outDtype;t=r.makeTensorInfo(g,y,v)}else{var b=Bh(d.shape,h),x=(0,E.Z)(b,2),k=x[0],w=on(x[1]),S=rP({inputs:{x:d},backend:r,attrs:{shape:[-1,w]}}),I=sP(S,us(i.dtype),"prod",r);t=rP({inputs:{x:I},backend:r,attrs:{shape:k}}),c.push(S),c.push(I)}if(s){c.push(t);var C=Uh(t.shape,l);t=rP({inputs:{x:t},backend:r,attrs:{shape:C}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var GU={kernelName:Ka,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=r.outputRaggedRank,u=a.map((function(e){return n.readSync(e.dataId)})),c=a.map((function(e){return e.shape})),l=n.readSync(i.dataId),h=n.readSync(o.dataId),p=PD(u,c,l,i.shape,i.dtype,h,o.shape,s),d=(0,E.Z)(p,3),f=d[0],m=d[1],v=d[2],g=f.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),y=n.makeTensorInfo(v,i.dtype,m);return g.concat([y])}};var jU={kernelName:qa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=LD(o,r.shape,r.dtype,s,a.shape,u,i.shape),l=(0,E.Z)(c,2),h=l[0],p=l[1];return[n.makeTensorInfo([h.length],"int32",h),n.makeTensorInfo([p.length],r.dtype,p)]}};var HU={kernelName:Xa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=n.readSync(o.dataId),p=s.map((function(e){return n.readSync(e.dataId)})),d=s.map((function(e){return e.shape})),f=zD(c,a.shape,l,i.shape,i.dtype,h,o.shape,p,d,u),m=(0,E.Z)(f,2),v=m[0],g=m[1];return n.makeTensorInfo(v,i.dtype,g)}},ZU=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=BD(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},KU={kernelName:Ya,backendName:"webgl",kernelFunc:ZU},qU=qM({opSnippet:"return 1.0 / x;"}),XU={kernelName:Ja,backendName:"webgl",kernelFunc:qU},YU=qM({opSnippet:fM+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),QU={kernelName:$a,backendName:"webgl",kernelFunc:YU},JU=qM({opSnippet:fM+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),$U={kernelName:ii,backendName:"webgl",kernelFunc:JU},eW=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,E.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),tW=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,E.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],",\n          ").concat(p[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var nW={kernelName:ri,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,E.Z)(s,2),c=u[0],l=u[1],h=zn().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tW(a.shape,c,l,i,o):new eW(a.shape,c,l,i,o);return n.runWebGLProgram(h,[a],"float32")}},rW=Re((function e(t,n,r){Te(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,E.Z)(n,3),i=a[1],o=a[2],s=(0,E.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=l[0]/h[0],d=l[1]/h[1],f=1/p,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var aW={kernelName:ai,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new rW(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},iW=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,E.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r],f=a?"0.5":"0.0";h=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),oW=Re((function e(t,n,r,a,i){Te(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,E.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r],f=a?"0.5":"0.0";h=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/d[0],",\n          ").concat(p[1]/d[1],",\n          ").concat(p[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var sW={kernelName:ti,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,E.Z)(s,2),c=u[0],l=u[1],h=zn().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new oW(a.shape,c,l,i,o):new iW(a.shape,c,l,i,o);return n.runWebGLProgram(h,[a],a.dtype)}},uW=Re((function e(t,n,r){Te(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,E.Z)(n,3),i=a[1],o=a[2],s=(0,E.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=l[0]/h[0],d=l[1]/h[1],f=1/p,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var cW={kernelName:ni,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new uW(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},lW=Re((function e(t,n){Te(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=zF(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),hW=Re((function e(t,n){Te(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=oM("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=zF(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var pW={kernelName:oi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=dn(i,a.shape);if(0===o)return LM({inputs:{x:a},backend:n});var u=zn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hW(a.shape,s):new lW(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},dW=Re((function e(t,n){Te(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),fW={kernelName:Yi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new dW(a.shape,o),l=tv(s,a.shape[1],a.shape[2]),h=(0,E.Z)(l,2),p=[[h[0],h[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,p)}},mW=qM({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),vW={kernelName:si,backendName:"webgl",kernelFunc:mW},gW=qM({opSnippet:"return inversesqrt(x);",cpuKernelImpl:UD}),yW={kernelName:ui,backendName:"webgl",kernelFunc:gW},bW=Re((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Te(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=zF(i.length),c=zF(o.length),l="";1===r?l="i":2===r&&(l="i, j");var h="getIndices(".concat(l,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),f="";s&&(f="coords[0], coords[1]");var m="getDefaultValue(".concat(f,")"),v=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(h,");\n              flattenedIndex += index * ").concat(v,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(m,", sum, float(found)));\n        }\n      ")})),xW=Re((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Te(this,e),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var u=zF(i.length),c=zF(o.length),l="";1===r?l="i":2===r&&(l="i, j");var h="getIndices(".concat(l,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),f="";s&&(f="coords[0], coords[1]");var m="getDefaultValue(".concat(f,")"),v=n>1?"strides[j]":"strides",g=n>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(t,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(n,"; j+=2) {\n              ivec4 index = round(").concat(h,");\n              flattenedIndex += index.xz * ").concat(v,";\n              if (j + 1 < ").concat(n,") {\n                flattenedIndex += index.yw * ").concat(g,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(m,", sum, found));\n        }\n      ")}));var kW={kernelName:ci,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=tf(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,d=[p/l,l];if(0===p)return n.makeTensorInfo(o,a.dtype);var f,m=rP({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=rP({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));f=zn().getBool("WEBGL_PACK")?new xW(c,u,m.shape.length,v.shape.length,h,d):new bW(c,u,m.shape.length,v.shape.length,h,d);var y=n.runWebGLProgram(f,[v,m,g],v.dtype),b=rP({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}},wW=Re((function e(t,n,r,a){Te(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===zn().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var SW={kernelName:hi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new wW(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},IW=Re((function e(t,n,r){var a,i;if(Te(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=zF(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var CW={kernelName:pi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new IW(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],ss(a.dtype,i.dtype))}},TW=qM({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(uv,";\n  float scale = ").concat(cv,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),NW={kernelName:di,backendName:"webgl",kernelFunc:TW},EW=qM({opSnippet:KM+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:VD}),RW={kernelName:yi,backendName:"webgl",kernelFunc:EW},AW=qM({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),_W={kernelName:gi,backendName:"webgl",kernelFunc:AW},OW=qM({opSnippet:KM+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(MM,"\n  return result;\n")}),FW={kernelName:mi,backendName:"webgl",kernelFunc:OW},DW=qM({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),MW={kernelName:vi,backendName:"webgl",kernelFunc:DW},PW=qM({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),LW={kernelName:bi,backendName:"webgl",kernelFunc:PW},zW={kernelName:wi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;nn(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,(0,Lt.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],h=zU({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=nv(h.shape,i,s,!1),d=rv(p.length,i.length,!1),f=av(h.shape,i,s,!1),m=rP({inputs:{x:h},backend:n,attrs:{shape:p}}),v=dP({inputs:{x:m},backend:n,attrs:{perm:d}}),g=rP({inputs:{x:v},backend:n,attrs:{shape:f}});return l.push(h),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var BW={kernelName:Ci,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],h=HD(s,r.shape,r.dtype,u,a.dtype,c,l),p=(0,E.Z)(h,5),d=p[0],f=p[1],m=p[2],v=p[3],g=p[4];return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([f[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};var UW={kernelName:Ti,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=ZD(s,r.shape,r.dtype,o,u),l=(0,E.Z)(c,3),h=l[0],p=l[1],d=l[2];return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}};var WW={kernelName:Ni,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=KD(o,r.shape,r.dtype,s,u,!0),l=(0,E.Z)(c,2),h=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,h)}};var VW={kernelName:Ei,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=KD(o,r.shape,r.dtype,s,u),l=(0,E.Z)(c,2),h=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,h)}};var GW={kernelName:Ri,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=tf(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.sliceSize,p=u.strides,d=u.outputSize;if("string"===i.dtype){var f=n.bufferSync(a),m=n.bufferSync(i),v=Ro(n.readSync(o.dataId)[0]),g=WD(f,m,s,d,h,l,c,p,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new bW(l,c,a.shape.length,i.shape.length,p,[d,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=rP({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var jW={kernelName:Si,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=dn(r.axis,a.shape)[0],s=Av(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=(0,Lt.Z)(l);t[o]=e;var r=lL({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},HW="return sqrt(x);",ZW=qM({opSnippet:HW,packedOpSnippet:HW,cpuKernelImpl:qD}),KW={kernelName:xi,backendName:"webgl",kernelFunc:ZW},qW={kernelName:_i,backendName:"webgl",kernelFunc:qM({opSnippet:"return x * x;"})},XW="return (a - b) * (a - b);",YW=XM({opSnippet:XW,packedOpSnippet:XW}),QW={kernelName:Ai,backendName:"webgl",kernelFunc:YW};var JW={kernelName:Oi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;if("string"!==a.dtype)throw new Error("Input must be of datatype string");var i=Wv(n.readSync(a.dataId)),o=XD(i,"string",r);return n.makeTensorInfo(a.shape,"string",o)}};var $W={kernelName:qi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=fM+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new dM(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},eV=Re((function e(t,n,r){Te(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=zF(r.length),o=zF(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var tV={kernelName:Fi,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,h=a.ellipsisMask,p=a.newAxisMask,d=a.shrinkAxisMask,f=ml(i.shape,o,s,u,c,l,h,p,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=rP({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){nn(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=hl(x,k,w),I=lL({inputs:{x:i},backend:r,attrs:{begin:x,size:S}});t=rP({inputs:{x:I},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(I)}else{if(r.shouldExecuteOnCPU([i])){var C=r.readSync(i.dataId),T=ju(i.shape,i.dtype,C),N=YD(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,N.values)}else{var E=new eV(x,w,m);t=r.runWebGLProgram(E,[i],i.dtype)}}var R=rP({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),R}};var nV={kernelName:Di,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,h=t.dataSplits,p=n.readSync(l.dataId),d=n.readSync(h.dataId),f=QD(p,d,a,i,o,s,u,c),m=(0,E.Z)(f,2),v=m[0],g=m[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(h.shape,"int32",g)]}};var rV={kernelName:Mi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=JD(o,s,r),c=(0,E.Z)(u,3),l=c[0],h=c[1],p=c[2],d=h.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(p))]}};var aV={kernelName:Pi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=$D(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},iV=qM({opSnippet:"return tan(x);"}),oV={kernelName:zi,backendName:"webgl",kernelFunc:iV},sV=qM({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),uV={kernelName:Bi,backendName:"webgl",kernelFunc:sV};var cV={kernelName:li,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.tensor,i=t.indices,o=t.updates;!function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(r);var s=tf(0,i,a.shape),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,d=[p/l,l];if(0===p)return n.makeTensorInfo(a.shape,i.dtype);var f=rP({inputs:{x:i},backend:n,attrs:{shape:[c,u]}}),m=rP({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),v=rP({inputs:{x:a},backend:n,attrs:{shape:d}}),g=new bW(c,u,f.shape.length,m.shape.length,h,d,!1,!0),y=n.runWebGLProgram(g,[m,f,v],v.dtype),b=rP({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),b}},lV=Re((function e(t,n){Te(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=zF(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function hV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Ro(e)})):o,u=ju(a.shape,a.dtype,s),c=tM(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new lV(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var pV={kernelName:Ui,backendName:"webgl",kernelFunc:hV},dV=Re((function e(t){Te(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),fV=Re((function e(t){Te(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function mV(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function vV(e){for(var t=1;t<e;)t*=2;return t}var gV={kernelName:Wi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=zn().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=zn().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var h=n.readSync(a.dataId),p=nM(h,c,a.dtype,i,o),d=(0,E.Z)(p,2),f=d[0],m=d[1];return[n.makeTensorInfo(f.shape,f.dtype,f.values),n.makeTensorInfo(m.shape,m.dtype,m.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,Xz({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),g=null!==v&&v.isPacked,y=g?n.unpackTensor(a):a,b=on(c)/l,x=rP({inputs:{x:y},attrs:{shape:[b,l]},backend:n});g&&mV(n,y);for(var k=vV(i),w=vV(l),S=null,I=function(){return null===S?[x,x]:[x,S]},C=function(e,t,r){var a=I(),i=new dV(r),o=[[l],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(i,a,"int32",o),mV(n,s)},T=1;T<k;T*=2)for(var N=2*T,R=T;R>=1;R/=2)C(N,R,[b,w]);for(var A=w;A>k;A/=2){var _=I(),O=new fV([b,A/2]),F=[[l],[null===S?1:0],[k]],D=S;S=n.runWebGLProgram(O,_,"int32",F),mV(n,D);for(var M=k/2,P=2*M,L=M;L>=1;L/=2)C(P,L,S.shape)}var z=S;S=lL({inputs:{x:S},backend:n,attrs:{begin:0,size:[b,i]}}),mV(n,z);var B=fB({inputs:{x:x,indices:S},backend:n,attrs:{axis:1,batchDims:1}});mV(n,x);var U=c.slice(0,-1);U.push(i),z=S,S=rP({inputs:{x:S},attrs:{shape:U},backend:n}),mV(n,z);var W=B;return B=rP({inputs:{x:B},attrs:{shape:U},backend:n}),mV(n,W),[B,S]}},yV=Re((function e(t,n,r,a,i,o){Te(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var bV={kernelName:Vi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=(0,E.Z)(a.shape,4),h=l[0],p=l[1],d=l[2],f=l[3],m=null!=c?c:[p,d],v=(0,E.Z)(m,2),g=v[0],y=v[1],b=new yV(p,d,o,s,u,[h,g,y,f]);return n.runWebGLProgram(b,[a,i],"float32")}};var xV={kernelName:ji,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;xF(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=aM(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var kV={kernelName:Hi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var p=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){d[i]=v;var g=lL({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=rP({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,p.push(g)}return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},wV=Re((function e(t,n){Te(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(p,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var SV={kernelName:Zi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Vh([c],s),h=a;null!=l&&(h=dP({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(h),c=jh(1,s)[0]);var p=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(h.shape,c,o),d=on([h.shape[c]]),f=rP({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});u.push(f);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=function(e,t){var n,r=!1;for(e<=$m?(n=e,r=!0):n=Sn(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Sn(e,n+1);return n}(c,o),h=new wV({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),p=n.compileAndRun(h,[t,a],i);if(u.push(p),p.shape[1]===o)return p;var d=ZU({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=hV({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(f),e(p,r,f,i,o)}(f,"unsortedSegmentSum",i,us(a.dtype),o),v=rP({inputs:{x:m},backend:n,attrs:{shape:p}}),g=v;if(null!=l){u.push(v);var y=Gh(l);g=dP({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},IV=0,CV=[gP,bP,kP,SP,TP,RP,AP,_P,LP,zP,UP,VP,jP,ZP,qP,QP,JP,tL,nL,rL,oL,pL,dL,fL,mL,kL,IL,NL,UM,AL,zL,ZL,QL,$L,ez,tz,rz,iz,sz,cz,fz,mz,vz,yz,kz,Iz,Cz,Nz,Rz,Az,Oz,Fz,Mz,Lz,Bz,Wz,jz,Kz,Qz,$z,nB,aB,sB,cB,lB,pB,mB,gB,bB,zM,xB,ML,wB,IB,TB,GM,EB,AB,_B,FB,MB,LB,BB,WB,jB,ZB,qB,YB,QB,JB,tU,nU,rU,aU,iU,sU,lU,pU,kU,nP,SU,CU,NU,RU,gL,_U,DU,MU,BU,WU,ZM,VU,GU,jU,HU,KU,bL,mU,XU,QU,$U,aP,nW,aW,sW,cW,pW,fW,vW,yW,kW,SW,CW,NW,RW,_W,FW,MW,hL,xU,LW,zW,BW,UW,WW,VW,GW,jW,KW,qW,QW,JW,$W,tV,nV,rV,aV,yU,pP,oV,uV,cV,pV,gV,bV,fP,xV,kV,SV,FU];IV<CV.length;IV++){oo(CV[IV])}var TV=n(97),NV=n.n(TV),EV=n(2509),RV=function(e,t){return(RV=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function AV(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}RV(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var _V=function(){return(_V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function OV(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function FV(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function DV(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}var MV=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],PV=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],LV={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},zV={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},BV=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],UV=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function WV(e){return e instanceof SVGAnimatedLength?e.baseVal.value:e}function VV(e){return OV(this,void 0,void 0,(function(){var t,n;return FV(this,(function(r){switch(r.label){case 0:return t=document.createElement("canvas"),e instanceof Jo?[4,il(e,t)]:[3,2];case 1:return r.sent(),[3,3];case 2:t.width=WV(e.width),t.height=WV(e.height),n=t.getContext("2d"),e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),r.label=3;case 3:return[2,t]}}))}))}function GV(e){return OV(this,void 0,void 0,(function(){var t,n,r,a,i,o;return FV(this,(function(s){switch(s.label){case 0:return e instanceof Jo?(t=e.shape.slice(0,2),n=t[0],r=t[1],a=ImageData.bind,[4,il(e)]):[3,2];case 1:return[2,new(a.apply(ImageData,[void 0,s.sent(),r,n]))];case 2:return i=document.createElement("canvas"),o=i.getContext("2d"),i.width=WV(e.width),i.height=WV(e.height),o.drawImage(e,0,0),[2,o.getImageData(0,0,i.width,i.height)]}}))}))}function jV(e){return OV(this,void 0,void 0,(function(){var t;return FV(this,(function(n){switch(n.label){case 0:return e instanceof SVGImageElement||e instanceof OffscreenCanvas?[4,VV(e)]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=e,n.label=3;case 3:return[2,sl(t,4)]}}))}))}function HV(e){if(e<0||e>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(e));if(!Number.isInteger(e))throw new Error("Mask value must be an integer but got ".concat(e))}var ZV={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},KV=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return OV(this,void 0,void 0,(function(){return FV(this,(function(e){return[2,this.mask]}))}))},e.prototype.toImageData=function(){return OV(this,void 0,void 0,(function(){return FV(this,(function(e){return[2,GV(this.mask)]}))}))},e.prototype.toTensor=function(){return OV(this,void 0,void 0,(function(){return FV(this,(function(e){return[2,jV(this.mask)]}))}))},e.prototype.getUnderlyingType=function(){return"canvasimagesource"},e}();function qV(e){return HV(e),"person"}var XV=function(){function e(e){var t,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new EV.Pose({locateFile:function(t,n){if(e.solutionPath){var r=e.solutionPath.replace(/\/+$/,"");return"".concat(r,"/").concat(t)}return"".concat(n,"/").concat(t)}}),e.modelType){case"lite":t=0;break;case"heavy":t=2;break;default:t=1}this.poseSolution.setOptions({modelComplexity:t,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(e){if(n.height=e.image.height,n.width=e.image.width,null==e.poseLandmarks)n.poses=[];else{var t=n.translateOutput(e.poseLandmarks,e.poseWorldLandmarks);e.segmentationMask&&(t.segmentation={maskValueToLabel:qV,mask:new KV(e.segmentationMask)}),n.poses=[t]}}))}return e.prototype.translateOutput=function(e,t){var n=this,r={keypoints:e.map((function(e,t){return{x:e.x*n.width,y:e.y*n.height,z:e.z,score:e.visibility,name:PV[t]}}))};return null!=t&&(r.keypoints3D=t.map((function(e,t){return{x:e.x,y:e.y,z:e.z,score:e.visibility,name:PV[t]}}))),r},e.prototype.estimatePoses=function(e,t,n){return OV(this,void 0,void 0,(function(){var r,a;return FV(this,(function(i){switch(i.label){case 0:return t&&t.flipHorizontal&&t.flipHorizontal!==this.selfieMode&&(this.selfieMode=t.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Jo?(a=ImageData.bind,[4,il(e)]):[3,2];case 1:return r=new(a.apply(ImageData,[void 0,i.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:r=e,i.label=3;case 3:return e=r,[4,this.poseSolution.send({image:e},n)];case 4:return i.sent(),[2,this.poses]}}))}))},e.prototype.dispose=function(){this.poseSolution.close()},e.prototype.reset=function(){this.poseSolution.reset()},e.prototype.initialize=function(){return this.poseSolution.initialize()},e}();function YV(e){return OV(this,void 0,void 0,(function(){var t,n;return FV(this,(function(r){switch(r.label){case 0:return t=function(e){if(null==e)return _V({},ZV);var t=_V({},e);return t.runtime="mediapipe",null==t.enableSegmentation&&(t.enableSegmentation=ZV.enableSegmentation),null==t.enableSmoothing&&(t.enableSmoothing=ZV.enableSmoothing),null==t.smoothSegmentation&&(t.smoothSegmentation=ZV.smoothSegmentation),null==t.modelType&&(t.modelType=ZV.modelType),t}(e),[4,(n=new XV(t)).initialize()];case 1:return r.sent(),[2,n]}}))}))}function QV(e){return e instanceof Jo?{height:e.shape[0],width:e.shape[1]}:{height:e.height,width:e.width}}function JV(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function $V(e){return e instanceof Jo?e:sl(e)}function eG(e,t,n){return tG(n,"inputResolution"),[1/n.width*e[0][0]*t.width,1/n.height*e[0][1]*t.width,e[0][3]*t.width,1/n.width*e[1][0]*t.height,1/n.height*e[1][1]*t.height,e[1][3]*t.height,0,0]}function tG(e,t){nn(0!==e.width,(function(){return"".concat(t," width cannot be 0.")})),nn(0!==e.height,(function(){return"".concat(t," height cannot be 0.")}))}function nG(e,t,n){var r=n.rotationVectorStartKeypointIndex,a=n.rotationVectorEndKeypointIndex,i=e.locationData,o=i.relativeKeypoints[r].x*t.width,s=i.relativeKeypoints[r].y*t.height,u=i.relativeKeypoints[a].x*t.width,c=i.relativeKeypoints[a].y*t.height,l=2*Math.sqrt((u-o)*(u-o)+(c-s)*(c-s)),h=function(e,t,n){var r,a=e.locationData,i=n.rotationVectorStartKeypointIndex,o=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var s=a.relativeKeypoints[i].x*t.width,u=a.relativeKeypoints[i].y*t.height,c=a.relativeKeypoints[o].x*t.width,l=a.relativeKeypoints[o].y*t.height;return JV(r-Math.atan2(-(l-u),c-s))}(e,t,n);return{xCenter:o/t.width,yCenter:s/t.height,width:l/t.width,height:l/t.height,rotation:h}}function rG(e){if(16!==e.length)throw new Error("Array length must be 16 but got ".concat(e.length));return[[e[0],e[1],e[2],e[3]],[e[4],e[5],e[6],e[7]],[e[8],e[9],e[10],e[11]],[e[12],e[13],e[14],e[15]]]}function aG(e,t,n,r,a,i,o){return e[t][a]*(e[n][i]*e[r][o]-e[n][o]*e[r][i])}function iG(e,t,n){var r=(t+1)%4,a=(t+2)%4,i=(t+3)%4,o=(n+1)%4,s=(n+2)%4,u=(n+3)%4;return aG(e,r,a,i,o,s,u)+aG(e,a,i,r,o,s,u)+aG(e,i,r,a,o,s,u)}function oG(e,t,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],a=0,i=e;a<i.length;a++){var o=i[a],s=o.x-.5,u=o.y-.5,c=n.ignoreRotation?0:t.rotation,l=Math.cos(c)*s-Math.sin(c)*u,h=Math.sin(c)*s+Math.cos(c)*u;l=l*t.width+t.xCenter,h=h*t.height+t.yCenter;var p=o.z*t.width,d=_V({},o);d.x=l,d.y=h,d.z=p,r.push(d)}return r}function sG(e,t){var n=function(e,t,n,r){var a=(r-n)/255;return{scale:a,offset:n-0*a}}(0,0,t[0],t[1]);return Yu((function(){return nc(ic(e,n.scale),n.offset)}))}function uG(e,t,n){var r,a,i,o,s,u,c,l,h,p,d,f,m=t.outputTensorSize,v=t.keepAspectRatio,g=t.borderMode,y=t.outputTensorFloatRange,b=QV(e),x=function(e,t){return t?{xCenter:t.xCenter*e.width,yCenter:t.yCenter*e.height,width:t.width*e.width,height:t.height*e.height,rotation:t.rotation}:{xCenter:.5*e.width,yCenter:.5*e.height,width:e.width,height:e.height,rotation:0}}(b,n),k=function(e,t,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=t.height,a=t.width;tG(t,"targetSize"),tG(e,"roi");var i,o,s=r/a,u=e.height/e.width,c=0,l=0;return s>u?(i=e.width,o=e.width*s,l=(1-u/s)/2):(i=e.height/s,o=e.height,c=(1-s/u)/2),e.width=i,e.height=o,{top:l,left:c,right:c,bottom:l}}(x,m,v),w=(r=x,a=b.width,i=b.height,!1,o=r.width,s=r.height,1,u=Math.cos(r.rotation),c=Math.sin(r.rotation),l=r.xCenter,h=r.yCenter,p=1/a,d=1/i,(f=new Array(16))[0]=o*u*1*p,f[1]=-s*c*p,f[2]=0,f[3]=(-.5*o*u*1+.5*s*c+l)*p,f[4]=o*c*1*d,f[5]=s*u*d,f[6]=0,f[7]=(-.5*s*u-.5*o*c*1+h)*d,f[8]=0,f[9]=0,f[10]=o*p,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,rG(f));return{imageTensor:Yu((function(){var t=$V(e),n=Yd(eG(w,b,m),[1,8]),r="zero"===g?"constant":"nearest",a=zm.transform(Jh(Hu(t,"float32")),n,"bilinear",r,0,[m.height,m.width]);return null!=y?sG(a,y):a})),padding:k,transformationMatrix:w}}function cG(e,t,n,r){return 1===r?.5*(e+t):e+(t-e)*n/(r-1)}function lG(e){return null!=e&&null!=e.currentTime}function hG(e){for(var t={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=0;o<e.length;++o){var s=e[o];n=Math.min(n,s.x),r=Math.max(r,s.x),a=Math.min(a,s.y),i=Math.max(i,s.y),t.locationData.relativeKeypoints.push({x:s.x,y:s.y})}return t.locationData.relativeBoundingBox={xMin:n,yMin:a,xMax:r,yMax:i,width:r-n,height:i-a},t}function pG(e,t,n,r){return OV(this,void 0,void 0,(function(){var r,a,i,o,s;return FV(this,(function(u){switch(u.label){case 0:return e.sort((function(e,t){return Math.max.apply(Math,t.score)-Math.max.apply(Math,e.score)})),r=Yd(e.map((function(e){return[e.locationData.relativeBoundingBox.yMin,e.locationData.relativeBoundingBox.xMin,e.locationData.relativeBoundingBox.yMax,e.locationData.relativeBoundingBox.xMax]}))),a=Xd(e.map((function(e){return e.score[0]}))),[4,zm.nonMaxSuppressionAsync(r,a,t,n)];case 1:return[4,(i=u.sent()).array()];case 2:return o=u.sent(),s=e.filter((function(e,t){return o.indexOf(t)>-1})),Qu([r,a,i]),[2,s]}}))}))}function dG(e,t){return e.map((function(e){var n=_V(_V({},e),{x:e.x*t.width,y:e.y*t.height});return null!=e.z&&(n.z=e.z*t.width),n}))}function fG(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S,I,C,T;return FV(this,(function(N){switch(N.label){case 0:if(r=jd(t,[0]),a=r.shape,i=a[0],o=a[1],s=a[2],e.length!==s)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+"".concat(e.length,", heatmap length: ").concat(s));return u=[],[4,r.buffer()];case 1:for(c=N.sent(),l=0;l<e.length;l++)if(h=e[l],p=_V({},h),u.push(p),d=Math.trunc(p.x*o),f=Math.trunc(p.y*i),!(d<0||d>=o||f<0||d>=i)){for(m=Math.trunc((n.kernelSize-1)/2),v=Math.max(0,d-m),g=Math.min(o,d+m+1),y=Math.max(0,f-m),b=Math.min(i,f+m+1),x=0,k=0,w=0,S=0,I=y;I<b;++I)for(C=v;C<g;++C)T=c.get(I,C,l),x+=T,S=Math.max(S,T),k+=C*T,w+=I*T;S>=n.minConfidenceToRefine&&x>0&&(p.x=k/o/x,p.y=w/i/x)}return r.dispose(),[2,u]}}))}))}function mG(e,t){var n=t.left,r=t.top,a=t.left+t.right,i=t.top+t.bottom;return e.map((function(e){return _V(_V({},e),{x:(e.x-n)/(1-a),y:(e.y-r)/(1-i),z:e.z/(1-a)})}))}function vG(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s;return FV(this,(function(u){switch(u.label){case 0:return r=e[0],a=e[1],i=function(e,t,n){return Yu((function(){var r,a,i,o;n.reverseOutputOrder?(a=jd(Yl(e,[0,n.boxCoordOffset+0],[-1,1])),r=jd(Yl(e,[0,n.boxCoordOffset+1],[-1,1])),o=jd(Yl(e,[0,n.boxCoordOffset+2],[-1,1])),i=jd(Yl(e,[0,n.boxCoordOffset+3],[-1,1]))):(r=jd(Yl(e,[0,n.boxCoordOffset+0],[-1,1])),a=jd(Yl(e,[0,n.boxCoordOffset+1],[-1,1])),i=jd(Yl(e,[0,n.boxCoordOffset+2],[-1,1])),o=jd(Yl(e,[0,n.boxCoordOffset+3],[-1,1]))),a=nc(ic(ac(a,n.xScale),t.w),t.x),r=nc(ic(ac(r,n.yScale),t.h),t.y),n.applyExponentialOnBoxSize?(i=ic(Qh(ac(i,n.hScale)),t.h),o=ic(Qh(ac(o,n.wScale)),t.w)):(i=ic(ac(i,n.hScale),t.h),o=ic(ac(o,n.wScale),t.h));var s=bc(r,ac(i,2)),u=bc(a,ac(o,2)),c=nc(r,ac(i,2)),l=nc(a,ac(o,2)),h=Kl([jl(s,[n.numBoxes,1]),jl(u,[n.numBoxes,1]),jl(c,[n.numBoxes,1]),jl(l,[n.numBoxes,1])],1);if(n.numKeypoints)for(var p=0;p<n.numKeypoints;++p){var d=n.keypointCoordOffset+p*n.numValuesPerKeypoint,f=void 0,m=void 0;n.reverseOutputOrder?(f=jd(Yl(e,[0,d],[-1,1])),m=jd(Yl(e,[0,d+1],[-1,1]))):(m=jd(Yl(e,[0,d],[-1,1])),f=jd(Yl(e,[0,d+1],[-1,1])));var v=nc(ic(ac(f,n.xScale),t.w),t.x),g=nc(ic(ac(m,n.yScale),t.h),t.y);h=Kl([h,jl(v,[n.numBoxes,1]),jl(g,[n.numBoxes,1])],1)}return h}))}(a,t,n),o=Yu((function(){var e=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(e=ch(r,-n.scoreClippingThresh,n.scoreClippingThresh)),e=Xl(e)):e})),[4,gG(i,o,n)];case 1:return s=u.sent(),Qu([i,o]),[2,s]}}))}))}function gG(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s,u,c,l,h,p,d,f;return FV(this,(function(m){switch(m.label){case 0:return r=[],[4,e.data()];case 1:return a=m.sent(),[4,t.data()];case 2:for(i=m.sent(),o=0;o<n.numBoxes;++o)if(!(null!=n.minScoreThresh&&i[o]<n.minScoreThresh||(s=o*n.numCoords,u=yG(a[s+0],a[s+1],a[s+2],a[s+3],i[o],n.flipVertically,o),(c=u.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((l=u.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,p=0;p<h;p+=n.numValuesPerKeypoint)d=s+n.keypointCoordOffset+p,f={x:a[d+0],y:n.flipVertically?1-a[d+1]:a[d+1]},l.relativeKeypoints.push(f);r.push(u)}return[2,r]}}))}))}function yG(e,t,n,r,a,i,o){return{score:[a],ind:o,locationData:{relativeBoundingBox:{xMin:t,yMin:i?1-n:e,xMax:r,yMax:i?1-e:n,width:r-t,height:n-e}}}}function bG(e,t){return"none"===e?t:function(e){return 1/(1+Math.exp(-e))}(t)}function xG(e,t,n,r){return OV(this,void 0,void 0,(function(){var a,i,o,s,u,c,l,h;return FV(this,(function(p){switch(p.label){case 0:return n=n||t.flipHorizontally||!1,r=r||t.flipVertically||!1,a=e.size,i=a/t.numLandmarks,[4,e.data()];case 1:for(o=p.sent(),s=[],u=0;u<t.numLandmarks;++u)c=u*i,(h={x:0,y:0}).x=n?t.inputImageWidth-o[c]:o[c],i>1&&(h.y=r?t.inputImageHeight-o[c+1]:o[c+1]),i>2&&(h.z=o[c+2]),i>3&&(h.score=bG(t.visibilityActivation,o[c+3])),s.push(h);for(l=0;l<s.length;++l)(h=s[l]).x=h.x/t.inputImageWidth,h.y=h.y/t.inputImageHeight,h.z=h.z/t.inputImageWidth/(t.normalizeZ||1);return[2,s]}}))}))}function kG(e,t,n){var r=e.width,a=e.height,i=e.rotation;if(null==n.rotation&&null==n.rotationDegree||(i=function(e,t){return null!=t.rotation?e+=t.rotation:null!=t.rotationDegree&&(e+=Math.PI*t.rotationDegree/180),JV(e)}(i,n)),0===i)e.xCenter=e.xCenter+r*n.shiftX,e.yCenter=e.yCenter+a*n.shiftY;else{var o=(t.width*r*n.shiftX*Math.cos(i)-t.height*a*n.shiftY*Math.sin(i))/t.width,s=(t.width*r*n.shiftX*Math.sin(i)+t.height*a*n.shiftY*Math.cos(i))/t.height;e.xCenter=e.xCenter+o,e.yCenter=e.yCenter+s}if(n.squareLong){var u=Math.max(r*t.width,a*t.height);r=u/t.width,a=u/t.height}else if(n.squareShort){var c=Math.min(r*t.width,a*t.height);r=c/t.width,a=c/t.height}return e.width=r*n.scaleX,e.height=a*n.scaleY,e}function wG(e,t){return e.map((function(e){var n=_V(_V({},e),{x:e.x/t.width,y:e.y/t.height});return null!=e.z&&(e.z=e.z/t.width),n}))}var SG=function(){function e(e){this.alpha=e,this.initialized=!1}return e.prototype.apply=function(e,t){var n;return this.initialized?n=null==t?this.storedValue+this.alpha*(e-this.storedValue):this.storedValue+this.alpha*t*Math.asinh((e-this.storedValue)/t):(n=e,this.initialized=!0),this.rawValue=e,this.storedValue=n,n},e.prototype.applyWithAlpha=function(e,t,n){return this.alpha=t,this.apply(e,n)},e.prototype.hasLastRawValue=function(){return this.initialized},e.prototype.lastRawValue=function(){return this.rawValue},e.prototype.reset=function(){this.initialized=!1},e}(),IG=function(){function e(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new SG(this.getAlpha(this.minCutOff)),this.dx=new SG(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return e.prototype.apply=function(e,t,n){if(null==e)return e;var r=Math.trunc(t);if(this.lastTimestamp>=r)return e;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var a=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*n*this.frequency:0,i=this.dx.applyWithAlpha(a,this.getAlpha(this.derivateCutOff)),o=this.minCutOff+this.beta*Math.abs(i),s=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(i):null;return this.x.applyWithAlpha(e,this.getAlpha(o),s)},e.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},e}(),CG=function(){function e(e){this.config=e}return e.prototype.apply=function(e,t,n){var r=this;if(null==e)return this.reset(),null;this.initializeFiltersIfEmpty(e);var a=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return DV([],e,!0);a=1/n}return e.map((function(e,n){var i=_V(_V({},e),{x:r.xFilters[n].apply(e.x,t,a),y:r.yFilters[n].apply(e.y,t,a)});return null!=e.z&&(i.z=r.zFilters[n].apply(e.z,t,a)),i}))},e.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},e.prototype.initializeFiltersIfEmpty=function(e){var t=this;null!=this.xFilters&&this.xFilters.length===e.length||(this.xFilters=e.map((function(e){return new IG(t.config)})),this.yFilters=e.map((function(e){return new IG(t.config)})),this.zFilters=e.map((function(e){return new IG(t.config)})))},e}(),TG=function(){function e(e){this.config=e,this.window=[],this.lowPassFilter=new SG(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return e.prototype.apply=function(e,t,n){if(null==e)return e;var r,a=Math.trunc(t);if(this.lastTimestamp>=a)return e;if(-1===this.lastTimestamp)r=1;else{for(var i=e*n-this.lastValue*this.lastValueScale,o=a-this.lastTimestamp,s=i,u=o,c=(1+this.window.length)*(1e6/30),l=0,h=this.window;l<h.length;l++){var p=h[l];if(u+p.duration>c)break;s+=p.distance,u+=p.duration}var d=s/(1e-6*u);r=1-1/(1+this.config.velocityScale*Math.abs(d)),this.window.unshift({distance:i,duration:o}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=n,this.lastTimestamp=a,this.lowPassFilter.applyWithAlpha(e,r)},e}(),NG=function(){function e(e){this.config=e}return e.prototype.apply=function(e,t,n){var r=this;if(null==e)return this.reset(),null;var a=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return DV([],e,!0);a=1/n}return this.initializeFiltersIfEmpty(e),e.map((function(e,n){var i=_V(_V({},e),{x:r.xFilters[n].apply(e.x,t,a),y:r.yFilters[n].apply(e.y,t,a)});return null!=e.z&&(i.z=r.zFilters[n].apply(e.z,t,a)),i}))},e.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},e.prototype.initializeFiltersIfEmpty=function(e){var t=this;null!=this.xFilters&&this.xFilters.length===e.length||(this.xFilters=e.map((function(e){return new TG(t.config)})),this.yFilters=e.map((function(e){return new TG(t.config)})),this.zFilters=e.map((function(e){return new TG(t.config)})))},e}(),EG=function(){function e(e){if(null!=e.velocityFilter)this.keypointsFilter=new NG(e.velocityFilter);else{if(null==e.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+"".concat(e,"."));this.keypointsFilter=new CG(e.oneEuroFilter)}}return e.prototype.apply=function(e,t,n,r,a){if(void 0===r&&(r=!1),null==e)return this.keypointsFilter.reset(),null;var i=null!=a?function(e,t){return(e.width*t.width+e.height*t.height)/2}(a,n):1,o=r?dG(e,n):e,s=this.keypointsFilter.apply(o,t,i);return r?wG(s,n):s},e}(),RG=function(){function e(e){this.alpha=e.alpha}return e.prototype.apply=function(e){var t=this;if(null==e)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===e.length||(this.visibilityFilters=e.map((function(e){return new SG(t.alpha)})));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=_V({},a);i.score=this.visibilityFilters[r].apply(a.score),n.push(i)}return n},e}(),AG={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},_G={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},OG={maxPoses:1,flipHorizontal:!1},FG={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},DG={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},MG={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},PG={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},LG={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},zG={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},BG={kernelSize:7,minConfidenceToRefine:.5},UG={alpha:.1},WG={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},VG={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},GG={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},jG={activation:"none"},HG={combineWithPreviousRatio:.7},ZG=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return OV(this,void 0,void 0,(function(){return FV(this,(function(e){return[2,VV(this.mask)]}))}))},e.prototype.toImageData=function(){return OV(this,void 0,void 0,(function(){return FV(this,(function(e){return[2,GV(this.mask)]}))}))},e.prototype.toTensor=function(){return OV(this,void 0,void 0,(function(){return FV(this,(function(e){return[2,this.mask]}))}))},e.prototype.getUnderlyingType=function(){return"tensor"},e}();function KG(e){return HV(e),"person"}var qG=function(){function e(e,t,n,r,a,i){this.detectorModel=e,this.landmarkModel=t,this.enableSmoothing=n,this.enableSegmentation=r,this.smoothSegmentation=a,this.modelType=i,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(e){null==e.reduceBoxesInLowestLayer&&(e.reduceBoxesInLowestLayer=!1),null==e.interpolatedScaleAspectRatio&&(e.interpolatedScaleAspectRatio=1),null==e.fixedAnchorSize&&(e.fixedAnchorSize=!1);for(var t=[],n=0;n<e.numLayers;){for(var r=[],a=[],i=[],o=[],s=n;s<e.strides.length&&e.strides[s]===e.strides[n];){var u=cG(e.minScale,e.maxScale,s,e.strides.length);if(0===s&&e.reduceBoxesInLowestLayer)i.push(1),i.push(2),i.push(.5),o.push(.1),o.push(u),o.push(u);else{for(var c=0;c<e.aspectRatios.length;++c)i.push(e.aspectRatios[c]),o.push(u);if(e.interpolatedScaleAspectRatio>0){var l=s===e.strides.length-1?1:cG(e.minScale,e.maxScale,s+1,e.strides.length);o.push(Math.sqrt(u*l)),i.push(e.interpolatedScaleAspectRatio)}}s++}for(var h=0;h<i.length;++h){var p=Math.sqrt(i[h]);r.push(o[h]/p),a.push(o[h]*p)}var d=0,f=0;if(e.featureMapHeight.length>0)d=e.featureMapHeight[n],f=e.featureMapWidth[n];else{var m=e.strides[n];d=Math.ceil(e.inputSizeHeight/m),f=Math.ceil(e.inputSizeWidth/m)}for(var v=0;v<d;++v)for(var g=0;g<f;++g)for(var y=0;y<r.length;++y){var b={xCenter:(g+e.anchorOffsetX)/f,yCenter:(v+e.anchorOffsetY)/d,width:0,height:0};e.fixedAnchorSize?(b.width=1,b.height=1):(b.width=a[y],b.height=r[y]),t.push(b)}n=s}return t}(AG);var o=Xd(this.anchors.map((function(e){return e.width}))),s=Xd(this.anchors.map((function(e){return e.height}))),u=Xd(this.anchors.map((function(e){return e.xCenter}))),c=Xd(this.anchors.map((function(e){return e.yCenter})));this.anchorTensor={x:u,y:c,w:o,h:s},this.prevFilteredSegmentationMask=this.enableSegmentation?Yd([],[0,0]):null}return e.prototype.estimatePoses=function(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x,k,w,S,I,C;return FV(this,(function(T){switch(T.label){case 0:return r=function(e){var t;if(null==(t=null==e?OG:_V({},e)).maxPoses&&(t.maxPoses=1),t.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(t.maxPoses,". Should be > 0."));if(t.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return t}(t),null==e?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=null!=n?1e3*n:lG(e)?1e6*e.currentTime:null,a=QV(e),i=Yu((function(){return Hu($V(e),"float32")})),null!=(o=this.regionOfInterest)?[3,2]:[4,this.detectPose(i)]);case 1:if(0===(s=T.sent()).length)return this.reset(),i.dispose(),[2,[]];u=s[0],o=this.poseDetectionToRoi(u,a),T.label=2;case 2:return[4,this.poseLandmarksByRoi(o,i)];case 3:return c=T.sent(),i.dispose(),null==c?(this.reset(),[2,[]]):(l=c.landmarks,h=c.auxiliaryLandmarks,p=c.poseScore,d=c.worldLandmarks,f=c.segmentationMask,m=this.poseLandmarkFiltering(l,h,d,a),v=m.actualLandmarksFiltered,g=m.auxiliaryLandmarksFiltered,y=m.actualWorldLandmarksFiltered,b=this.poseLandmarksToRoi(g,a),this.regionOfInterest=b,x=this.smoothSegmentation&&null!=f?this.poseSegmentationFiltering(f):f,null!=(k=null!=v?dG(v,a):null)&&k.forEach((function(e,t){e.name=PV[t]})),null!=(w=y)&&w.forEach((function(e,t){e.name=PV[t]})),S={score:p,keypoints:k,keypoints3D:w},null!==x&&(I=Yu((function(){var e=Jh(x,2),t=Zp(e,[[0,0],[0,0],[0,1]]);return Lp(t,[[0,0],[0,0],[0,2]],"symmetric")})),this.smoothSegmentation||Qu(x),C={maskValueToLabel:KG,mask:new ZG(I)},S.segmentation=C),[2,[S]])}}))}))},e.prototype.poseSegmentationFiltering=function(e){var t=this.prevFilteredSegmentationMask;return 0===t.size?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=function(e,t,n){return"webgl"===$u()?function(e,t,n){var r=n.combineWithPreviousRatio.toFixed(2),a={variableNames:["prevMask","newMask"],outputShape:e.shape,userCode:"\n  void main() {\n      ivec2 coords = getOutputCoords();\n      int height = coords[0];\n      int width = coords[1];\n\n      float prevMaskValue = getPrevMask(height, width);\n      float newMaskValue = getNewMask(height, width);\n\n      /*\n      * Assume p := newMaskValue\n      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)\n      * uncertainty alpha(p) =\n      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the\n      * uncertainty]\n      *\n      * The following polynomial approximates uncertainty alpha as a\n      * function of (p + 0.5):\n      */\n      const float c1 = 5.68842;\n      const float c2 = -0.748699;\n      const float c3 = -57.8051;\n      const float c4 = 291.309;\n      const float c5 = -624.717;\n      float t = newMaskValue - 0.5;\n      float x = t * t;\n\n      float uncertainty =\n        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));\n\n      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *\n                             (uncertainty * ".concat(r,");\n\n      setOutput(outputValue);\n    }\n")},i=tc();return Yu((function(){var n=i.compileAndRun(a,[e,t]);return qu().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}))}(e,t,n):Yu((function(){var r=bc(t,.5),a=sc(r),i=bc(1,Pp(1,ic(a,nc(5.68842,ic(a,nc(-.748699,ic(a,nc(-57.8051,ic(a,nc(291.309,ic(a,-624.717)))))))))));return nc(t,ic(bc(e,t),ic(i,n.combineWithPreviousRatio)))}))}(t,e,HG),Qu(e)),Qu(t),this.prevFilteredSegmentationMask},e.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),Qu([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},e.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(Qu(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=Yd([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},e.prototype.detectPose=function(e){return OV(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,u,c,l;return FV(this,(function(h){switch(h.label){case 0:return t=uG(e,MG),n=t.imageTensor,r=t.padding,a=this.detectorModel.predict(n),i=function(e){return Yu((function(){var t=function(e){return Yu((function(){return[Yl(e,[0,0,0],[1,-1,1]),Yl(e,[0,0,1],[1,-1,-1])]}))}(e),n=t[0],r=t[1];return{boxes:jd(r),logits:jd(n)}}))}(a),o=i.boxes,[4,vG([s=i.logits,o],this.anchorTensor,FG)];case 1:return 0===(u=h.sent()).length?(Qu([n,a,s,o]),[2,u]):[4,pG(u,this.maxPoses,.3)];case 2:return c=h.sent(),l=function(e,t){void 0===e&&(e=[]);for(var n=t.left,r=t.top,a=t.left+t.right,i=t.top+t.bottom,o=0;o<e.length;o++){var s=e[o],u=s.locationData.relativeBoundingBox,c=(u.xMin-n)/(1-a),l=(u.yMin-r)/(1-i),h=u.width/(1-a),p=u.height/(1-i);u.xMin=c,u.yMin=l,u.width=h,u.height=p,u.xMax=c+h,u.yMax=l+p;var d=s.locationData.relativeKeypoints;d&&d.forEach((function(e){var t=(e.x-n)/(1-a),o=(e.y-r)/(1-i);e.x=t,e.y=o}))}return e}(c,r),Qu([n,a,s,o]),[2,l]}}))}))},e.prototype.poseDetectionToRoi=function(e,t){return kG(nG(e,t,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),t,DG)},e.prototype.poseLandmarksByRoi=function(e,t){return OV(this,void 0,void 0,(function(){var n,r,a,i,o,s,u,c,l,h,p,d,f,m;return FV(this,(function(v){switch(v.label){case 0:if(n=QV(t),r=uG(t,PG,e),a=r.imageTensor,i=r.padding,o=r.transformationMatrix,"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,"+"but got ".concat(this.modelType));return s=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&s.push("activation_segmentation"),u=this.landmarkModel.execute(a,s),[4,this.tensorsToPoseLandmarksAndSegmentation(u)];case 1:return null==(c=v.sent())?(Qu(u),Qu(a),[2,null]):(l=c.landmarks,h=c.auxiliaryLandmarks,p=c.poseScore,d=c.worldLandmarks,f=c.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,e,i,o,l,h,d,f)]);case 2:return m=v.sent(),Qu(u),Qu(a),[2,_V({poseScore:p},m)]}}))}))},e.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,t,n,r,a,i,o,s){return OV(this,void 0,void 0,(function(){var u,c,l,h,p,d;return FV(this,(function(f){return u=mG(a,n),c=mG(i,n),l=oG(u,t),h=oG(c,t),p=function(e,t){for(var n=[],r=0,a=e;r<a.length;r++){var i=a[r],o=i.x,s=i.y,u=t.rotation,c=Math.cos(u)*o-Math.sin(u)*s,l=Math.sin(u)*o+Math.cos(u)*s,h=_V({},i);h.x=c,h.y=l,n.push(h)}return n}(o,t),d=null,this.enableSegmentation&&(d=Yu((function(){var t=s.shape,n=t[0],a=t[1],i=function(e){var t=rG(new Array(16).fill(0));t[0][0]=iG(e,0,0),t[1][0]=-iG(e,0,1),t[2][0]=iG(e,0,2),t[3][0]=-iG(e,0,3),t[0][2]=iG(e,2,0),t[1][2]=-iG(e,2,1),t[2][2]=iG(e,2,2),t[3][2]=-iG(e,2,3),t[0][1]=-iG(e,1,0),t[1][1]=iG(e,1,1),t[2][1]=-iG(e,1,2),t[3][1]=iG(e,1,3),t[0][3]=-iG(e,3,0),t[1][3]=iG(e,3,1),t[2][3]=-iG(e,3,2),t[3][3]=iG(e,3,3);for(var n=e[0][0]*t[0][0]+e[1][0]*t[0][1]+e[2][0]*t[0][2]+e[3][0]*t[0][3],r=0;r<t.length;r++)for(var a=0;a<t.length;a++)t[r][a]/=n;return t}(r),o=Yd(eG(i,{width:a,height:n},e),[1,8]),u=[1,n,a,1];return jd(zm.transform(jl(s,u),o,"bilinear","constant",0,[e.height,e.width]),[0,3])})),Qu(s)),[2,{landmarks:l,auxiliaryLandmarks:h,worldLandmarks:p,segmentationMask:d}]}))}))},e.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return OV(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,u,c,l,h,p,d;return FV(this,(function(f){switch(f.label){case 0:return t=e[0],n=e[1],r=e[2],a=e[3],i=this.enableSegmentation?e[4]:null,[4,n.data()];case 1:return(o=f.sent()[0])<.5?[2,null]:[4,xG(t,LG)];case 2:return[4,fG(f.sent(),r,BG)];case 3:return s=f.sent(),u=s.slice(0,33),c=s.slice(33,35),[4,xG(a,zG)];case 4:return l=f.sent(),h=l.slice(0,33),p=function(e,t,n){void 0===n&&(n=!0);for(var r=[],a=0;a<e.length;a++){var i=_V({},t[a]);n&&(i.score=e[a].score),r.push(i)}return r}(u,h,!0),d=this.enableSegmentation?function(e,t,n){return Yu((function(){var n=jd(e,[0]),r=n.shape[2];if(1===r){var a=n;switch(t.activation){case"none":break;case"sigmoid":a=Xl(a);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported (".concat(t.activation,")"))}return jd(a,[2])}throw new Error("Unsupported number of tensor channels ".concat(r))}))}(i,jG):null,[2,{landmarks:u,auxiliaryLandmarks:c,poseScore:o,worldLandmarks:p,segmentationMask:d}]}}))}))},e.prototype.poseLandmarksToRoi=function(e,t){return kG(nG(hG(e),t,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),t,DG)},e.prototype.poseLandmarkFiltering=function(e,t,n,r){var a,i,o;if(null!=this.timestamp&&this.enableSmoothing){var s=nG(hG(t),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new RG(UG)),a=this.visibilitySmoothingFilterActual.apply(e),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new RG(UG)),i=this.visibilitySmoothingFilterAuxiliary.apply(t),o=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new EG(WG)),a=this.landmarksSmoothingFilterActual.apply(a,this.timestamp,r,!0,s),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new EG(VG)),i=this.landmarksSmoothingFilterAuxiliary.apply(i,this.timestamp,r,!0,s),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new EG(GG)),o=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else a=e,i=t,o=n;return{actualLandmarksFiltered:a,auxiliaryLandmarksFiltered:i,actualWorldLandmarksFiltered:o}},e}();function XG(e){return OV(this,void 0,void 0,(function(){var t,n,r,a,i,o;return FV(this,(function(s){switch(s.label){case 0:return t=function(e){var t=_V({},null==e?_G:e);if(null==t.enableSmoothing&&(t.enableSmoothing=_G.enableSmoothing),null==t.enableSegmentation&&(t.enableSegmentation=_G.enableSegmentation),null==t.smoothSegmentation&&(t.smoothSegmentation=_G.smoothSegmentation),null==t.modelType&&(t.modelType=_G.modelType),null==t.detectorModelUrl&&(t.detectorModelUrl=_G.detectorModelUrl),null==t.landmarkModelUrl)switch(t.modelType){case"lite":t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;default:t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return t}(e),n="string"==typeof t.detectorModelUrl&&t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r="string"==typeof t.landmarkModelUrl&&t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([FC(t.detectorModelUrl,{fromTFHub:n}),FC(t.landmarkModelUrl,{fromTFHub:r})])];case 1:return a=s.sent(),i=a[0],o=a[1],[2,new qG(i,o,t.enableSmoothing,t.enableSegmentation,t.smoothSegmentation,t.modelType)]}}))}))}var YG,QG,JG,$G=function(){function e(e){!function(e){if(e.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but "+"encountered ".concat(e.maxTracks));if(e.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but "+"encountered ".concat(e.maxAge));if(void 0!==e.keypointTrackerParams){if(e.keypointTrackerParams.keypointConfidenceThreshold<0||e.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+"".concat(e.keypointTrackerParams.keypointConfidenceThreshold));if(e.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but "+"encountered ".concat(e.keypointTrackerParams.minNumberOfKeypoints));for(var t=0,n=e.keypointTrackerParams.keypointFalloff;t<n.length;t++){var r=n[t];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive "+"but encountered ".concat(r))}}}(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=1e3*e.maxAge,this.minSimilarity=e.minSimilarity,this.nextID=1}return e.prototype.apply=function(e,t){this.filterOldTracks(t);var n=this.computeSimilarity(e);return this.assignTracks(e,n,t),this.updateTracks(t),e},e.prototype.getTracks=function(){return this.tracks.slice()},e.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(e){return e.id})))},e.prototype.filterOldTracks=function(e){var t=this;this.tracks=this.tracks.filter((function(n){return e-n.lastTimestamp<=t.maxAge}))},e.prototype.assignTracks=function(e,t,n){for(var r=Array.from(Array(t[0].length).keys()),a=[],i=0,o=Array.from(Array(e.length).keys());i<o.length;i++){var s=o[i];if(0!==r.length){for(var u=-1,c=-1,l=0,h=r;l<h.length;l++){var p=h[l],d=t[s][p];d>=this.minSimilarity&&d>c&&(u=p,c=d)}if(u>=0){var f=this.tracks[u];f=Object.assign(f,this.createTrack(e[s],n,f.id)),e[s].id=f.id;var m=r.indexOf(u);r.splice(m,1)}else a.push(s)}else a.push(s)}for(var v=0,g=a;v<g.length;v++){s=g[v];var y=this.createTrack(e[s],n);this.tracks.push(y),e[s].id=y.id}},e.prototype.updateTracks=function(e){this.tracks.sort((function(e,t){return t.lastTimestamp-e.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},e.prototype.createTrack=function(e,t,n){var r={id:n||this.nextTrackID(),lastTimestamp:t,keypoints:DV([],e.keypoints,!0).map((function(e){return _V({},e)}))};return void 0!==e.box&&(r.box=_V({},e.box)),r},e.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracks=this.tracks.filter((function(t){return!e.includes(t.id)}))},e.prototype.reset=function(){this.tracks=[]},e}(),ej=function(e){function t(t){return e.call(this,t)||this}return AV(t,e),t.prototype.computeSimilarity=function(e){var t=this;return 0===e.length||0===this.tracks.length?[[]]:e.map((function(e){return t.tracks.map((function(n){return t.iou(e,n)}))}))},t.prototype.iou=function(e,t){var n=Math.max(e.box.xMin,t.box.xMin),r=Math.max(e.box.yMin,t.box.yMin),a=Math.min(e.box.xMax,t.box.xMax),i=Math.min(e.box.yMax,t.box.yMax);if(n>=a||r>=i)return 0;var o=(a-n)*(i-r);return o/(e.box.width*e.box.height+t.box.width*t.box.height-o)},t}($G),tj=function(e){function t(t){var n=e.call(this,t)||this;return n.keypointThreshold=t.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=t.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=t.keypointTrackerParams.minNumberOfKeypoints,n}return AV(t,e),t.prototype.computeSimilarity=function(e){if(0===e.length||0===this.tracks.length)return[[]];for(var t=[],n=0,r=e;n<r.length;n++){for(var a=r[n],i=[],o=0,s=this.tracks;o<s.length;o++){var u=s[o];i.push(this.oks(a,u))}t.push(i)}return t},t.prototype.oks=function(e,t){for(var n=this.area(t.keypoints)+1e-6,r=0,a=0,i=0;i<e.keypoints.length;++i){var o=e.keypoints[i],s=t.keypoints[i];if(!(o.score<this.keypointThreshold||s.score<this.keypointThreshold)){a+=1;var u=Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2),c=2*this.keypointFalloff[i];r+=Math.exp(-1*u/(2*n*Math.pow(c,2)))}}return a<this.minNumKeyoints?0:r/a},t.prototype.area=function(e){var t=this,n=e.filter((function(e){return e.score>t.keypointThreshold})),r=Math.min.apply(Math,DV([1],n.map((function(e){return e.x})),!1)),a=Math.max.apply(Math,DV([0],n.map((function(e){return e.x})),!1)),i=Math.min.apply(Math,DV([1],n.map((function(e){return e.y})),!1));return(a-r)*(Math.max.apply(Math,DV([0],n.map((function(e){return e.y})),!1))-i)},t}($G);function nj(e){switch(e){case QG.BlazePose:return PV.reduce((function(e,t,n){return e[t]=n,e}),{});case QG.PoseNet:case QG.MoveNet:return MV.reduce((function(e,t,n){return e[t]=n,e}),{});default:throw new Error("Model ".concat(e," is not supported."))}}(JG=YG||(YG={})).Keypoint="keypoint",JG.BoundingBox="boundingBox",function(e){e.MoveNet="MoveNet",e.BlazePose="BlazePose",e.PoseNet="PoseNet"}(QG||(QG={}));Object.freeze({__proto__:null,getKeypointIndexBySide:function(e){switch(e){case QG.BlazePose:return LV;case QG.PoseNet:case QG.MoveNet:return zV;default:throw new Error("Model ".concat(e," is not supported."))}},getAdjacentPairs:function(e){switch(e){case QG.BlazePose:return UV;case QG.PoseNet:case QG.MoveNet:return BV;default:throw new Error("Model ".concat(e," is not supported."))}},getKeypointIndexByName:nj});var rj=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],aj={modelType:"SinglePose.Lightning",enableSmoothing:!0},ij={},oj={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},sj={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},uj={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function cj(e,t){var n,r,a,i;return e?t.width>t.height?(n=1,r=t.height/t.width,a=0,i=(t.width/2-t.height/2)/t.width):(n=t.width/t.height,r=1,a=(t.height/2-t.width/2)/t.height,i=0):t.width>t.height?(n=t.width/t.height,r=1,a=(t.height/2-t.width/2)/t.height,i=0):(n=1,r=t.height/t.width,a=0,i=(t.width/2-t.height/2)/t.width),{yMin:a,xMin:i,yMax:a+n,xMax:i+r,height:n,width:r}}function lj(e,t){var n={maxTracks:e.maxTracks,maxAge:e.maxAge,minSimilarity:e.minSimilarity};return null!=t.maxTracks&&(n.maxTracks=t.maxTracks),null!=t.maxAge&&(n.maxAge=t.maxAge),null!=t.minSimilarity&&(n.minSimilarity=t.minSimilarity),n}var hj=function(){function e(e,t){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=nj(QG.MoveNet),"SinglePose.Lightning"===t.modelType?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):"SinglePose.Thunder"===t.modelType&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel="MultiPose.Lightning"===t.modelType,this.multiPoseModel||(this.keypointFilter=new CG(oj),this.cropRegionFilterYMin=new SG(.9),this.cropRegionFilterXMin=new SG(.9),this.cropRegionFilterYMax=new SG(.9),this.cropRegionFilterXMax=new SG(.9)),this.enableSmoothing=t.enableSmoothing,t.minPoseScore?this.minPoseScore=t.minPoseScore:this.minPoseScore=.25,t.multiPoseMaxDimension?this.multiPoseMaxDimension=t.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=t.enableTracking,this.multiPoseModel&&this.enableTracking&&(t.trackerType===YG.Keypoint?this.tracker=new tj(t.trackerConfig):t.trackerType===YG.BoundingBox&&(this.tracker=new ej(t.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return e.prototype.runSinglePersonPoseModel=function(e){return OV(this,void 0,void 0,(function(){var t,n,r,a,i;return FV(this,(function(o){switch(o.label){case 0:if(4!==(t=this.moveNetModel.execute(e)).shape.length||1!==t.shape[0]||1!==t.shape[1]||17!==t.shape[2]||3!==t.shape[3])throw t.dispose(),new Error("Unexpected output shape from model: [".concat(t.shape,"]"));return"webgpu"===$u()?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=o.sent(),o.label=3;case 3:for(t.dispose(),r={keypoints:[],score:0},a=0,i=0;i<17;++i)r.keypoints[i]={y:n[3*i],x:n[3*i+1],score:n[3*i+2]},r.keypoints[i].score>.2&&(++a,r.score+=r.keypoints[i].score);return a>0&&(r.score/=a),[2,r]}}))}))},e.prototype.runMultiPersonPoseModel=function(e){return OV(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,u;return FV(this,(function(c){switch(c.label){case 0:if(3!==(t=this.moveNetModel.execute(e)).shape.length||1!==t.shape[0]||56!==t.shape[2])throw t.dispose(),new Error("Unexpected output shape from model: [".concat(t.shape,"]"));return"webgpu"===$u()?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=c.sent(),c.label=3;case 3:for(t.dispose(),r=[],a=n.length/56,i=0;i<a;++i)for(r[i]={keypoints:[]},o=56*i+51,r[i].box={yMin:n[o],xMin:n[o+1],yMax:n[o+2],xMax:n[o+3],width:n[o+3]-n[o+1],height:n[o+2]-n[o]},s=56*i+55,r[i].score=n[s],r[i].keypoints=[],u=0;u<17;++u)r[i].keypoints[u]={y:n[56*i+3*u],x:n[56*i+3*u+1],score:n[56*i+3*u+2]};return[2,r]}}))}))},e.prototype.estimatePoses=function(e,t,n){return void 0===t&&(t=ij),OV(this,void 0,void 0,(function(){var r,a,i,o,s,u;return FV(this,(function(c){switch(c.label){case 0:return t=function(e){return null==e?ij:_V({},e)}(t),null==e?(this.reset(),[2,[]]):(null==n?lG(e)&&(n=1e6*e.currentTime):n*=1e3,r=$V(e),a=QV(r),i=Jh(r,0),e instanceof Jo||r.dispose(),o=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(i,a,n)]);case 1:return o=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(i,a,n)];case 3:o=c.sent(),c.label=4;case 4:for(s=0;s<o.length;++s)for(u=0;u<o[s].keypoints.length;++u)o[s].keypoints[u].name=MV[u],o[s].keypoints[u].y*=a.height,o[s].keypoints[u].x*=a.width;return[2,o]}}))}))},e.prototype.estimateSinglePose=function(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s=this;return FV(this,(function(u){switch(u.label){case 0:return this.cropRegion||(this.cropRegion=cj(null==this.cropRegion,t)),r=Yu((function(){var t=Yd([[s.cropRegion.yMin,s.cropRegion.xMin,s.cropRegion.yMax,s.cropRegion.xMax]]),n=Fp([1],"int32"),r=[s.modelInputResolution.height,s.modelInputResolution.width];return Hu(zm.cropAndResize(e,t,n,r,"bilinear",0),"int32")})),e.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(a=u.sent(),r.dispose(),a.score<this.minPoseScore)return this.reset(),[2,[]];for(i=0;i<a.keypoints.length;++i)a.keypoints[i].y=this.cropRegion.yMin+a.keypoints[i].y*this.cropRegion.height,a.keypoints[i].x=this.cropRegion.xMin+a.keypoints[i].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(a.keypoints=this.keypointFilter.apply(a.keypoints,n,1)),o=function(e,t,n,r){for(var a={},i=0,o=MV;i<o.length;i++){var s=o[i];a[s]=[t[n[s]].y*r.height,t[n[s]].x*r.width]}if(function(e,t){return(e[t.left_hip].score>.2||e[t.right_hip].score>.2)&&(e[t.left_shoulder].score>.2||e[t.right_shoulder].score>.2)}(t,n)){var u=(a.left_hip[0]+a.right_hip[0])/2,c=(a.left_hip[1]+a.right_hip[1])/2,l=function(e,t,n,r,a){for(var i=["left_shoulder","right_shoulder","left_hip","right_hip"],o=0,s=0,u=0;u<i.length;u++)(d=Math.abs(r-n[i[u]][0]))>o&&(o=d),(f=Math.abs(a-n[i[u]][1]))>s&&(s=f);for(var c=0,l=0,h=0,p=Object.keys(n);h<p.length;h++){var d,f,m=p[h];e[t[m]].score<.2||((d=Math.abs(r-n[m][0]))>c&&(c=d),(f=Math.abs(a-n[m][1]))>l&&(l=f))}return[o,s,c,l]}(t,n,a,u,c),h=l[0],p=l[1],d=l[2],f=l[3],m=Math.max(1.9*p,1.9*h,1.2*d,1.2*f),v=[u-(m=Math.min(m,Math.max(c,r.width-c,u,r.height-u))),c-m];if(m>Math.max(r.width,r.height)/2)return cj(null==e,r);var g=2*m;return{yMin:v[0]/r.height,xMin:v[1]/r.width,yMax:(v[0]+g)/r.height,xMax:(v[1]+g)/r.width,height:(v[0]+g)/r.height-v[0]/r.height,width:(v[1]+g)/r.width-v[1]/r.width}}return cj(null==e,r)}(this.cropRegion,a.keypoints,this.keypointIndexByName,t),this.cropRegion=this.filterCropRegion(o),[2,[a]]}}))}))},e.prototype.estimateMultiplePoses=function(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s,u,c,l,h,p,d,f=this;return FV(this,(function(m){switch(m.label){case 0:return t.width>t.height?(a=this.multiPoseMaxDimension,i=Math.round(this.multiPoseMaxDimension*t.height/t.width),r=zm.resizeBilinear(e,[i,a]),s=a,u=32*Math.ceil(i/32),o=Zp(r,[[0,0],[0,u-i],[0,0],[0,0]])):(a=Math.round(this.multiPoseMaxDimension*t.width/t.height),i=this.multiPoseMaxDimension,r=zm.resizeBilinear(e,[i,a]),s=32*Math.ceil(a/32),u=i,o=Zp(r,[[0,0],[0,0],[0,s-a],[0,0]])),r.dispose(),e.dispose(),c=Hu(o,"int32"),o.dispose(),[4,this.runMultiPersonPoseModel(c)];case 1:for(l=m.sent(),c.dispose(),l=l.filter((function(e){return e.score>=f.minPoseScore})),p=0;p<l.length;++p)for(h=0;h<l[p].keypoints.length;++h)l[p].keypoints[h].y*=u/i,l[p].keypoints[h].x*=s/a;if(this.enableTracking&&(this.tracker.apply(l,n),this.enableSmoothing)){for(p=0;p<l.length;++p)this.keypointFilterMap.has(l[p].id)||this.keypointFilterMap.set(l[p].id,new CG(oj)),l[p].keypoints=this.keypointFilterMap.get(l[p].id).apply(l[p].keypoints,n,1);d=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(e,t){d.has(t)||f.keypointFilterMap.delete(t)}))}return[2,l]}}))}))},e.prototype.filterCropRegion=function(e){if(e){var t=this.cropRegionFilterYMin.apply(e.yMin),n=this.cropRegionFilterXMin.apply(e.xMin),r=this.cropRegionFilterYMax.apply(e.yMax),a=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:t,xMin:n,yMax:r,xMax:a,height:r-t,width:a-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},e.prototype.dispose=function(){this.moveNetModel.dispose()},e.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},e.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},e}();function pj(e){return void 0===e&&(e=aj),OV(this,void 0,void 0,(function(){var t,n,r,a;return FV(this,(function(i){switch(i.label){case 0:return t=function(e){var t,n=null==e?aj:_V({},e);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(rj.indexOf(n.modelType)<0)throw new Error("Invalid architecture ".concat(n.modelType,". ")+"Should be one of ".concat(rj));if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if("MultiPose.Lightning"===n.modelType&&null==n.enableTracking&&(n.enableTracking=!0),"MultiPose.Lightning"===n.modelType&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=YG.BoundingBox),n.trackerType===YG.Keypoint)null!=n.trackerConfig?n.trackerConfig=function(e){var t=lj(sj,e);return t.keypointTrackerParams=_V({},sj.keypointTrackerParams),null!=e.keypointTrackerParams&&(null!=e.keypointTrackerParams.keypointConfidenceThreshold&&(t.keypointTrackerParams.keypointConfidenceThreshold=e.keypointTrackerParams.keypointConfidenceThreshold),null!=e.keypointTrackerParams.keypointFalloff&&(t.keypointTrackerParams.keypointFalloff=e.keypointTrackerParams.keypointFalloff),null!=e.keypointTrackerParams.minNumberOfKeypoints&&(t.keypointTrackerParams.minNumberOfKeypoints=e.keypointTrackerParams.minNumberOfKeypoints)),t}(n.trackerConfig):n.trackerConfig=sj;else{if(n.trackerType!==YG.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=(t=n.trackerConfig,lj(uj,t)):n.trackerConfig=uj}return n}(e),r=!0,t.modelUrl?(r="string"==typeof t.modelUrl&&t.modelUrl.indexOf("https://tfhub.dev")>-1,[4,FC(t.modelUrl,{fromTFHub:r})]):[3,2];case 1:return n=i.sent(),[3,4];case 2:return a=void 0,"SinglePose.Lightning"===t.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":"SinglePose.Thunder"===t.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":"MultiPose.Lightning"===t.modelType&&(a="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,FC(a,{fromTFHub:r})];case 3:n=i.sent(),i.label=4;case 4:return"webgl"===$u()&&zn().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new hj(n,t)]}}))}))}var dj={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},fj=["MobileNetV1","ResNet50"],mj={MobileNetV1:[8,16],ResNet50:[16]},vj=[8,16,32],gj={MobileNetV1:[.5,.75,1],ResNet50:[1]},yj=[1,2,4],bj={maxPoses:1,flipHorizontal:!1},xj={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},kj=[-123.15,-115.9,-103.06];function wj(e){return Math.floor(e/2)}var Sj=function(){function e(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return e.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},e.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},e.prototype.empty=function(){return-1===this.numberOfElements},e.prototype.size=function(){return this.numberOfElements+1},e.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},e.prototype.max=function(){return this.priorityQueue[0]},e.prototype.swim=function(e){for(;e>0&&this.less(wj(e),e);)this.exchange(e,wj(e)),e=wj(e)},e.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},e.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},e.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},e.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},e}();function Ij(e,t,n,r,a,i){for(var o=i.shape,s=o[0],u=o[1],c=!0,l=Math.max(n-a,0),h=Math.min(n+a+1,s),p=l;p<h;++p){for(var d=Math.max(r-a,0),f=Math.min(r+a+1,u),m=d;m<f;++m)if(i.get(p,m,e)>t){c=!1;break}if(!c)break}return c}function Cj(e){return OV(this,void 0,void 0,(function(){return FV(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))}function Tj(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+17)}}function Nj(e,t,n){var r=Tj(e.heatmapY,e.heatmapX,e.id,n),a=r.y,i=r.x;return{x:e.heatmapX*t+i,y:e.heatmapY*t+a}}function Ej(e,t,n,r){var a=n.x,i=n.y;return e.some((function(e){var n,o,s,u,c=e.keypoints;return n=i,o=a,(s=c[r].y-n)*s+(u=c[r].x-o)*u<=t}))}var Rj=MV.reduce((function(e,t,n){return e[t]=n,e}),{}),Aj=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map((function(e){var t=e[0],n=e[1];return[Rj[t],Rj[n]]})),_j=Aj.map((function(e){return e[1]})),Oj=Aj.map((function(e){return e[0]}));function Fj(e,t,n){return e<t?t:e>n?n:e}function Dj(e,t,n,r){return{y:Fj(Math.round(e.y/t),0,n-1),x:Fj(Math.round(e.x/t),0,r-1)}}function Mj(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Pj(e,t,n,r,a,i,o,s){void 0===s&&(s=2);for(var u=r.shape,c=u[0],l=u[1],h={y:t.y,x:t.x},p=Mj(h,function(e,t,n){var r=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,r+e)}}(e,Dj(h,i,c,l),o)),d=0;d<s;d++){var f=Dj(p,i,c,l),m=Tj(f.y,f.x,n,a);p=Mj({x:f.x*i,y:f.y*i},{x:m.x,y:m.y})}var v=Dj(p,i,c,l),g=r.get(v.y,v.x,n);return{y:p.y,x:p.x,name:MV[n],score:g}}function Lj(e,t,n,r,a,i){var o=t.shape[2],s=_j.length,u=new Array(o),c=e.part,l=e.score,h=Nj(c,r,n);u[c.id]={score:l,name:MV[c.id],y:h.y,x:h.x};for(var p=s-1;p>=0;--p){var d=_j[p],f=Oj[p];u[d]&&!u[f]&&(u[f]=Pj(p,u[d],f,t,n,r,i))}for(p=0;p<s;++p)d=Oj[p],f=_j[p],u[d]&&!u[f]&&(u[f]=Pj(p,u[d],f,t,n,r,a));return u}function zj(e,t,n){return n.reduce((function(n,r,a){var i=r.y,o=r.x,s=r.score;return Ej(e,t,{y:i,x:o},a)||(n+=s),n}),0)/n.length}function Bj(e,t,n,r,a,i,o,s){return void 0===o&&(o=.5),void 0===s&&(s=20),OV(this,void 0,void 0,(function(){var u,c,l,h,p,d,f,m,v,g,y,b;return FV(this,(function(x){switch(x.label){case 0:return[4,Cj([e,t,n,r])];case 1:for(u=x.sent(),c=u[0],l=u[1],h=u[2],p=u[3],d=[],f=function(e,t,n){for(var r=n.shape,a=r[0],i=r[1],o=r[2],s=new Sj(a*i*o,(function(e){return e.score})),u=0;u<a;++u)for(var c=0;c<i;++c)for(var l=0;l<o;++l){var h=n.get(u,c,l);h<e||Ij(l,h,u,c,1,n)&&s.enqueue({score:h,part:{heatmapY:u,heatmapX:c,id:l}})}return s}(o,0,c),m=s*s;d.length<i&&!f.empty();)v=f.dequeue(),g=Nj(v.part,a,l),Ej(d,m,g,v.part.id)||(y=Lj(v,c,l,a,h,p),b=zj(d,m,y),d.push({keypoints:y,score:b}));return[2,d]}}))}))}var Uj=zn();Uj.registerFlag("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE",(function(){return 15})),Uj.registerFlag("WEBGPU_CPU_FORWARD",(function(){return!0})),Uj.registerFlag("WEBGPU_MATMUL_PROGRAM_TYPE",(function(){return-1})),Uj.registerFlag("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE",(function(){return!1})),Uj.registerFlag("WEBGPU_USE_LOW_POWER_GPU",(function(){return!1})),Uj.registerFlag("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e3})),Uj.registerFlag("WEBGPU_USE_PROFILE_TOOL",(function(){return!1})),Uj.registerFlag("WEBGPU_IMPORT_EXTERNAL_TEXTURE",(function(){return!0})),Uj.registerFlag("WEBGPU_USE_NAIVE_CONV2D_DEBUG",(function(){return!1})),Uj.registerFlag("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL",(function(){return 0})),Uj.registerFlag("WEBGPU_CONV_SEPARATE_IM2COL_SHADER",(function(){return!1}));var Wj=function(){function e(t){Te(this,e),t&&(this.vendor=t.vendor,this.architecture=t.architecture,this.intelGPUGeneration=this.getIntelGPUGeneration())}return Re(e,[{key:"getIntelGPUGeneration",value:function(){if(this.isIntel()){if(this.architecture.startsWith("gen"))return Number(this.architecture.match(/\d+/));if(this.architecture.startsWith("xe"))return 12}return 0}},{key:"isIntel",value:function(){return"intel"===this.vendor}}]),e}(),Vj=function(){function e(t){Te(this,e),this.device=t,this.numUsedBuffers=0,this.numFreeBuffers=0,this.freeBuffers=new Map,this.usedBuffers=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}return Re(e,[{key:"acquireUploadBuffer",value:function(e,t){return this.acquireBuffer(e,t,!0)}},{key:"acquireBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gj(e,t);if(this.freeBuffers.has(r)||this.freeBuffers.set(r,[]),this.usedBuffers.has(r)||this.usedBuffers.set(r,[]),this.numBytesUsed+=e,this.numUsedBuffers++,this.freeBuffers.get(r).length>0){this.numFreeBuffers--;var a=this.freeBuffers.get(r).shift();return this.usedBuffers.get(r).push(a),a}this.numBytesAllocated+=e;var i=this.device.createBuffer({size:e,usage:t,mappedAtCreation:n});return this.usedBuffers.get(r).push(i),i}},{key:"releaseBuffer",value:function(e,t,n){if(0!==this.freeBuffers.size){var r=Gj(t,n);this.freeBuffers.has(r)||this.freeBuffers.set(r,[]),this.freeBuffers.get(r).push(e),this.numFreeBuffers++,this.numUsedBuffers--;var a=this.usedBuffers.get(r),i=a.indexOf(e);if(i<0)throw new Error("Cannot release a buffer that was never provided by this buffer manager");a.splice(i,1),this.numBytesUsed-=t}}},{key:"releaseUploadBuffer",value:function(e,t,n){var r=this;e.mapAsync(GPUMapMode.WRITE).then((function(){r.releaseBuffer(e,t,n)}),(function(e){}))}},{key:"getNumUsedBuffers",value:function(){return this.numUsedBuffers}},{key:"getNumFreeBuffers",value:function(){return this.numFreeBuffers}},{key:"dispose",value:function(){this.freeBuffers.forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),this.usedBuffers.forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),this.freeBuffers=new Map,this.usedBuffers=new Map,this.numUsedBuffers=0,this.numFreeBuffers=0,this.numBytesUsed=0,this.numBytesAllocated=0}}]),e}();function Gj(e,t){return"".concat(e,"_").concat(t)}var jj=function(){function e(t){Te(this,e),this.device=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures=new Map,this.usedTextures=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}return Re(e,[{key:"acquireTexture",value:function(e,t,n,r){var a=e*t*Zj(n),i=Hj(e,t,n,r);if(this.freeTextures.has(i)||this.freeTextures.set(i,[]),this.usedTextures.has(i)||this.usedTextures.set(i,[]),this.numBytesUsed+=a,this.numUsedTextures++,this.freeTextures.get(i).length>0){this.numFreeTextures--;var o=this.freeTextures.get(i).shift();return this.usedTextures.get(i).push(o),o}this.numBytesAllocated+=a;var s=this.device.createTexture({size:[e,t],format:n,usage:r});return this.usedTextures.get(i).push(s),s}},{key:"releaseTexture",value:function(e,t,n,r,a){if(0!==this.freeTextures.size){var i=Hj(t,n,r,a);this.freeTextures.has(i)||this.freeTextures.set(i,[]),this.freeTextures.get(i).push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures.get(i),s=o.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(s,1);var u=t*n*Zj(r);this.numBytesUsed-=u}}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){this.freeTextures.forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),this.usedTextures.forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),this.freeTextures=new Map,this.usedTextures=new Map,this.numUsedTextures=0,this.numFreeTextures=0,this.numBytesUsed=0,this.numBytesAllocated=0}}]),e}();function Hj(e,t,n,r){return"".concat(e,"_").concat(t,"_").concat(n,"_").concat(r)}function Zj(e){if("rgba8unorm"===e)return 16;throw new Error(e+" is not supported!")}function Kj(e,t){if(Math.max.apply(Math,(0,Lt.Z)(e))>3)throw new Error("Cannot symbolically compute strides for rank > 4 tensor.");var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}var qj=function(e,t,n){return"int32"===n?"atomicAdd(".concat(e,", bitcast<i32>(").concat(t,"));"):"\n          {\n            var oldValue = 0;\n            loop {\n              let newValueF32 = bitcast<f32>(oldValue) + (".concat(t,");\n              let newValue = bitcast<i32>(newValueF32);\n              let res = atomicCompareExchangeWeak(").concat(e,", oldValue, newValue);\n              if res.exchanged {\n                break;\n              }\n              oldValue = res.old_value;\n            }\n          }")};function Xj(e){if(e<=1)return"i32";if(2===e)return"vec2<i32>";if(3===e)return"vec3<i32>";if(4===e)return"vec4<i32>";if(5===e)return"vec5";if(6===e)return"vec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Yj(e){if(0===e)return"x";if(1===e)return"y";if(2===e)return"z";if(3===e)return"w";if(4===e)return"u";if(5===e)return"v";throw Error("Index ".concat(e," is not yet supported"))}function Qj(){var e;switch(arguments.length){case 0:e="\n        fn main()\n      ";break;case 1:e="\n        fn main(".concat(arguments.length<=0?void 0:arguments[0]," : i32)\n      ");break;default:throw Error("Unreachable")}return e}function Jj(e,t){var n;return n="\n     ".concat(function(e){return"\n  @compute @workgroup_size(".concat(e.workgroupSize[0],", ").concat(e.workgroupSize[1],", ").concat(e.workgroupSize[2],")\n")}(t),"\n      fn _start(@builtin(local_invocation_id) LocalId : vec3<u32>,\n                @builtin(global_invocation_id) GlobalId : vec3<u32>,\n                @builtin(local_invocation_index) LocalIndex: u32,\n                @builtin(workgroup_id) WorkgroupId : vec3<u32>,\n                @builtin(num_workgroups) NumWorkgroups : vec3<u32>) {\n        localId = LocalId;\n        localIndex = LocalIndex;\n        globalId = GlobalId;\n        numWorkgroups = NumWorkgroups;\n        workgroupId = WorkgroupId;\n        ").concat(e?"main(getGlobalIndex());":"main();",";\n      }\n    "),n}var $j="\n  struct vec5 {x: i32, y: i32, z: i32, w: i32, u: i32};\n  struct vec6 {x: i32, y: i32, z: i32, w: i32, u: i32, v: i32};\n\n  // Checks whether coordinates lie within the bounds of the shape.\n  fn coordsInBounds2D(coord : vec2<i32>, shape : vec2<i32>) -> bool {\n    return all(coord >= vec2<i32>(0)) && all(coord < shape);\n  }\n  fn coordsInBounds3D(coord : vec3<i32>, shape : vec3<i32>) -> bool {\n    return all(coord >= vec3<i32>(0)) && all(coord < shape);\n  }\n  fn coordsInBounds4D(coord : vec4<i32>, shape : vec4<i32>) -> bool {\n    return all(coord >= vec4<i32>(0)) && all(coord < shape);\n  }\n\n  fn getIndexFromCoords1D(coord : i32, shape : i32) -> i32 {\n    return coord;\n  }\n  fn getIndexFromCoords2D(coords : vec2<i32>, shape : vec2<i32>) -> i32 {\n    return dot(coords, vec2<i32>(shape.y, 1));\n  }\n  fn getIndexFromCoords3D(coords : vec3<i32>, shape : vec3<i32>) -> i32 {\n    return dot(coords, vec3<i32>(shape.y * shape.z, shape.z, 1));\n  }\n  fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n    return dot(coords, vec4<i32>(\n        shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n  }\n  fn getIndexFromCoords5D(coords : vec5, shape : vec5) -> i32 {\n    let shapeStrides: vec5 = vec5(shape.y * shape.z * shape.w * shape.u, shape.z * shape.w * shape.u, shape.w * shape.u, shape.u, 1);\n    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u;\n  }\n  fn getIndexFromCoords6D(coords : vec6, shape : vec6) -> i32 {\n    let shapeStrides: vec6 = vec6(shape.y * shape.z * shape.w * shape.u * shape.v, shape.z * shape.w * shape.u * shape.v, shape.w * shape.u * shape.v, shape.u * shape.v, shape.v, 1);\n    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u + coords.v*shapeStrides.v;\n  }\n\n  fn idiv(a: i32, b: i32, sign: f32) -> i32 {\n    var res: i32 = a / b;\n    let modulo: i32 = a % b;\n    if (sign < 0. && modulo != 0) {\n      res = res - 1;\n    }\n    return res;\n  }\n\n  // NaN defination in IEEE 754-1985 is :\n  //   - sign = either 0 or 1.\n  //   - biased exponent = all 1 bits.\n  //   - fraction = anything except all 0 bits (since all 0 bits represents infinity).\n  // https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers\n  fn isnan(val: f32) -> bool {\n    let floatToUint: u32 = bitcast<u32>(val);\n    return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n  }\n  fn isnanVec4(val : vec4<f32>) -> vec4<bool> {\n    let floatToUint: vec4<u32> = bitcast<vec4<u32>>(val);\n    return (floatToUint & vec4<u32>(0x7fffffffu)) > vec4<u32>(0x7f800000u);\n  }\n",eH="\n  fn isinf(val: f32) -> bool {\n    return abs(val) == uniforms.INFINITY;\n  }\n";function tH(e){var t=e.length;if(t<=1)return"fn getCoordsFromIndex(index : i32) -> i32 { return index; }";for(var n,r=In(e),a=Xj(t),i=[],o=0;o<t;o++)i.push("d"+o);return 1===r.length?"    fn getCoordsFromIndex(index : i32) -> vec2<i32> {\n      let d0 = index / uniforms.outShapeStrides; let d1 = index - d0 * uniforms.outShapeStrides;\n      return vec2<i32>(d0, d1);\n    }":(n="var index2 = index;"+r.map((function(e,t){return"".concat("let ".concat(i[t]," = index2 / uniforms.outShapeStrides.").concat(Yj(t)),"; ",t===r.length-1?"let ".concat(i[t+1]," = index2 - ").concat(i[t]," * uniforms.outShapeStrides.").concat(Yj(t)):"index2 = index2 - ".concat(i[t]," * uniforms.outShapeStrides.").concat(Yj(t)),";")})).join(""),"\n    fn getCoordsFromIndex(index : i32) -> ".concat(a," {\n      ").concat(n,"\n      return ").concat(a,"(").concat(i.join(","),");\n    }\n  "))}function nH(e){var t="";switch(e){case 0:case 1:t+="\n        fn getOutputIndexFromCoords(coords : i32) -> i32 {\n          return coords;\n        }\n        ";break;case 2:t+="\n        fn getOutputIndexFromCoords(coords : vec2<i32>) -> i32 {\n          return dot(coords, vec2<i32>(uniforms.outShapeStrides, 1));\n        }\n        ";break;case 3:t+="\n        fn getOutputIndexFromCoords(coords : vec3<i32>) -> i32 {\n          return dot(coords, vec3<i32>(uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, 1));\n        }\n        ";break;case 4:t+="\n        fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n          return dot(coords, vec4<i32>(\n            uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, uniforms.outShapeStrides.z, 1));\n        }\n        ";break;case 5:t+="\n        fn getOutputIndexFromCoords(coords : vec5) -> i32 {\n          return coords.x * uniforms.outShapeStrides.x +\n              coords.y * uniforms.outShapeStrides.y +\n              coords.z * uniforms.outShapeStrides.z +\n              coords.w * uniforms.outShapeStrides.w +\n              coords.u;\n        }\n        ";break;case 6:t+="\n        fn getOutputIndexFromCoords(coords : vec6) -> i32 {\n          return coords.x * uniforms.outShapeStrides.x +\n              coords.y * uniforms.outShapeStrides.y +\n              coords.z * uniforms.outShapeStrides.z +\n              coords.w * uniforms.outShapeStrides.w +\n              coords.u * uniforms.outShapeStrides.u +\n              coords.v;\n        }\n        ";break;default:nn(!1,(function(){return"Unsupported ".concat(e,"D shape")}))}return t}function rH(e){return 1===e.dispatch[1]&&1===e.dispatch[2]}function aH(e,t){return"float32"===e?t?"vec4<f32>":"f32":"int32"===e||"bool"===e?t?"vec4<i32>":"i32":e}function iH(e){return(!e.dispatchLayout.hasOwnProperty("y")||0===e.dispatchLayout.y.length)&&(!e.dispatchLayout.hasOwnProperty("z")||0===e.dispatchLayout.z.length)}var oH,sH=function(e){for(var t=1,n=0;n<e.length;n++)t*=e[n];return t};function uH(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=[Math.ceil(sH(e.x.map((function(e){return t[e]})))/(n[0]*r[0])),e.y?Math.ceil(sH(e.y.map((function(e){return t[e]})))/(n[1]*r[1])):1,e.z?Math.ceil(sH(e.z.map((function(e){return t[e]})))/(n[2]*r[2])):1];return[a[0],a[1],a[2]]}function cH(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return[8,8,1];var n=sH(e.x.map((function(e){return t[e]}))),r=sH(e.y.map((function(e){return t[e]})));return n<=4?[4,16,1]:r<=4?[16,4,1]:[16,16,1]}function lH(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return[4,4,1];var n=sH(e.x.map((function(e){return t[e]}))),r=sH(e.y.map((function(e){return t[e]})));return n<=4?[1,2,1]:r<=4?[2,1,1]:[2,2,1]}function hH(e){return{x:e.map((function(e,t){return t}))}}function pH(e){if("float32"===e||"int32"===e||"bool"===e||"string"===e)return 4;if("complex64"===e)return 8;throw new Error("Unknown dtype "+e)}function dH(){return("undefined"!=typeof window||"undefined"!=typeof WorkerGlobalScope)&&!!navigator.gpu}!function(e){e[e.MatMulReduceProgram=0]="MatMulReduceProgram",e[e.MatMulSplitKProgram=1]="MatMulSplitKProgram",e[e.MatMulSmallOutputSizeProgram=2]="MatMulSmallOutputSizeProgram",e[e.MatMulPackedProgram=3]="MatMulPackedProgram",e[e.MatMulMax=4]="MatMulMax"}(oH||(oH={}));var fH,mH=zn().getNumber("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD"),vH=function(e){Mo(n,e);var t=Uo(n);function n(e,r){var a;if(Te(this,n),(a=t.call(this)).commandQueueOwnedIds=new WeakSet,a.dispatchNumberInEncoder=0,a.disposed=!1,a.downloadWaitMs=0,a.tensorDataPendingDisposal=[],a.stagingPendingDisposal=[],a.uniformPendingDisposal=[],a.uploadWaitMs=0,!dH())throw new Error("WebGPU is not supported on this device");return a.pipelineCache={},a.device=e,a.queue=e.queue,a.currentCommandEncoder=null,a.currentComputePass=null,a.supportTimeQuery=e.features.has("timestamp-query-inside-passes"),a.adapterInfo=new Wj(r),a.thresholdToIncreaseWorkgroups=a.adapterInfo.intelGPUGeneration>=12?16:8,a.bufferManager=new Vj(a.device),a.textureManager=new jj(a.device),a.tensorMap=new qt(zo(a),qu()),a.supportTimeQuery&&(a.querySet=a.device.createQuerySet({type:"timestamp",count:2})),zn().getBool("WEBGPU_USE_PROFILE_TOOL")&&(a.dummyCanvas=document.createElement("canvas"),a.dummyCanvas.width=1,a.dummyCanvas.height=1,a.dummyContext=a.dummyCanvas.getContext("webgpu"),a.dummyContext.configure({device:e,format:"bgra8unorm"}),document.body.appendChild(a.dummyCanvas)),Bo(a)}return Re(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"floatPrecision",value:function(){return 32}},{key:"defaultGpuBufferUsage",value:function(){return GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.tensorDataPendingDisposal.indexOf(e)>=0)return!1;if(!this.tensorMap.has(e))return!0;var n=this.tensorMap.get(e);if(this.decRef(e),!t&&n.refCount>0)return!1;if(this.commandQueueOwnedIds.has(e))return this.tensorDataPendingDisposal.push(e),!1;var r=this.tensorMap.get(e).complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.releaseResource(e),this.tensorMap.delete(e),!0}},{key:"memory",value:function(){return{numBytesInGPU:this.bufferManager.numBytesUsed,numBytesAllocatedInGPU:this.bufferManager.numBytesAllocated,unreliable:!1}}},{key:"releaseResource",value:function(e){var t=this.tensorMap.get(e);if(t&&t.resourceInfo)if(t.external)t.resourceInfo=null;else{if("texture"in t.resourceInfo){var n=t.resourceInfo;n.texture instanceof GPUTexture&&this.textureManager.releaseTexture(n.texture,n.width,n.height,n.format,n.usage),n.texture=null}else{var r=t.resourceInfo;this.bufferManager.releaseBuffer(r.buffer,r.size,r.usage),r.buffer=null}t.resourceInfo=null}}},{key:"refCount",value:function(e){return this.tensorMap.has(e)?this.tensorMap.get(e).refCount:0}},{key:"incRef",value:function(e){this.tensorMap.get(e).refCount++}},{key:"decRef",value:function(e){this.tensorMap.has(e)&&this.tensorMap.get(e).refCount--}},{key:"write",value:function(e,t,n){if("complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.tensorMap.set(r,{dtype:n,shape:t,values:e,refCount:1}),r}},{key:"move",value:function(e,t,n,r,a){if("complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.tensorMap.set(e,{dtype:r,shape:n,values:t,refCount:a})}},{key:"submitQueue",value:function(){var e=this;this.ensureComputePassEnded(),this.queue.submit([this.currentCommandEncoder.finish()]),this.currentCommandEncoder=null,this.dispatchNumberInEncoder=0,this.commandQueueOwnedIds=new WeakSet,this.tensorDataPendingDisposal.forEach((function(t){e.releaseResource(t),e.tensorMap.delete(t)})),this.uniformPendingDisposal.forEach((function(t){return e.bufferManager.releaseBuffer(t.buffer,t.size,t.usage)})),this.stagingPendingDisposal.forEach((function(t){return e.bufferManager.releaseUploadBuffer(t.buffer,t.size,t.usage)})),this.tensorDataPendingDisposal=[],this.uniformPendingDisposal=[],this.stagingPendingDisposal=[]}},{key:"ensureCommandEncoderReady",value:function(){this.currentCommandEncoder||(this.currentCommandEncoder=this.device.createCommandEncoder())}},{key:"ensureComputePassEnded",value:function(){this.currentComputePass&&(this.currentComputePass.end(),this.currentComputePass=null)}},{key:"getComputePass",value:function(){return this.currentComputePass||(this.currentComputePass=this.currentCommandEncoder.beginComputePass()),this.currentComputePass}},{key:"getBufferData",value:function(){var e=Ht(Gt().mark((function e(t,n){var r,a;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ),this.ensureCommandEncoderReady(),this.ensureComputePassEnded(),this.currentCommandEncoder.copyBufferToBuffer(t,0,r,0,n),this.submitQueue(),e.next=7,r.mapAsync(GPUMapMode.READ);case 7:return a=r.getMappedRange().slice(0),e.abrupt("return",(r.unmap(),null!=r&&this.bufferManager.releaseBuffer(r,n,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ),zn().getBool("WEBGPU_USE_PROFILE_TOOL")&&(nn(void 0!==this.dummyContext,(function(){return"Fail to get context for profiling tool"})),this.dummyContext.getCurrentTexture()),a));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.tensorMap.get(e);return this.releaseResource(e),n.values=t,n.values}},{key:"readSync",value:function(e){var t=this.tensorMap.get(e).values;if(null==t)throw new Error("WebGPU readSync is only available for CPU-resident tensors.");return t}},{key:"read",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,u,c;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tensorMap.has(t)){e.next=2;break}throw new Error("Tensor ".concat(t," was not registered!"));case 2:if(n=this.tensorMap.get(t),null==(r=n.values)){e.next=5;break}return e.abrupt("return",this.convertAndCacheOnCPU(t,r));case 5:if("complex64"!==n.dtype){e.next=14;break}return e.next=8,Promise.all([this.read(n.complexTensorInfos.real.dataId),this.read(n.complexTensorInfos.imag.dataId)]);case 8:i=e.sent,o=i[0],s=i[1],a=vv(o,s),e.next=19;break;case 14:return u=n.resourceInfo,e.next=17,this.getBufferData(u.buffer,u.size);case 17:c=e.sent,a=Nn(c,n.dtype);case 19:return e.abrupt("return",(this.convertAndCacheOnCPU(t,a),a));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"copyBuffer",value:function(e,t,n){var r=this.bufferManager.acquireBuffer(t,n);return this.ensureCommandEncoderReady(),this.ensureComputePassEnded(),this.currentCommandEncoder.copyBufferToBuffer(e,0,r,0,t),this.submitQueue(),r}},{key:"createTensorFromGPUData",value:function(e,t,n){var r=e.buffer;if("complex64"===n)throw new Error("Cannot write to a complex64 dtype. ");var a={id:this.nextDataId()};this.tensorMap.set(a,{dtype:n,shape:t,values:null,refCount:1,external:e.zeroCopy});var i=this.tensorMap.get(a),o=pH(i.dtype)*on(i.shape);if(e.buffer.size<o)throw new Error("GPUBuffer size(".concat(e.buffer.size,") is smaller than tensor size(").concat(o,")!"));if((e.buffer.usage&(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))!=(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))throw new Error("GPUBuffer.usage should include GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC!");return!0!==e.zeroCopy&&(r=this.copyBuffer(r,o,r.usage)),i.resourceInfo={size:r.size,usage:r.usage,buffer:r},qu().makeTensorFromDataId(a,t,n,this)}},{key:"readToGPU",value:function(e){var t=this.tensorMap.get(e),n=t.values,r=t.dtype,a=t.shape,i=t.resourceInfo;if("complex64"===r)throw new Error("Does not support reading buffer for complex64 dtype.");if(null==i)throw null!=n?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var o=i.size,s=this.bufferManager.acquireBuffer(o,i.usage);this.ensureCommandEncoderReady(),this.ensureComputePassEnded(),this.currentCommandEncoder.copyBufferToBuffer(i.buffer,0,s,0,o),this.submitQueue();var u=this.makeTensorInfo(a,r),c=qu().makeTensorFromTensorInfo(u);return this.tensorMap.get(u.dataId).resourceInfo={size:o,usage:this.defaultGpuBufferUsage(),buffer:s},{tensorRef:c,buffer:s,bufSize:o}}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Ro(e)}));return ju(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return ju(e.shape,e.dtype,t)}},{key:"time",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i,o,s,u;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.supportTimeQuery||console.warn("This device doesn't support timestamp-query-inside-passes extension. Start Chrome browser with flag --disable-dawn-features=disallow_unsafe_apis then try again. Otherwise, zero will be shown for the kernel time when profiling mode is enabled. Using performance.now is not workable for webgpu since it doesn't support synchronous data read from GPU."),n=this.activeTimers,r=[],a=!1,null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t(),i=_o(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=_o(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,a&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},e.next=9,Promise.all(i);case 9:return u=e.sent,e.abrupt("return",(s.kernelMs=tn(u),s.getExtraProfileInfo=function(){return u.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},this.uploadWaitMs=0,this.downloadWaitMs=0,s));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"makeTensorInfo",value:function(e,t,n){return"string"===t&&null!=n&&n.length>0&&bn(n[0])&&(n=n.map((function(e){return Eo(e)}))),{dataId:this.write(n,e,t),shape:e,dtype:t}}},{key:"tensorToBinding",value:function(e){if(!e)return null;var t=this.tensorMap.get(e.dataId);if("texture"in t.resourceInfo){var n=t.resourceInfo;return n.texture instanceof GPUExternalTexture?n.texture:n.texture.createView()}var r=t.resourceInfo;return{offset:0,size:r.size,buffer:r.buffer}}},{key:"getQueryTime",value:function(){var e=Ht(Gt().mark((function e(t){return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.supportTimeQuery?this.getTimeFromQuerySet(t):0);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadToGPU",value:function(e){var t=this.tensorMap.get(e);if(!t.resourceInfo){var n=pH(t.dtype)*on(t.shape),r=this.bufferManager.acquireBuffer(n,this.defaultGpuBufferUsage());if(t.resourceInfo={size:n,usage:this.defaultGpuBufferUsage(),buffer:r},t.values){var a=this.bufferManager.acquireUploadBuffer(n,GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC),i=a.getMappedRange();"int32"===t.dtype||"bool"===t.dtype?new Int32Array(i).set(t.values):new Float32Array(i).set(t.values),a.unmap(),this.ensureCommandEncoderReady(),this.ensureComputePassEnded(),this.currentCommandEncoder.copyBufferToBuffer(a,0,r,0,n);var o={size:n,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,buffer:a};this.stagingPendingDisposal.push(o)}}}},{key:"makeUniforms",value:function(e){var t=0,n=0,r=[],a=1;e.forEach((function(e){var i;switch(0===e.data.length&&(e.data=[1]),e.data.length){case 1:i=4;break;case 2:i=8;break;case 3:case 4:case 5:case 6:i=16;break;default:nn(!1,(function(){return"Unsupported ".concat(e.data.length,"D shape")}))}5!==n&&6!==n||(i=16),i>a&&(a=i),t=Math.ceil(t/i)*i,n=e.data.length,r.push(t),t+=4*e.data.length})),t=Math.ceil(t/a)*a;var i=new ArrayBuffer(t);e.forEach((function(e,t){var n=r[t];"int32"===e.type?new Int32Array(i,n,e.data.length).set(e.data):"uint32"===e.type?new Uint32Array(i,n,e.data.length).set(e.data):new Float32Array(i,n,e.data.length).set(e.data)}));var o=this.bufferManager.acquireBuffer(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.queue.writeBuffer(o,0,i,0,t);var s={size:t,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM,buffer:o};return this.uniformPendingDisposal.push(s),{offset:0,size:t,buffer:o}}},{key:"runWebGPUProgram",value:function(e,t,n,r,a){var i=this;if(a||(a=this.makeTensorInfo(e.outputShape,n)),0===on(a.shape))return this.tensorMap.get(a.dataId).values=mn(a.dtype,0),a;this.uploadToGPU(a.dataId),e.dispatch=function(e,t){var n=e.limits.maxComputeWorkgroupsPerDimension,r=t.dispatchLayout,a=t.dispatch;if(a.every((function(e){return e<=n})))return a;nn(a[0]>n&&void 0===r.y&&void 0===r.z,(function(){return"Dispatch size exceeds WebGPU limits in Y or Z dimension."}));var i=Math.ceil(Math.sqrt(a[0]));return i>n?(nn((i=Math.ceil(Math.cbrt(a[0])))<=n,(function(){return"Total dispatch size exceeds WebGPU maximum."})),[i,i,i]):[i,i,1]}(this.device,e);var o=[],s=[];if(!e.isFromPixels){o.push({type:"float32",data:[NaN]},{type:"float32",data:[1/0]}),s=t.concat(a).map((function(e){return e.shape}));var u="int32";s.map((function(e){o.push({type:u,data:e})}));var c=In(a.shape);if(o.push({type:u,data:c}),e.size){var l=on(e.outputShape);o.push({type:u,data:[e.isVec4?l/4:l]})}}var h,p=t.map((function(t,n){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");return i.uploadToGPU(t.dataId),{dtype:i.tensorMap.get(t.dataId).dtype,shape:t.shape,name:e.variableNames[n]}})),d=function(e,t,n,r){var a=e.shaderKey;if(e.isFromPixels)return a;var i=n.map((function(e){return e.dtype})).concat(r.dtype),o=n.map((function(e){return wc(e.shape,r.shape)})),s=n.map((function(e){return sn(e.shape,r.shape)})).join("_"),u=o.map((function(e){return e.join("_")})).join(";"),c=rH(e)?"flatDispatch":"";return a+="_"+(e.workgroupSize?e.workgroupSize.join(","):"")+t.map((function(e){return e.length})).join(",")+i.join(",")+e.variableNames.join(",")+u+s+c}(e,s,p,a);d in this.pipelineCache?h=this.pipelineCache[d]:(h=function(e,t,n,r){var a=function(e,t,n){var r=[],a=n.workgroupSize[0]*n.workgroupSize[1]*n.workgroupSize[2];if(r.push("\n\n      var<private> localId: vec3<u32>;\n      var<private> localIndex: u32;\n      var<private> globalId: vec3<u32>;\n      var<private> numWorkgroups: vec3<u32>;\n      var<private> workgroupId: vec3<u32>;\n\n      // Only used when the y/z dimension of workgroup size is 1.\n      fn getGlobalIndex() -> i32 {\n        ".concat(rH(n)?"  return i32(globalId.x);":"  return i32((workgroupId.z * numWorkgroups.x * numWorkgroups.y +\n                workgroupId.y * numWorkgroups.x + workgroupId.x) * ".concat(a,"u +\n                localIndex);\n        "),"\n      }\n    ")),n.isFromPixels){r.push("\n        struct Uniform {\n          size            : i32,\n          numChannels     : i32,\n          outShapeStrides : vec2<i32>,\n        };\n\n        @group(0) @binding(0) var<storage, read_write> result: array<".concat(aH(t.dtype,n.isVec4),">;\n        @group(0) @binding(2) var<uniform> uniforms: Uniform;\n      "));var i=iH(n);return[$j,r.join("\n"),tH(t.shape),n.getUserCode(),Jj(i,n)].join("\n")}var o="struct Uniforms { NAN : f32, INFINITY : f32, ";n.variableNames.forEach((function(t,n){var r=Xj(e[n].shape.length);o+="".concat(t.charAt(0).toLowerCase()+t.slice(1),"Shape : ").concat(r,", ")}));var s=Xj(t.shape.length);o+="outShape : ".concat(s,", ");var u=Xj(t.shape.length-1);o+="\n         outShapeStrides: ".concat(u,", "),n.size&&(o+="size : i32, "),n.uniforms&&(o+=n.uniforms),o=function(e){return(e=e.replace(/(\w+)\s*:\s*vec(5|6)/g,(function(e){return"@align(16) "+e}))).replace(/vec(5|6)\s*,\s*(\w+)/g,(function(e,t,n){return"vec".concat(t,", @align(16) ").concat(n)}))}(o+="};"),r.push(o),n.atomic?r.push("\n      @group(0) @binding(0) var<storage, read_write> result: array<atomic<i32>>;\n    "):r.push("\n      @group(0) @binding(0) var<storage, read_write> result: array<".concat(aH(t.dtype,n.isVec4),">;\n    ")),n.variableNames.forEach((function(t,a){r.push("\n      @group(0) @binding(".concat(1+a,") var<storage, read> ").concat(t,": array<").concat(n.variableTypes?n.variableTypes[a]:aH(e[a].dtype,n.isVec4),">;\n        "))})),""!==o&&r.push("\n      @group(0) @binding(".concat(1+n.variableNames.length,") var<uniform> uniforms: Uniforms;\n      "));var c=function(e,t){var n=t.x,r=t.y,a=void 0===r?[]:r,i=t.z,o=void 0===i?[]:i,s=e.length,u=n.length+a.length+o.length;if(u!==s)return"";if(n.length===s){var c=Xj(s);return"fn getOutputCoords() -> ".concat(c,"{\n    let globalIndex = getGlobalIndex();\n    return getCoordsFromIndex(globalIndex);\n  }\n  ")}for(var l="",h=[n,a,o],p=0;p<h.length;p++){var d=h[p];if(0!==d.length)if(1===d.length)l+="let d".concat(d[0]," = i32(globalId[").concat(p,"]);");else{var f=Kj(d,"uniforms.outShape");l+="var index".concat(p," = i32(globalId[").concat(p,"]);");for(var m=0;m<f.length;m++)l+="let d".concat(d[m]," = index").concat(p," / ").concat(f[m],";"),m===f.length-1?l+="let d".concat(d[m+1]," = index").concat(p," - d").concat(d[m]," * ").concat(f[m],";"):l+="index".concat(p," = index").concat(p," - d").concat(d[m]," * ").concat(f[m],";")}}for(var v=[],g=0;g<u;g++)v.push("d"+g);var y=Xj(u),b="fn getOutputCoords() -> ".concat(y," {\n  ").concat(l,"\n");return 0===v.length?b+="return ".concat(y,"(0); }"):b+="return ".concat(y,"(").concat(v.join(","),"); }"),b}(t.shape,n.dispatchLayout),l=[$j,r.join("\n")+eH,tH(t.shape),c,nH(t.shape.length)];n.atomic||l.push(function(e,t,n){var r,a=e.length,i=aH(t,n);if(r=n?"fn setOutputAtIndex(flatIndex : i32, value : vec4<f32>) {\n      result[flatIndex] = ".concat(i,"(value);\n    }\n    fn setOutputAtIndexI32(flatIndex : i32, value : vec4<i32>) {\n      result[flatIndex] = ").concat(i,"(value);\n    }"):"fn setOutputAtIndex(flatIndex : i32, value : f32) {\n      result[flatIndex] = ".concat(i,"(value);\n    }\n    fn setOutputAtIndexI32(flatIndex : i32, value : i32) {\n      result[flatIndex] = ").concat(i,"(value);\n    }"),a>=2){var o=["d0","d1","d2","d3","d4","d5"].slice(0,a),s=Xj(a);r+=n?"\n      fn setOutputAtCoords(".concat(o.map((function(e){return e+" : i32"})).join(", "),", value : vec4<f32>) {\n        let flatIndex = getOutputIndexFromCoords(").concat(s,"(").concat(o.join(", "),"));\n        setOutputAtIndex(flatIndex / 4, value);\n      }\n      fn setOutputAtCoordsI32(").concat(o.map((function(e){return e+" : i32"})).join(", "),", value : vec4<i32>) {\n        let flatIndex = getOutputIndexFromCoords(").concat(s,"(").concat(o.join(", "),"));\n        setOutputAtIndexI32(flatIndex / 4, value);\n      }\n    "):"\n      fn setOutputAtCoords(".concat(o.map((function(e){return e+" : i32"})).join(", "),", value : f32) {\n        let flatIndex = getOutputIndexFromCoords(").concat(s,"(").concat(o.join(", "),"));\n        setOutputAtIndex(flatIndex, value);\n      }\n      fn setOutputAtCoordsI32(").concat(o.map((function(e){return e+" : i32"})).join(", "),", value : i32) {\n        let flatIndex = getOutputIndexFromCoords(").concat(s,"(").concat(o.join(", "),"));\n        setOutputAtIndexI32(flatIndex, value);\n      }\n    ")}return r}(t.shape,t.dtype,n.isVec4));var h=e.map((function(e,r){return function(e,t,n,r){var a=function(e,t){var n=e.name,r=e.shape.length,a=Xj(r),i="get"+n.charAt(0).toUpperCase()+n.slice(1),o=["d0","d1","d2","d3","d4","d5"].slice(0,r),s=o.map((function(e){return e+" : i32"})).join(", ");if(r<1)return t?"\n        fn ".concat(i,"() -> vec4<f32> {\n          return vec4<f32>(").concat(n,"[0]);\n        }\n      "):"\n      fn ".concat(i,"() ->f32 {\n        return f32(").concat(n,"[0]);\n      }\n    ");var u="uniforms.".concat(n.charAt(0).toLowerCase()+n.slice(1),"Shape"),c=r+"D";return 0===r&&(c="1D"),t?"\n      fn ".concat(i,"(").concat(s,") -> vec4<f32> {\n        return vec4<f32>(").concat(n,"[getIndexFromCoords").concat(c,"(").concat(a,"(").concat(o.join(","),"),\n          ").concat(u,") / 4]);\n      }\n      "):"\n    fn ".concat(i,"(").concat(s,") -> f32 {\n      return f32(").concat(n,"[getIndexFromCoords").concat(c,"(").concat(a,"(").concat(o.join(","),"),\n        ").concat(u,")]);\n    }\n   ")}(e,n);return e.shape.length<=t.length&&(a+=function(e,t,n,r){var a=e.name,i=a.charAt(0).toUpperCase()+a.slice(1),o="get"+i+"ByOutput",s=e.shape.length,u=t.length,c=Xj(u);if(sn(e.shape,t)&&r)return n?"\n      fn ".concat(o,"Index(globalIndex : i32) -> vec4<f32> {\n        return vec4<f32>(").concat(a,"[globalIndex]);\n      }\n\n      fn ").concat(o,"Coords(coords : ").concat(c,") -> vec4<f32> {\n        return vec4<f32>(").concat(a,"[").concat(u>1?"getOutputIndexFromCoords(coords)":"coords"," / 4]);\n      }\n      "):"\n    fn ".concat(o,"Index(globalIndex : i32) -> f32 {\n      return f32(").concat(a,"[globalIndex]);\n    }\n\n    fn ").concat(o,"Coords(coords : ").concat(c,") -> f32 {\n      return f32(").concat(a,"[").concat(u>1?"getOutputIndexFromCoords(coords)":"coords","]);\n    }\n    ");var l,h=wc(e.shape,t),p=u-s;if(0===s)return n?"\n    fn ".concat(o,"Index(globalIndex : i32) -> vec4<f32> {\n      return get").concat(i,"();\n    }\n\n    fn ").concat(o,"Coords(coords : ").concat(c,") -> vec4<f32> {\n      return get").concat(i,"();\n    }\n  "):"\n    fn ".concat(o,"Index(globalIndex : i32) -> f32{\n      return get").concat(i,"();\n    }\n\n    fn ").concat(o,"Coords(coords : ").concat(c,") -> f32{\n      return get").concat(i,"();\n    }\n  ");l=u<2&&h.length>=1?"coords = 0;":h.map((function(e){return"coords.".concat(Yj(e+p)," = 0;")})).join("\n");var d="";if(u<2&&s>0)d="coords";else if(u>1){var f=Xj(s),m=e.shape.map((function(e,t){return"coords."+Yj(t+p)})).join(", ");d="".concat(f,"(").concat(m,")")}else d="coords";var v="uniforms.".concat(a.charAt(0).toLowerCase()+a.slice(1),"Shape"),g=s+"D";return n?"\n    fn ".concat(o,"Index(globalIndex : i32) -> vec4<f32> {\n      var coords = getCoordsFromIndex(globalIndex);\n      ").concat(l,"\n      return ").concat(a,"[getIndexFromCoords").concat(g,"(").concat(d,", ").concat(v,") / 4];\n    }\n\n    fn ").concat(o,"Coords(coordsIn : ").concat(c,") -> vec4<f32> {\n      var coords = coordsIn;\n      ").concat(l,"\n      return ").concat(a,"[getIndexFromCoords").concat(g,"(").concat(d,", ").concat(v,") / 4];\n    }\n  "):"\n  fn ".concat(o,"Index(globalIndex : i32) -> f32 {\n    var coords = getCoordsFromIndex(globalIndex);\n    ").concat(l,"\n    return f32(").concat(a,"[getIndexFromCoords").concat(g,"(").concat(d,", ").concat(v,")]);\n  }\n\n  fn ").concat(o,"Coords(coordsIn : ").concat(c,") -> f32 {\n    var coords = coordsIn;\n    ").concat(l,"\n    return f32(").concat(a,"[getIndexFromCoords").concat(g,"(").concat(d,", ").concat(v,")]);\n  }\n")}(e,t,n,r)),a}(e,t.shape,n.variableTypes?"vec4<f32>"===n.variableTypes[r]:n.isVec4,n.dispatchLayout.x.length===t.shape.length)})).join("\n");l.push(h),l.push(n.getUserCode());var p=iH(n);return l.push(Jj(p,n)),l.join("\n")}(n,{dtype:r.dtype,shape:r.shape},t),i=e.createShaderModule({code:a,label:t.constructor.name});return e.createComputePipeline({compute:{module:i,entryPoint:"_start"},label:t.constructor.name,layout:"auto"})}(this.device,e,p,a),this.pipelineCache[d]=h),r&&(o=[].concat((0,Lt.Z)(o),(0,Lt.Z)(r)));var f=[this.tensorToBinding(a)].concat((0,Lt.Z)(t.map((function(e){return i.tensorToBinding(e)}))),[this.makeUniforms(o)]),m=this.device.createBindGroup({layout:h.getBindGroupLayout(0),entries:f.map((function(e,t){return{binding:t,resource:e}}))});this.ensureCommandEncoderReady();var v=this.getComputePass(),g=null!=this.activeTimers;return g&&this.supportTimeQuery&&v.writeTimestamp(this.querySet,0),v.setPipeline(h),v.setBindGroup(0,m),v.dispatchWorkgroups(e.dispatch[0],e.dispatch[1],e.dispatch[2]),g&&this.supportTimeQuery&&v.writeTimestamp(this.querySet,1),this.dispatchNumberInEncoder++,t.forEach((function(e){i.commandQueueOwnedIds.add(e.dataId)})),this.commandQueueOwnedIds.add(a.dataId),zn().get("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE")<=this.dispatchNumberInEncoder&&this.submitQueue(),g&&this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(this.querySet)}),a}},{key:"getTimeFromQuerySet",value:function(){var e=Ht(Gt().mark((function e(t){var n,r,a,i;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.bufferManager.acquireBuffer(16,GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE),r=this.bufferManager.acquireBuffer(16,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),this.ensureCommandEncoderReady(),this.ensureComputePassEnded(),this.currentCommandEncoder.resolveQuerySet(t,0,2,n,0),this.currentCommandEncoder.copyBufferToBuffer(n,0,r,0,16),this.submitQueue(),e.next=8,r.mapAsync(GPUMapMode.READ);case 8:return a=new BigUint64Array(r.getMappedRange()),i=Number(a[1]-a[0]),e.abrupt("return",(r.unmap(),this.bufferManager.releaseBuffer(r,16,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),this.bufferManager.releaseBuffer(n,16,GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE),i/1e6));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mH;return zn().getBool("WEBGPU_CPU_FORWARD")&&e.every((function(e){return null==t.tensorMap.get(e.dataId).resourceInfo&&on(e.shape)<n}))}},{key:"numDataIds",value:function(){return this.tensorMap.numDataIds()-this.tensorDataPendingDisposal.length}},{key:"dispose",value:function(){this.disposed||(this.bufferManager.dispose(),this.textureManager.dispose(),this.disposed=!0)}}]),n}(Xt);vH.nextDataId=0,dH()&&ec("webgpu",Ht(Gt().mark((function e(){var t,n,r,a,i,o;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zn().set("CHECK_COMPUTATION_FOR_ERRORS",!1),t={powerPreference:zn().get("WEBGPU_USE_LOW_POWER_GPU")?"low-power":"high-performance"},e.next=4,navigator.gpu.requestAdapter(t);case 4:return n=e.sent,r={},n.features.has("timestamp-query-inside-passes")&&(r.requiredFeatures=["timestamp-query-inside-passes"]),a=n.limits,r.requiredLimits={maxComputeWorkgroupStorageSize:a.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:a.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:a.maxStorageBufferBindingSize},e.next=11,n.requestDevice(r);case 11:return i=e.sent,e.next=14,n.requestAdapterInfo();case 14:return o=e.sent,e.abrupt("return",new vH(i,o));case 16:case"end":return e.stop()}}),e)}))),3),function(e){e[e.ADD=0]="ADD",e[e.ATAN2=1]="ATAN2",e[e.COMPLEX_MULTIPLY_IMAG=2]="COMPLEX_MULTIPLY_IMAG",e[e.COMPLEX_MULTIPLY_REAL=3]="COMPLEX_MULTIPLY_REAL",e[e.DIV=4]="DIV",e[e.EQUAL=5]="EQUAL",e[e.GREATER=6]="GREATER",e[e.GREATER_EQUAL=7]="GREATER_EQUAL",e[e.INT_DIV=8]="INT_DIV",e[e.LESS=9]="LESS",e[e.LESS_EQUAL=10]="LESS_EQUAL",e[e.LOGICAL_AND=11]="LOGICAL_AND",e[e.LOGICAL_OR=12]="LOGICAL_OR",e[e.MAX=13]="MAX",e[e.MIN=14]="MIN",e[e.MOD=15]="MOD",e[e.MUL=16]="MUL",e[e.NOT_EQUAL=17]="NOT_EQUAL",e[e.POW=18]="POW",e[e.PRELU=19]="PRELU",e[e.SQUARED_DIFFERENCE=20]="SQUARED_DIFFERENCE",e[e.SUB=21]="SUB"}(fH||(fH={}));var gH,yH="\n  if (isnan(a)) { return a; }\n  if (isnan(b)) { return b; }\n  ",bH="\n  resultTemp = select(\n      resultTemp, vec4<f32>(valueForNaN),\n      vec4<bool>(isNaN) | isnanVec4(a) | isnanVec4(b));\n  ",xH="\n  ".concat(yH,"\n  if (b == 0.) {\n    return uniforms.NAN;\n  }\n  var resultTemp = a % b;\n  if ((a < 0. && b < 0.) || (a >= 0. && b > 0.)) {\n    return resultTemp;\n  } else {\n    return (resultTemp + b) % b;\n  }\n"),kH="\n  let isNaN = !vec4<bool>(b);\n  let valueForNaN = uniforms.NAN;\n  var resultTemp = vec4<f32>(a % b);\n  ".concat(bH,"\n\n  if (!((a[0] < 0. && b[0] < 0.) || (a[0] >= 0. && b[0] > 0.))) {\n    resultTemp[0] = (resultTemp[0] + b[0]) % b[0];\n  }\n  if (!((a[1] < 0. && b[1] < 0.) || (a[1] >= 0. && b[1] > 0.))) {\n    resultTemp[1] = (resultTemp[1] + b[1]) % b[1];\n  }\n  if (!((a[2] < 0. && b[2] < 0.) || (a[2] >= 0. && b[2] > 0.))) {\n    resultTemp[2] = (resultTemp[2] + b[2]) % b[2];\n  }\n  if (!((a[3] < 0. && b[3] < 0.) || (a[3] >= 0. && b[3] > 0.))) {\n    resultTemp[3] = (resultTemp[3] + b[3]) % b[3];\n  }\n\n  return resultTemp;\n"),wH="\n  var resultTemp = vec4<f32>(a != b);\n  let valueForNaN = 1.0;\n  ".concat(bH,"\n\n  return resultTemp;\n"),SH="\n  let isModRound1Bool = vec4<i32>(round(abs(b) % vec4<f32>(2.0))) == vec4<i32>(1);\n  let isModRound1 = vec4<f32>(isModRound1Bool);\n  let multiplier = sign(a) * isModRound1 + (vec4<f32>(1.0) - isModRound1);\n  var resultTemp = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  let isExpZero = b == vec4<f32>(0.0);\n  if (isExpZero.r) {\n    resultTemp.r = 1.0;\n  }\n  if (isExpZero.g) {\n    resultTemp.g = 1.0;\n  }\n  if (isExpZero.b) {\n    resultTemp.b = 1.0;\n  }\n  if (isExpZero.a) {\n    resultTemp.a = 1.0;\n  }\n  let isNaN = (a < vec4<f32>(0.0)) & (floor(b) < b);\n  let valueForNaN = uniforms.NAN;\n  ".concat(bH,"\n  return resultTemp;\n");function IH(e,t){var n=t?bH:yH;return t?"\n    let valueForNaN = ".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"uniforms.NAN",";\n    var resultTemp = vec4<f32>(").concat(e,"(a, b));\n    ")+n+"\n    return resultTemp;\n  ":n+"\n    return ".concat(e,"(a, b);\n  ")}function CH(e,t){switch(e){case fH.ADD:return"return a + b;";case fH.ATAN2:return IH("atan2",t);case fH.COMPLEX_MULTIPLY_IMAG:return"return areal * bimag + aimag * breal;";case fH.COMPLEX_MULTIPLY_REAL:return"return areal * breal - aimag * bimag;";case fH.DIV:return"return a / b;";case fH.EQUAL:return t?"return vec4<f32>(a == b);":"return f32(a == b);";case fH.GREATER:return t?"return vec4<f32>(a > b);":"return f32(a > b);";case fH.GREATER_EQUAL:return t?"return vec4<f32>(a >= b);":"return f32(a >= b);";case fH.INT_DIV:return t?"\n  let ia = vec4<i32>(round(a));\n  let ib = vec4<i32>(round(b));\n  let cond = ib != vec4<i32>(0);\n  var resultTemp = vec4<i32>(0);\n  let s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    resultTemp[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    resultTemp[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    resultTemp[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    resultTemp[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4<f32>(resultTemp);\n":"\n  let s = sign(a) * sign(b);\n  let ia = i32(round(a));\n  let ib = i32(round(b));\n  return f32(idiv(ia, ib, s));\n";case fH.LESS:return t?"return vec4<f32>(a < b);":"return f32(a < b);";case fH.LESS_EQUAL:return t?"return vec4<f32>(a <= b);":"return f32(a <= b);";case fH.LOGICAL_AND:return t?"return (vec4<f32>(a >= vec4<f32>(1.0)) *\n  vec4<f32>(b >= vec4<f32>(1.0)));":"return f32(a >= 1.0 && b >= 1.0);";case fH.LOGICAL_OR:return t?"return min(vec4<f32>(a >= vec4<f32>(1.0)) +\n  vec4<f32>(b >= vec4<f32>(1.0)), vec4<f32>(1.0));":"return f32(a >= 1.0 || b >= 1.0);";case fH.MAX:return IH("max",t);case fH.MIN:return IH("min",t);case fH.MOD:return t?kH:xH;case fH.MUL:return"return a * b;";case fH.NOT_EQUAL:return t?wH:"\n  if (isnan(a) || isnan(b)) {\n    return 1.0;\n  }\n  return f32(a != b);\n";case fH.POW:return t?SH:"\n  if(a < 0.0 && floor(b) < b) {\n    return uniforms.NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  if (round(abs(b) % 2.0) != 1.0) {\n    return pow(abs(a), b);\n  }\n  return sign(a) * pow(abs(a), b);\n";case fH.PRELU:return t?"\n  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));\n  return (aLessThanZero * (b * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);\n":"if (a < 0.0) { return b * a; }  return a;";case fH.SQUARED_DIFFERENCE:return"return (a - b) * (a - b);";case fH.SUB:return"return a - b;";default:throw new Error("BinaryType ".concat(e," is not implemented!"))}}!function(e){e[e.ABS=0]="ABS",e[e.ACOS=1]="ACOS",e[e.ACOSH=2]="ACOSH",e[e.ASIN=3]="ASIN",e[e.ASINH=4]="ASINH",e[e.ATAN=5]="ATAN",e[e.ATANH=6]="ATANH",e[e.CEIL=7]="CEIL",e[e.COS=8]="COS",e[e.COSH=9]="COSH",e[e.ELU=10]="ELU",e[e.ERF=11]="ERF",e[e.EXP=12]="EXP",e[e.EXPM1=13]="EXPM1",e[e.FLOOR=14]="FLOOR",e[e.IS_FINITE=15]="IS_FINITE",e[e.IS_INF=16]="IS_INF",e[e.IS_NAN=17]="IS_NAN",e[e.LINEAR=18]="LINEAR",e[e.LOG=19]="LOG",e[e.LOG1P=20]="LOG1P",e[e.LOGICAL_NOT=21]="LOGICAL_NOT",e[e.NEG=22]="NEG",e[e.RELU=23]="RELU",e[e.RELU6=24]="RELU6",e[e.LEAKYRELU=25]="LEAKYRELU",e[e.RECIPROCAL=26]="RECIPROCAL",e[e.ROUND=27]="ROUND",e[e.RSQRT=28]="RSQRT",e[e.SELU=29]="SELU",e[e.SIGMOID=30]="SIGMOID",e[e.SIGN=31]="SIGN",e[e.SIN=32]="SIN",e[e.SINH=33]="SINH",e[e.SOFTPLUS=34]="SOFTPLUS",e[e.SQRT=35]="SQRT",e[e.SQUARE=36]="SQUARE",e[e.STEP=37]="STEP",e[e.TAN=38]="TAN",e[e.TANH=39]="TANH",e[e.TO_INT=40]="TO_INT"}(gH||(gH={}));var TH='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  let p = '.concat(lv,";\n  let a1 = ").concat(hv,";\n  let a2 = ").concat(pv,";\n  let a3 = ").concat(dv,";\n  let a4 = ").concat(fv,";\n  let a5 = ").concat(mv,";\n\n  let sign = sign(a);\n  let absA = abs(a);\n  let t = 1.0 / (1.0 + p * absA);\n  return sign * (1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-absA * absA));\n"),NH="\n  if (a >= 0.0) {\n    return ".concat(cv," * a;\n  } else {\n    return ").concat(uv," * (exp(a) - 1.0);\n  }\n");function EH(e,t){switch(e){case gH.ABS:return"return abs(a);";case gH.ACOS:return"\n  if (abs(a) > 1.) {\n    return uniforms.NAN;\n  }\n  return acos(a);\n";case gH.ACOSH:return"\n  if (a < 1.) {\n    return uniforms.NAN;\n  }\n  return acosh(a);\n";case gH.ASIN:return"\n  if (abs(a) > 1.) {\n    return uniforms.NAN;\n  }\n  return asin(a);\n";case gH.ASINH:return"return asinh(a);";case gH.ATAN:return"\n  if (isnan(a)) {\n    return uniforms.NAN;\n  }\n  return atan(a);\n";case gH.ATANH:return"\n  if (abs(a) > 1.) {\n    return uniforms.NAN;\n  }\n  if (a == 1.) {\n    return uniforms.INFINITY;\n  }\n  if (a == -1.) {\n    return -uniforms.INFINITY;\n  }\n  return atanh(a);\n";case gH.COS:return"return cos(a);";case gH.COSH:return"\n  let e2x = exp(-a);\n  return (e2x + 1.0 / e2x) / 2.0;\n";case gH.CEIL:return"return ceil(a);";case gH.ELU:return t?"\n  var resFloat = exp(a) - vec4<f32>(1.0);\n  if (a.r >= 0.0) {\n    resFloat.r = a.r;\n  }\n  if (a.g >= 0.0) {\n    resFloat.g = a.g;\n  }\n  if (a.b >= 0.0) {\n    resFloat.b = a.b;\n  }\n  if (a.a >= 0.0) {\n    resFloat.a = a.a;\n  }\n  return resFloat;\n":"if (a >= 0.0) { return a; }  return (exp(a) - 1.0);";case gH.ERF:return TH;case gH.EXP:return"return exp(a);";case gH.EXPM1:return"return exp(a) - 1.0;";case gH.FLOOR:return"return floor(a);";case gH.IS_FINITE:return"return f32(!isnan(a) && !isinf(a));";case gH.IS_INF:return"return f32(isinf(a));";case gH.IS_NAN:return"return f32(isnan(a));";case gH.LINEAR:return"return a;";case gH.LOG:return"if (a < 0.0) { return uniforms.NAN; }\n  return log(a);";case gH.LOG1P:return"\n  if (isnan(a)) { return a; }\n  return log(1.0 + a);\n";case gH.LOGICAL_NOT:return"return f32(!(a >= 1.0));";case gH.NEG:return"return -a;";case gH.LEAKYRELU:return t?"\n  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));\n  return (aLessThanZero * (uniforms.alpha * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);\n":"if (a < 0.0) { return uniforms.alpha * a; } return a;";case gH.RECIPROCAL:return"return 1.0 / a;";case gH.RELU:return t?"\n  return select(a, vec4<f32>(0.0), a < vec4<f32>(0.0));\n":"return select(a, 0.0, a < 0.0);";case gH.RELU6:return t?"return clamp(a, vec4<f32>(0.0, 0.0, 0.0, 0.0), vec4<f32>(6.0, 6.0, 6.0, 6.0));":"return clamp(a, 0.0, 6.0);";case gH.ROUND:return"return round(a);";case gH.RSQRT:return"return inverseSqrt(a);";case gH.SELU:return NH;case gH.SIGMOID:return"return 1.0 / (1.0 + exp(-1.0 * a));";case gH.SIGN:return"return sign(a);";case gH.SIN:return"return sin(a);";case gH.SINH:return"\n  let e2x = exp(a);\n  return (e2x - 1.0 / e2x) / 2.0;\n";case gH.SOFTPLUS:return"\n  let epsilon = 1.1920928955078125e-7;\n  let threshold = log(epsilon) + 2.0;\n\n  let too_large = a > -threshold;\n  let too_small = a < threshold;\n  let exp_a = exp(a);\n\n  if (too_large) {\n    return a;\n  } else if (too_small) {\n    return exp_a;\n  } else {\n    return log(exp_a + 1.0);\n  }\n";case gH.SQRT:return"return sqrt(a);";case gH.SQUARE:return"return a * a;";case gH.STEP:return"\n  if (isnan(a)) {\n    return a;\n  }\n\n  return select(uniforms.stepAlpha, 1.0, a > 0.0);\n";case gH.TAN:return"return tan(a);";case gH.TANH:return"\n  let e2x = exp(-2.0 * abs(a));\n  return sign(a) * (1.0 - e2x) / (1.0 + e2x);\n";case gH.TO_INT:return"return f32(i32((a)));";default:throw new Error("BinaryType ".concat(e," is not implemented!"))}}var RH=function(e){switch(e){case 1:return"f32";case 2:return"vec2<f32>";case 3:return"vec3<f32>";case 4:return"vec4<f32>";default:throw new Error(e+"-component is not supported.")}};function AH(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;if(null===e)return"";var a="";if("linear"===e)a=EH(gH.LINEAR);else if("relu"===e)a=EH(gH.RELU,n);else if("elu"===e)a=EH(gH.ELU,n);else if("relu6"===e)a=EH(gH.RELU6,n);else if("prelu"===e)a=CH(fH.PRELU,n);else if("sigmoid"===e)a=EH(gH.SIGMOID,n);else{if("leakyrelu"!==e)throw new Error("Activation ".concat(e," has not been implemented for the WebGPU backend."));a=EH(gH.LEAKYRELU,n)}var i=RH(n?4:1);return t?"\n      fn activation(a : ".concat(i,", coords : vec").concat(r,"<i32>) -> ").concat(i," {\n        let b = getPreluActivationWeightsByOutputCoords(coords);\n        ").concat(a,"\n      }"):"\n      fn activation(a : ".concat(i,", coords : vec").concat(r,"<i32>) -> ").concat(i," {\n        ").concat(a,"\n      }")}function _H(e,t){return"\n      ".concat(e?"value = value + getBiasByOutputCoords(coords);":"","\n      ").concat(t?"value = activation(value, coords);":"","\n      ")}function OH(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;nn(e&&1===a||!e,(function(){return"transposeA ".concat(e," is not compatible with component size ").concat(a)}));var i="\n      ".concat(e?"value = getA(batch, col, row);":"value = getA(batch, row, col);","\n\n    "),o=t?"value = getB(batch, col, row);":"value = getB(batch, row, col);";return"\n  fn mm_readA(batch: i32, row: i32, colIn: i32) -> ".concat(RH(a)," {\n    var value = ").concat(RH(a),"(0.0);\n    let col = colIn * ").concat(a,";\n    ").concat(n&&r?i:"\n    ".concat(e?"if(row < uniforms.dimAOuter && col < uniforms.dimInner)":"if(row < uniforms.aShape[1] && col < uniforms.aShape[2])","\n    {\n      ").concat(i,"\n    }\n    "),"\n    return value;\n  }\n\n  fn mm_readB(batch: i32, row: i32, colIn: i32) -> ").concat(RH(a)," {\n    let col = colIn * ").concat(a,";\n    var value = ").concat(RH(a),"(0.0);\n    ").concat(o,"\n    return value;\n  }\n  ")}function FH(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;return"\n  ".concat(OH(n,r,a,i,arguments.length>6&&void 0!==arguments[6]&&arguments[6],o),"\n  fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ").concat(RH(o),") {\n    let col = colIn * ").concat(o,";\n    ").concat(a&&i?"":"if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)","\n    {\n      var value = valueIn;\n      let coords = vec3<i32>(batch, row, col);\n      ").concat(_H(e,t),"\n      setOutputAtCoords(coords[0], coords[1], coords[2], value);\n    }\n  }\n  ")}function DH(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:32,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=t[1]*e[1],c=t[0]*e[0],l=n?u:r,h=n?r:u,p=l/t[0],d=r/t[1],f=e[1];return nn((n&&4===p&&4===e[1]||!n&&(3===p||4===p))&&l%t[0]==0&&r%t[1]==0&&4===e[0],(function(){return"If transposeA ".concat(n," is true, innerElementSize ").concat(p," and workPerThread[1] ").concat(e[1]," must be 4.\n          Otherwise, innerElementSize ").concat(p," must be 3 or 4.\n      tileAWidth ").concat(l," must be divisible by workgroupSize[0]").concat(t[0],". tileInner ").concat(r," must be divisible by workgroupSize[1] ").concat(t[1],". colPerThread ").concat(e[0]," must be 4.")})),"\n  var<workgroup> mm_Asub : array<array<vec".concat(p,"<f32>, ").concat(l/p,">, ").concat(h,">;\n  var<workgroup> mm_Bsub : array<array<vec4<f32>, ").concat(c/e[0],">, ").concat(r,">;\n\n  ").concat(Qj()," {\n    let localRow = i32(localId.y);\n    let tileRow = ").concat(o?"0":"localRow * "+f,";\n    let tileCol = i32(localId.x);\n\n    let globalRow = ").concat(o?"0":"i32(globalId.y) * "+f,";\n    let globalCol = i32(globalId.x);\n    let batch = ").concat(a?"0":"i32(globalId.z)",";\n    let batchA = ").concat(a||!s?"batch":"batch % uniforms.aShape[0]",";\n    let batchB = ").concat(a||!s?"batch":"batch % uniforms.bShape[0]",";\n    let globalRowStart = i32(workgroupId.y) * ").concat(u,";\n\n    let numTiles = ").concat(a?""+Math.ceil(i/r):"(uniforms.dimInner - 1) / ".concat(r," + 1"),";\n    var kStart = ").concat(a?"i32(globalId.z) * "+i:"0",";\n\n    var acc: array<vec4<f32>, ").concat(f,">;\n\n    // Loop over shared dimension.\n    let tileRowB = localRow * ").concat(d,";\n    for (var t = 0; t < numTiles; t++) {\n        // Load one tile of A into local memory.\n        for (var innerRow = 0; innerRow < ").concat(f,"; innerRow++) {\n            let inputRow = tileRow + innerRow;\n            let inputCol = tileCol;\n            ").concat(function(e,t){return e?"\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          kStart + inputRow,\n          globalRowStart / ".concat(t," + inputCol);\n        "):"\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          globalRow + innerRow,\n          kStart / ".concat(t," + inputCol);\n        ")}(n,p),"\n        }\n\n        // Load one tile of B into local memory.\n        for (var innerRow = 0; innerRow < ").concat(d,"; innerRow++) {\n            let inputRow = tileRowB + innerRow;\n            let inputCol = tileCol;\n            mm_Bsub[inputRow][inputCol] = mm_readB(batchB, kStart + inputRow, globalCol);\n        }\n        kStart = kStart + ").concat(r,";\n        workgroupBarrier();\n\n        // Compute acc values for a single thread.\n        for (var k = 0; k < ").concat(r/p,"; k++) {\n            let BCached0 = mm_Bsub[k * ").concat(p,"][tileCol];\n            let BCached1 = mm_Bsub[k * ").concat(p," + 1][tileCol];\n            let BCached2 = mm_Bsub[k * ").concat(p," + 2][tileCol];\n            ").concat(3===p?"":"let BCached3 = mm_Bsub[k * ".concat(p," + 3][tileCol];"),"\n\n            ").concat(function(e,t,n){return e?"\n        let ACached0 = mm_Asub[k * ".concat(t,"][localRow];\n        let ACached1 = mm_Asub[k * ").concat(t," + 1][localRow];\n        let ACached2 = mm_Asub[k * ").concat(t," + 2][localRow];\n        ").concat(3===t?"":"let ACached3 = mm_Asub[k * ".concat(t," + 3][localRow];"),"\n        for (var i = 0; i < ").concat(n,"; i++) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ").concat(3===t?"":"acc[i] = BCached3 * ACached3[i] + acc[i];","\n        }"):"\n        for (var i = 0; i < ".concat(n,"; i++) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ").concat(3===t?"":"acc[i] = BCached3 * ACached.w + acc[i];","\n        }")}(n,p,f),"\n        }\n\n        workgroupBarrier();\n    }\n\n    for (var innerRow = 0; innerRow < ").concat(f,"; innerRow++) {\n        mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n    }\n  }")}var MH=function(e){return e?"\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          kStart + inputRow,\n          globalRowStart + inputCol);\n        ":"\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          globalRowStart + inputRow,\n          kStart + inputCol);\n        "};function PH(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:32,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=e[1]*t[1],c=e[0]*t[0],l=n?u:r,h=n?r:u;nn(h%t[1]==0&&l%t[0]==0&&r%t[1]==0,(function(){return"tileAHight ".concat(h," must be divisible by workgroupSize[1]").concat(t[1],", tileAWidth ").concat(l," must be divisible by workgroupSize[0]").concat(t[0],", tileInner ").concat(r," must be divisible by workgroupSize[1]").concat(t[1])}));var p=h/t[1],d=l/t[0],f=r/t[1],m=e[1],v=e[0],g=o?"\n      let localRow = i32(localId.y);\n      let localCol = i32(localId.x);\n      let globalRowStart = i32(workgroupId.y) * ".concat(u,";\n      let globalColStart = i32(workgroupId.x) * ").concat(c,";\n\n      // Loop over shared dimension.\n      for (var t = 0; t < numTiles; t++) {\n        // Load one tile of A into local memory.\n        for (var inputRow = localRow; inputRow < ").concat(h,"; inputRow = inputRow + ").concat(t[1],") {\n          for (var inputCol = localCol; inputCol < ").concat(l,"; inputCol = inputCol + ").concat(t[0],") {\n            ").concat(MH(n),"\n          }\n        }\n        // Load one tile of B into local memory.\n        for (var inputRow = localRow; inputRow < ").concat(r,"; inputRow = inputRow + ").concat(t[1],") {\n              for (var inputCol = localCol; inputCol < ").concat(c,"; inputCol = inputCol + ").concat(t[0],") {\n            mm_Bsub[inputRow][inputCol] = mm_readB(batchB,\n              kStart + inputRow,\n              globalColStart + inputCol);\n          }\n        }\n        kStart = kStart + ").concat(r,";\n        workgroupBarrier();\n\n        // Compute acc values for a single thread.\n        var BCached : array<f32, ").concat(v,">;\n        for (var k = 0; k < ").concat(r,"; k++) {\n          for (var inner = 0; inner < ").concat(v,"; inner++) {\n            BCached[inner] = mm_Bsub[k][localCol + inner * ").concat(t[0],"];\n          }\n          for (var innerRow = 0; innerRow < ").concat(m,"; innerRow++) {\n            let ACached = ").concat(n?"mm_Asub[k][localRow + innerRow * ".concat(t[1],"];"):"mm_Asub[localRow + innerRow * ".concat(t[1],"][k];"),"\n            for (var innerCol = 0; innerCol < ").concat(v,"; innerCol++) {\n              acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                  ACached * BCached[innerCol];\n            }\n          }\n        }\n        workgroupBarrier();\n      }\n      for (var innerRow = 0; innerRow < ").concat(m,"; innerRow++) {\n        let gRow = globalRowStart + localRow + innerRow * ").concat(t[1],";\n        for (var innerCol = 0; innerCol < ").concat(v,"; innerCol++) {\n          let gCol = globalColStart + localCol + innerCol * ").concat(t[0],";\n          mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n        }\n      }\n      "):"\n  let tileRow = i32(localId.y) * ".concat(m,";\n  let tileCol = i32(localId.x) * ").concat(v,";\n\n  let globalRow = i32(globalId.y) * ").concat(m,";\n  let globalCol = i32(globalId.x) * ").concat(v,";\n  let globalRowStart = i32(workgroupId.y) * ").concat(u,";\n\n  let tileRowA = i32(localId.y) * ").concat(p,";\n  let tileColA = i32(localId.x) * ").concat(d,";\n  let tileRowB = i32(localId.y) * ").concat(f,";\n  // Loop over shared dimension.\n  for (var t = 0; t < numTiles; t++) {\n    // Load one tile of A into local memory.\n    for (var innerRow = 0; innerRow < ").concat(p,"; innerRow++) {\n      for (var innerCol = 0; innerCol < ").concat(d,"; innerCol++) {\n        let inputRow = tileRowA + innerRow;\n        let inputCol = tileColA + innerCol;\n        ").concat(MH(n),"\n      }\n    }\n\n    // Load one tile of B into local memory.\n    for (var innerRow = 0; innerRow < ").concat(f,"; innerRow++) {\n      for (var innerCol = 0; innerCol < ").concat(v,"; innerCol++) {\n        let inputRow = tileRowB + innerRow;\n        let inputCol = tileCol + innerCol;\n        mm_Bsub[inputRow][inputCol] = mm_readB(batchB,\n          kStart + inputRow,\n          globalCol + innerCol);\n      }\n    }\n    kStart = kStart + ").concat(r,";\n    workgroupBarrier();\n\n    // Compute acc values for a single thread.\n    var BCached : array<f32, ").concat(v,">;\n    for (var k = 0; k < ").concat(r,"; k++) {\n      for (var inner = 0; inner < ").concat(v,"; inner++) {\n        BCached[inner] = mm_Bsub[k][tileCol + inner];\n      }\n\n      for (var innerRow = 0; innerRow < ").concat(m,"; innerRow++) {\n        ").concat(function(e){return e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];"}(n),"\n        for (var innerCol = 0; innerCol < ").concat(v,"; innerCol++) {\n          acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n        }\n      }\n    }\n\n    workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < ").concat(m,"; innerRow++) {\n    for (var innerCol = 0; innerCol < ").concat(v,"; innerCol++) {\n      mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n          acc[innerRow][innerCol]);\n    }\n  }\n  ");return"\n    var<workgroup> mm_Asub : array<array<f32, ".concat(l,">, ").concat(h,">;\n    var<workgroup> mm_Bsub : array<array<f32, ").concat(c,">, ").concat(r,">;\n\n    ").concat(Qj()," {\n      let batch = ").concat(a?"0":"i32(globalId.z)",";\n      let batchA = ").concat(a||!s?"batch":"batch % uniforms.aShape[0]",";\n      let batchB = ").concat(a||!s?"batch":"batch % uniforms.bShape[0]",";\n      let numTiles = ").concat(a?""+Math.ceil(i/r):"(uniforms.dimInner - 1) / ".concat(r," + 1"),";\n      var kStart = ").concat(a?"i32(globalId.z) * "+i:"0",";\n\n      var acc : array<array<f32, ").concat(v,">, ").concat(m,">;\n\n      // Without this initialization strange values show up in acc.\n      for (var innerRow = 0; innerRow < ").concat(m,"; innerRow++) {\n        for (var innerCol = 0; innerCol < ").concat(v,"; innerCol++) {\n          acc[innerRow][innerCol] = 0.0;\n        }\n      }\n      ").concat(g,"\n    }\n  ")}var LH=function(){function e(t,n){var r,a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Te(this,e),this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=n,this.dispatchLayout={x:[2],y:[1],z:[0]};var h=i?t[1]:t[2];if(this.isVec4=(h%4==0&&!i||n[1]%4==0&&i)&&n[2]%4==0&&!o,this.isVectorA=1===n[1]&&!i,!this.isVec4&&this.isVectorA)this.elementsPerThread=[1,1,1],this.workgroupSize=[32,1,1];else{var p=function(e,t,n){var r=[8,8,1],a=[4,4,1];return arguments.length>3&&void 0!==arguments[3]&&arguments[3]||(e<=8&&(a[1]=1),t<=16&&n<=16&&(r[0]=4)),{workgroupSize:r,elementsPerThread:a}}(n[1],h,n[2],i);this.workgroupSize=p.workgroupSize,this.elementsPerThread=p.elementsPerThread}this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread);var d=null!=s,f=null!=c;d&&this.variableNames.push("bias"),f&&this.variableNames.push("preluActivationWeights"),this.sequentialAccessByThreads=l,this.transposeA=i,this.transposeB=o,this.addBias=d,this.activation=u,this.hasPreluActivationWeights=f,r=this.getShapeFit(n[1],n[2],h),a=(0,E.Z)(r,3),this.fitAOuter=a[0],this.fitBOuter=a[1],this.fitInner=a[2],this.shaderKey="matMulPacked_".concat(this.elementsPerThread,"_").concat(i,"_").concat(o,"_").concat(this.activation,"_").concat(this.fitAOuter,"_").concat(this.fitBOuter,"_").concat(this.fitInner,"_").concat(this.isVec4,"_").concat(this.isVectorA,"_").concat(this.sequentialAccessByThreads)}return Re(e,[{key:"getShapeFit",value:function(e,t,n){var r=this.workgroupSize[1]*this.elementsPerThread[1],a=this.workgroupSize[0]*this.elementsPerThread[0];return!this.isVec4&&this.isVectorA?this.tileInner=4*this.workgroupSize[0]:this.tileInner=a,[e%r==0,t%a==0,n%this.tileInner==0]}},{key:"getUserCode",value:function(){return"\n      ".concat(AH(this.activation,this.hasPreluActivationWeights,this.isVec4),"\n      ").concat(FH(this.addBias,this.activation,!1,this.transposeB,this.fitAOuter,this.fitBOuter,this.fitInner,this.isVec4?4:1),"\n      ").concat(this.isVec4?DH(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.isVectorA,!0):this.isVectorA?function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];nn(1===e[1]&&1===e[2],(function(){return"A linear work group size is required. But got ".concat(e,".")}));var n=4*e[0];return"\n    var<workgroup> mm_Asub : array<vec4<f32>, ".concat(e[0],">;\n\n    ").concat(Qj()," {\n      let tileCol = i32(localId.x);\n      let globalCol = i32(globalId.x);\n      let globalRow = i32(globalId.y);\n\n      let numTiles = (uniforms.dimInner - 1) / ").concat(n," + 1;\n      let batch = i32(globalId.z);\n      let batchA = batch % uniforms.aShape[0];\n      let batchB = batch % uniforms.bShape[0];\n      // Without this initialization strange values show up in acc.\n      var acc = 0.0;\n\n      // Loop over shared dimension.\n      for (var t = 0; t < numTiles; t++) {\n        // Load one tile of A into local memory.\n        let colA = t * ").concat(n," + tileCol * 4;\n        mm_Asub[tileCol] = vec4<f32>(").concat(function(e){return e?"\n      mm_readA(batchA, colA, globalRow),\n      mm_readA(batchA, colA + 1, globalRow),\n      mm_readA(batchA, colA + 2, globalRow),\n      mm_readA(batchA, colA + 3, globalRow)\n  ":"\n      mm_readA(batchA, globalRow, colA),\n      mm_readA(batchA, globalRow, colA + 1),\n      mm_readA(batchA, globalRow, colA + 2),\n      mm_readA(batchA, globalRow, colA + 3)\n  "}(t),");\n        workgroupBarrier();\n\n        // Compute acc values for a single thread.\n        for (var k = 0; k < ").concat(n/4,"; k++) {\n          let rowB = t * ").concat(n," + k * 4;\n          let BCached = vec4<f32>(mm_readB(batchB, rowB, globalCol),\n                              mm_readB(batchB, rowB + 1, globalCol),\n                              mm_readB(batchB, rowB + 2, globalCol),\n                              mm_readB(batchB, rowB + 3, globalCol));\n\n          let ACached = mm_Asub[k];\n          acc = acc + dot(ACached, BCached);\n        }\n\n        workgroupBarrier();\n      }\n\n      mm_write(batch, globalRow, globalCol, acc);\n    }\n  ")}(this.workgroupSize,this.transposeA):PH(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.sequentialAccessByThreads,!0),"\n    ")}}]),e}(),zH=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Te(this,e),this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[256,1,1],this.outputShape=t,this.dispatchLayout={x:[],y:[1,2],z:[0]},this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize);var s=null!=a,u=null!=o;s&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),this.transposeA=n,this.transposeB=r,this.addBias=s,this.activation=i,this.hasPreluActivationWeights=u,this.shaderKey="matMulReduce_".concat(this.activation,"_").concat(n,"_").concat(r)}return Re(e,[{key:"getUserCode",value:function(){var e;return"\n      ".concat(AH(this.activation,this.hasPreluActivationWeights),"\n      ").concat(FH(this.addBias,this.activation,this.transposeA,this.transposeB),"\n      ").concat((e=this.workgroupSize[0],"\n    var<workgroup> sumValues : array<f32, ".concat(e,">;\n    ").concat(Qj()," {\n      let coords = getOutputCoords();\n      let batch = coords[0];\n      let batchA = batch % uniforms.aShape[0];\n      let batchB = batch % uniforms.bShape[0];\n      let row = coords[1];\n      let col = coords[2];\n      var sum = 0.0;\n      let Length = uniforms.dimInner;\n      for (var k = i32(localId.x); k < Length; k = k + ").concat(e,") {\n        let dataA = mm_readA(batchA, row, k);\n        let dataB = mm_readB(batchB, k, col);\n        sum = sum + dataA * dataB;\n      }\n      sumValues[localId.x] = sum;\n      workgroupBarrier();\n\n      for(var currentSize = ").concat(e/2,"u; currentSize > 1u;\n          currentSize = currentSize / 2u) {\n        if (localId.x < currentSize)\n        {\n          sumValues[localId.x] = sumValues[localId.x] + sumValues[localId.x + currentSize];\n        }\n        workgroupBarrier();\n      }\n\n      if (localId.x == 0u) {\n        sum = sumValues[0] + sumValues[1];\n        mm_write(batch, row, col, sum);\n      }\n    }\n  ")),"\n    ")}}]),e}(),BH=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;Te(this,e),this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[16,8,1],this.outputShape=r,this.dispatchLayout={x:[2],y:[1],z:[0]},this.dispatch=[Math.ceil(r[2]/this.workgroupSize[0]),Math.ceil(r[1]/this.workgroupSize[1]),r[0]];var c=null!=o;c&&this.variableNames.push("bias");var l=null!=u;l&&this.variableNames.push("preluActivationWeights"),this.transposeA=a,this.transposeB=i,this.addBias=c,this.activation=s,this.hasPreluActivationWeights=l,this.shaderKey="matMulSmallOutputSize_".concat(this.activation,"_").concat(a,"_").concat(i)}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(AH(this.activation,this.hasPreluActivationWeights),"\n      ").concat(FH(this.addBias,this.activation,this.transposeA,this.transposeB),"\n      ").concat(function(e){var t=e[1],n=e[0],r=t>n?t:n;return"\n  var<workgroup> mm_Asub : array<array<f32, ".concat(r,">, ").concat(t,">;\n  var<workgroup> mm_Bsub : array<array<f32, ").concat(n,">, ").concat(r,">;\n\n  // If the output size is small for matrix multiplication, avoid to use vec4\n  // and handle some elements per thread to optimally utilize the ALU.\n  // Read data from global memory to registers firstly, then store them into\n  // shared memory, so it is instruction-Level parallelism for arithmetic\n  // operations and others handle IO operations between barrier api, makes ALU\n  // and load/store units work simultaneously, could improves the performance.\n  ").concat(Qj()," {\n    let tileRow = i32(localId.y);\n    let tileCol = i32(localId.x);\n    let globalRow = i32(globalId.y);\n    let globalCol = i32(globalId.x);\n    let batch = i32(globalId.z);\n    let batchA = batch % uniforms.aShape[0];\n    let batchB = batch % uniforms.bShape[0];\n\n    // uniforms.dimInner should be greater than 0.\n    let numTiles = (uniforms.dimInner - 1) / ").concat(r," + 1;\n    var acc = 0.0;\n\n    var globalColA = tileCol;\n    var globalRowB = 0;\n    var regA = mm_readA(batchA, globalRow, globalColA);\n    var regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);\n    var regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);\n    globalColA = globalColA + ").concat(r,";\n    globalRowB = globalRowB + ").concat(r,";\n\n    for (var t = 0; t < numTiles; t = t + 1) {\n      mm_Asub[tileRow][tileCol] = regA;\n      mm_Bsub[2 * tileRow][tileCol] = regB0;\n      mm_Bsub[2 * tileRow + 1][tileCol] = regB1;\n\n      workgroupBarrier();\n\n      regA = mm_readA(batchA, globalRow, globalColA);\n      regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);\n      regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);\n      globalColA = globalColA + ").concat(r,";\n      globalRowB = globalRowB + ").concat(r,";\n\n      for (var k = 0; k < ").concat(r,"; k = k + 1) {\n        acc = acc + mm_Asub[tileRow][k] * mm_Bsub[k][tileCol];\n      }\n      workgroupBarrier();\n    }\n\n    mm_write(batch, globalRow, globalCol, acc);\n  }\n  ")}(this.workgroupSize),"\n    ")}}]),e}(),UH=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Te(this,e),this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[8,8,1],this.atomic=!0,this.isVec4=!1,this.splitedDimInner=128,nn(1===t[0],(function(){return"MatMulSplitKProgram only supports batch = 1."})),this.outputShape=t,this.dispatchLayout={x:[2],y:[1],z:[0,3]},this.isVec4=(r&&this.outputShape[1]%4==0||!r&&n%4==0)&&this.outputShape[2]%4==0,this.elementsPerThread=[4,4,this.splitedDimInner],this.isVec4||(this.outputShape[1]<16&&(this.elementsPerThread[1]=1),this.outputShape[2]<16&&(this.elementsPerThread[0]=1)),this.dispatch=uH(this.dispatchLayout,[this.outputShape[0],this.outputShape[1],this.outputShape[2],n],this.workgroupSize,this.elementsPerThread),this.transposeA=r,this.transposeB=a,this.shaderKey="matMulSplitK_".concat(r,"_").concat(a,"_").concat(this.elementsPerThread,"_").concat(this.isVec4)}return Re(e,[{key:"getUserCode",value:function(){var e=this.isVec4?4:1;return"\n      ".concat(OH(!1,this.transposeB,!1,!1,!1,e),"\n      fn mm_write(batch: i32, row : i32, colIn : i32, value : ").concat(RH(e),") {\n        let col = colIn * ").concat(e,";\n        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {\n          let coords = vec3<i32>(batch, row, col);\n          let flatIndex = getOutputIndexFromCoords(coords);\n          // The problem is that we should initialize output to zero before using.\n          // Otherwise, the original value will be added to the result.\n          for (var i = 0; i < ").concat(e,"; i = i + 1) {\n            ").concat(qj("&result[flatIndex + i]",e>1?"value[i]":"value","float32"),"\n          }\n        }\n      }\n      ").concat(this.isVec4?DH(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner):PH(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner),"\n    ")}}]),e}(),WH=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Te(this,e),this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=null!=n,this.hasPreluActivationWeights=null!=a,this.activation=r,this.addBias&&this.variableNames.push("bias"),this.hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.shaderKey="biasActivation_"+r}return Re(e,[{key:"getUserCode",value:function(){return"\n    ".concat(AH(this.activation,this.hasPreluActivationWeights),"\n    ").concat(Qj("index")," {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        var value = getXByOutputIndex(index);\n        ").concat(_H(this.addBias,this.activation),"\n        setOutputAtIndex(index, value);\n      }\n    }\n    ")}}]),e}(),VH=function(){function e(t){Te(this,e),this.variableNames=[],this.outputShape=[],this.uniforms="value : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="fill"}return Re(e,[{key:"getUserCode",value:function(){return"\n    ".concat(Qj("index")," {\n      if (index < uniforms.size) {\n        setOutputAtIndex(index, uniforms.value);\n      }\n    }\n  ")}}]),e}();function GH(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||kn(a))){var o=vn(i,on(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new VH(r),u=[{type:"float32",data:[a]}];return t.runWebGPUProgram(s,[],i,u)}var jH={kernelName:Xr,backendName:"webgpu",kernelFunc:GH};function HH(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,i=on(r.shape),o=pn(a,i),s=on(o);return nn(i===s,(function(){return"The new shape (".concat(o,") has ").concat(s," elements and the old shape (").concat(r.shape,") has ").concat(i," elements. The new shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var ZH={kernelName:ei,backendName:"webgpu",kernelFunc:HH};function KH(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,p=e.activation,d=void 0===p?null:p,f=t.shape.length,m=n.shape.length,v=r?t.shape[f-2]:t.shape[f-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=on(x),S=on(k),I=Ic(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);nn(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var C,T,N=r?[w,v,y]:[w,y,v],E=a?[S,b,g]:[S,g,b],R=HH({inputs:{x:t},backend:i,attrs:{shape:N}}),A=HH({inputs:{x:n},backend:i,attrs:{shape:E}}),_=[R,A],O=Math.max(w,S),F=[R,A],D=[{type:"int32",data:[y]},{type:"int32",data:[b]},{type:"int32",data:[v]}],M=[O,y,b],P=zn().get("WEBGPU_MATMUL_PROGRAM_TYPE");if(P<0){var L=zn().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),z=L>0?L:i.thresholdToIncreaseWorkgroups,B=O*Math.ceil(y/32)*Math.ceil(b/32);P=B<=z||y<=8&&B<=2*z?O*y*b<=128?oH.MatMulReduceProgram:1===O&&g>=2e3?oH.MatMulSplitKProgram:oH.MatMulSmallOutputSizeProgram:oH.MatMulPackedProgram}switch(P){case oH.MatMulReduceProgram:C=new zH(M,r,a,s,d,c);break;case oH.MatMulSplitKProgram:if(T=GH({backend:i,attrs:{shape:M,value:0,dtype:t.dtype}}),C=new UH(M,g,r,a),s||d){T=i.runWebGPUProgram(C,F,t.dtype,D,T);var U=new WH(T.shape,s,d,c),W=null,V=[T];s&&V.push(s),c&&V.push(c),"leakyrelu"===d&&(W=[{type:"float32",data:[h]}],U.uniforms+=" alpha : f32,");var G=i.runWebGPUProgram(U,V,T.dtype,W);_.push(T);var j=HH({inputs:{x:G},backend:i,attrs:{shape:I}});_.push(G);var H,Z=Kt(_);try{for(Z.s();!(H=Z.n()).done;){var K=H.value;i.disposeData(K.dataId)}}catch($Q){Z.e($Q)}finally{Z.f()}return j}break;case oH.MatMulSmallOutputSizeProgram:C=new BH(N,E,M,r,a,s,d,c);break;case oH.MatMulPackedProgram:var q=i.adapterInfo.isIntel();C=new LH(N,M,r,a,s,d,c,q);break;default:throw new Error("Unsupported MatMulProgramType ".concat(P,"."))}s&&F.push(s),c&&F.push(c),"leakyrelu"===d&&(D.push({type:"float32",data:[h]}),C.uniforms+=" alpha : f32,");var X=HH({inputs:{x:T=i.runWebGPUProgram(C,F,t.dtype,D,T)},backend:i,attrs:{shape:I}});_.push(T);for(var Y=0,Q=_;Y<Q.length;Y++){var J=Q[Y];i.disposeData(J.dataId)}return X}var qH={kernelName:Qi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return KH({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},XH=function(){function e(t,n,r){Te(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=Ic(n,r),this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="binaryOpComplex_"+t,this.op=t}return Re(e,[{key:"getUserCode",value:function(){return"\n      fn binaryOpComplex(\n          areal : f32, aimag : f32, breal : f32, bimag : f32) -> f32 {\n        ".concat(CH(this.op,!1),"\n      }\n\n      ").concat(Qj("index")," {\n        if(index < uniforms.size) {\n          let areal = getARealByOutputIndex(index);\n          let aimag = getAImagByOutputIndex(index);\n          let breal = getBRealByOutputIndex(index);\n          let bimag = getBImagByOutputIndex(index);\n          setOutputAtIndex(index, binaryOpComplex(areal, aimag, breal, bimag));\n        }\n      }\n    ")}}]),e}(),YH=function(){function e(t,n,r){Te(this,e),this.size=!0,this.variableNames=["A","B"],this.outputShape=Ic(n,r),this.dispatchLayout=hH(this.outputShape),this.op=t,this.useSharedMemoryWithA=n.length<=1&&r.length>1&&n[0]<128,this.useSharedMemoryWithB=r.length<=1&&n.length>1&&r[0]<128,this.useSharedMemoryWithA||this.useSharedMemoryWithB?(this.isVec4=!1,this.lastDimensionSize=this.useSharedMemoryWithB?r[0]:n[0],this.shaderKey="binary_".concat(this.type,"_").concat(t,"_").concat(this.lastDimensionSize,"_").concat(this.useSharedMemoryWithB),this.type="shared",this.workgroupSize=[256,1,1],this.workPerThread=1):(sn(n,r)&&on(n)%4==0?(this.isVec4=!0,this.type="vec4",this.workPerThread=4):(this.isVec4=!1,this.type="plain",this.workPerThread=1),this.shaderKey="binary_".concat(this.type,"_").concat(t),this.workgroupSize=[128,1,1]),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1])}return Re(e,[{key:"getUserCode",value:function(){var e,t=this.isVec4?"vec4<f32>":"f32",n="\n    fn binaryOperation(a : ".concat(t,", b : ").concat(t,") -> ").concat(t," {\n      let isNaN = false;\n      {\n        ").concat(CH(this.op,this.isVec4),"\n      }\n    };\n    ");if("shared"===this.type){var r=this.lastDimensionSize>1?"coords[".concat(this.outputShape.length-1,"]"):"0",a=this.useSharedMemoryWithB?"let a = getAByOutputIndex(index);\n          let b = sharedBuf[".concat(r,"];"):"let a = sharedBuf[".concat(r,"];\n          let b = getBByOutputIndex(index);");e="\n        ".concat(n,"\n        var<workgroup> sharedBuf : array<f32, ").concat(this.lastDimensionSize,">;\n        ").concat(Qj("index")," {\n          // Fill in the shared memory buffer.\n          let localIndex = i32(localId.x);\n          if(localIndex < ").concat(this.lastDimensionSize,") {\n            sharedBuf[localIndex] = f32(").concat(this.useSharedMemoryWithB?"B":"A","[localIndex]);\n          }\n          workgroupBarrier();\n\n          if(index < uniforms.size) {\n            let coords = getCoordsFromIndex(index);\n            ").concat(a,"\n            setOutputAtIndex(index, binaryOperation(a, b));\n          }\n        }\n        ")}else e="\n       ".concat(n,"\n       ").concat(Qj("index")," {\n         if (index < uniforms.size) {\n           let a = getAByOutputIndex(index);\n           let b = getBByOutputIndex(index);\n           setOutputAtIndex(index, binaryOperation(a, b));\n         }\n       }\n       ");return e}}]),e}();function QH(e){var t=e.inputs.x;return e.backend.incRef(t.dataId),{dataId:t.dataId,shape:t.shape,dtype:t.dtype}}var JH={kernelName:aa,backendName:"webgpu",kernelFunc:QH};function $H(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.tensorMap.get(i.dataId),s=QH({inputs:{x:r},backend:n}),u=QH({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var eZ={kernelName:mr,backendName:"webgpu",kernelFunc:$H},tZ=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Te(this,e),this.variableNames=["A"],this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.op=n,""!==r&&(this.uniforms=r),this.shaderKey="unary_"+n}return Re(e,[{key:"getUserCode",value:function(){return"\n      fn unaryOperation(a : f32) -> f32 {\n        ".concat(EH(this.op,!1),"\n      }\n      ").concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let a = getAByOutputIndex(index);\n          setOutputAtIndex(index, unaryOperation(a));\n        }\n      }\n      ")}}]),e}();function nZ(e){var t=e.opType,n=e.cpuKernelImpl,r=e.dtype;return function(e){var a=e.inputs,i=e.backend,o=a.x,s=i,u=r||o.dtype;if(s.shouldExecuteOnCPU([o])&&null!=n){var c=s.tensorMap.get(o.dataId),l=n(c.values,u);return s.makeTensorInfo(o.shape,u,l)}var h=new tZ(o.shape,t);return s.runWebGPUProgram(h,[o],u)}}function rZ(e){var t=e.opType,n=e.cpuKernelImpl,r=e.supportsComplex,a=void 0!==r&&r,i=e.dtype;return function(e){var r=e.inputs,o=e.backend,s=r.a,u=r.b,c=o;if(a&&"complex64"===s.dtype){var l,h,p=c.tensorMap.get(s.dataId),d=c.tensorMap.get(u.dataId);if(t!==fH.MUL){var f=[[p.complexTensorInfos.real,d.complexTensorInfos.real],[p.complexTensorInfos.imag,d.complexTensorInfos.imag]].map((function(e){var n=(0,E.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:s.shape},o={dataId:a.dataId,dtype:a.dtype,shape:u.shape},l=new YH(t,s.shape,u.shape);return c.runWebGPUProgram(l,[i,o],ss(r.dtype,a.dtype))})),m=(0,E.Z)(f,2);l=m[0],h=m[1]}else{var v=new XH(fH.COMPLEX_MULTIPLY_REAL,s.shape,u.shape),g=new XH(fH.COMPLEX_MULTIPLY_IMAG,s.shape,u.shape),y=[{dataId:p.complexTensorInfos.real.dataId,dtype:p.complexTensorInfos.real.dtype,shape:s.shape},{dataId:p.complexTensorInfos.imag.dataId,dtype:p.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:d.complexTensorInfos.real.dataId,dtype:d.complexTensorInfos.real.dtype,shape:u.shape},{dataId:d.complexTensorInfos.imag.dataId,dtype:d.complexTensorInfos.imag.dtype,shape:u.shape}];l=c.runWebGPUProgram(v,y,"float32"),h=c.runWebGPUProgram(g,y,"float32")}var b=$H({inputs:{real:l,imag:h},backend:c});return c.disposeData(l.dataId),c.disposeData(h.dataId),b}var x=i||ss(s.dtype,u.dtype);if(("string"===s.dtype||"string"===u.dtype||c.shouldExecuteOnCPU([s,u]))&&null!=n){var k=c.tensorMap.get(s.dataId).values,w=c.tensorMap.get(u.dataId).values,S="string"===s.dtype?Wv(k):k,I="string"===s.dtype?Wv(w):w,C=n(s.shape,u.shape,S,I,x),T=(0,E.Z)(C,2),N=T[0],R=T[1];return c.makeTensorInfo(R,x,N)}var A=new YH(t,s.shape,u.shape);return c.runWebGPUProgram(A,[s,u],x)}}function aZ(e){return function(t,n,r,a,i){var o=Ic(t,n),s=o.length,u=In(o),c=mn(i,on(o)),l=t.length,h=n.length,p=In(t),d=In(n),f=wc(t,o),m=wc(n,o);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],a[v%a.length]);else for(var g=function(){var t=Fn(y,s,u),n=t.slice(-l);f.forEach((function(e){return n[e]=0}));var i=On(n,l,p),o=t.slice(-h);m.forEach((function(e){return o[e]=0}));var v=On(o,h,d);c[y]=e(r[i],a[v])},y=0;y<c.length;++y)g();return[c,o]}}var iZ=aZ((function(e,t){return e+t}));function oZ(e){return function(t,n,r){for(var a=mn(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var sZ=oZ((function(e){return Math.ceil(e)})),uZ=aZ((function(e,t){return e===t?1:0})),cZ=oZ((function(e){return Math.exp(e)})),lZ=oZ((function(e){return Math.expm1(e)})),hZ=oZ((function(e){return Math.floor(e)})),pZ=aZ((function(e,t){return e>t?1:0})),dZ=aZ((function(e,t){return e>=t?1:0})),fZ=aZ((function(e,t){return e<t?1:0})),mZ=aZ((function(e,t){return e<=t?1:0})),vZ=oZ((function(e){return Math.log(e)})),gZ=aZ((function(e,t){return Math.max(e,t)})),yZ=aZ((function(e,t){return Math.min(e,t)})),bZ=aZ((function(e,t){return e*t})),xZ=aZ((function(e,t){return e!==t?1:0}));function kZ(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}var wZ=Dm,SZ=function(){function e(t,n,r,a,i,o,s,u,c,l){Te(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Ym(l),this.raggedRank=Qm(this.rowPartitionTypes)}return Re(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===wZ.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===wZ.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case wZ.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case wZ.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type "+wZ[this.getRowPartitionTypeByDimension(t-1)])}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return CZ(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;Jm(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=Xm(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(var a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return nn(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var h=0;h<s-u;++h)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case wZ.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case wZ.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: "+wZ[i])}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case wZ.FIRST_DIM_SIZE:return e[0];case wZ.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case wZ.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type "+wZ[t])}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=CZ(t,!1),i=vn(this.valuesDType,on(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=on(o=o.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;Yu((function(){var e=jl(c,l),t=sh(e,o);c=t.dataSync()}))}for(var h=0,p=0,d=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==d){if(p<d){var v=a.subarray(h*s);IZ(i.subarray(p*s),v,(d-p)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>d)if(1===this.defaultValue.length)i.subarray(d*s,m*s).fill(this.defaultValue[0]),d=m;else for(;m>d;)IZ(i.slice(d*s),c,s),++d;m<0?(h=f+1,p=d):(h=f,d=(p=d)+1)}else++d}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function IZ(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function CZ(e,t){var n,r=[],a=Kt(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch($Q){a.e($Q)}finally{a.f()}return r}var TZ=oZ((function(e){return 1/Math.sqrt(e)})),NZ=oZ((function(e){return 1/(1+Math.exp(-e))})),EZ=oZ((function(e){return Math.sqrt(e)})),RZ=aZ((function(e,t){var n=e-t;return n*n})),AZ=function(){function e(t,n,r,a,i,o){Te(this,e),this.separator=Eo(t),this.nGramWidths=n,this.leftPad=Eo(r),this.rightPad=Eo(a),this.padWidth=i,this.preserveShort=o}return Re(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),h=i-(c+l),p=t+(c>0?0:u-s),d=0;d+=c*o.leftPad.length;for(var f=0;f<h;++f)d+=e[p+f].length;d+=l*o.rightPad.length,d+=(c+l+h-1)*o.separator.length,n[r+u]=new Uint8Array(d);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<h-1;++b)g(e[p+b]),g(o.separator);if(h>0){g(e[p+h-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got "+i);for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=vn("int32",a);if(0===r||0===a){for(var l=new Array(r),h=0;h<=u;++h)c[h]=0;return[l,c]}c[0]=0;for(var p=function(){var e=t[d]-t[d-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[d]=c[d-1]+r},d=1;d<=u;++d)p();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function _Z(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}var OZ=aZ((function(e,t){return e-t})),FZ=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function DZ(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);DZ(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,h=r;for(en(e,n,t),FZ(e[r],c)>0&&en(e,n,r);l<h;){for(en(e,l,h),l++,h--;FZ(e[l],c)<0;)l+=1;for(;FZ(e[h],c)>0;)h-=1}0===FZ(e[n],c)?en(e,n,h):en(e,h+=1,r),h<=t&&(n=h+1),t<=h&&(r=h-1)}}var MZ=Object.freeze({__proto__:null,simpleAbsImpl:function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t},addImpl:iZ,bincountImpl:function(e,t,n,r,a){for(var i=on(r),o=Rn(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o},bincountReduceImpl:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=ju([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o},castImpl:function(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=To([0],n),i=aZ((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),o=(0,E.Z)(i,2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))},ceilImpl:sZ,concatImpl:function(e,t,n,r){var a=vn(n,on(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=on(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Wv(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a},equalImpl:uZ,expImpl:cZ,expm1Impl:lZ,floorImpl:hZ,gatherNdImpl:function(e,t,n,r,a,i,o,s,u){for(var c=ju([r,i],n),l=0;l<r;l++){for(var h=[],p=0,d=0;d<a;d++){var f=e[l*a+d];p+=f*o[d],h.push(f)}if(p<0||p>=u/i)throw new Error("Invalid indices: ".concat(h," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,(0,Lt.Z)(t.indexToLoc(p*i+m)))}return c},gatherV2Impl:function(e,t,n){for(var r=ju(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r},greaterImpl:pZ,greaterEqualImpl:dZ,lessImpl:fZ,lessEqualImpl:mZ,linSpaceImpl:function(e,t,n){var r=(t-e)/(n-1),a=Rn(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a},logImpl:vZ,maxImpl:function(e,t,n,r){for(var a=mn(r,on(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a},maximumImpl:gZ,minimumImpl:yZ,multiplyImpl:bZ,negImpl:function(e,t,n){var r=Co(-1,n);return bZ([],t,r,e,n)},notEqualImpl:xZ,prodImpl:function(e,t,n,r){for(var a=Bh(e,r),i=(0,E.Z)(a,2),o=i[0],s=i[1],u=ss(t,"int32"),c=Rn(on(o),u),l=on(s),h=0;h<c.length;++h){for(var p=h*l,d=1,f=0;f<l;++f)d*=n[p+f];c[h]=d}return{outVals:c,outShape:o,outDtype:u}},raggedGatherImpl:function(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Fn(r,t.length,In(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=function(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],h=1;h<u+1;++h)s[c].push(h*l)}for(var p=0;p<e.length;++p){for(var d=e[p],f=e[p]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[d],x=d;x<f;++x)s[g].push(v[x+1]+b);d=v[d],f=v[f]}f!==d&&(a.push([d,f]),i+=f-d)}return{outSplits:s,valueSlices:a,numValues:i}}(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,h=u.numValues,p=function(e){for(var t=[],n=function(){var n=vn("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(c),d=function(e,t,n,r,a){var i=t.slice();i[0]=a;var o=vn(n,on(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=kZ(t,2)[1],u=kZ(i,2)[1],c=0,l=Kt(n);try{for(l.s();!(o=l.n()).done;)for(var h=o.value,p=h[0];p<h[1];++p){for(var d=0;d<r;++d)a[c*u+d]=e[p*s+d];++c}}catch($Q){l.e($Q)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}(n,r,a,l,h);return[p,d[0],d[1]]},raggedRangeImpl:function(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var h=1;h<l.length;++h)if(l[h]!==l[h-1])throw new Error("starts, limits, and deltas must have the same shape");var p=0===l.length?1:l[0],d=vn("int32",p+1);d[0]=0;for(var f=0;f<p;++f){var m=s?e[0]:e[f],v=u?r[0]:r[f],g=c?i[0]:i[f];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if((y=Math.ceil(Math.abs((v-m)/g)))>2147483647)throw new Error("Requires ((limit - start) / delta) <= 2147483647");d[f+1]=d[f]+y}for(var b=vn(n,d[p]),x=0,k=0;k<p;++k)for(var w=d[k+1]-d[k],S=s?e[0]:e[k],I=c?i[0]:i[k],C=0;C<w;++C)b[x++]=S,S+=I;return[d,b]},raggedTensorToTensorImpl:function(e,t,n,r,a,i,o,s,u,c){return new SZ(e,t,n,r,a,i,o,s,u,c).compute()},rangeImpl:function(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Rn(0,r);var a=Rn(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a},rsqrtImpl:TZ,scatterImpl:function(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=e.values,p=t.values;if(0===r)return ju(n,t.dtype);var d=ju(l,t.dtype);"string"==typeof u||"number"==typeof u?d.values.fill(u):"boolean"==typeof u&&d.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=h[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[v*a+b]+=p[f*a+b]:d.values[v*a+b]=0===t.rank?p[0]:p[f*a+b]}return d},sigmoidImpl:NZ,sliceImpl:function(e,t,n,r,a){var i=pl(r,t,n),o=on(n),s=In(r);if(i){var u=dl(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=ju(r,a,"string"===a?Wv(e):e),l=ju(n,a),h=0;h<l.size;++h){var p=l.indexToLoc(h),d=p.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,(0,Lt.Z)(d))].concat((0,Lt.Z)(p)))}return"string"===a?Vv(l.values):l.values},sparseFillEmptyRowsImpl:function(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),h=t[1];if(0===u){if(0!==s)throw new Error(_v(s));return[vn(n,0),[0,h],vn(a,0),c,l]}for(var p=!0,d=0,f=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*h];if(v<0)throw new Error(Ov(m,v));if(v>=u)throw new Error(Fv(m,v,u));++f[v],p=p&&v>=d,d=v}for(var g=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,g=g&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(g&&p){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,h],k,c,l]}for(var S=f[u-1],I=vn(n,S*h),C=vn(a,S),T=new Array(u).fill(0),N=0;N<s;++N){var E=e[N*h],R=T[E],A=(0===E?0:f[E-1])+R;T[E]++;for(var _=0;_<h;++_)I[A*h+_]=e[N*h+_];C[A]=r[N],l[N]=A}for(var O=0;O<u;++O)if(0===T[O]){var F=0===O?0:f[O-1];I[F*h+0]=O;for(var D=1;D<h;++D)I[F*h+D]=0;C[F]=o}return[I,[S,h],C,c,l]},sparseReshapeImpl:function(e,t,n,r,a){for(var i=on(r),o=t[0],s=a.length,u=[],c=1,l=-1,h=0;h<s;++h){var p=a[h];if(-1===p){if(-1!==l)throw new Error(Dv(l,h));l=h,u.push(1)}else{if(p<0)throw new Error(Mv(h,p));c*=p,u.push(p)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var d=Math.trunc(i/c);if(c*d!==i)throw new Error(Pv(r,u));u[l]=d}if(on(u)!==i)throw new Error(Lv(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var v=f-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=vn(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<f;++w)k+=e[x*f+w]*m[w];for(var S=0;S<s;++S)b[x*s+S]=Math.trunc(k/g[S]),k%=g[S]}return[b,[o,s],u]},sparseSegmentReductionImpl:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");var h=t.slice();h[0]=l;var p=h.reduce((function(e,t){return e*t}),1),d=vn(n,p);if(0===s)return l>0&&d.fill(o),[d,h];if(l<=0)throw new Error("segment ids must be >= 0");for(var f=0,m=1,v=0,g=a[f];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error("segment ids are not increasing")}if(g<0||g>=l)throw new Error(zv(g,l));g>v&&d.fill(o,v*c,g*c);for(var b=f;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(Bv(b,r[b],u[0]));for(var k=0;k<c;k++)d[g*c+k]+=e[x*c+k]}if(i)for(var w=0;w<c;w++)d[g*c+w]/=m-f;if(f=m,v=g+1,g=y,++m>s)break}return v<l&&d.fill(o,v*c,l*c),[d,h]},sqrtImpl:EZ,squaredDifferenceImpl:RZ,stridedSliceImpl:function(e,t,n,r){for(var a=ju(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat((0,Lt.Z)(o)))}return a},stringNGramsImpl:function(e,t,n,r,a,i,o,s){return new AZ(n,r,a,i,o,s).compute(e,t)},stringSplitImpl:function(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;_Z(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var h=vn("int32",2*i),p=new Array(i),d=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)h[2*f]=m,h[2*f+1]=v,p[f]=a[f],++f;return[h,p,d]},stringToHashBucketFastImpl:function(e,t){for(var n=vn("int32",e.length),r=0;r<e.length;++r)n[r]=Io(e[r]).modulo(t).getLowBitsUnsigned();return n},subImpl:OZ,tileImpl:function(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=ju(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a},topKImpl:function(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=mn(n,o*r),c=mn("int32",o*r),l=function(){var t=h*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(DZ(i,r),i=i.slice(0,r)),a&&i.sort(FZ);for(var o=h*r,l=u.subarray(o,o+r),p=c.subarray(o,o+r),d=0;d<r;d++)l[d]=i[d].value,p[d]=i[d].index},h=0;h<o;h++)l();var p=t.slice();return p[p.length-1]=r,[ju(p,n,u),ju(p,"int32",c)]},transposeImpl:function(e,t,n,r,a){for(var i=t.length,o=on(t),s=In(t),u=In(a),c=mn(n,on(a)),l=0;l<o;++l){for(var h=Fn(l,i,s),p=new Array(h.length),d=0;d<p.length;d++)p[d]=h[r[d]];c[On(p,i,u)]=e[l]}return c},uniqueImpl:function(e,t,n,r){for(var a=dn(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new Xo(i,r,e),h=[],p=1===i[0]&&1===i[2],d=0;d<n[a];d++){var f=void 0;if(p)f=e[d].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,d,g));f=m.join(",")}if(void 0!==u[f])c[d]=u[f];else{var y=Object.keys(u).length;u[f]=y,c[d]=y,h.push(d)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new Xo(b,r);h.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=b[1],{outputValues:x.values,outputShape:k,indices:c}}}),PZ=MZ.addImpl,LZ=MZ.castImpl,zZ=MZ.ceilImpl,BZ=MZ.concatImpl,UZ=MZ.equalImpl,WZ=MZ.expImpl,VZ=MZ.expm1Impl,GZ=MZ.floorImpl,jZ=MZ.gatherNdImpl,HZ=MZ.gatherV2Impl,ZZ=MZ.greaterEqualImpl,KZ=MZ.greaterImpl,qZ=MZ.lessEqualImpl,XZ=MZ.lessImpl,YZ=MZ.logImpl,QZ=MZ.maxImpl,JZ=MZ.maximumImpl,$Z=MZ.minimumImpl,eK=MZ.multiplyImpl,tK=MZ.negImpl,nK=MZ.notEqualImpl,rK=MZ.prodImpl,aK=MZ.rangeImpl,iK=MZ.rsqrtImpl,oK=MZ.scatterImpl,sK=MZ.simpleAbsImpl,uK=MZ.sliceImpl,cK=MZ.stridedSliceImpl,lK=MZ.stringNGramsImpl,hK=MZ.subImpl,pK=MZ.tileImpl,dK=MZ.topKImpl,fK=MZ.transposeImpl,mK=(MZ.uniqueImpl,{kernelName:Gn,backendName:"webgpu",kernelFunc:nZ({opType:gH.ABS,cpuKernelImpl:sK})}),vK={kernelName:jn,backendName:"webgpu",kernelFunc:nZ({opType:gH.ACOS})},gK={kernelName:Hn,backendName:"webgpu",kernelFunc:nZ({opType:gH.ACOSH})},yK={kernelName:Zn,backendName:"webgpu",kernelFunc:rZ({opType:fH.ADD,cpuKernelImpl:PZ,supportsComplex:!0})},bK=function(){function e(t){Te(this,e),this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t[0],this.variableNames=t.map((function(e,t){return"T"+t})),this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="addN"}return Re(e,[{key:"getUserCode",value:function(){var e=[];this.variableNames.forEach((function(t){e.push("let v".concat(t," = get").concat(t,"ByOutputCoords(coords);"))}));var t=this.variableNames.map((function(e){return"v"+e})).join(" + ");return"\n      ".concat(Qj("index")," {\n        for (var i = 0; i < ").concat(this.workPerThread,"; i = i + 1) {\n          let flatIndex = index * ").concat(this.workPerThread," + i;\n          if (flatIndex < uniforms.size) {\n            let coords = getCoordsFromIndex(flatIndex);\n            ").concat(e.join("\n        "),"\n            setOutputAtIndex(flatIndex, ").concat(t,");\n          }\n        }\n      }\n    ")}}]),e}(),xK={kernelName:Kn,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;if(1===r.length)return QH({inputs:{x:r[0]},backend:n});var a=r.map((function(e){return e.dtype})).reduce((function(e,t){return ss(e,t)})),i=r.map((function(e){return e.shape})),o=new bK(i);return n.runWebGPUProgram(o,r,a)}},kK=function(){function e(t,n){Te(this,e),this.variableNames=["A"],this.workgroupSize=[16,16,1];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.dispatchLayout={x:[0],y:[1]},this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[1,1,1]),this.shaderKey="transposeShared"}return Re(e,[{key:"getUserCode",value:function(){var e=this;nn(this.workgroupSize[0]===this.workgroupSize[1],(function(){return"Must be a square tile, current tile shape is ".concat(e.workgroupSize[0]," x ").concat(e.workgroupSize[1])}));var t=this.workgroupSize[0];return"\n      var<workgroup> tile : array<array<f32, ".concat(this.workgroupSize[0]+1,">, ").concat(this.workgroupSize[0],">;\n      ").concat(Qj()," {\n        var x = i32(workgroupId.x) * ").concat(t," + i32(localId.x);\n        var y = i32(workgroupId.y) * ").concat(t," + i32(localId.y);\n        let width = uniforms.outShape[0];\n        let height = uniforms.outShape[1];\n        if (x < width && y < height) {\n          tile[localId.y][localId.x] = f32(A[y * width + x]);\n        }\n        workgroupBarrier();\n\n        x = i32(workgroupId.y) * ").concat(t," + i32(localId.x);\n        y = i32(workgroupId.x) * ").concat(t," + i32(localId.y);\n        if (x < height && y < width) {\n          setOutputAtIndex((y * height + x), tile[localId.x]\n            [localId.y]);\n        }\n      }\n    ")}}]),e}(),wK=function(){function e(t,n){Te(this,e),this.variableNames=["A"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.newDim=n,this.shaderKey="transpose_"+n}return Re(e,[{key:"getUserCode",value:function(){var e=Xj(this.outputShape.length),t=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=new Array(t),r=0;r<e.length;r++)n[e[r]]="resRC."+Yj(r);return n.join()}(this.newDim);return"\n      ".concat(Qj("index")," {\n        for(var i = 0; i < ").concat(this.workPerThread,"; i = i + 1) {\n          let flatIndex = index * ").concat(this.workPerThread," + i;\n          if(flatIndex < uniforms.size) {\n            let resRC = getCoordsFromIndex(flatIndex);\n            setOutputAtIndex(flatIndex, A[getIndexFromCoords").concat(this.outputShape.length,"D(\n              ").concat(e,"(").concat(t,"), uniforms.aShape)]);\n          }\n        }\n      }\n    ")}}]),e}();function SK(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.perm,o=n,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];if(n.shouldExecuteOnCPU([a])){var l=o.tensorMap.get(a.dataId).values,h=fK(l,a.shape,a.dtype,i,u);return n.makeTensorInfo(u,a.dtype,h)}if(2===a.shape.length&&sn(i,[1,0])){var p=new kK(a.shape,i);return o.runWebGPUProgram(p,[a],a.dtype)}var d=new wK(a.shape,i);return o.runWebGPUProgram(d,[a],a.dtype)}var IK={kernelName:Gi,backendName:"webgpu",kernelFunc:SK},CK=function(){function e(t,n){Te(this,e),this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="reduceSize : i32,",this.size=!0,this.inputShape=[t.batchSize,t.inSize];var r=Bh(this.inputShape,[1]),a=(0,E.Z)(r,1)[0];this.outputShape=0===a.length?[1]:a,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,[1,1,1]),this.reduceType=n,this.shaderKey="reduce_"+n}return Re(e,[{key:"getUserCode",value:function(){var e="",t="0.0",n=this.workgroupSize[0];"min"===this.reduceType||"max"===this.reduceType?(e="\n         if (isnan(candidate)) {\n          bestValue = uniforms.NAN;\n         } else if (!isnan(bestValue) && candidate ".concat("min"===this.reduceType?"<":">"," bestValue)\n           {  bestValue = candidate; }"),t="f32(x[offset])"):"sum"===this.reduceType||"mean"===this.reduceType?e=" bestValue = bestValue + candidate; ":"prod"===this.reduceType?(e=" bestValue = bestValue * candidate; ",t="1.0"):"all"===this.reduceType?(e=" bestValue = f32(bestValue >= 1.0 && candidate >= 1.0); ",t="1.0"):"any"===this.reduceType&&(e=" bestValue = f32(bestValue >= 1.0 || candidate >= 1.0); ",t="0.0");var r="mean"===this.reduceType?"setOutputAtIndex(outputIndex, bestValue / f32(uniforms.reduceSize));":"setOutputAtIndex(outputIndex, bestValue);";return"\n       fn DIV_CEIL(a : u32, b : u32) -> u32 {\n        return ((a - 1u) / b + 1u);\n       }\n\n       ".concat("\n         var<workgroup> xBestValues : array<f32, ".concat(n,">;\n       "),"\n       fn getOffset(outputIndex : i32) -> i32 {\n         let outputCoords = getCoordsFromIndex(outputIndex);\n         let offset = ",1===this.outputShape.length?"outputCoords":"outputCoords[0]"," * uniforms.reduceSize;\n          return offset;\n       }\n       ").concat(Qj("index")," {\n         let outputIndex = index / ").concat(n,";\n         let offset = getOffset(outputIndex);\n         var bestValue = ").concat(t,";\n         let Length = uniforms.reduceSize;\n         let WorkPerThread = DIV_CEIL(u32(Length), ").concat(n,"u);\n         for (var k = i32(localId.x); k < Length && outputIndex < uniforms.size;\n             k = k + ").concat(n,") {\n           let candidate = f32(x[offset + k]);\n           ").concat(e,"\n         }\n         xBestValues[localId.x] = bestValue;\n         workgroupBarrier();\n\n         var reduceSize = min(u32(Length), ").concat(n,"u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (localId.x < currentSize) {\n            let candidate = xBestValues[localId.x + interval];\n            ").concat(e,"\n            xBestValues[localId.x] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (localId.x == 0u && outputIndex < uniforms.size) {\n          ").concat(r,"\n        }\n       }\n     ")}}]),e}();function TK(e,t,n,r,a){var i=e.shape.length,o=[],s=dn(t,e.shape),u=s,c=Vh(u,i),l=e;null!=c&&(l=SK({inputs:{x:e},attrs:{perm:c},backend:a}),u=jh(u.length,i),o.push(l)),Wh(r,u,i);var h,p=Bh(l.shape,u),d=(0,E.Z)(p,2),f=d[0],m=d[1],v=f;if(n&&(v=Uh(f,s)),"max"!==r&&"prod"!==r||!a.shouldExecuteOnCPU([l])){var g=on(m),y={windowSize:g,inSize:g,batchSize:on(l.shape)/g,outSize:1},b="mean"===r?"float32":us(e.dtype),x=[{type:"int32",data:[g]}],k=new CK(y,r),w=a.runWebGPUProgram(k,[l],b,x);o.push(w),h=HH({inputs:{x:w},attrs:{shape:v},backend:a})}else{var S=a.tensorMap.get(l.dataId).values;switch(r){case"max":var I=QZ(S,on(m),v,e.dtype);h=a.makeTensorInfo(v,e.dtype,I);break;case"prod":var C=rK(l.shape,l.dtype,S,u),T=C.outVals,N=C.outShape,R=C.outDtype;h=a.makeTensorInfo(N,R,T);break;default:throw new Error(r+" CPU implementation is not yet supported.")}}return o.forEach((function(e){return a.disposeData(e.dataId)})),h}var NK={kernelName:qn,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.keepDims;return TK(a,r.axis,i,"all",n)}},EK={kernelName:Xn,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.keepDims;return TK(a,r.axis,i,"any",n)}},RK=function(){function e(t,n,r){Te(this,e),this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="infinityValue : f32,",this.size=!0;var a=[n];this.op="min"===r?"<":">";var i=Bh(t,a),o=(0,E.Z)(i,2),s=o[0],u=o[1];this.outputShape=0===s.length?[1]:s,this.dispatchLayout=hH(this.outputShape),on(u)<32||on(s)>1e3?(this.type="plain",this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize)):(this.type="shared",this.dispatch=uH(this.dispatchLayout,this.outputShape,[1,1,1])),this.inputShape=t,this.shaderKey="argMinMax_".concat(this.op,"_").concat(this.type)}return Re(e,[{key:"getUserCode",value:function(){var e=this,t=this.workgroupSize[0],n=function(){return 1===e.inputShape.length?"uniforms.xShape":"uniforms.xShape."+Yj(e.inputShape.length-1)},r=function(){var t="";if(1===e.outputShape.length)1!==e.inputShape.length&&(t+="outputCoords,");else for(var n=0;n<e.outputShape.length;n++)t+="outputCoords.".concat(Yj(n),",");return t};return"shared"===this.type?"\n      fn DIV_CEIL(a : u32, b : u32) -> u32 {\n        return ((a - 1u) / b + 1u);\n      }\n\n      ".concat("\n      var<workgroup> xBestIndices : array<i32, ".concat(t,">;\n      var<workgroup> xBestValues : array<f32, ").concat(t,">;\n    "),"\n\n      ",Qj("index")," {\n        let outputIndex = index / ").concat(t,";\n        let reduceLength = ").concat(n(),";\n\n        var bestIndex = i32(localId.x);\n        var bestValue = uniforms.infinityValue;\n        let outputCoords = getCoordsFromIndex(outputIndex);\n        for (var k = i32(localId.x); k < reduceLength && outputIndex < uniforms.size;\n            k = k + ").concat(t,") {\n          let candidate = getX(").concat(r()," k);\n          if (!isnan(candidate) && candidate ").concat(this.op," bestValue) {\n            bestValue = candidate;\n            bestIndex = k;\n          }\n        }\n        xBestValues[localId.x] = bestValue;\n        xBestIndices[localId.x] = bestIndex;\n        workgroupBarrier();\n\n        var reduceSize = min(u32(reduceLength), ").concat(t,"u);\n        for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n            currentSize = reduceSize / 2u) {\n          let interval = DIV_CEIL(reduceSize, 2u);\n          if (localId.x < currentSize) {\n            let candidate = xBestValues[localId.x + interval];\n            if (candidate ").concat(this.op," bestValue) {\n              bestValue = candidate;\n              xBestValues[localId.x] = bestValue;\n              xBestIndices[localId.x] = xBestIndices[localId.x + interval];\n            }\n          }\n          reduceSize = interval;\n          workgroupBarrier();\n        }\n\n        if (localId.x == 0u && outputIndex < uniforms.size) {\n          setOutputAtIndexI32(outputIndex, xBestIndices[localId.x]);\n        }\n      }\n    "):"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let outputCoords = getCoordsFromIndex(index);\n          var bestIndex = 0;\n          var bestValue = getX(").concat(r()," 0);\n          let reduceLength = ").concat(n(),";\n          for (var i = 1; i < reduceLength; i++) {\n            let candidate = getX(").concat(r()," i);\n            if (candidate ").concat(this.op," bestValue) {\n              bestValue = candidate;\n              bestIndex = i;\n            }\n          }\n          setOutputAtIndexI32(index, bestIndex);\n        }\n      }\n      ")}}]),e}(),AK={kernelName:Yn,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=dn(r.axis,a.shape),o=Vh(i,a.shape.length),s=a,u=[];null!=o&&(s=SK({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=jh(i.length,s.shape.length)),Wh("argMax",[i[0]],s.shape.length);var c=new RK(s.shape,i[0],"max"),l=[{type:"float32",data:[Number.NEGATIVE_INFINITY]}],h=n.runWebGPUProgram(c,[s],"int32",l);return u.forEach((function(e){return n.disposeData(e.dataId)})),h}},_K={kernelName:Qn,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=dn(r.axis,a.shape),o=Vh(i,a.shape.length),s=a,u=[];null!=o&&(s=SK({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=jh(i.length,s.shape.length)),Wh("argMin",[i[0]],s.shape.length);var c=new RK(s.shape,i[0],"min"),l=[{type:"float32",data:[Number.POSITIVE_INFINITY]}],h=n.runWebGPUProgram(c,[s],"int32",l);return u.forEach((function(e){return n.disposeData(e.dataId)})),h}},OK={kernelName:Jn,backendName:"webgpu",kernelFunc:nZ({opType:gH.ASIN})},FK={kernelName:$n,backendName:"webgpu",kernelFunc:nZ({opType:gH.ASINH})},DK={kernelName:er,backendName:"webgpu",kernelFunc:nZ({opType:gH.ATAN})},MK={kernelName:nr,backendName:"webgpu",kernelFunc:rZ({opType:fH.ATAN2})},PK={kernelName:tr,backendName:"webgpu",kernelFunc:nZ({opType:gH.ATANH})},LK=function(){function e(t,n){Te(this,e),this.variableNames=["x"],this.uniforms="stride : vec2<i32>, pad : vec2<i32>, dilation : vec2<i32>, convDims : vec2<i32>, filterDims : vec2<i32>,",this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="pool2D_"+n,this.poolType=n}return Re(e,[{key:"getUserCode",value:function(){var e="resultValue = max(value, resultValue);";"avg"===this.poolType&&(e="resultValue = resultValue + value; count = count + 1.0;");var t="resultValue";return"avg"===this.poolType&&(t="resultValue / max(count, 1.0)"),"\n      ".concat(Qj("index")," {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n          let batch = coords[0];\n          let xRCCorner = vec2<i32>(coords.yz) * uniforms.stride - uniforms.pad;\n          let xRCorner = xRCCorner.x;\n          let xCCorner = xRCCorner.y;\n\n          var resultValue = ").concat("avg"===this.poolType?"0.0":"-1.0 / pow(10.0, -20.0)",";\n          var count = 0.0;\n\n          for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + uniforms.dilation.x) {\n            let xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= uniforms.convDims.x) {\n              continue;\n            }\n\n            for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + uniforms.dilation.y) {\n              let xC = xCCorner + wC;\n              if (xC < 0 || xC >= uniforms.convDims.y) {\n                continue;\n              }\n\n              let value = getX(batch, xR, xC, coords[3]);\n              ").concat(e,"\n            }\n          }\n\n          setOutputAtIndex(index, ").concat(t,");\n        }\n      }\n    ")}}]),e}(),zK=function(){function e(t){Te(this,e),this.variableNames=["x"],this.uniforms="stride : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="poolWithFilterSizeEqualsOne"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let batch = coords[0];\n          let d = coords[3];\n\n          let xRCCorner = coords.yz * uniforms.stride;\n          let xRCorner = xRCCorner.x;\n          let xCCorner = xRCCorner.y;\n\n          let value = getX(batch, xRCorner, xCCorner, d);\n          setOutputAtIndex(index, value);\n        }\n      }\n    ")}}]),e}();function BK(e){var t=e.inputs,n=e.backend,r=e.attrs;return TK(t.x,r.reductionIndices,r.keepDims,"max",n)}var UK={kernelName:ka,backendName:"webgpu",kernelFunc:BK};function WK(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.keepDims;return TK(a,r.axis,i,"mean",n)}var VK={kernelName:Ea,backendName:"webgpu",kernelFunc:WK};function GK(e,t,n,r){if(1===t.filterWidth&&1===t.filterHeight&&sn(t.inShape,t.outShape))return QH({inputs:{x:e},backend:r});if(t.filterWidth===t.inWidth&&t.filterHeight===t.inHeight&&1===t.batchSize&&"VALID"===t.padInfo.type){var a,i=e.shape.length,o=HH({inputs:{x:e},backend:r,attrs:{shape:[e.shape[i-3]*e.shape[i-2],e.shape[i-1]]}});"avg"===n?a=WK({inputs:{x:o},backend:r,attrs:{axis:0,keepDims:!1}}):(nn("max"===n,(function(){return"Invalid pool type "+n})),a=BK({inputs:{x:o},backend:r,attrs:{reductionIndices:0,keepDims:!1}}));var s=HH({inputs:{x:a},backend:r,attrs:{shape:t.outShape}});return r.disposeData(o.dataId),r.disposeData(a.dataId),s}var u,c=[{type:"int32",data:[t.strideHeight,t.strideWidth]}];return 1===t.filterHeight&&1===t.filterWidth?u=new zK(t):("avg"===n?u=new LK(t,"avg"):(nn("max"===n,(function(){return"Invalid pool type "+n})),u=new LK(t,"max")),c.push({type:"int32",data:[t.padInfo.top,t.padInfo.left]},{type:"int32",data:[t.dilationHeight,t.dilationWidth]},{type:"int32",data:[t.inHeight,t.inWidth]},{type:"int32",data:[t.effectiveFilterHeight,t.effectiveFilterWidth]})),r.runWebGPUProgram(u,[e],e.dtype,c)}var jK={kernelName:rr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;return GK(a,Al(a.shape,i,o,1,s,u),"avg",n)}},HK=function(){function e(t){Te(this,e),this.variableNames=["dy"],this.uniforms="stride : vec2<i32>, pads : vec2<i32>, dilation : vec2<i32>, filterDims : vec2<i32>,\n       outHeight : i32, outWidth : i32, avgMultiplier : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avg_pool2d_backprop"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords[0];\n        let d = coords[3];\n\n        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;\n        let dyRCorner = dyRCCorner.x;\n        let dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var wR = 0; wR < uniforms.filterDims[0]; wR = wR + uniforms.dilation[0]) {\n          let dyR = f32(dyRCorner + wR) / f32(uniforms.stride[0]);\n\n          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n            continue;\n          }\n          let idyR = i32(dyR);\n\n          for (var wC = 0; wC < uniforms.filterDims[1]; wC = wC + uniforms.dilation[1]) {\n            let dyC = f32(dyCCorner + wC) / f32(uniforms.stride[1]);\n\n            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n              continue;\n            }\n            let idyC = i32(dyC);\n\n            let dyValue = getDy(batch, idyR, idyC, d);\n\n            dotProd = dotProd + dyValue * uniforms.avgMultiplier;\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    ")}}]),e}(),ZK={kernelName:ar,backendName:"webgpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.dy,o=n.input,s=o;t=[i,o],Array.isArray(t)||(t=[t]),t.forEach((function(e){null!=e&&nn("complex64"!==e.dtype,(function(){return"avgPoolGrad does not support complex64 tensors in the WebGPU backend."}))}));var u=a.filterSize,c=a.strides,l=a.pad,h=Al(s.shape,u,c,1,l),p=new HK(h),d=1/(h.filterHeight*h.filterWidth),f=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.effectiveFilterHeight-1-h.padInfo.top,h.effectiveFilterWidth-1-h.padInfo.left]},{type:"int32",data:[h.dilationHeight,h.dilationWidth]},{type:"int32",data:[h.effectiveFilterHeight,h.effectiveFilterWidth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]},{type:"float32",data:[d]}];return r.runWebGPUProgram(p,[i],s.dtype,f)}},KK={kernelName:sr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return KH({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},qK=function(){function e(t,n){Te(this,e),this.variableNames=["source"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.rank=n.length,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.start=t,this.uniforms="start : ".concat(Xj(t.length),", "),this.shaderKey="slice"}return Re(e,[{key:"getUserCode",value:function(){var e,t=Xj(this.rank),n=function(e){if(1===e)return"sourceLoc";if(e<=6)return XK.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);return e=1===this.start.length?this.outputShape.map((function(e,t){return"sourceLoc = uniforms.start + coords;"})):this.outputShape.map((function(e,t){return"sourceLoc.".concat(XK[t]," = uniforms.start.").concat(Yj(t)," + coords.").concat(XK[t],";")})),"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          var sourceLoc : ").concat(t,";\n          let coords = getCoordsFromIndex(index);\n          ").concat(e.join("\n"),"\n          setOutputAtIndex(index, getSource(").concat(n,"));\n        }\n      }\n    ")}}]),e}(),XK=["x","y","z","w","u","v"];function YK(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=fl(a,r.begin,r.size),o=(0,E.Z)(i,2),s=o[0],u=o[1];if(ll(a,s,u),n.shouldExecuteOnCPU([a])||"string"===a.dtype){var c=n.tensorMap.get(a.dataId),l=uK(c.values,s,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}if(0===on(u))return n.makeTensorInfo(u,a.dtype,[]);var h=new qK(s,u),p=[{type:"int32",data:s}];return n.runWebGPUProgram(h,[a],a.dtype,p)}var QK={kernelName:fi,backendName:"webgpu",kernelFunc:YK},JK={kernelName:ur,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;nn(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGPU backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=nv(a.shape,i,s),c=rv(u.length,i.length),l=av(a.shape,i,s),h=iv(o,i.length),p=ov(l,o,i.length),d=[],f=HH({inputs:{x:a},backend:n,attrs:{shape:u}}),m=SK({inputs:{x:f},backend:n,attrs:{perm:c}}),v=HH({inputs:{x:m},backend:n,attrs:{shape:l}}),g=YK({inputs:{x:v},backend:n,attrs:{begin:h,size:p}});return d.push(f),d.push(m),d.push(v),d.forEach((function(e){return n.disposeData(e.dataId)})),g}},$K="\n  fn bincount_write(index: i32, value: f32) {\n    ".concat(qj("&result[index]","value","float32"),"\n  }\n"),eq=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Te(this,e),this.outputShape=[],this.variableNames=["x"],this.uniforms="binCountSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.hasWeights=!0,this.binaryOutput=!1,this.outputShape=t,this.rank=t.length,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.binaryOutput=r,r&&(this.atomic=!1),this.hasWeights=n,this.hasWeights&&this.variableNames.push("w"),this.shaderKey="bincount_".concat(this.hasWeights,"_").concat(this.binaryOutput,"_").concat(this.rank)}return Re(e,[{key:"getUserCode",value:function(){return"\n    ".concat(this.binaryOutput?"\n  fn bincount_write(index: i32, value: f32) {\n    atomicStore(&result[index], bitcast<i32>(value));\n  }\n":$K,"\n  ").concat(Qj("index")," {\n    ").concat(1===this.rank?"if (index < uniforms.xShape) {\n      let indexVal = i32(getX(index));\n      if (indexVal < uniforms.binCountSize) {\n        let value = ".concat(this.binaryOutput?1:this.hasWeights?"getW(index)":"1.",";\n        bincount_write(indexVal, value);\n      }\n    }"):"let coord = getCoordsFromIndex(index);\n    if (coordsInBounds2D(coord, uniforms.xShape)) {\n      let indexVal = i32(getX(coord[0], coord[1]));\n      if (indexVal < uniforms.binCountSize) {\n        let value = ".concat(this.binaryOutput?1:this.hasWeights?"getW(coord[0], coord[1])":"1.",";\n        bincount_write(coord.x * uniforms.binCountSize + indexVal, value);\n      }\n    }"),"\n  }\n  ")}}]),e}(),tq={kernelName:cr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=on(a.shape),u=on(i.shape)>0,c=[o],l=i.dtype,h=GH({backend:n,attrs:{shape:c,value:0,dtype:l}}),p=new eq([s],u),d=[{type:"int32",data:[o]}],f=u?[a,i]:[a];return n.runWebGPUProgram(p,f,l,d,h)}},nq=rZ({opType:fH.NOT_EQUAL,dtype:"bool",cpuKernelImpl:nK}),rq={kernelName:Pa,backendName:"webgpu",kernelFunc:nq};function aq(e){var t=e.inputs,n=e.backend,r=t.input;return QH({inputs:{x:n.tensorMap.get(r.dataId).complexTensorInfos.real},backend:n})}var iq={kernelName:Qa,backendName:"webgpu",kernelFunc:aq},oq={kernelName:pr,backendName:"webgpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return QH({inputs:{x:i},backend:r});var s=Fp(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=$H({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeData(u.dataId),c}if("complex64"===i.dtype){var l=aq({inputs:{input:i},backend:r}),h=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeData(l.dataId),h}if(!gn(i.dtype,o)){var p=QH({inputs:{x:i},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var d=r.tensorMap.get(i.dataId).values,f=LZ(d,i.shape,i.dtype,o),m=(0,E.Z)(f,3),v=m[0],g=m[1],y=m[2];return r.makeTensorInfo(v,g,y)}if("int32"===o)return function(e,t){var n=new tZ(e.shape,gH.TO_INT),r=t.runWebGPUProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var b=r.makeTensorInfo([],"bool",mn("bool",1)),x=nq({inputs:{a:i,b:b},backend:r});return r.disposeData(b.dataId),x}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},sq={kernelName:dr,backendName:"webgpu",kernelFunc:nZ({opType:gH.CEIL,cpuKernelImpl:zZ})},uq=function(){function e(t){Te(this,e),this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workPerThread=4,this.workgroupSize=[64,1,1],this.isVec4=!0,this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="clipVec4"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if(index < uniforms.size) {\n          let value = getAByOutputIndex(index);\n          var clampedValue = clamp(\n              value, vec4<f32>(uniforms.minVal), vec4<f32>(uniforms.maxVal));\n          clampedValue = select(clampedValue, value, isnanVec4(value));\n          setOutputAtIndex(index, clampedValue);\n        }\n      }\n    ")}}]),e}(),cq=function(){function e(t){Te(this,e),this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="clip"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if(index < uniforms.size) {\n          let value = getAByOutputIndex(index);\n          if (isnan(value)) {\n            setOutputAtIndex(index, value);\n            return;\n          }\n          setOutputAtIndex(index, clamp(value, uniforms.minVal, uniforms.maxVal));\n        }\n      }\n    ")}}]),e}(),lq={kernelName:fr,backendName:"webgpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=[{type:"float32",data:[a.clipValueMin]},{type:"float32",data:[a.clipValueMax]}];return t=on(i.shape)%4==0?new uq(i.shape):new cq(i.shape),r.runWebGPUProgram(t,[i],i.dtype,o)}},hq=function(){function e(t){Te(this,e),this.uniforms="",this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=qm(t,1),this.variableNames=t.map((function(e,t){return"T"+t})),this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.offsetLength=t.length-1;for(var n=0;n<this.offsetLength;n++)this.uniforms+="offset".concat(n," : i32,");this.shaderKey="concat"}return Re(e,[{key:"getUserCode",value:function(){var e=[];if(this.offsetLength>0){e.push("if (yC < uniforms.offset0){ setOutputAtCoords(coords.x, coords.y, getT0(yR, yC)); }");for(var t=1;t<this.offsetLength;t++)e.push("else if (yC < uniforms.offset".concat([t],"){ setOutputAtCoords(coords.x, coords.y, getT").concat(t,"(yR, yC - uniforms.offset").concat(t-1,")); }"));var n=this.offsetLength,r=this.offsetLength-1;e.push("else { setOutputAtCoords(coords.x, coords.y, getT".concat(n,"(yR, yC - uniforms.offset").concat(r,")); }"))}else e.push("setOutputAtCoords(coords.x, coords.y, getT0(yR, yC));");return"\n      ".concat(Qj("index")," {\n        for(var i = 0; i < ").concat(this.workPerThread,"; i = i + 1) {\n          let flatIndex = index * ").concat(this.workPerThread," + i;\n          if(flatIndex < uniforms.size) {\n            let coords = getCoordsFromIndex(flatIndex);\n            let yR = coords.x;\n            let yC = coords.y;\n\n            ").concat(e.join("\n        "),"\n          }\n        }\n      }\n    ")}}]),e}();function pq(e){var t=e.inputs,n=e.backend,r=t.input;return QH({inputs:{x:n.tensorMap.get(r.dataId).complexTensorInfos.imag},backend:n})}var dq={kernelName:oa,backendName:"webgpu",kernelFunc:pq};function fq(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return aq({inputs:{input:e},backend:n})})),i=e.map((function(e){return pq({inputs:{input:e},backend:n})})),o=fq(a,t,n),s=fq(i,t,n),u=$H({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeData(e.dataId)})),i.forEach((function(e){return n.disposeData(e.dataId)})),n.disposeData(o.dataId),n.disposeData(s.dataId),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=on(e.shape.slice(t));return HH({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),h=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),p=qm(l.map((function(e){return e.shape})),1),d=1===l[0].shape[0],f=BZ(h,p,r,d),m=qm(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,f);return l.forEach((function(e){return n.disposeData(e.dataId)})),v}var g=n.device.limits.maxStorageBuffersPerShaderStage-1;if(e.length>g){for(var y=[],b=0;b<e.length;b+=g){var x=e.slice(b,b+g);y.push(fq(x,t,n))}for(var k=fq(y,t,n),w=0,S=y;w<S.length;w++){var I=S[w];n.disposeData(I.dataId)}return k}var C=function(e,t,n){var r=qm(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return HH({inputs:{x:e},backend:n,attrs:{shape:[on(e.shape.slice(0,t)),on(e.shape.slice(t))]}})})),outShape:r}}(e,t,n),T=C.tensors2D,N=C.outShape,E=T.map((function(e){return e.shape})),R=new hq(E),A=[],_=new Array(E.length-1);if(_.length>0){_[0]=E[0][1],A.push({type:"int32",data:[_[0]]});for(var O=1;O<_.length;O++)_[O]=_[O-1]+E[O][1],A.push({type:"int32",data:[_[O]]})}var F=n.runWebGPUProgram(R,T,T[0].dtype,A);T.forEach((function(e){return n.disposeData(e.dataId)}));var D=HH({inputs:{x:F},backend:n,attrs:{shape:N}});return n.disposeData(F.dataId),D}function mq(e){var t=e.inputs,n=e.backend,r=dn(e.attrs.axis,t[0].shape)[0],a=t.map((function(e){return e.shape}));Km(a,r);var i=qm(t.map((function(e){return e.shape})),r);if(0===on(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return on(e.shape)>0}));return 1===o.length?QH({inputs:{x:o[0]},backend:n}):fq(o,r,n)}var vq={kernelName:gr,backendName:"webgpu",kernelFunc:mq},gq=function(){function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Te(this,e),this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>, dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=t.outShape,this.isChannelsLast="channelsLast"===t.dataFormat,this.isVec4=((t.inChannels%4==0||t.inChannels%3==0)&&this.isChannelsLast||t.outWidth%4==0&&!this.isChannelsLast)&&t.outChannels%4==0,this.dispatchLayout=this.isChannelsLast?{x:[3],y:[1,2],z:[0]}:{x:[2,3],y:[1],z:[0]},this.workgroupSize=cH(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=lH(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4?(this.isChannelsLast&&t.inChannels%4!=0?(this.innerElementSize=3,this.variableTypes=["f32","vec4<f32>"]):(this.innerElementSize=4,this.variableTypes=["vec4<f32>","vec4<f32>"]),i&&(this.variableNames.push("bias"),this.variableTypes.push("vec4<f32>")),s&&(this.variableNames.push("preluActivationWeights"),this.variableTypes.push("vec4<f32>"))):(this.innerElementSize=this.elementsPerThread[0],i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights")),this.sequentialAccessByThreads=u,this.addBias=i,this.activation=o,this.hasPreluActivationWeights=s,this.tileAOuter=this.workgroupSize[1]*this.elementsPerThread[1],this.tileBOuter=this.workgroupSize[0]*this.elementsPerThread[0],this.tileInner=Math.max(this.workgroupSize[0]*this.innerElementSize,this.workgroupSize[1]),this.fitAOuter=n%this.tileAOuter==0,this.fitBOuter=r%this.tileBOuter==0,this.fitInner=a%this.tileInner==0,this.shaderKey="conv2DMM_".concat(this.elementsPerThread,"_").concat(this.activation,"}_").concat(this.fitAOuter,"_").concat(this.fitBOuter,"_").concat(this.fitInner,"_").concat(this.isVec4,"_").concat(this.innerElementSize,"_").concat(this.isChannelsLast,"_").concat(this.sequentialAccessByThreads)}return Re(e,[{key:"getUserCode",value:function(){var e=this.isVec4?DH(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner):PH(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner,!1,null,this.sequentialAccessByThreads),t=this.isVec4?[this.innerElementSize,4,4]:[1,1,1];return"\n    ".concat(function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:4,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:4,l=e?"\n      let coord = vec4<i32>(batch, xRow, xCol, xCh);\n      ":"\n      let coord = vec4<i32>(batch, xCh, xRow, xCol);\n      ",h=e?"\n      let coords = vec4<i32>(\n        batch,\n        row / outWidth,\n        row % outWidth,\n        col);\n      ":"\n      let coords = vec4<i32>(\n        batch,\n        row,\n        col / outWidth,\n        col % outWidth);\n      ",p=e?"uniforms.xShape[1]":"uniforms.xShape[2]",d=e?"uniforms.xShape[2]":"uniforms.xShape[3]",f=e?"row":"col",m=e?"col":"row",v="\n      let inChannels = uniforms.wShape[2];\n      let outWidth = ".concat(e?"uniforms.outShape[2]":"uniforms.outShape[3]",";\n      let outRow = ").concat(f," / outWidth;\n      let outCol = ").concat(f," % outWidth;\n\n      let WRow = ").concat(m," / (uniforms.filterDims[1] * inChannels);\n      let WCol = ").concat(m," / inChannels % uniforms.filterDims[1];\n      let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];\n      let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];\n      let xCh = ").concat(m," % inChannels;\n      var resData = ").concat(RH(s),"(0.0);\n      // The bounds checking is always needed since we use it to pad zero for\n      // the 'same' padding type.\n      if (xRow >= 0 && xRow < ").concat(p," && xCol >= 0 && xCol < ").concat(d,") {\n        ").concat(l,"\n        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);\n        ").concat(function(e){switch(e){case 1:return"resData = x[xIndex];";case 3:return"resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);";case 4:return"resData = x[xIndex / 4];";default:throw new Error("innerElementSize ".concat(e," is not supported."))}}(s),"\n      }\n      return resData;"),g=e?t&&r?"\n      let col = colIn * ".concat(s,";\n      ").concat(v):"\n      let col = colIn * ".concat(s,";\n      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        ").concat(v,"\n      }\n      return ").concat(RH(s),"(0.0);"):r&&n?"\n      let col = colIn * ".concat(s,";\n      ").concat(v):"\n      let col = colIn * ".concat(s,";\n      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n        ").concat(v,"\n      }\n      return ").concat(RH(s),"(0.0);"),y=""+function(e){switch(e){case 1:return"return W[row * uniforms.wShape[3] + colIn];";case 4:return"return W[row * uniforms.wShape[3] / 4 + colIn];";default:throw new Error("innerElementSize ".concat(e," is not supported."))}}(u),b=RH(c),x=RH(e?s:u),k=RH(e?u:s);return"\n      ".concat(AH(i,o,4===c,4),"\n      fn mm_readA(batch: i32, row : i32, colIn : i32) -> ").concat(x," {\n        ").concat(e?g:y,"\n      }\n\n      fn mm_readB(batch: i32, row : i32, colIn : i32) -> ").concat(k," {\n        ").concat(e?y:g,"\n      }\n\n      fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ").concat(b,") {\n        let col = colIn * ").concat(c,";\n        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)\n        {\n        var value = valueIn;\n        let outWidth = ").concat(e?"uniforms.outShape[2]":"uniforms.outShape[3]",";\n        ").concat(h,"\n        ").concat(_H(a,i),"\n        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }")}(this.isChannelsLast,this.fitAOuter,this.fitBOuter,this.fitInner,this.addBias,this.activation,this.hasPreluActivationWeights,t[0],t[1],t[2]),"\n    ").concat(e,"\n  ")}}]),e}(),yq=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Te(this,e),this.variableNames=["x","W"],this.uniforms="filterDims: vec2<i32>, pad: vec2<i32>, stride: vec2<i32>, dilation: vec2<i32>,",this.workgroupSize=[4,4,8],this.outputShape=t.outShape,this.isChannelsLast="channelsLast"===t.dataFormat,this.dispatchLayout=this.isChannelsLast?{x:[2],y:[1],z:[0,3]}:{x:[3],y:[2],z:[0,1]},this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=n,this.activation=r,this.hasPreluActivationWeights=a,n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.shaderKey="conv2dnaive_".concat(this.activation,"_").concat(this.isChannelsLast)}return Re(e,[{key:"getUserCode",value:function(){return"\n       ".concat(AH(this.activation,this.hasPreluActivationWeights,!1,4),"\n       fn readInp(batch : i32, row : i32, col : i32, chan : i32) -> f32{\n         let coords = vec4<i32>(batch, row, col, chan);\n         if (coordsInBounds4D(coords, uniforms.xShape)) {\n           return  getX(batch, row, col, chan);\n         } else {\n          return 0.0;\n         }\n       }\n       fn readFilt(row : i32, col : i32, xChannel : i32, outChannel : i32) -> f32{\n         let coords = vec4<i32>(row, col, xChannel, outChannel);\n         if(coordsInBounds4D(coords, uniforms.wShape)) {\n           return getW(row, col, xChannel, outChannel);\n          } else {\n            return 0.0;\n          }\n       }\n       fn writeResult(batch : i32, row : i32, col : i32, chan : i32, valueIn : f32) {\n         let coords = ").concat(this.isChannelsLast?"vec4<i32>(batch, row, col, chan);":"vec4<i32>(batch, chan, row, col);","\n         if (coordsInBounds4D(coords, uniforms.outShape)) {\n           var value = valueIn;\n           ").concat(_H(this.addBias,this.activation),"\n           setOutputAtCoords(coords.x, coords.y, coords.z, coords.w, value);\n         }\n       }\n       ").concat(Qj("index")," {\n         let coords = getOutputCoords();\n         let batch = coords[0];\n         let outChannel = ").concat(this.isChannelsLast?"coords[3];":"coords[1];","\n         let outRow = ").concat(this.isChannelsLast?"coords[1];":"coords[2];","\n         let outCol = ").concat(this.isChannelsLast?"coords[2];":"coords[3];","\n         var acc : f32 = 0.0;\n         for (var row = 0; row < uniforms.filterDims[0]; row = row + 1) {\n           for (var col = 0; col < uniforms.filterDims[1]; col = col + 1) {\n             let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * row - uniforms.pad[0];\n             let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * col - uniforms.pad[1];\n             for (var xChannel = 0; xChannel < ").concat(this.isChannelsLast?"uniforms.xShape[3];":"uniforms.xShape[1];"," xChannel = xChannel + 1) {\n               ").concat(this.isChannelsLast?"let v = readInp(batch, xRow, xCol, xChannel);":"let v = readInp(batch, xChannel, xRow, xCol);","\n               let f = readFilt(row, col, xChannel, outChannel);\n               acc = acc + v * f;\n             }\n           }\n         }\n         writeResult(batch, outRow, outCol, outChannel, acc);\n       }\n     ")}}]),e}(),bq=function(){function e(t,n){Te(this,e),this.variableNames=["x"],this.uniforms="pad : vec2<i32>, stride : vec2<i32>, dilation : vec2<i32>, outWidth : i32, itemsPerBlockRow : i32,\n       inChannels : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=n,this.shaderKey="im2col_"+this.isChannelsLast}return Re(e,[{key:"getUserCode",value:function(){var e=this.isChannelsLast?1:2,t=this.isChannelsLast?2:3,n=this.isChannelsLast?"coords[1]":"coords[2]",r=this.isChannelsLast?"coords[2]":"coords[1]",a=this.isChannelsLast?"getX(batch, xRow, xCol, ch)":"getX(batch, ch, xRow, xCol)";return"\n    ".concat(Qj("index")," {\n      let coords = getCoordsFromIndex(index);\n      if(index < uniforms.size) {\n        let batch = coords[0];\n        let row = ").concat(n,";\n        let col = ").concat(r,";\n        let offsetY = (row / uniforms.outWidth) * uniforms.stride[0] - uniforms.pad[0];\n        let xRow = offsetY + uniforms.dilation[0] * (col / uniforms.itemsPerBlockRow);\n        var value = 0.0;\n        if(xRow < uniforms.xShape[").concat(e,"] && xRow >= 0) {\n          let offsetX = (row % uniforms.outWidth) * uniforms.stride[1] -\n              uniforms.pad[1];\n          let xCol = offsetX + uniforms.dilation[1] * ((col %\n              uniforms.itemsPerBlockRow) / uniforms.inChannels);\n          let ch = col % uniforms.inChannels;\n          if(xCol < uniforms.xShape[").concat(t,"] && xCol >= 0) {\n            value = ").concat(a,";\n          }\n        }\n        setOutputAtIndex(index, value);\n      }\n    }\n   ")}}]),e}();function xq(e,t){var n=e.length;return n>=3?[].concat((0,Lt.Z)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function kq(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,p=void 0===h?null:h,d=null!=o,f=null!=u,m="channelsLast"===r.dataFormat,v=m&&r.filterHeight===r.inHeight&&r.filterWidth===r.inWidth&&"VALID"===r.padInfo.type,g=zn().getBool("WEBGPU_USE_NAIVE_CONV2D_DEBUG");if(!g&&(v||1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type)))return function(e){var t,n,r=e.x,a=e.filter,i=e.convInfo,o=e.backend,s=e.bias,u=void 0===s?null:s,c=e.preluActivationWeights,l=void 0===c?null:c,h=e.leakyreluAlpha,p=void 0===h?0:h,d=e.activation,f=void 0===d?null:d,m="channelsLast"===i.dataFormat,v=!m,g=[];if(m&&i.filterHeight===i.inHeight&&i.filterWidth===i.inWidth&&"VALID"===i.padInfo.type){var y=i.inHeight*i.inWidth*i.inChannels;t=HH({inputs:{x:r},backend:o,attrs:{shape:[1,i.batchSize,y]}}),n=HH({inputs:{x:a},backend:o,attrs:{shape:[1,y,i.outChannels]}})}else t=HH({inputs:{x:r},backend:o,attrs:{shape:m?[i.batchSize,i.inHeight*i.inWidth,i.inChannels]:[i.batchSize,i.inChannels,i.inHeight*i.inWidth]}}),n=HH({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});if(g.push(t),g.push(n),null!=l){var b=xq(l.shape,m);null!=b&&(l=HH({inputs:{x:l},backend:o,attrs:{shape:b}}),g.push(l))}if(null!=u){var x=xq(u.shape,m);null!=x&&(u=HH({inputs:{x:u},backend:o,attrs:{shape:x}}),g.push(u))}var k=KH({a:m?t:n,b:m?n:t,transposeA:v,transposeB:!1,backend:o,bias:u,activation:f,preluActivationWeights:l,leakyreluAlpha:p}),w=HH({inputs:{x:k},backend:o,attrs:{shape:i.outShape}});g.push(k);for(var S=0,I=g;S<I.length;S++){var C=I[S];o.disposeData(C.dataId)}return w}({x:t,filter:n,convInfo:r,backend:a,bias:o,activation:p,preluActivationWeights:u,leakyreluAlpha:l});var y,b=zn().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),x=b>0?b:a.thresholdToIncreaseWorkgroups,k=r.batchSize*Math.ceil(r.outHeight*r.outWidth/32)*Math.ceil(r.outChannels/32);if(zn().getBool("WEBGPU_CONV_SEPARATE_IM2COL_SHADER")||k<=x)return function(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,p=void 0===h?null:h,d=r.filterWidth,f=r.filterHeight,m=r.inChannels,v=r.strideWidth,g=r.strideHeight,y=r.padInfo,b=r.outWidth,x=r.outHeight,k=r.dilationWidth,w=r.dilationHeight,S="channelsLast"===r.dataFormat,I=d*f*m,C=x*b,T=S?[r.batchSize,C,I]:[r.batchSize,I,C],N=new bq(T,S),E=[{type:"int32",data:[y.top,y.left]},{type:"int32",data:[g,v]},{type:"int32",data:[w,k]},{type:"int32",data:[b]},{type:"int32",data:[m*d]},{type:"int32",data:[m]}],R=a.runWebGPUProgram(N,[t],t.dtype,E),A=[];A.push(R);var _=HH({inputs:{x:n},backend:a,attrs:{shape:[1,I,-1]}});if(A.push(_),null!=u){var O=xq(u.shape,S);null!=O&&(u=HH({inputs:{x:u},backend:a,attrs:{shape:O}}),A.push(u))}if(null!=o){var F=xq(o.shape,S);null!=F&&(o=HH({inputs:{x:o},backend:a,attrs:{shape:F}}),A.push(o))}var D=KH({a:S?R:_,b:S?_:R,transposeA:!S,transposeB:!1,backend:a,bias:o,activation:p,preluActivationWeights:u,leakyreluAlpha:l}),M=HH({inputs:{x:D},backend:a,attrs:{shape:r.outShape}});A.push(D);for(var P=0,L=A;P<L.length;P++){var z=L[P];a.disposeData(z.dataId)}return M}({x:t,filter:n,convInfo:r,backend:a,bias:o,preluActivationWeights:u,leakyreluAlpha:l,activation:p});var w=[r.padInfo.top,r.padInfo.left],S=[{type:"int32",data:[r.filterHeight,r.filterWidth]},{type:"int32",data:[].concat(w)},{type:"int32",data:[r.strideHeight,r.strideWidth]},{type:"int32",data:[r.dilationHeight,r.dilationWidth]}];if(g)y=new yq(r,d,p,f);else{var I=m?r.outHeight*r.outWidth:r.outChannels,C=m?r.outChannels:r.outHeight*r.outWidth,T=r.filterHeight*r.filterWidth*r.inChannels;S.push({type:"int32",data:[I]},{type:"int32",data:[C]},{type:"int32",data:[T]});var N=a.adapterInfo.isIntel();y=new gq(r,I,C,T,d,p,f,N)}var E=[],R=[t,n];d&&(m||1!==o.shape.length||(o=HH({inputs:{x:o},backend:a,attrs:{shape:[o.shape[0],1,1]}}),E.push(o)),R.push(o)),f&&(m||1!==u.shape.length||(u=HH({inputs:{x:u},backend:a,attrs:{shape:[u.shape[0],1,1]}}),E.push(u)),R.push(u)),"leakyrelu"===p&&(S.push({type:"float32",data:[l]}),y.uniforms+=" alpha : f32,");for(var A=a.runWebGPUProgram(y,R,t.dtype,S),_=0,O=E;_<O.length;_++){var F=O[_];a.disposeData(F.dataId)}return A}var wq,Sq={kernelName:yr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode,h=Vl(u);return kq({x:a,filter:i,convInfo:Ol(a.shape,i.shape,o,c,s,l,!1,h),backend:r})}},Iq=function(){function e(t){Te(this,e),this.variableNames=["dy","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, stride : vec2<i32>, outBackprop : vec4<i32>,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast="channelsLast"===t.dataFormat,this.shaderKey="conv2DDerInput_"+this.isChannelsLast}return Re(e,[{key:"getUserCode",value:function(){var e=this.isChannelsLast?1:2,t=this.isChannelsLast?2:3,n=this.isChannelsLast?3:1;return"\n    ".concat(Qj("index")," {\n      if(index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords[0];\n        let d1 = coords[").concat(n,"];\n\n        let dyCorner = vec2<i32>(coords[").concat(e,"], coords[").concat(t,"]) - uniforms.pads;\n        let dyRCorner = dyCorner.x;\n        let dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {\n          let dyR = (f32(dyRCorner) + f32(wR)) / f32(uniforms.stride.x);\n          let wRPerm = uniforms.filterDims.x - 1 - wR;\n          if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) || fract(dyR) > 0.0 ||\n              wRPerm < 0) {\n            continue;\n          }\n          let idyR = i32(dyR);\n\n          for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {\n            let dyC = (f32(dyCCorner) + f32(wC)) / f32(uniforms.stride.y);\n            let wCPerm = uniforms.filterDims.y - 1 - wC;\n            if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||\n                fract(dyC) > 0.0 || wCPerm < 0) {\n              continue;\n            }\n            let idyC = i32(dyC);\n\n            for (var d2 = 0; d2 < uniforms.outBackprop[3]; d2 = d2 + 1) {\n              if (").concat(this.isChannelsLast,") {\n                let xValue = getDy(batch, idyR, idyC, d2);\n                let wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd = dotProd + xValue * wValue;\n              } else {\n                let xValue = getDy(batch, d2, idyR, idyC);\n                let wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd = dotProd + xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n  ")}}]),e}(),Cq=function(){function e(t){Te(this,e),this.variableNames=["x","dy"],this.uniforms="pad : vec2<i32>, stride : vec2<i32>, batchSize : i32, outHeight : i32, outWidth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.filterShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast="channelsLast"===t.dataFormat,this.shaderKey="conv2DDerFilter_"+this.isChannelsLast}return Re(e,[{key:"getUserCode",value:function(){return"\n    ".concat(Qj("index")," {\n      if(index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let wR = coords[0];\n        let wC = coords[1];\n        let d1 = coords[2];\n        let d2 = coords[3];\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var b = 0; b < uniforms.batchSize; b = b + 1) {\n          for (var yR = 0; yR < uniforms.outHeight; yR = yR + 1) {\n            let xR = wR + yR * uniforms.stride[0] - uniforms.pad[0];\n            if (xR < 0 || xR >= uniforms.inHeight) {\n              continue;\n            }\n\n            for (var yC = 0; yC < uniforms.outWidth; yC = yC + 1) {\n              let xC = wC + yC * uniforms.stride[1] - uniforms.pad[1];\n\n              if (xC < 0 || xC >= uniforms.inWidth) {\n                continue;\n              }\n\n              if (").concat(this.isChannelsLast,") {\n                let dyValue = getDy(b, yR, yC, d2);\n                let xValue = getX(b, xR, xC, d1);\n                dotProd = dotProd + xValue * dyValue;\n              } else {\n                let dyValue = getDy(b, d2, yR, yC);\n                let xValue = getX(b, d1, xR, xC);\n                dotProd = dotProd + xValue * dyValue;\n              }\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n  ")}}]),e}(),Tq={kernelName:br,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=Vl(u),p=Ol(a.shape,l,o,1,s,c,!1,h),d=new Cq(p),f=[{type:"int32",data:[p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.batchSize]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]},{type:"int32",data:[p.inHeight]},{type:"int32",data:[p.inWidth]}];return n.runWebGPUProgram(d,[a,i],a.dtype,f)}},Nq=function(){function e(t){Te(this,e),this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, stride : vec2<i32>, outBackprop : vec4<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=t.inShape,nn("channelsLast"===t.dataFormat,(function(){return"TODO: NCHW is unimplemented"})),this.isVec4=t.inChannels%4==0&&t.outChannels%4==0,this.dispatchLayout={x:[3],y:[1,2],z:[0]},this.workgroupSize=cH(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=lH(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4&&(this.variableTypes=["vec4<f32>","f32"]),this.shaderKey="conv2DDerInputMM_".concat(this.isVec4,"_").concat(this.elementsPerThread)}return Re(e,[{key:"getUserCode",value:function(){var e=this.isVec4?DH(this.elementsPerThread,this.workgroupSize):PH(this.elementsPerThread,this.workgroupSize);return"\n    ".concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t="if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        ".concat("\n      let outRow = row / uniforms.outShape[2];\n      let outCol = row % uniforms.outShape[2];\n\n      let WRow = col / (uniforms.filterDims[1] * uniforms.outBackprop[3]);\n      let WCol = col / uniforms.outBackprop[3] % uniforms.filterDims[1];\n      let xR = f32(outRow - uniforms.pads[0] + WRow) / f32(uniforms.stride[0]);\n      let xC = f32(outCol - uniforms.pads[1] + WCol) / f32(uniforms.stride[1]);\n      if (xR < 0.0 || xR >= f32(uniforms.outBackprop[1]) || fract(xR) > 0.0) {\n        return ".concat(RH(e),"(0.0);\n      }\n      if (xC < 0.0 || xC >= f32(uniforms.outBackprop[2]) || fract(xC) > 0.0) {\n        return ").concat(RH(e),"(0.0);\n      }\n      let coord = vec4<i32>(\n          batch,\n          i32(xR),\n          i32(xC),\n          col % uniforms.outBackprop[3]);\n      return x[getIndexFromCoords4D(coord, uniforms.xShape)/").concat(e,"];"),"\n      }\n      return ",RH(e),"(0.0);");return"\n  fn mm_readA(batch: i32, row : i32, colIn : i32) -> ".concat(RH(e)," {\n    let col = colIn * ").concat(e,";\n    ").concat(t,"\n  }\n\n  fn mm_readB(batch: i32, row : i32, colIn : i32) -> ").concat(RH(e)," {\n    let col = colIn * ").concat(e,";\n    let coordX = uniforms.filterDims.x - 1 -\n        row / (uniforms.filterDims[1] * uniforms.outBackprop[3]);\n    let coordY = uniforms.filterDims.y - 1 -\n        (row / uniforms.outBackprop[3]) % uniforms.filterDims[1];\n    if (row < uniforms.dimInner && col < uniforms.dimBOuter &&\n        coordX >= 0 && coordY >= 0) {\n      let rowInner = row % uniforms.outBackprop[3];\n      let coord = vec4<i32>(coordX, coordY, col, rowInner);\n      ").concat(function(e){switch(e){case 1:return"return W[getIndexFromCoords4D(coord, uniforms.wShape)];";case 4:return"\n            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);\n            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);\n            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);\n            let v0 = W[getIndexFromCoords4D(coord, uniforms.wShape)];\n            let v1 = W[getIndexFromCoords4D(coord1, uniforms.wShape)];\n            let v2 = W[getIndexFromCoords4D(coord2, uniforms.wShape)];\n            let v3 = W[getIndexFromCoords4D(coord3, uniforms.wShape)];\n            return vec4<f32>(v0, v1, v2, v3);\n            ";default:throw new Error("innerElementSize ".concat(e," is not supported."))}}(e),"\n    }\n    return ").concat(RH(e),"(0.0);\n  }\n\n  fn mm_write(batch: i32, row : i32, colIn : i32, valueInput : ").concat(RH(e),") {\n    let col = colIn * ").concat(e,";\n    if (row < uniforms.dimAOuter && (col + ").concat(e-1,") < uniforms.dimBOuter) {\n      var value = valueInput;\n      let outCoord = vec4<i32>(\n          batch,\n          row / uniforms.outShape[2],\n          row % uniforms.outShape[2],\n          col);\n      result[getIndexFromCoords4D(outCoord, uniforms.outShape)/").concat(e,"] = value;\n    }\n  }")}(this.isVec4?4:1),"\n    ").concat(e,"\n    ")}}]),e}(),Eq={kernelName:xr,backendName:"webgpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.dy,o=n.filter,s=a.inputShape,u=a.strides,c=a.pad,l=a.dataFormat,h=a.dimRoundingMode,p=Vl(l),d=Ol(s,o.shape,u,1,c,h,!1,p),f=[{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.filterHeight-1-d.padInfo.top,d.filterWidth-1-d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.batchSize,d.outHeight,d.outWidth,d.outChannels]}];if(zn().getBool("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE")||d.filterHeight<=2&&d.filterWidth<=2&&d.outChannels<=16&&1===d.inChannels)t=new Iq(d);else{t=new Nq(d);var m=d.inHeight*d.inWidth,v=d.inChannels,g=d.filterHeight*d.filterWidth*d.outChannels;f.push({type:"uint32",data:[m]},{type:"uint32",data:[v]},{type:"uint32",data:[g]})}return r.runWebGPUProgram(t,[i,o],"float32",f)}},Rq={kernelName:Ir,backendName:"webgpu",kernelFunc:nZ({opType:gH.COS})},Aq={kernelName:Cr,backendName:"webgpu",kernelFunc:nZ({opType:gH.COSH})},_q=function(){function e(t,n,r,a){Te(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.uniforms="extrapolationValue : f32,",this.workgroupSize=[64,1,1],this.size=!0;var i=(0,E.Z)(n,1)[0];this.outputShape=[i,r[0],r[1],t],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.methodId="bilinear"===a?1:0,this.cropHeightBiggerThan1=this.outputShape[1]>1,this.cropWidthBiggerThan1=this.outputShape[2]>1,this.shaderKey="cropAndResize_".concat(this.methodId,"_").concat(this.cropHeightBiggerThan1,"_").concat(this.cropWidthBiggerThan1)}return Re(e,[{key:"getUserCode",value:function(){var e="f32(uniforms.imageShape[1] - 1)",t="f32(uniforms.imageShape[2] - 1)",n=this.cropHeightBiggerThan1?["(".concat(e," / f32(uniforms.outShape[1] - 1))"),"(y2-y1) * height_ratio","y1*".concat(e," + f32(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * "+e],r=(0,E.Z)(n,3),a=r[0],i=r[1],o=r[2],s=this.cropWidthBiggerThan1?["(".concat(t," / f32(uniforms.outShape[2] - 1))"),"(x2-x1) * width_ratio","x1*".concat(t," + f32(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * "+t],u=(0,E.Z)(s,3),c=u[0],l=u[1],h=u[2];return"\n    ".concat(Qj("index")," {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let height_ratio = f32(").concat(a,");\n        let width_ratio = f32(").concat(c,");\n        let b = coords[0];\n        let y = coords[1];\n        let x = coords[2];\n        let d = coords[3];\n        // get box vals\n        let y1 = getBoxes(b, 0);\n        let x1 = getBoxes(b, 1);\n        let y2 = getBoxes(b, 2);\n        let x2 = getBoxes(b, 3);\n        // get image in batch index\n        let bInd = i32(round(getBoxInd(b)));\n        if(bInd < 0 || bInd >= uniforms.outShape[0]) {\n          return;\n        }\n        let height_scale = ").concat(i,";\n        let width_scale = ").concat(l,";\n        let in_y = ").concat(o,";\n        if( in_y < 0.0 || in_y > ").concat(e," ) {\n          setOutputAtIndex(index, uniforms.extrapolationValue);\n          return;\n        }\n        let in_x = ").concat(h,";\n        if( in_x < 0.0 || in_x > ").concat(t," ) {\n          setOutputAtIndex(index, uniforms.extrapolationValue);\n          return;\n        }\n        let sourceFracIndexCR = vec2<f32>(in_x,in_y);\n        if(").concat(this.methodId," == 1) {\n          // Compute the four integer indices.\n          let sourceFloorCR = vec2<i32>(sourceFracIndexCR);\n          let sourceCeilCR = vec2<i32>(ceil(sourceFracIndexCR));\n          let topLeft = getImage(bInd, sourceFloorCR.y, sourceFloorCR.x, d);\n          let bottomLeft = getImage(bInd, sourceCeilCR.y, sourceFloorCR.x, d);\n          let topRight = getImage(bInd, sourceFloorCR.y, sourceCeilCR.x, d);\n          let bottomRight = getImage(bInd, sourceCeilCR.y, sourceCeilCR.x, d);\n          let fracCR = sourceFracIndexCR - vec2<f32>(sourceFloorCR);\n          let top = topLeft + (topRight - topLeft) * fracCR.x;\n          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          let newValue = top + (bottom - top) * fracCR.y;\n          setOutputAtIndex(index, newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          let sourceNearestCR = vec2<i32>(floor(\n            sourceFracIndexCR + vec2<f32>(0.5,0.5)));\n          let newValue = getImage(\n            bInd, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutputAtIndex(index, newValue);\n        }\n      }\n    }\n    ")}}]),e}(),Oq={kernelName:Er,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new _q(a.shape[3],i.shape,s,u),h=[{type:"float32",data:[c]}];return n.runWebGPUProgram(l,[a,i,o],"float32",h)}};!function(e){e.Prod="*",e.Sum="+"}(wq||(wq={}));var Fq=function(){function e(t,n,r,a){Te(this,e),this.variableNames=["x"],this.uniforms="index : f32,",this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=n,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.exclusive=r,this.reverse=a,this.op=t,this.shaderKey="cum_".concat(this.op,"_").concat(this.exclusive,"_").concat(this.reverse)}return Re(e,[{key:"getUserCode",value:function(){var e=this.outputShape.length,t=this.op===wq.Prod?"1.0":"0.0",n=this.exclusive?t:"getX(".concat(Dq(e,"coords",this.op),")"),r=this.outputShape[this.outputShape.length-1],a="",i="";return this.exclusive?(a=this.reverse?"end != "+(r-1):"end != 0",i=this.reverse?"end + 1":"end - 1"):(a=this.reverse?"end + pow2 < "+r:"end >= pow2",i=this.reverse?"end + pow2":"end - pow2"),"\n      ".concat(Qj("index")," {\n       if (index < uniforms.size) {\n         var coords = getCoordsFromIndex(index);\n\n         let end = ").concat(Mq(e,"coords",this.op),";\n         var val = ").concat(n,";\n         let pow2 = i32(pow(2.0, uniforms.index));\n         if (").concat(a,") {\n           let idx = ").concat(i,";\n           ").concat(Mq(e,"coords",this.op)," = idx;\n           val ").concat(this.op,"= getX(").concat(Dq(e,"coords",this.op),");\n         }\n         setOutputAtIndex(index, val);\n       }\n      }\n    ")}}]),e}();function Dq(e,t,n){if(1===e)return""+t;if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function Mq(e,t,n){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function Pq(e,t,n,r,a,i){var o=t.shape.length,s=Vh([r],o),u=t;null!=s&&(u=SK({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=jh(1,o)[0];if(c!==o-1)throw new Error("WebGPU cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=")+r);for(var l=u.shape[c],h=QH({inputs:{x:u},backend:n}),p=0;p<=Math.ceil(Math.log2(l))-1;p++){var d=new Fq(e,u.shape,!1,i),f=h,m=[{type:"float32",data:[p]}];h=n.runWebGPUProgram(d,[h],h.dtype,m),n.disposeData(f.dataId)}if(a){var v=new Fq(e,u.shape,a,i),g=h;h=n.runWebGPUProgram(v,[h],h.dtype,[{type:"float32",data:[0]}]),n.disposeData(g.dataId)}if(null!=s){var y=SK({inputs:{x:h},backend:n,attrs:{perm:Gh(s)}});return n.disposeData(h.dataId),n.disposeData(u.dataId),y}return h}var Lq={kernelName:Tr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return Pq(wq.Prod,a,n,i,o,s)}},zq={kernelName:Nr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return Pq(wq.Sum,a,n,i,o,s)}},Bq={kernelName:Rr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput,u=1===a.shape.length,c=on(i.shape)>0,l=i.dtype,h=u?[a.shape[0]]:[a.shape[0],a.shape[1]],p=GH({backend:n,attrs:{shape:u?[o]:[a.shape[0],o],value:0,dtype:l}}),d=new eq(h,c,s),f=[{type:"int32",data:[o]}],m=c?[a,i]:[a];return n.runWebGPUProgram(d,m,l,f,p)}},Uq=function(){function e(t,n){Te(this,e),this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.uniforms="blockSize : i32,",this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthToSpace_"+n,this.dataFormat=n}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let b = coords[0];\n          let h = ").concat(this.getHeightCoordString(),";\n          let w = ").concat(this.getWidthCoordString(),";\n          let d = ").concat(this.getDepthCoordString(),";\n\n          let in_h = h / uniforms.blockSize;\n          let offset_h = h % uniforms.blockSize;\n          let in_w = w / uniforms.blockSize;\n          let offset_w = w % uniforms.blockSize;\n          let offset_d = (offset_h * uniforms.blockSize + offset_w) *\n            ").concat(this.getOutputDepthSize(),";\n          let in_d = d + offset_d;\n\n          let rlt = ").concat(this.getInputSamplingString(),";\n          setOutputAtIndex(index, rlt);\n        }\n      }")}},{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?"uniforms.outShape[3]":"uniforms.outShape[1]"}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}(),Wq={kernelName:Ar,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),h=[{type:"int32",data:[i]}],p=new Uq("NHWC"===o?[s,u,c,l]:[s,l,u,c],o);return n.runWebGPUProgram(p,[a],a.dtype,h)}},Vq=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Te(this,e),this.variableNames=["x","W"],this.uniforms="pad : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[16,16,1],this.outputShape=t,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.addBias=a,this.activation=i,this.hasPreluActivation=o,this.filterHeight=n,this.filterWidth=r,this.shaderKey="depthwiseNCHW_".concat(this.activation,"_").concat(this.filterHeight,"_").concat(this.filterWidth)}return Re(e,[{key:"getUserCode",value:function(){var e=this.filterWidth*this.filterHeight,t=this.workgroupSize[0]*this.workgroupSize[1]*this.workgroupSize[2],n=this.workgroupSize[1]+this.filterHeight-1,r=this.workgroupSize[0]+this.filterWidth-1;return"\n      ".concat(AH(this.activation,this.hasPreluActivation,!1,4),"\n\n      var<workgroup> mm_Asub : array<array<f32, ").concat(r,">, ").concat(n,">;\n      var<workgroup> mm_Bsub : array<array<f32, ").concat(this.filterWidth,">, ").concat(this.filterHeight,">;\n      fn readX(batch : i32, channel : i32, row : i32, col : i32) -> f32 {\n        var value = 0.0;\n        if (row >=0 && row < uniforms.inDims[0] && col >=0 && col < uniforms.inDims[1])\n        {\n          value = getX(batch, channel, row, col);\n        }\n        return value;\n      }\n\n      ").concat(Qj()," {\n        let coords = getOutputCoords();\n        let batch = coords[0];\n        let xRCCorner = vec2<i32>(coords.zw) - uniforms.pad;\n        let channelMul = uniforms.wShape[3];\n        let d1 = coords[1] / channelMul;\n        let q = coords[1] % channelMul;\n\n        let inputRowStart = xRCCorner.x;\n        let inputColStart = xRCCorner.y;\n\n        let localRow = i32(localId.y);\n        let localCol = i32(localId.x);\n\n        // Load one tile of X into local memory.\n        for (var inputRow = localRow; inputRow < ").concat(n,"; inputRow = inputRow + ").concat(this.workgroupSize[1],") {\n          for (var inputCol = localCol; inputCol < ").concat(r,"; inputCol = inputCol + ").concat(this.workgroupSize[0],") {\n            let rowOffset = inputRow - localRow;\n            let colOffset = inputCol - localCol;\n            mm_Asub[inputRow][inputCol] = readX(batch, d1, inputRowStart + rowOffset, inputColStart + colOffset);\n          }\n        }\n\n        // Load one tile of W into local memory.\n        var wIndex = i32(localIndex);\n        ").concat(e<t?"if (wIndex < ".concat(e,")"):"for(; wIndex < ".concat(e,"; wIndex = wIndex + ").concat(t,")"),"\n\n        {\n          let wRow = wIndex / ").concat(this.filterWidth,";\n          let wCol = wIndex % ").concat(this.filterWidth,";\n          mm_Bsub[wRow][wCol] = getW(wRow, wCol, d1, q);\n        }\n\n        workgroupBarrier();\n\n        var value = 0.0;\n        for (var wR = 0; wR < ").concat(this.filterHeight,"; wR = wR + 1) {\n          for (var wC = 0; wC < ").concat(this.filterWidth,"; wC = wC + 1) {\n            let xVal = mm_Asub[localRow + wR][localCol + wC];\n            let wVal = mm_Bsub[wR][wC];\n            value = fma(xVal, wVal, value);\n          }\n        }\n        ").concat(_H(this.addBias,this.activation),"\n        if (coordsInBounds4D(coords, uniforms.outShape)) {\n          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }\n    ")}}]),e}(),Gq=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Te(this,e),this.variableNames=["x","W"],this.uniforms="pad : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[4,4,4],this.workPerThread=4,this.isVec4=!0,this.outputShape=t.outShape,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[4,this.workPerThread,1]),nn("channelsLast"===t.dataFormat,(function(){return"TODO: NCHW is unimplemented"})),n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.convInfo=t,this.addBias=n,this.activation=r,this.hasPreluActivation=a,this.shaderKey="depthwiseVec4_".concat(r,"_").concat(this.convInfo.filterHeight,"_").concat(this.convInfo.filterWidth,"_").concat(this.convInfo.strideHeight,"_").concat(this.convInfo.strideWidth,"_").concat(this.workPerThread)}return Re(e,[{key:"getUserCode",value:function(){var e=(this.workPerThread-1)*this.convInfo.strideWidth+this.convInfo.filterWidth,t=this.convInfo.strideHeight,n=this.convInfo.strideWidth;return"\n      ".concat(AH(this.activation,this.hasPreluActivation,!0,4),"\n      fn readX(batch : i32, row : i32, col : i32, channel : i32) -> vec4<f32> {\n        var value = vec4<f32>(0.0);\n        if (col >=0 && col < uniforms.inDims[1]) {\n          value = getX(batch, row, col, channel);\n        }\n        return value;\n      }\n\n      ").concat(Qj()," {\n        let batch = i32(globalId.z) / uniforms.outShape[1];\n        let r = i32(globalId.z) % uniforms.outShape[1];\n        let c = i32(globalId.y) * ").concat(this.workPerThread,";\n        let d1 = i32(globalId.x) * 4;\n        let xRCCorner = vec2<i32>(r, c) * vec2<i32>(").concat(t,", ").concat(n,") - uniforms.pad;\n\n        let xRCorner = xRCCorner.x;\n        let xCCorner = xRCCorner.y;\n        var xVals : array<vec4<f32>, ").concat(e,">;\n        var dotProd : array<vec4<f32>, ").concat(this.workPerThread,">;\n        for (var i = 0; i < ").concat(this.workPerThread,"; i++) {\n          dotProd[i] = vec4<f32>(0.0);\n        }\n\n        // Use constant instead of uniform can give better performance.\n        for (var wR = 0; wR < ").concat(this.convInfo.filterHeight,"; wR = wR + 1) {\n          let xR = xRCorner + wR;\n          if (xR >=0 && xR < uniforms.inDims[0]) {\n            for (var i = 0; i < ").concat(e,"; i++) {\n              xVals[i] = readX(batch, xR, xCCorner + i, d1);\n            }\n            for (var wC = 0; wC < ").concat(this.convInfo.filterWidth,"; wC = wC + 1) {\n              let wValue = getW(wR, wC, d1, 0);\n              for (var i = 0; i < ").concat(this.workPerThread,"; i++) {\n                dotProd[i] = fma(xVals[i * ").concat(n," + wC], wValue, dotProd[i]);\n              }\n            }\n          }\n        }\n\n        for (var i = 0; i < ").concat(this.workPerThread,"; i = i + 1) {\n          let coords = vec4<i32>(batch, r, c + i, d1);\n          if (coordsInBounds4D(coords, uniforms.outShape)) {\n            var value = dotProd[i];\n            ").concat(_H(this.addBias,this.activation),"\n            setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n          }\n        }\n      }\n    ")}}]),e}(),jq=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Te(this,e),this.variableNames=["x","W"],this.uniforms="pad : vec2<i32>, inDims : vec2<i32>, filterHeight : i32,\n      filterWidth : i32, stride : vec2<i32>, dilation : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast="channelsLast"===t.dataFormat,n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.convInfo=t,this.addBias=n,this.activation=r,this.hasPreluActivation=a,this.shaderKey="depthwise_".concat(this.activation,"_").concat(this.isChannelsLast)}return Re(e,[{key:"getUserCode",value:function(){var e=this.isChannelsLast?"getX(batch, xR, xC, d1);":"getX(batch, d1, xR, xC);";return"\n      ".concat(AH(this.activation,this.hasPreluActivation,!1,4),"\n\n      ").concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getOutputCoords();\n          let batch = coords[0];\n          let xRCCorner = vec2<i32>(coords.").concat(this.isChannelsLast?"yz":"zw",") * uniforms.stride - uniforms.pad;\n          let d2 = coords[").concat(this.isChannelsLast?3:1,"];\n          let channelMul = uniforms.wShape[3];\n          let d1 = d2 / channelMul;\n          let q = d2 % channelMul;\n\n          let inputRowStart = xRCCorner.x;\n          let inputColStart = xRCCorner.y;\n          let inputRowEnd = inputRowStart + uniforms.filterHeight *\n              uniforms.dilation[0];\n          let inputColEnd = inputColStart + uniforms.filterWidth *\n              uniforms.dilation[1];\n\n          // Convolve x(?, ?, d1)|x(d1, ?, ?) with w(:, :, d1, q) to get\n          // y(yR, yC, d2)|y(d2, yR, yC). ? = to be determined. : = across all\n          // values in that axis. x(?, ?, d1) and y(yR, yC, d2) is for NHWC.\n          // x(d1, ?, ?) and y(d2, yR, yC) is for NCHW.\n          var value = 0.0;\n\n          // Extract if checking out of for loop for performance.\n          if (inputRowStart >= 0 && inputColStart >= 0 &&\n            inputRowEnd < uniforms.inDims[0] &&\n                inputColEnd < uniforms.inDims[1]) {\n              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {\n                let xR = inputRowStart + wR * uniforms.dilation[0];\n\n                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {\n                  let xC = inputColStart + wC * uniforms.dilation[1];\n\n                  let xVal = ").concat(e,";\n                  let wVal = getW(wR, wC, d1, q);\n                  value = value + xVal * wVal;\n                }\n              }\n            } else {\n              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {\n                let xR = inputRowStart + wR * uniforms.dilation[0];\n\n                if (xR < 0 || xR >= uniforms.inDims[0]) {\n                  continue;\n                }\n\n                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {\n                  let xC = inputColStart + wC * uniforms.dilation[1];\n\n                  if (xC < 0 || xC >= uniforms.inDims[1]) {\n                    continue;\n                  }\n\n                  let xVal = ").concat(e,";\n                  let wVal = getW(wR, wC, d1, q);\n                  value = value + xVal * wVal;\n                }\n              }\n            }\n            ").concat(_H(this.addBias,this.activation),"\n          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }\n    ")}}]),e}(),Hq={kernelName:_r,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode,h=Vl(u),p=c;null==p&&(p=[1,1]);var d,f=Ol(a.shape,i.shape,o,p,s,l,!0,h),m=[{type:"int32",data:[f.padInfo.top,f.padInfo.left]},{type:"int32",data:[f.inHeight,f.inWidth]}],v="channelsLast"===f.dataFormat;return!v&&f.inHeight>16&&f.inWidth>16&&1===f.strideHeight&&1===f.strideWidth&&1===f.dilationWidth&&1===f.dilationHeight&&f.inChannels===f.outChannels?d=new Vq(f.outShape,f.filterHeight,f.filterWidth):v&&f.outHeight>4&&f.outWidth>4&&f.strideWidth<=2&&f.inChannels===f.outChannels&&1===f.dilationHeight&&1===f.dilationWidth&&f.inChannels%4==0?d=new Gq(f):(d=new jq(f),m.push({type:"int32",data:[f.filterHeight]},{type:"int32",data:[f.filterWidth]},{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.dilationHeight,f.dilationWidth]})),n.runWebGPUProgram(d,[a,i],a.dtype,m)}},Zq=function(){function e(t){Te(this,e),this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t,t],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="diag"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getOutputCoords();\n          let value = select(0.0, getX(coords[0]), coords[0] == coords[1]);\n          setOutputAtIndex(index, value);\n        }\n      }\n    ")}}]),e}(),Kq={kernelName:Dr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat((0,Lt.Z)(r.shape),(0,Lt.Z)(r.shape)),i=on(r.shape),o=HH({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new Zq(i),u=n.runWebGPUProgram(s,[o],o.dtype),c=HH({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeData(o.dataId),n.disposeData(u.dataId),c}},qq=function(){function e(t){Te(this,e),this.variableNames=["x","w"],this.uniforms="filterDims: vec2<i32>, pad: vec2<i32>, stride: vec2<i32>, dilation: vec2<i32>",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="dilation2d"}return Re(e,[{key:"getUserCode",value:function(){return"\n       ".concat(Qj("index")," {\n         if (index < uniforms.size) {\n           let neg_infinity = -3.4e38;\n           let coords = getOutputCoords();\n           let batch = coords.x;\n           let d1 = coords.w;\n           let outTopLeftCorner = coords.yz * uniforms.stride - uniforms.pad;\n           let hBeg = outTopLeftCorner.x;\n           let wBeg = outTopLeftCorner.y;\n\n           var curVal = neg_infinity;\n           for (var h = 0; h < uniforms.filterDims[0]; h = h + 1) {\n             let hIn = hBeg + h * uniforms.dilation[0];\n\n             if (hIn >= 0 && hIn < uniforms.xShape[1]) {\n               for (var w = 0; w < uniforms.filterDims[1]; w = w + 1) {\n                 let wIn = wBeg + w * uniforms.dilation[1];\n\n                 if (wIn >= 0 && wIn < uniforms.xShape[2]) {\n                   let val = getX(batch, hIn, wIn, d1) + getW(h, w, d1);\n                   if (val > curVal) {\n                     curVal = val;\n                   }\n                 }\n               }\n             }\n           }\n\n           setOutputAtIndex(index, curVal);\n         }\n       }\n     ")}}]),e}(),Xq={kernelName:Mr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Rl(a.shape,i.shape,o,s,"NHWC",u),l=[c.padInfo.top,c.padInfo.left],h=[{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[].concat(l)},{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]}],p=new qq(c);return n.runWebGPUProgram(p,[a,i],a.dtype,h)}},Yq=rZ({opType:fH.MUL,cpuKernelImpl:eK,supportsComplex:!0}),Qq={kernelName:Da,backendName:"webgpu",kernelFunc:Yq};function Jq(e){var t=e.inputs,n=e.backend,r=e.attrs;return TK(t.x,r.axis,r.keepDims,"sum",n)}var $q={kernelName:ki,backendName:"webgpu",kernelFunc:Jq},eX={kernelName:Ur,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Iv(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;Tv(i.length,s,r);for(var u=Nv(o,s),c=u.path,l=u.steps,h=l.length,p=null,d=i.length,f=[],m=0;m<h;++m){var v,g=Kt(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Cv(d,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;Ev(x)?w=r[y]:(w=SK({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),f.push(w));for(var S=w.shape.slice(),I=0;I<k.length;++I)S.splice(k[I],0,1);sn(w.shape,S)||(w=HH({inputs:{x:w},backend:n,attrs:{shape:S}}),f.push(w)),null===p?p=w:(p=Yq({inputs:{a:w,b:p},backend:n}),f.push(p))}}catch($Q){g.e($Q)}finally{g.f()}m<h-1&&(c[m]>=0&&(p=Jq({inputs:{x:p},backend:n,attrs:{axis:c[m]-(i.length-d),keepDims:!1}}),f.push(p)),d--)}for(var C=0,T=f;C<T.length;C++){var N=T[C];N!==p&&n.disposeData(N.dataId)}return p}},tX={kernelName:Wr,backendName:"webgpu",kernelFunc:nZ({opType:gH.ELU})},nX={kernelName:jr,backendName:"webgpu",kernelFunc:rZ({opType:fH.EQUAL,dtype:"bool",cpuKernelImpl:UZ})},rX={kernelName:Gr,backendName:"webgpu",kernelFunc:nZ({opType:gH.ERF})},aX=nZ({opType:gH.EXP,cpuKernelImpl:WZ,dtype:"float32"}),iX={kernelName:Hr,backendName:"webgpu",kernelFunc:aX};function oX(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(nn(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),HH({inputs:{x:i},backend:r,attrs:{shape:s}})}var sX={kernelName:Zr,backendName:"webgpu",kernelFunc:oX},uX={kernelName:Kr,backendName:"webgpu",kernelFunc:nZ({opType:gH.EXPM1,cpuKernelImpl:VZ})},cX=function(){function e(t,n){Te(this,e),this.variableNames=["real","imag"],this.outputShape=[],this.uniforms="exponentMultiplier : f32, denominator: f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.component=t,this.shaderKey="fft_"+t}return Re(e,[{key:"getUserCode",value:function(){return"\n    fn unaryOpComplex(real: f32, expR: f32, imag: f32, expI: f32) -> f32 {\n      ".concat("real"===this.component?"return real * expR - imag * expI;":"return real * expI + imag * expR;","\n    }\n\n    fn mulMatDFT(batch: i32, index: i32) -> f32 {\n      let indexRatio = f32(index) / f32(uniforms.realShape[1]);\n      let exponentMultiplierTimesIndexRatio =\n          uniforms.exponentMultiplier * indexRatio;\n\n      var result = 0.0;\n\n      for (var i = 0; i < uniforms.realShape[1]; i = i + 1) {\n        // x = (-2|2 * PI / N) * index * i;\n        let x = exponentMultiplierTimesIndexRatio * f32(i);\n        let expR = cos(x);\n        let expI = sin(x);\n        let real = getReal(batch, i);\n        let imag = getImag(batch, i);\n\n        result = result +\n            unaryOpComplex(real, expR, imag, expI) / uniforms.denominator;\n      }\n\n      return result;\n    }\n\n    ").concat(Qj("index")," {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        setOutputAtIndex(index, mulMatDFT(coords[0], coords[1]));\n      }\n    }\n  ")}}]),e}();function lX(e,t,n){var r=n.tensorMap.get(e.dataId),a=on(e.shape),i=e.shape[e.shape.length-1],o=[],s=HH({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}});o.push(s);var u=s.shape,c=new cX("real",u),l=new cX("imag",u),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],p=[{type:"float32",data:[t?2*Math.PI:-2*Math.PI]},{type:"float32",data:[t?u[1]:1]}],d=n.runWebGPUProgram(c,h,"float32",p);o.push(d);var f=n.runWebGPUProgram(l,h,"float32",p);o.push(f);var m=$H({inputs:{real:d,imag:f},backend:n});o.push(m);var v=HH({inputs:{x:m},backend:n,attrs:{shape:e.shape}});return o.forEach((function(e){return n.disposeData(e.dataId)})),v}var hX,pX={kernelName:qr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend;return lX(t.input,!1,n)}},dX=function(){function e(t){Te(this,e),this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="flipLeftRight"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let coordX = uniforms.xShape[2] - coords[2] - 1;\n          let outputValue = getX(coords[0], coords[1], coordX, coords[3]);\n          setOutputAtIndex(index, outputValue);\n        }\n      }\n    ")}}]),e}(),fX={kernelName:Yr,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new dX(r.shape);return a.runWebGPUProgram(i,[r],r.dtype)}},mX={kernelName:Qr,backendName:"webgpu",kernelFunc:nZ({opType:gH.FLOOR,cpuKernelImpl:GZ})},vX={kernelName:Jr,backendName:"webgpu",kernelFunc:rZ({opType:fH.INT_DIV,dtype:"int32"})},gX=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Te(this,e),this.isFromPixels=!0,this.outputShape=[0],this.variableNames=[],this.workgroupSize=[256,1,1],this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[n,1,1]),this.importVideo=r,this.shaderKey="fromPixels_"+this.importVideo}return Re(e,[{key:"getUserCode",value:function(){var e=this.importVideo?"textureLoad(src, vec2<i32>(coords.yx));":"textureLoad(src, vec2<i32>(coords.yx), 0)";return"\n      @binding(1) @group(0) var src: ".concat(this.importVideo?"texture_external":"texture_2d<f32>",";\n      ").concat(Qj("index")," {\n        let flatIndex = index * uniforms.numChannels;\n        if (flatIndex < uniforms.size) {\n          let coords = getCoordsFromIndex(flatIndex);\n          let values = ").concat(e,";\n          for (var i = 0; i < uniforms.numChannels; i = i + 1) {\n            result[flatIndex + i] = i32(floor(255.0 * values[i]));\n          }\n        }\n      }\n  ")}}]),e}(),yX={kernelName:Xi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels;if(null==a)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u="undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&a instanceof OffscreenCanvas,c="undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap,l=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],h=(0,E.Z)(l,2),p=h[0],d=h[1],f=[d,p,i],m=o||s;if(c||u||m){var v;if(m){var g=zn().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=hX&&g===bX||(bX=g,hX=document.createElement("canvas").getContext("2d",{willReadFrequently:bX})),hX.canvas.width=p,hX.canvas.height=d,hX.drawImage(a,0,0,p,d),a=hX.canvas}var y=GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,b="rgba8unorm",x=n.textureManager.acquireTexture(f[1],f[0],b,y);n.queue.copyExternalImageToTexture({source:a},{texture:x},[f[1],f[0]]),v={width:p,height:d,format:b,usage:y,texture:x};var k=on(f),w=In(f),S=new gX(f,i,!1),I=[{type:"uint32",data:[k]},{type:"uint32",data:[i]},{type:"uint32",data:(0,Lt.Z)(w)}],C=n.makeTensorInfo([d,p],"int32");n.tensorMap.get(C.dataId).resourceInfo=v;var T=n.runWebGPUProgram(S,[C],"int32",I);return n.disposeData(C.dataId),T}var N=a.data,R=N;if(null!=i&&4!==i){R=new Uint8Array(a.width*a.height*i);for(var A=N.length,_=0,O=0;O<A;O++)O%4<i&&(R[_++]=N[O])}var F=n.makeTensorInfo(f,"int32",new Int32Array(R));return n.uploadToGPU(F.dataId),F}},bX=zn().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU"),xX=function(){function e(t,n,r,a,i){Te(this,e),this.uniforms="varianceEpsilon : f32,",this.workgroupSize=[128,1,1],this.size=!0,this.variableNames=["x","mean","variance"],Ic(t,n),Ic(t,r),this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),null!=a&&(Ic(t,a),this.variableNames.push("offset")),null!=i&&(Ic(t,i),this.variableNames.push("scale")),this.offsetShape=a,this.scaleShape=i,this.shaderKey="batchNorm"}return Re(e,[{key:"getUserCode",value:function(){var e="0.0";null!=this.offsetShape&&(e="getOffsetByOutputIndex(index)");var t="1.0";return null!=this.scaleShape&&(t="getScaleByOutputIndex(index)"),"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size)\n        {\n          let xValue = getXByOutputIndex(index);\n          let meanValue = getMeanByOutputIndex(index);\n          let varianValue = getVarianceByOutputIndex(index);\n          let offsetValue = ").concat(e,";\n          let scaleValue = ").concat(t,";\n          let inv = scaleValue * inverseSqrt(varianValue + f32(uniforms.varianceEpsilon));\n          setOutputAtIndex(index,dot(vec3<f32>(xValue, -meanValue, offsetValue), vec3<f32>(inv, inv, 1.0)));\n        }\n      }\n  ")}}]),e}(),kX={kernelName:$r,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance,c=n.varianceEpsilon,l=r,h=[a,s,u],p=null;null!=o&&(p=o.shape,h.push(o));var d=null;null!=i&&(d=i.shape,h.push(i));var f=new xX(a.shape,s.shape,u.shape,p,d),m=[{type:"float32",data:[c]}];return l.runWebGPUProgram(f,h,a.dtype,m)}},wX={kernelName:Ji,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=Vl(l);return kq({x:a,filter:i,convInfo:Ol(a.shape,i.shape,u,h,c,p,!1,m),backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:d})}},SX={kernelName:$i,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,h=r.dimRoundingMode,p=r.activation,d=r.leakyreluAlpha,f=l;null==f&&(f=[1,1]),nn(Ul(u,f),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(f,"'")}));var m=Ol(a.shape,i.shape,u,f,c,h,!0),v=[a,i],g=null!=o,y=null!=s;g&&v.push(o),y&&v.push(s);var b,x=[{type:"int32",data:[m.padInfo.top,m.padInfo.left]},{type:"int32",data:[m.inHeight,m.inWidth]}];return m.outHeight>4&&m.outWidth>4&&m.strideWidth<=2&&m.inChannels===m.outChannels&&1===m.dilationHeight&&1===m.dilationWidth&&m.inChannels%4==0?b=new Gq(m,g,p,y):(b=new jq(m,g,p,y),x.push({type:"int32",data:[m.filterHeight]},{type:"int32",data:[m.filterWidth]},{type:"int32",data:[m.strideHeight,m.strideWidth]},{type:"int32",data:[m.dilationHeight,m.dilationWidth]})),"leakyrelu"===p&&(x.push({type:"float32",data:[d]}),b.uniforms+=" alpha : f32,"),n.runWebGPUProgram(b,v,"float32",x)}},IX=function(){function e(t,n){Te(this,e),this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gathernd_"+t,this.sliceDim=t,this.uniforms="sliceDim : i32, strides : ".concat(Xj(t),",")}return Re(e,[{key:"getUserCode",value:function(){var e;return e=this.sliceDim>1?"uniforms.strides[j]":"uniforms.strides","\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          var flattenIndex = 0;\n          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {\n            let indexTemp = i32(round(getIndices(coords[0], j)));\n            let strideNum = ").concat(e,";\n            flattenIndex = flattenIndex + indexTemp * strideNum;\n          }\n\n          setOutputAtIndex(index, getA(flattenIndex, coords[1]));\n        }\n      }\n      ")}}]),e}(),CX={kernelName:ta,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=on(r.shape),u=sv(r,a),c=(0,E.Z)(u,4),l=c[0],h=c[1],p=c[2],d=c[3],f=HH({inputs:{x:a},backend:n,attrs:{shape:[h,o]}}),m=HH({inputs:{x:r},backend:n,attrs:{shape:[on(r.shape)/p,p]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),g=n.bufferSync(r),y=jZ(v,g,r.dtype,h,o,p,d,r.shape,s);return n.makeTensorInfo(l,r.dtype,y.values)}var b=new IX(o,[h,p]),x=[{type:"int32",data:[o]},{type:"int32",data:d}],k=n.runWebGPUProgram(b,[m,f],m.dtype,x),w=HH({inputs:{x:k},backend:n,attrs:{shape:l}});return n.disposeData(f.dataId),n.disposeData(m.dataId),n.disposeData(k.dataId),w}},TX=function(){function e(t,n){Te(this,e),this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.slice(),this.aShape=t,this.outputShape=n,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gather"}return Re(e,[{key:"getUserCode",value:function(){var e=function(e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],r=0;r<e.length;r++)2===r?n.push("indexZ"):n.push(""+t[r]);return n.join()}(this.aShape);return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let resRC = getCoordsFromIndex(index);\n          let indexZ = i32(getIndices(resRC.x, resRC.z));\n          let inBounds = select(0.0, 1.0, indexZ >= 0 && indexZ < uniforms.aShape[2]);\n          setOutputAtIndex(index, inBounds * getA(").concat(e,"));\n        }\n      }\n    ")}}]),e}();function NX(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Uv(a,i,dn(o,a.shape)[0],s),c=on(i.shape),l=[],h=HH({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=HH({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});l.push(h),l.push(p);var d=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])){var f=n.tensorMap.get(p.dataId).values,m=ju(p.shape,p.dtype,f),v=n.tensorMap.get(h.dataId).values,g=ju(h.shape,h.dtype,v),y=HZ(g,m,d);return l.forEach((function(e){return n.disposeData(e.dataId)})),n.makeTensorInfo(u.outputShape,y.dtype,y.values)}var b=new TX(h.shape,d),x=n.runWebGPUProgram(b,[h,p],h.dtype);l.push(x);var k=HH({inputs:{x:x},backend:n,attrs:{shape:u.outputShape}});return l.forEach((function(e){return n.disposeData(e.dataId)})),k}var EX={kernelName:ea,backendName:"webgpu",kernelFunc:NX},RX={kernelName:na,backendName:"webgpu",kernelFunc:rZ({opType:fH.GREATER,cpuKernelImpl:KZ,dtype:"bool"})},AX={kernelName:ra,backendName:"webgpu",kernelFunc:rZ({opType:fH.GREATER_EQUAL,dtype:"bool",cpuKernelImpl:ZZ})},_X={kernelName:ia,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend;return lX(t.input,!0,n)}},OX={kernelName:sa,backendName:"webgpu",kernelFunc:nZ({opType:gH.IS_FINITE,dtype:"bool"})},FX={kernelName:ua,backendName:"webgpu",kernelFunc:nZ({opType:gH.IS_INF,dtype:"bool"})},DX={kernelName:ca,backendName:"webgpu",kernelFunc:nZ({opType:gH.IS_NAN,dtype:"bool"})},MX={kernelName:la,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=[{type:"float32",data:[r.alpha]}],o=new tZ(a.shape,gH.LEAKYRELU,"alpha : f32,");return n.runWebGPUProgram(o,[a],"float32",i)}},PX={kernelName:ha,backendName:"webgpu",kernelFunc:rZ({opType:fH.LESS,dtype:"bool",cpuKernelImpl:XZ})},LX={kernelName:pa,backendName:"webgpu",kernelFunc:rZ({opType:fH.LESS_EQUAL,dtype:"bool",cpuKernelImpl:qZ})},zX=function(){function e(t){Te(this,e),this.variableNames=[],this.outputShape=[],this.uniforms="start : f32, step : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="linSpace"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          setOutputAtIndex(index, uniforms.start + f32(index) * uniforms.step);\n        }\n      }\n    ")}}]),e}(),BX={kernelName:da,backendName:"webgpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=(a-r)/(i-1),s=new zX(i),u=[{type:"float32",data:[r]},{type:"float32",data:[o]}];return t.runWebGPUProgram(s,[],"float32",u)}},UX={kernelName:fa,backendName:"webgpu",kernelFunc:nZ({opType:gH.LOG,cpuKernelImpl:YZ})},WX={kernelName:ma,backendName:"webgpu",kernelFunc:nZ({opType:gH.LOG1P})},VX={kernelName:va,backendName:"webgpu",kernelFunc:rZ({opType:fH.LOGICAL_AND,dtype:"bool"})},GX={kernelName:ga,backendName:"webgpu",kernelFunc:nZ({opType:gH.LOGICAL_NOT})},jX={kernelName:ya,backendName:"webgpu",kernelFunc:rZ({opType:fH.LOGICAL_OR})},HX="\n  var powValue = 0.0;\n  let basis = uniforms.bias + uniforms.alpha * sum;\n  if (uniforms.beta == 0.5) {\n    powValue = inverseSqrt(basis);\n  } else if (uniforms.beta == 1.0) {\n    powValue = 1.0 / basis;\n  } else {\n    powValue = exp(log(basis) * (-uniforms.beta));\n  }\n",ZX=function(){function e(t){Te(this,e),this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn"}return Re(e,[{key:"getUserCode",value:function(){return"\n    ".concat(Qj("index")," {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        let b = coords[0];\n        let r = coords[1];\n        let c = coords[2];\n        let d = coords[3];\n\n        let x = getX(b, r, c, d);\n        var sum = 0.0;\n        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {\n          let idx = d + i;\n          if (idx >= 0 && idx < uniforms.xShape[3]) {\n            let z = getX(b, r, c, idx);\n            sum = sum + z * z;\n          }\n        }\n        ").concat(HX,"\n\n        setOutputAtIndex(index, x * powValue);\n      }\n    }\n  ")}}]),e}(),KX=function(){function e(t,n){var r=this;Te(this,e),this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[256,1,1],this.maxAllowRadius=16,nn(n<=this.maxAllowRadius,(function(){return"Radius must be less than or equal to ".concat(r.maxAllowRadius,", current radius is ").concat(n)})),this.outputShape=t,this.elementsPerWorkgroup=this.workgroupSize[0]-2*this.maxAllowRadius,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=uH(this.dispatchLayout,this.outputShape,[this.elementsPerWorkgroup,this.workgroupSize[1],this.workgroupSize[2]]),this.shaderKey="lrn_shared"}return Re(e,[{key:"getUserCode",value:function(){return"\n    var <workgroup>lrnSub: array<f32, ".concat(this.workgroupSize[0],">;\n    const elementsPerWorkgroup = ").concat(this.elementsPerWorkgroup,";\n    const maxAllowRadius = ").concat(this.maxAllowRadius,";\n\n    ").concat(Qj()," {\n      let localDepth = i32(localId.x);\n      let workgroupDepth = i32(workgroupId.x) * elementsPerWorkgroup;\n      let xDepth = workgroupDepth + localDepth - maxAllowRadius;\n      let b = i32(globalId.z) / uniforms.xShape[1];\n      let r = i32(globalId.z) - b * uniforms.xShape[1];\n      let c = i32(globalId.y);\n      let d = workgroupDepth + localDepth;\n\n      var x = 0.0;\n      if (xDepth >= 0 && xDepth < uniforms.xShape[3]) {\n        x = getX(b, r, c, xDepth);\n      }\n      lrnSub[localDepth] = x;\n      workgroupBarrier();\n\n      if (localDepth < elementsPerWorkgroup && d < uniforms.outShape[3]) {\n        var sum = 0.0;\n        let index = localDepth + maxAllowRadius;\n        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {\n          let z = lrnSub[index + i];\n          sum = sum + z * z;\n        }\n        ").concat(HX,"\n\n        setOutputAtCoords(b, r, c, d, lrnSub[index] * powValue);\n      }\n    } ")}}]),e}(),qX={kernelName:ba,backendName:"webgpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.depthRadius,s=a.bias,u=a.alpha,c=a.beta;t=o>16?new ZX(i.shape):new KX(i.shape,o);var l=[{type:"int32",data:[o]},{type:"float32",data:[s]},{type:"float32",data:[u]},{type:"float32",data:[c]}];return r.runWebGPUProgram(t,[i],i.dtype,l)}},XX={kernelName:wa,backendName:"webgpu",kernelFunc:rZ({opType:fH.MAX,cpuKernelImpl:JZ})},YX={kernelName:Sa,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;return GK(a,Al(a.shape,i,o,1,s,u),"max",n)}},QX={kernelName:Ra,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return TK(t.x,r.axis,r.keepDims,"min",n)}},JX={kernelName:Aa,backendName:"webgpu",kernelFunc:rZ({opType:fH.MIN,cpuKernelImpl:$Z})},$X=function(){function e(t,n,r){var a=this;Te(this,e),this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]})),this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=t,n.map((function(e,t){a.uniforms+=" pad".concat(t," : vec2<i32>,")})),this.offset="reflect"===r?0:1,this.shaderKey="mirrorPad_"+r}return Re(e,[{key:"getUserCode",value:function(){var e=this.xShape.length,t=this.xShape.map((function(e,t){return"uniforms.pad".concat(t,"[0]")})).join(","),n=this.xShape.map((function(t,n){return"uniforms.pad".concat(n,"[0] + uniforms.xShape").concat(e>1?"[".concat(n,"]"):"")})).join(","),r=1===e?"start":"start[i]",a=1===e?"end":"end[i]",i=1===e?"outC":"outC[i]",o=Xj(e),s=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let start = ").concat(o,"(").concat(t,");\n          let end = ").concat(o,"(").concat(n,");\n          var outC = getCoordsFromIndex(index);\n          for (var i = 0; i < ").concat(e,"; i = i + 1) {\n            if (").concat(i," < ").concat(r,") {\n              ").concat(i," = ").concat(r," * 2 - ").concat(i," - ").concat(this.offset,";\n            } else if(").concat(i," >= ").concat(a,") {\n              ").concat(i," = (").concat(a," - 1) * 2 - ").concat(i," + ").concat(this.offset,";\n            }\n          }\n          let coords = outC - start;\n          setOutputAtIndex(index, getX(").concat(s,"));\n        }\n      }\n    ")}}]),e}(),eY={kernelName:_a,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.paddings,o=n.mode,s=r,u=i.map((function(e){return{type:"int32",data:[e[0],e[1]]}})),c=new $X(a.shape,i,o);return s.runWebGPUProgram(c,[a],a.dtype,u)}},tY={kernelName:Oa,backendName:"webgpu",kernelFunc:rZ({opType:fH.MOD})},nY={kernelName:Ma,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;if(n.shouldExecuteOnCPU([r])){var a=n.tensorMap.get(r.dataId),i=tK(a.values,r.shape,r.dtype),o=(0,E.Z)(i,2),s=o[0],u=o[1];return n.makeTensorInfo(u,r.dtype,s)}var c=new tZ(r.shape,gH.NEG);return n.runWebGPUProgram(c,[r],r.dtype)}},rY={kernelName:La,backendName:"webgpu",kernelFunc:function(e){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=qf(n.readSync(a.dataId),n.readSync(i.dataId),o,s,u).selectedIndices;return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}},aY={kernelName:Ba,backendName:"webgpu",kernelFunc:function(e){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=Yf(n.readSync(a.dataId),n.readSync(i.dataId),o,s,u,c),h=l.selectedIndices,p=l.selectedScores;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},iY=function(){function e(t,n){Te(this,e),this.variableNames=["x"],this.uniforms="onValue : f32, offValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t,n],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="onehot"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if(index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          setOutputAtIndex(index, mix(uniforms.offValue, uniforms.onValue,\n                                      f32(i32(round(getX(coords.x))) == coords.y)));\n        }\n      }\n    ")}}]),e}(),oY={kernelName:Wa,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=on(a.shape),l=new iY(c,o),h=HH({inputs:{x:a},backend:n,attrs:{shape:[c]}}),p=[{type:"float32",data:[s]},{type:"float32",data:[u]}],d=n.runWebGPUProgram(l,[h],i,p);n.disposeData(h.dataId);var f=HH({inputs:{x:d},backend:n,attrs:{shape:[].concat((0,Lt.Z)(a.shape),[o])}});return n.disposeData(d.dataId),f}};function sY(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=aq({inputs:{input:r},backend:n}),i=sY({inputs:{x:a},backend:n}),o=pq({inputs:{input:r},backend:n}),s=sY({inputs:{x:o},backend:n}),u=$H({inputs:{real:i,imag:s},backend:n});return n.disposeData(a.dataId),n.disposeData(i.dataId),n.disposeData(o.dataId),n.disposeData(s.dataId),u}return GH({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var uY={kernelName:Ki,backendName:"webgpu",kernelFunc:sY},cY={kernelName:Ua,backendName:"webgpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=aq({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=pq({inputs:{input:a},backend:r}),u=sY({inputs:{x:s},backend:r}),c=$H({inputs:{real:o,imag:u},backend:r});return r.disposeData(i.dataId),r.disposeData(o.dataId),r.disposeData(s.dataId),r.disposeData(u.dataId),c}return GH({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},lY={kernelName:Va,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return oX({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){rn(a,e.shape,"All tensors passed to stack must have matching shapes"),nn(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=mq({inputs:t.map((function(e){var t=oX({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeData(e.dataId)})),s}},hY=function(){function e(t,n){var r=this;Te(this,e),this.variableNames=["x"],this.uniforms="constantValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]})),this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),n.map((function(e,t){r.uniforms+=" pad".concat(t," : vec2<i32>,")})),this.xShape=t,this.shaderKey="pad"}return Re(e,[{key:"getUserCode",value:function(){var e=this.xShape.length,t=Xj(e),n=this.xShape.map((function(e,t){return"uniforms.pad".concat(t,"[0]")})).join(","),r=this.xShape.map((function(t,n){return"uniforms.pad".concat(n,"[0] + uniforms.xShape").concat(e>1?"[".concat(n,"]"):"")})).join(","),a=e>1?"".concat(t,"(").concat(n,")"):""+n,i=e>1?"".concat(t,"(").concat(r,")"):""+r,o=e>1?"any(outC < start)":"outC < start",s=e>1?"any(outC >= end)":"outC >= end",u=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let start = ").concat(a,";\n          let end = ").concat(i,";\n          let outC = getCoordsFromIndex(index);\n\n          if (").concat(o," || ").concat(s,") {\n            setOutputAtIndex(index, uniforms.constantValue);\n          } else {\n            let coords = outC - start;\n            setOutputAtIndex(index, getX(").concat(u,"));\n          }\n        }\n      }\n    ")}}]),e}(),pY=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(i.every((function(e){return sn(e,[0,0])})))return QH({inputs:{x:a},backend:n});if(0===on(a.shape))return GH({backend:n,attrs:{shape:i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),value:o,dtype:a.dtype}});var s=[{type:"float32",data:[o]}];i.map((function(e){return s.push({type:"int32",data:[e[0],e[1]]})}));var u=new hY(a.shape,i);return n.runWebGPUProgram(u,[a],a.dtype,s)},dY={kernelName:Ga,backendName:"webgpu",kernelFunc:pY},fY={kernelName:ja,backendName:"webgpu",kernelFunc:rZ({opType:fH.POW})},mY={kernelName:Ha,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=new YH(fH.PRELU,r.shape,a.shape);return n.runWebGPUProgram(i,[r,a],"float32")}},vY={kernelName:Za,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return TK(t.x,r.axis,r.keepDims,"prod",n)}},gY={kernelName:Ya,backendName:"webgpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=aK(r,a,i,o);return t.makeTensorInfo([s.length],o,s)}},yY=rZ({opType:fH.DIV}),bY={kernelName:Br,backendName:"webgpu",kernelFunc:yY},xY={kernelName:Ja,backendName:"webgpu",kernelFunc:nZ({opType:gH.RECIPROCAL})},kY={kernelName:$a,backendName:"webgpu",kernelFunc:nZ({opType:gH.RELU})},wY={kernelName:ii,backendName:"webgpu",kernelFunc:nZ({opType:gH.RELU6})},SY=function(){function e(t,n,r){Te(this,e),this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, halfPixelCenters : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t[0],n,r,t[3]],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="resizeBilinear"}return Re(e,[{key:"getUserCode",value:function(){return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n          let b = coords[0];\n          let d = coords[3];\n          let rc = coords.yz;\n\n          let effectiveInSize = vec2<f32>(\n            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveOutSize = vec2<f32>(\n            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveInputOverOutputRatioRC =\n              effectiveInSize / effectiveOutSize;\n\n          // Fractional source index\n          let sourceFracIndexRC =\n            (vec2<f32>(rc) + vec2<f32>(uniforms.halfPixelCenters)) *\n            effectiveInputOverOutputRatioRC - vec2<f32>(uniforms.halfPixelCenters);\n\n          // Compute the four integer indices.\n          let sourceFloorRC = vec2<i32>(sourceFracIndexRC);\n          let sourceCeilRC = vec2<i32>(\n            min(vec2<f32>(uniforms.xShape.yz) - vec2<f32>(1.0), ceil(sourceFracIndexRC)));\n\n          let topLeft = getX(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          let bottomLeft = getX(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          let topRight = getX(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          let bottomRight = getX(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          let fracRC = sourceFracIndexRC - vec2<f32>(sourceFloorRC);\n\n          let top = topLeft + (topRight - topLeft) * fracRC.y;\n          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          let newValue = top + (bottom - top) * fracRC.x;\n\n          setOutputAtIndex(index, newValue);\n        }\n      }\n    ")}}]),e}(),IY={kernelName:ri,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.size,s=r.halfPixelCenters,u=(0,E.Z)(o,2),c=u[0],l=u[1],h=[{type:"float32",data:[i&&c>1?1:0,i&&l>1?1:0]},{type:"float32",data:[s?.5:0]}],p=new SY(a.shape,c,l);return n.runWebGPUProgram(p,[a],"float32",h)}},CY=function(){function e(t,n,r,a){Te(this,e),this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, roundBase : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t[0],n,r,t[3]],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.halfPixelCenters=a,this.shaderKey="resizeNearest_"+a}return Re(e,[{key:"getUserCode",value:function(){var e;return e=this.halfPixelCenters?"max((vec2<f32>(rc) + vec2<f32>(0.5)) * effectiveInputOverOutputRatioRC, vec2<f32>(0.0))":"vec2<f32>(rc) * effectiveInputOverOutputRatioRC","\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let b = coords[0];\n          let d = coords[3];\n          let rc = coords.yz;\n\n          let effectiveInSize = vec2<f32>(\n            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveOutSize = vec2<f32>(\n            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveInputOverOutputRatioRC =\n              effectiveInSize / effectiveOutSize;\n\n          // Fractional source index\n          let sourceFracIndexRC = ").concat(e,";\n\n          // Compute the coordinators of nearest neighbor point.\n          let inputShapeRC = vec2<f32>(f32(uniforms.xShape.y), f32(uniforms.xShape.z));\n          let sourceNearestRC = vec2<i32>(\n            min(inputShapeRC - 1.0, floor(sourceFracIndexRC + uniforms.roundBase)));\n          let newValue = getX(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n          setOutputAtIndex(index, newValue);\n        }\n      }\n    ")}}]),e}(),TY={kernelName:ti,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,E.Z)(s,2),c=u[0],l=u[1],h=[{type:"float32",data:[i&&c>1?1:0,i&&l>1?1:0]},{type:"float32",data:[i?.5:0]}],p=new CY(a.shape,c,l,o);return n.runWebGPUProgram(p,[a],a.dtype,h)}},NY=function(){function e(t){Te(this,e),this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=" axis : vec4<i32>,",this.shaderKey="reverse"}return Re(e,[{key:"getUserCode",value:function(){return"\n      \n      // Using uniform variables as judging conditions, so the function has\n      // coherent execution within all threads.\n      fn getReverseCoords(coords : vec4<i32>) -> vec4<i32> {\n        var reverseCoords = coords;\n        if (uniforms.axis[0] == 1) {\n          reverseCoords[0] = uniforms.xShape[0] - coords[0] - 1;\n        }\n        if (uniforms.axis[1] == 1) {\n          reverseCoords[1] = uniforms.xShape[1] - coords[1] - 1;\n        }\n        if (uniforms.axis[2] == 1) {\n          reverseCoords[2] = uniforms.xShape[2] - coords[2] - 1;\n        }\n        if (uniforms.axis[3] == 1) {\n          reverseCoords[3] = uniforms.xShape[3] - coords[3] - 1;\n        }\n\n        return reverseCoords;\n      }\n    \n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let reverseCoords = getReverseCoords(coords);\n          setOutputAtIndex(index, getX(reverseCoords[0],\n              reverseCoords[1], reverseCoords[2], reverseCoords[3]));\n        }\n      }\n    ")}}]),e}(),EY={kernelName:oi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length;if(0===o)return QH({inputs:{x:a},backend:n});var s=a.shape,u=[1,1,1,1];s.forEach((function(e,t){u[t+4-o]=e}));var c=dn(i,a.shape),l=[0,0,0,0];c.forEach((function(e){l[e+4-o]=1}));var h=[{type:"int32",data:l}],p=HH({inputs:{x:a},backend:n,attrs:{shape:u}}),d=new NY(u),f=n.runWebGPUProgram(d,[p],p.dtype,h);n.disposeData(p.dataId);var m=HH({inputs:{x:f},backend:n,attrs:{shape:s}});return n.disposeData(f.dataId),m}},RY=function(){function e(t,n){Te(this,e),this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="centerX : f32, centerY : f32, sinRadians : f32,\n          cosRadians : f32,",this.shaderKey="rotate",this.outputShape=t,"number"==typeof n?(this.uniforms+=" fillValue : f32,",this.fillSnippet="var outputValue = uniforms.fillValue;",this.shaderKey+="_float"):(this.uniforms+=" fillValue : vec3<f32>,",this.fillSnippet="var outputValue = uniforms.fillValue[coords[3]];",this.shaderKey+="_vec3")}return Re(e,[{key:"getUserCode",value:function(){return"\n        ".concat(Qj("index")," {\n          if (index < uniforms.size) {\n            let coords = getCoordsFromIndex(index);\n            let coordXFloat = (f32(coords[2]) - uniforms.centerX) *\n                uniforms.cosRadians - (f32(coords[1]) - uniforms.centerY) *\n                uniforms.sinRadians;\n            let coordYFloat = (f32(coords[2]) - uniforms.centerX) *\n                uniforms.sinRadians + (f32(coords[1]) - uniforms.centerY) *\n                uniforms.cosRadians;\n            let coordX = i32(round(coordXFloat + uniforms.centerX));\n            let coordY = i32(round(coordYFloat + uniforms.centerY));\n            ").concat(this.fillSnippet,"\n            if(coordX >= 0 && coordX < uniforms.xShape[2] && coordY >= 0 &&\n                coordY < uniforms.xShape[1]) {\n              outputValue = getX(coords[0], coordY, coordX, coords[3]);\n            }\n            setOutputAtIndex(index, outputValue);\n          }\n        }\n      ")}}]),e}(),AY={kernelName:Yi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new RY(a.shape,o),l=tv(s,a.shape[1],a.shape[2]),h=(0,E.Z)(l,2),p=[{type:"float32",data:[h[0]]},{type:"float32",data:[h[1]]},{type:"float32",data:[Math.sin(i)]},{type:"float32",data:[Math.cos(i)]}];return"number"==typeof o?p.push({type:"float32",data:[Number.parseFloat(o.toFixed(2))]}):p.push({type:"float32",data:o}),u.runWebGPUProgram(c,[a],a.dtype,p)}},_Y={kernelName:si,backendName:"webgpu",kernelFunc:nZ({opType:gH.ROUND})},OY={kernelName:ui,backendName:"webgpu",kernelFunc:nZ({opType:gH.RSQRT,cpuKernelImpl:iK})},FY=function(){function e(t,n,r,a,i,o,s){var u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];Te(this,e),this.variableNames=["updates","indices"],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=o,this.type=s,this.sumDupeIndices=u,this.dispatchLayout=hH(t),this.dispatch=uH(this.dispatchLayout,t,this.workgroupSize),this.sliceDimGreaterThanOne=n>1,this.shaderKey="scatter_".concat(r,"_").concat(a,"_").concat(this.sliceDimGreaterThanOne,"_").concat(s,"_").concat(u);var c=Xj(i.length);this.uniforms="sliceDim : i32, strides: ".concat(c,", updatesSize: i32,"),this.updatesRank=a,this.indicesRank=r}return Re(e,[{key:"getUserCode",value:function(){var e="";1===this.indicesRank?e="coords[0]":2===this.indicesRank&&(e="coords[0], j");var t="getIndices(".concat(e,")"),n=this.sliceDimGreaterThanOne?"uniforms.strides[j]":"uniforms.strides",r="",a="";1===this.dispatchLayout.x.length?(r="flattenedIndex",a="\n      fn getUpdatesCoordsFromFlatIndex(index : i32) -> i32 {\n        return index;\n      }\n      "):2===this.dispatchLayout.x.length&&(r="vec2<i32>(flattenedIndex, coords[1])",a="\n      fn getUpdatesCoordsFromFlatIndex(index : i32) -> vec2<i32> {\n        // N.B. |updates| could be a scalar tensor, conceptually representing a\n        // 2D tensor with all values equal to that. By design, its size must be\n        // the same as |outShape[1]| in one dimension, and |indicesShape[0]|\n        // gives the other.\n        let sliceSize = uniforms.outShape[1];\n        let d0 = index / sliceSize;\n        let d1 = index - d0 * sliceSize;\n        return vec2<i32>(d0, d1);\n      }\n      ");var i="getUpdates(".concat(Array.from({length:this.updatesRank},(function(e,t){return"coords[".concat(t,"]")})).join(", "),")");return"\n    ".concat(a,"\n      ").concat(Qj("index")," {\n        if (index < uniforms.updatesSize) {\n          let coords = getUpdatesCoordsFromFlatIndex(index);\n          var flattenedIndex = 0;\n          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {\n            let indexInside = i32(round(").concat(t,"));\n            flattenedIndex = flattenedIndex + indexInside * ").concat(n,";\n          }\n          let updateValue =\n              ").concat(aH(this.type,!1),"(").concat(i,");\n          let flatIndex = getOutputIndexFromCoords(").concat(r,");\n\n          ").concat(this.sumDupeIndices?qj("&result[flatIndex]","updateValue",this.type):"atomicStore(&result[flatIndex], bitcast<i32>(updateValue));","\n        }\n      }")}}]),e}(),DY={kernelName:ci,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=tf(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,p=s.outputSize,d=[p/l,l];if(0===p)return n.makeTensorInfo(o,a.dtype);var f=HH({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=HH({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),v=m.dtype,g=GH({backend:n,attrs:{shape:d,value:0,dtype:v}}),y=[{type:"int32",data:[u]},{type:"int32",data:h},{type:"int32",data:[on(m.shape)]}],b=new FY(m.shape,u,f.shape.length,m.shape.length,h,d,v),x=n.runWebGPUProgram(b,[m,f],v,y,g),k=HH({inputs:{x:x},backend:n,attrs:{shape:o}});return n.disposeData(f.dataId),n.disposeData(m.dataId),n.disposeData(x.dataId),k}},MY=function(){function e(t,n){Te(this,e),this.outputShape=[],this.variableNames=["sortedSequence","values"],this.uniforms="numInputs : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.side=n,this.shaderKey="search_sorted_"+n}return Re(e,[{key:"getUserCode",value:function(){return"\n      fn findBound(batch: i32, value: f32) -> i32 {\n        var left = i32(0);\n        var right = uniforms.numInputs;\n        while (left < right) {\n          var mid = (left + right) / 2;\n          if (getSortedSequence(batch, mid) ".concat("left"===this.side?"<":"<="," value) {\n            left = mid + 1;\n          } else {\n            right = mid;\n          }\n        }\n        return right;\n      }\n\n      ").concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let value = getValuesByOutputIndex(index);\n          setOutputAtIndexI32(index, findBound(coords[0], value));\n        }\n      }\n    ")}}]),e}(),PY={kernelName:hi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new MY([i.shape[0],i.shape[1]],o),u=[{type:"int32",data:[a.shape[1]]}];return n.runWebGPUProgram(s,[a,i],"int32",u)}},LY=function(){function e(t,n,r){Te(this,e),this.variableNames=["c","a","b"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.cRank=t,this.rank=r,this.shaderKey="select"}return Re(e,[{key:"getUserCode",value:function(){var e,t;if(this.rank>4)throw Error("Where for rank ".concat(this.rank," is not yet supported"));if(1===this.rank)t="resRC",e="resRC";else{for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=[],i=0;i<this.outputShape.length;i++)a.push(""+n[i]),i<this.cRank&&r.push(""+n[i]);e=r.join(),t=a.join()}return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let resRC = getCoordsFromIndex(index);\n          let cVal = getC(").concat(e,");\n          if (cVal >= 1.0) {\n            setOutputAtIndex(index, getA(").concat(t,"));\n          } else {\n            setOutputAtIndex(index, getB(").concat(t,"));\n          }\n        }\n      }\n    ")}}]),e}(),zY={kernelName:pi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new LY(r.shape.length,a.shape,a.shape.length);return n.runWebGPUProgram(o,[r,a,i],ss(a.dtype,i.dtype))}},BY={kernelName:di,backendName:"webgpu",kernelFunc:nZ({opType:gH.SELU})},UY={kernelName:yi,backendName:"webgpu",kernelFunc:nZ({opType:gH.SIGMOID})},WY={kernelName:gi,backendName:"webgpu",kernelFunc:nZ({opType:gH.SIGN})},VY={kernelName:mi,backendName:"webgpu",kernelFunc:nZ({opType:gH.SIN})},GY={kernelName:vi,backendName:"webgpu",kernelFunc:nZ({opType:gH.SINH})},jY=rZ({opType:fH.SUB,cpuKernelImpl:hK,supportsComplex:!0}),HY={kernelName:Li,backendName:"webgpu",kernelFunc:jY},ZY={kernelName:Ii,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=dn([r.dim],a.shape),o=BK({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=Uh(o.shape,i),u=HH({inputs:{x:o},backend:n,attrs:{shape:s}}),c=jY({inputs:{a:a,b:u},backend:n}),l=aX({inputs:{x:c},backend:n}),h=Jq({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),p=HH({inputs:{x:h},backend:n,attrs:{shape:s}}),d=yY({inputs:{a:l,b:p},backend:n});return n.disposeData(o.dataId),n.disposeData(u.dataId),n.disposeData(c.dataId),n.disposeData(l.dataId),n.disposeData(h.dataId),n.disposeData(p.dataId),d}},KY={kernelName:bi,backendName:"webgpu",kernelFunc:nZ({opType:gH.SOFTPLUS})},qY={kernelName:wi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;nn(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGPU backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,(0,Lt.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],h=pY({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=nv(h.shape,i,s,!1),d=rv(p.length,i.length,!1),f=av(h.shape,i,s,!1),m=HH({inputs:{x:h},backend:n,attrs:{shape:p}}),v=SK({inputs:{x:m},backend:n,attrs:{perm:d}}),g=HH({inputs:{x:v},backend:n,attrs:{shape:f}});return l.push(h),l.push(m),l.push(v),l.forEach((function(e){return n.disposeData(e.dataId)})),g}},XY=function(){function e(t,n){Te(this,e),this.variableNames=["A"],this.workgroupSize=[64,1,1],this.size=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.rank=this.outputShape.length,this.shaderKey="tile"}return Re(e,[{key:"getUserCode",value:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e>=5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(1===e)return"(resRC % ".concat(t,"aShape)");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e;a++)r.push("(".concat(n[a]," % ").concat(t,"aShape[").concat(a,"])"));return r.join()}(this.rank,"uniforms.");return"\n      ".concat(Qj("index")," {\n        if (index < uniforms.size) {\n          let resRC = getCoordsFromIndex(index);\n          setOutputAtIndex(index, getA(").concat(e,"));\n        }\n      }\n    ")}}]),e}();function YY(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if(n.shouldExecuteOnCPU([a])||"string"===a.dtype||a.shape.length>=5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Ro(e)})):o,u=ju(a.shape,a.dtype,s),c=pK(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new XY(a.shape,i);return n.runWebGPUProgram(l,[a],a.dtype)}var QY={kernelName:Ui,backendName:"webgpu",kernelFunc:YY},JY={kernelName:Ri,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=tf(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.sliceSize,p=u.strides,d=u.outputSize;if("string"===i.dtype){var f=n.bufferSync(a),m=n.bufferSync(i),v=Ro(n.readSync(o.dataId)[0]),g=oK(f,m,s,d,h,l,c,p,v,!1);return n.makeTensorInfo(s,g.dtype,g.values)}var y=[d/h,h],b=HH({inputs:{x:a},backend:n,attrs:{shape:[l,c]}}),x=i.shape.length?HH({inputs:{x:i},backend:n,attrs:{shape:[l,h]}}):QH({inputs:{x:i},backend:n}),k=x.dtype,w=n.makeTensorInfo([],k,Rn(1,k)),S=HH({inputs:{x:o},backend:n,attrs:{shape:Array(y.length).fill(1)}}),I=YY({inputs:{x:S},backend:n,attrs:{reps:y}}),C=[{type:"int32",data:[c]},{type:"int32",data:p},{type:"int32",data:[on([l,h])]}];switch(l){case 0:break;case 1:var T=new FY([l,h],c,b.shape.length,x.shape.length,p,y,k,!1);n.runWebGPUProgram(T,[x,b],k,C,I);break;default:var N=new FY([l,h],c,b.shape.length,w.shape.length,p,y,k,!1);n.runWebGPUProgram(N,[w,b],k,C,I);var E=new FY([l,h],c,b.shape.length,x.shape.length,p,y,k);n.runWebGPUProgram(E,[x,b],k,C,I)}var R=HH({inputs:{x:I},backend:n,attrs:{shape:s}});return n.disposeData(b.dataId),n.disposeData(x.dataId),n.disposeData(S.dataId),n.disposeData(w.dataId),n.disposeData(I.dataId),R}},$Y={kernelName:Si,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=dn(r.axis,a.shape)[0],s=Av(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=(0,Lt.Z)(l);t[o]=e;var r=YK({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},eQ={kernelName:xi,backendName:"webgpu",kernelFunc:nZ({opType:gH.SQRT})},tQ={kernelName:_i,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,i=new tZ(r.shape,gH.SQUARE);return a.runWebGPUProgram(i,[r],r.dtype)}},nQ={kernelName:Ai,backendName:"webgpu",kernelFunc:rZ({opType:fH.SQUARED_DIFFERENCE})},rQ={kernelName:qi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=new tZ(a.shape,gH.STEP,"stepAlpha : f32,"),o=[{type:"float32",data:[n.alpha]}];return r.runWebGPUProgram(i,[a],a.dtype,o)}},aQ=function(){function e(t){Te(this,e),this.variableNames=["x"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]);var n=Xj(this.outputShape.length);this.uniforms="begin : ".concat(n,",  strides : ").concat(n,", "),this.shaderKey="stridedSlice"}return Re(e,[{key:"getUserCode",value:function(){var e=this,t="";if(1===this.outputShape.length)t="coords * uniforms.strides + uniforms.begin";else{var n=0;t=this.outputShape.map((function(t,r){return n++,1===e.outputShape.length?"coords * uniforms.strides[".concat(r,"] + uniforms.begin[").concat(r,"]"):"coords[".concat(n-1,"] * uniforms.strides[").concat(r,"] + uniforms.begin[").concat(r,"]")})).join(",")}return"\n       ".concat(Qj("index")," {\n         if (index < uniforms.size) {\n           let coords = getCoordsFromIndex(index);\n           setOutputAtIndex(index, getX(").concat(t,"));\n         }\n       }\n     ")}}]),e}(),iQ={kernelName:Fi,backendName:"webgpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,h=a.ellipsisMask,p=a.newAxisMask,d=a.shrinkAxisMask,f=ml(i.shape,o,s,u,c,l,h,p,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=HH({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){nn(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: "+i.shape.length}));var S=hl(x,k,w),I=YK({inputs:{x:i},backend:r,attrs:{begin:x,size:S}});t=HH({inputs:{x:I},backend:r,attrs:{shape:v}}),r.disposeData(I.dataId)}else if(r.shouldExecuteOnCPU([i])){var C=r.readSync(i.dataId),T=ju(i.shape,i.dtype,C),N=cK(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,N.values)}else{var E=new aQ(m),R=[{type:"int32",data:x},{type:"int32",data:w}],A=r.runWebGPUProgram(E,[i],i.dtype,R);t=HH({inputs:{x:A},backend:r,attrs:{shape:v}}),r.disposeData(A.dataId)}return t}},oQ={kernelName:Di,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,h=t.dataSplits,p=n.readSync(l.dataId),d=n.readSync(h.dataId),f=lK(p,d,a,i,o,s,u,c),m=(0,E.Z)(f,2),v=m[0],g=m[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(h.shape,"int32",g)]}},sQ={kernelName:zi,backendName:"webgpu",kernelFunc:nZ({opType:gH.TAN})},uQ={kernelName:Bi,backendName:"webgpu",kernelFunc:nZ({opType:gH.TANH})},cQ=function(){function e(t){Te(this,e),this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, negativeInf : f32,\n        dir : i32, inc : i32,",this.shaderKey="swap"}return Re(e,[{key:"getUserCode",value:function(){return"\n        ".concat(Qj("index")," {\n          if (index < uniforms.size) {\n            let outC = getCoordsFromIndex(index);\n            let batch = outC[0];\n            let elemIdx = outC[1];\n            // We compare elements pair-wise within a group of size 2 * inc.\n            // The comparing rule for each group alternates between ascending\n            // and descending. Within each group, we compare each pair at\n            // positions i and i+inc. To decide whether an element at position i\n            // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n            // inc, it is in the first half of the group, we denote it as x0,\n            // otherwise we denote it as x1.\n            // For example, as shown in the Bitonic top K paper referenced\n            // above, Figure5(a) shows that element[1] is in the second half of\n            // the group when group size is 2, but it is in the first half of\n            // the group when group size is 4.\n            let isFirstInPair = elemIdx % (2 * uniforms.inc) < uniforms.inc;\n            var i = 0;\n            if (isFirstInPair) {\n              i = elemIdx;\n            } else {\n              i = elemIdx - uniforms.inc;\n            }\n\n            var i0 = 0;\n            if (uniforms.firstPass == 1) {\n              i0 = i;\n            } else {\n              i0 = i32(getIndices(batch, i));\n            }\n\n            var i1 = 0;\n            if (uniforms.firstPass == 1) {\n              i1 = i + uniforms.inc;\n            } else {\n              i1 = i32(getIndices(batch, i + uniforms.inc));\n            }\n\n            var x0 = f32(0.0);\n            var x1 = f32(0.0);\n            if (i0 < uniforms.inputSize) {\n              x0 = getX(batch, i0);\n            } else {\n              x0 = uniforms.negativeInf;\n            }\n            if (i1 < uniforms.inputSize) {\n              x1 = getX(batch, i1);\n            } else {\n              x1 = uniforms.negativeInf;\n            }\n\n            let reverse = elemIdx % (2 * uniforms.dir) >= uniforms.dir;\n            let isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n            if (reverse == isGreater) {\n              // Elements in opposite order of direction\n              let iTemp = i0;\n              i0 = i1;\n              i1 = iTemp;\n            }\n            if (isFirstInPair) {\n              setOutputAtIndex(index, f32(i0));\n            } else {\n              setOutputAtIndex(index, f32(i1));\n            }\n          }\n        }\n      ")}}]),e}(),lQ=function(){function e(t){Te(this,e),this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, k : i32,",this.shaderKey="merge"}return Re(e,[{key:"getUserCode",value:function(){return"\n        ".concat(Qj("index")," {\n          if (index < uniforms.size) {\n            let outC = getCoordsFromIndex(index);\n            let batch = outC[0];\n            let elemIdx = outC[1];\n            // The output size is half of the previous size.\n            // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _\n            // (k=4), we only need to output the indices at positions |, the\n            // indices at positions _ can be thrown away, see Figure5(b) After\n            // Phase 2 (Merge phase) in the Bitonic Top K paper referenced\n            // above.\n            // For example, the paper shows we only need to output the orange\n            // bars. The output sequence should look like this | | | | | | | |.\n            // Because the sequence is halved, to map the output index back to\n            // the previous sequence to find the corresponding value, we need\n            // to double the index. When we double the index, we basically\n            // interpolate a position, so 2i looks like\n            // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k\n            // position of each 2k positions by - elemIdx % k. E.g. for output\n            // at index 4,5,6,7, we want to get the corresponding element at\n            // original index 8,9,10,11, for output at index 8,9,10,11,\n            // we want to get the corresponding element at original index\n            // 16,17,18,19, so on and so forth.\n\n            var i = 0;\n            if (elemIdx < uniforms.k) {\n              i = elemIdx;\n            } else {\n              i = elemIdx * 2 - elemIdx % uniforms.k;\n            }\n            var i0 = 0;\n            if (uniforms.firstPass == 1) {\n              i0 = i;\n            } else {\n              i0 = i32(getIndices(batch, i));\n            }\n            var i1 = 0;\n            if (uniforms.firstPass == 1) {\n              i1 = i + uniforms.k;\n            } else {\n              i1 = i32(getIndices(batch, i + uniforms.k));\n            }\n\n            let x0 = getX(batch, i0);\n            var x1 = f32(0.0);\n            if (i1 < uniforms.inputSize) {\n              x1 = getX(batch, i1);\n            } else {\n              x1 = x0;\n            }\n\n            if (x0 >= x1) {\n              setOutputAtIndex(index, f32(i0));\n            } else {\n              setOutputAtIndex(index, f32(i1));\n            }\n          }\n        }\n      ")}}]),e}();function hQ(e,t){null!==t&&e.disposeData(t.dataId)}function pQ(e){for(var t=1;t<e;)t*=2;return t}for(var dQ={kernelName:Wi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=a.shape,u=s[s.length-1];if(n.shouldExecuteOnCPU([a])){var c=n.readSync(a.dataId),l=dK(c,s,a.dtype,i,o),h=(0,E.Z)(l,2),p=h[0],d=h[1];return[n.makeTensorInfo(p.shape,p.dtype,p.values),n.makeTensorInfo(d.shape,d.dtype,d.values)]}if(0===i)return s[s.length-1]=0,[n.makeTensorInfo(s,a.dtype,[]),n.makeTensorInfo(s,"int32",[])];if(1===u)return[a,GH({attrs:{shape:s,dtype:"int32",value:0},backend:n})];for(var f=on(s)/u,m=HH({inputs:{x:a},attrs:{shape:[f,u]},backend:n}),v=pQ(i),g=pQ(u),y=null,b=function(){return null===y?[m,m]:[m,y]},x=function(e,t,r){var a=b(),i=new cQ(r),o=[{type:"int32",data:[u]},{type:"int32",data:[null===y?1:0]},{type:"float32",data:[Number.NEGATIVE_INFINITY]},{type:"int32",data:[e]},{type:"int32",data:[t]}],s=y;y=n.runWebGPUProgram(i,a,"int32",o),hQ(n,s)},k=1;k<v;k*=2)for(var w=2*k,S=k;S>=1;S/=2)x(w,S,[f,g]);for(var I=g;I>v;I/=2){var C=b(),T=new lQ([f,I/2]),N=[{type:"int32",data:[u]},{type:"int32",data:[null===y?1:0]},{type:"int32",data:[v]}],R=y;y=n.runWebGPUProgram(T,C,"int32",N),hQ(n,R);for(var A=v/2,_=2*A,O=A;O>=1;O/=2)x(_,O,y.shape)}var F=y;y=YK({inputs:{x:y},backend:n,attrs:{begin:0,size:[f,i]}}),hQ(n,F);var D=NX({inputs:{x:m,indices:y},backend:n,attrs:{axis:1,batchDims:1}});hQ(n,m);var M=s.slice(0,-1);M.push(i),F=y,y=HH({inputs:{x:y},attrs:{shape:M},backend:n}),hQ(n,F);var P=D;return D=HH({inputs:{x:D},attrs:{shape:M},backend:n}),hQ(n,P),[D,y]}},fQ=function(){function e(t){Te(this,e),this.variableNames=["Image","Transforms"],this.uniforms="interpolationModeId : i32, fillModeId : i32, fillValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="transform"}return Re(e,[{key:"getUserCode",value:function(){return"\n          fn mapCoord(outCoord : f32, len : f32) -> f32{\n            var inCoord = outCoord;\n            if(uniforms.fillModeId == 2) {\n              if (inCoord < 0.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz2 = 2.0 * len;\n                  if (inCoord < sz2) {\n                    inCoord = sz2 * f32(i32(f32(-inCoord / sz2))) +\n                    inCoord;\n                  }\n                  if (inCoord < -len) {\n                    inCoord = inCoord + sz2;\n                  } else {\n                    inCoord = -inCoord - 1.0;\n                  }\n                }\n              } else if (inCoord > len - 1.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz2 = 2.0 * len;\n                  inCoord = inCoord - sz2 * f32(i32(f32(inCoord / sz2)));\n                  if (inCoord >= len) {\n                    inCoord = sz2 - inCoord - 1.0;\n                  }\n                }\n              }\n              return clamp(inCoord, 0.0, len - 1.0);\n            } else if (uniforms.fillModeId == 3) {\n              if (inCoord < 0.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz = len - 1.0;\n                  inCoord = inCoord + len * (f32(i32(f32(-inCoord / sz))) + 1.0);\n                }\n              } else if (inCoord > len - 1.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz = len - 1.0;\n                  inCoord = inCoord - len * f32(i32(f32(inCoord / sz)));\n                }\n              }\n              return clamp(inCoord, 0.0, len - 1.0);\n            } else if (uniforms.fillModeId == 4) {\n              return clamp(outCoord, 0.0, len - 1.0);\n            }\n            return outCoord;\n          }\n          fn readWithFillValue(batch : i32, coordY : i32, coordX : i32,\n            channel : i32) -> f32 {\n            var outputValue : f32;\n            if (0 <= coordY && coordY < uniforms.imageShape[1] && 0 <= coordX && coordX < uniforms.imageShape[2]) {\n                outputValue = getImage(batch, coordY, coordX, channel);\n            } else {\n              outputValue = uniforms.fillValue;\n            }\n            return outputValue;\n          }\n\n          ".concat(Qj("index")," {\n            if (index < uniforms.size) {\n              let coords = getCoordsFromIndex(index);\n              var outputValue : f32;\n              let batch = coords[0];\n              let x = coords[2];\n              let y = coords[1];\n              let channel = coords[3];\n              let xf = f32(x);\n              let yf = f32(y);\n              let a1 = getTransforms(batch, 0);\n              let a2 = getTransforms(batch, 1);\n              let a3 = getTransforms(batch, 2);\n              let b1 = getTransforms(batch, 3);\n              let b2 = getTransforms(batch, 4);\n              let b3 = getTransforms(batch, 5);\n              let c1 = getTransforms(batch, 6);\n              let c2 = getTransforms(batch, 7);\n              let projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = uniforms.fillValue;\n              } else {\n                let inX = (a1 * xf + a2 * yf + a3) / projection;\n                let inY = (b1 * xf + b2 * yf + b3) / projection;\n                let mapX = mapCoord(inX, f32(uniforms.imageShape[2]));\n                let mapY = mapCoord(inY, f32(uniforms.imageShape[1]));\n\n                if (uniforms.interpolationModeId == 1) {\n                  let coordY = i32(round(mapY));\n                  let coordX = i32(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  let yFloor = floor(mapY);\n                  let xFloor = floor(mapX);\n                  let yCeil = yFloor + 1.0;\n                  let xCeil = xFloor + 1.0;\n                  let valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, i32(yFloor), i32(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, i32(yFloor), i32(xCeil), channel);\n                  let valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, i32(yCeil), i32(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, i32(yCeil), i32(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutputAtIndex(index, outputValue);\n            }\n          }\n        ")}}]),e}(),mQ=[qH,mK,vK,gK,yK,xK,NK,EK,AK,_K,OK,FK,DK,MK,PK,jK,ZK,KK,JK,tq,oq,sq,lq,eZ,vq,Sq,Tq,Eq,Rq,Aq,Oq,Lq,zq,Bq,Wq,Hq,Kq,Xq,eX,tX,nX,rX,iX,sX,uX,pX,jH,fX,yX,mX,vX,kX,wX,SX,CX,EX,RX,AX,JH,_X,dq,OX,FX,DX,MX,PX,LX,BX,WX,UX,VX,GX,jX,qX,UK,XX,YX,VK,QX,JX,eY,tY,Qq,nY,rY,aY,rq,oY,cY,lY,dY,fY,mY,vY,gY,iq,bY,xY,kY,wY,ZH,IY,TY,EY,AY,_Y,OY,DY,PY,zY,BY,UY,WY,VY,GY,QK,rQ,iQ,oQ,ZY,KY,qY,JY,$Y,eQ,tQ,nQ,HY,$q,sQ,uQ,QY,dQ,{kernelName:Vi,backendName:"webgpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.image,o=n.transforms,s=a.interpolation,u=a.fillMode,c=a.fillValue,l=a.outputShape,h=(0,E.Z)(i.shape,4),p=h[0],d=h[1],f=h[2],m=h[3],v=null!=l?l:[d,f],g=(0,E.Z)(v,2),y=g[0],b=g[1],x=new fQ([p,y,b,m]),k="nearest"===s?1:2;switch(u){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}var w=[{type:"int32",data:[k]},{type:"int32",data:[t]},{type:"float32",data:[c]}];return r.runWebGPUProgram(x,[i,o],"float32",w)}},IK,{kernelName:Hi,backendName:"webgpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var p=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){d[i]=v;var g=YK({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=HH({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,p.push(g)}return p.forEach((function(e){return n.disposeData(e.dataId)})),m}},uY],vQ=0,gQ=mQ;vQ<gQ.length;vQ++){oo(gQ[vQ])}function yQ(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];switch(t.length){case 0:e="fn main() ";break;case 1:e="fn main(".concat(t[0]," : i32)");break;default:throw Error("Unreachable")}return e}var bQ=function(){function e(e){this.variableNames=["A","B"],this.size=!0,this.workgroupSize=[32,1,1],this.outputShape=[e[0],1],this.dispatchLayout=hH(this.outputShape),this.dispatch=uH(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="getpointsConfidenceOp"}return e.prototype.getUserCode=function(){return"\n        ".concat(yQ("index")," {\n          if (index < uniforms.size) {\n            let y = B[index * 2];\n            let x = B[index * 2 + 1];\n            let outIndex = y * uniforms.aShape.x * uniforms.aShape.z + x * uniforms.aShape.z + index;\n            result[index] = A[outIndex];\n          }\n        }\n        ")},e}();var xQ=function(){function e(e){if(this.variableNames=["A","B"],this.size=!0,this.supportedLastDimension=2,2!==e.length||e[1]!==this.supportedLastDimension)throw new Error("GetOffsetVectorsProgram only supports shape of [x, ".concat(this.supportedLastDimension,"], but current shape is ").concat(e));this.workgroupSize=[32,1,1],this.outputShape=e;var t=[e[0],1];this.dispatchLayout=hH(t),this.dispatch=uH(this.dispatchLayout,t,this.workgroupSize),this.shaderKey="GetOffsetVectors"}return e.prototype.getUserCode=function(){return"\n    fn getOffsetPoint(y: i32, x: i32, index: i32) -> vec2<i32> {\n      let outIndexY = y * uniforms.bShape.x * uniforms.bShape.y + x * uniforms.bShape.y + index;\n      let outIndexX = outIndexY + uniforms.bShape.z;\n      let outY = i32(B[outIndexY]);\n      let outX = i32(B[outIndexX]);\n      return vec2<i32>(outY, outX);\n    }\n\n    ".concat(yQ("index")," {\n      if (index < uniforms.size) {\n        let indexY = index * ").concat(this.supportedLastDimension,";\n        let indexX = indexY + 1;\n        let heatmapY = A[indexY];\n        let heatmapX = A[indexX];\n        let out = getOffsetPoint(i32(heatmapY), i32(heatmapX), index);\n        result[indexY] = f32(out[0]);\n        result[indexX] = f32(out[1]);\n      }\n    }\n    ")},e}();function kQ(e){var t=e.shape,n=t[0],r=t[1],a=t[2];return Yu((function(){var t,i,o=jl(e,[n*r,a]),s=wl(o,0),u=Jh(ac(s,lc(r,"int32")),1),c=Jh((t=s,i=r,Yu((function(){var e=ac(t,lc(i,"int32"));return bc(t,ic(e,lc(i,"int32")))}))),1);return Kl([u,c],1)}))}function wQ(e,t,n){return Yu((function(){var r=function(e,t){for(var n=[],r=0;r<MV.length;r++){var a=SQ(e.get(r,0).valueOf(),e.get(r,1).valueOf(),r,t),i=a.x,o=a.y;n.push(o),n.push(i)}return Yd(n,[MV.length,2])}(e,n);return nc(Hu(ic(e.toTensor(),lc(t,"int32")),"float32"),r)}))}function SQ(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+MV.length)}}function IQ(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i,o,s,u,c,l,h,p;return FV(this,(function(d){switch(d.label){case 0:return r=0,a=kQ(e),[4,Promise.all([e.buffer(),t.buffer(),a.buffer()])];case 1:return i=d.sent(),o=i[0],s=i[1],u=i[2],[4,(c=wQ(u,n,s)).buffer()];case 2:return l=d.sent(),h=Array.from(function(e,t){for(var n=t.shape[0],r=new Float32Array(n),a=0;a<n;a++){var i=t.get(a,0),o=t.get(a,1);r[a]=e.get(i,o,a)}return r}(o,u)),p=h.map((function(e,t){return r+=e,{y:l.get(t,0),x:l.get(t,1),score:e,name:MV[t]}})),a.dispose(),c.dispose(),[2,{keypoints:p,score:r/p.length}]}}))}))}function CQ(e,t,n){return OV(this,void 0,void 0,(function(){var r,a,i;return FV(this,(function(o){return r=kQ(e),a=function(e,t,n){return Yu((function(){var r=function(e,t){if(tc()instanceof vH)return function(e,t){var n=tc(),r=new xQ(e.shape),a=n.runWebGPUProgram(r,[e,t],"float32");return qu().makeTensorFromTensorInfo(a)}(e,t);throw new Error("getOffsetVectorsGPU is not supported in this backend!")}(e,n);return nc(Hu(ic(e,lc(t,"int32")),"float32"),r)}))}(r,n,t),i=function(e,t){if(tc()instanceof vH)return function(e,t){var n=tc(),r=new bQ(t.shape),a=n.runWebGPUProgram(r,[e,t],"float32");return qu().makeTensorFromTensorInfo(a)}(e,t);throw new Error("getPointsConfidenceWebGPU is not supported in this backend!")}(e,r),[2,[a,i]]}))}))}function TQ(e,t){return(e-1)%t==0}var NQ="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",EQ="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function RQ(e,t){return function(e,t){return(e-1)%t==0}(e,t)?e:Math.floor(e/t)*t+1}var AQ=function(){function e(e,t){this.posenetModel=e;var n=this.posenetModel.inputs[0].shape;nn(-1===n[1]&&-1===n[2],(function(){return"Input shape [".concat(n[1],", ").concat(n[2],"] ")+"must both be equal to or -1"}));var r,a,i=(r=t.inputResolution,a=t.outputStride,{height:RQ(r.height,a),width:RQ(r.width,a)});!function(e){nn(vj.indexOf(e)>=0,(function(){return"outputStride of ".concat(e," is invalid. ")+"It must be either 8 or 16."}))}(t.outputStride),function(e,t){nn(TQ(e.height,t),(function(){return"height of ".concat(e.height," is invalid for output stride ")+"".concat(t,".")})),nn(TQ(e.width,t),(function(){return"width of ".concat(e.width," is invalid for output stride ")+"".concat(t,".")}))}(i,t.outputStride),this.inputResolution=i,this.outputStride=t.outputStride,this.architecture=t.architecture}return e.prototype.estimatePoses=function(e,t){return void 0===t&&(t=bj),OV(this,void 0,void 0,(function(){return FV(this,(function(n){return[2,this.estimatePosesGPU(e,t,!1)]}))}))},e.prototype.estimatePosesGPU=function(e,t,n){return void 0===t&&(t=bj),void 0===n&&(n=!1),OV(this,void 0,void 0,(function(){var r,a,i,o,s,u,c,l,h,p,d,f,m,v,g,y,b,x;return FV(this,(function(k){switch(k.label){case 0:return r=function(e){var t=e;if(null==t.maxPoses&&(t.maxPoses=1),t.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(t.maxPoses,". Should be > 0."));if(t.maxPoses>1){if((t=_V(_V({},xj),t)).scoreThreshold<0||t.scoreThreshold>1)throw new Error("Invalid scoreThreshold ".concat(t.scoreThreshold,". ")+"Should be in range [0.0, 1.0]");if(t.nmsRadius<=0)throw new Error("Invalid nmsRadius ".concat(t.nmsRadius,"."))}return t}(t),null==e?[2,n?[[],[]]:[]]:(this.maxPoses=r.maxPoses,a=uG(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),i=a.imageTensor,o=a.padding,s="ResNet50"===this.architecture?nc(i,kj):sG(i,[-1,1]),u=this.posenetModel.predict(s),"ResNet50"===this.architecture?(c=jd(u[2],[0]),l=jd(u[3],[0]),h=jd(u[0],[0]),p=jd(u[1],[0])):(c=jd(u[0],[0]),l=jd(u[1],[0]),h=jd(u[2],[0]),p=jd(u[3],[0])),d=Xl(l),1!==this.maxPoses?[3,5]:n?[4,CQ(d,c,this.outputStride)]:[3,2]);case 1:return m=k.sent(),g=m[0],v=m[1],f=[g,v],[3,4];case 2:return[4,IQ(d,c,this.outputStride)];case 3:g=k.sent(),f=[g],k.label=4;case 4:return[3,7];case 5:if(n)throw new Error("GPU renderer only supports single pose!");return[4,Bj(d,c,h,p,this.outputStride,this.maxPoses,r.scoreThreshold,r.nmsRadius)];case 6:f=k.sent(),k.label=7;case 7:if(n){if(!0===r.flipHorizontal)throw new Error("flipHorizontal is not supported!");y=this.getCanvasInfo(QV(e),this.inputResolution,o)}else x=QV(e),b=function(e,t,n,r){var a=t.height,i=t.width,o=a/(n.height*(1-r.top-r.bottom)),s=i/(n.width*(1-r.left-r.right)),u=-r.top*n.height,c=-r.left*n.width;if(1===s&&1===o&&0===u&&0===c)return e;for(var l=0,h=e;l<h.length;l++)for(var p=0,d=h[l].keypoints;p<d.length;p++){var f=d[p];f.x=(f.x+c)*s,f.y=(f.y+u)*o}return e}(f,x,this.inputResolution,o),r.flipHorizontal&&(b=function(e,t){for(var n=0,r=e;n<r.length;n++)for(var a=0,i=r[n].keypoints;a<i.length;a++){var o=i[a];o.x=t.width-1-o.x}return e}(b,x));return i.dispose(),s.dispose(),Qu(u),c.dispose(),l.dispose(),h.dispose(),p.dispose(),d.dispose(),[2,n?[f,y]:b]}}))}))},e.prototype.getCanvasInfo=function(e,t,n){var r=e.height,a=e.width,i=r/(t.height*(1-n.top-n.bottom)),o=a/(t.width*(1-n.left-n.right)),s=-n.top*t.height;return[-n.left*t.width,s,o,i,e.width,e.height]},e.prototype.dispose=function(){this.posenetModel.dispose()},e.prototype.reset=function(){},e}();function _Q(e){return void 0===e&&(e=dj),OV(this,void 0,void 0,(function(){var t,n,r,a,i;return FV(this,(function(o){switch(o.label){case 0:return"ResNet50"!==(t=function(e){var t=e||dj;if(null==t.architecture&&(t.architecture="MobileNetV1"),fj.indexOf(t.architecture)<0)throw new Error("Invalid architecture ".concat(t.architecture,". ")+"Should be one of ".concat(fj));if(null==t.inputResolution&&(t.inputResolution={height:257,width:257}),null==t.outputStride&&(t.outputStride=16),mj[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride ".concat(t.outputStride,". ")+"Should be one of ".concat(mj[t.architecture]," ")+"for architecture ".concat(t.architecture,"."));if(null==t.multiplier&&(t.multiplier=1),gj[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier ".concat(t.multiplier,". ")+"Should be one of ".concat(gj[t.architecture]," ")+"for architecture ".concat(t.architecture,"."));if(null==t.quantBytes&&(t.quantBytes=4),yj.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes ".concat(t.quantBytes,". ")+"Should be one of ".concat(yj," ")+"for architecture ".concat(t.architecture,"."));if("MobileNetV1"===t.architecture&&32===t.outputStride&&1!==t.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return t}(e)).architecture?[3,2]:(s=t.outputStride,u=t.quantBytes,c="model-stride".concat(s,".json"),n=4===u?EQ+"float/"+c:EQ+"quant".concat(u,"/")+c,[4,FC(t.modelUrl||n)]);case 1:return r=o.sent(),[2,new AQ(r,t)];case 2:return a=function(e,t,n){var r={1:"100",.75:"075",.5:"050"},a="model-stride".concat(e,".json");return 4===n?NQ+"float/".concat(r[t],"/")+a:NQ+"quant".concat(n,"/").concat(r[t],"/")+a}(t.outputStride,t.multiplier,t.quantBytes),[4,FC(t.modelUrl||a)];case 3:return i=o.sent(),[2,new AQ(i,t)]}var s,u,c}))}))}function OQ(e,t){return OV(this,void 0,void 0,(function(){var n,r;return FV(this,(function(a){switch(e){case QG.PoseNet:return[2,_Q(t)];case QG.BlazePose:if(r=void 0,null!=(n=t)){if("tfjs"===n.runtime)return[2,XG(t)];if("mediapipe"===n.runtime)return[2,YV(t)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(r));case QG.MoveNet:return[2,pj(t)];default:throw new Error("".concat(e," is not a supported model name."))}}))}))}var FQ={left_shoulder:5,right_shoulder:6,left_elbow:7,right_elbow:8,left_wrist:9,right_wrist:10,left_hip:11,right_hip:12,left_knee:13,right_knee:14,left_ankle:15,right_ankle:16};function DQ(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"red";e.beginPath(),e.arc(n,r,a,0,2*Math.PI),e.fillStyle=i,e.fill()}function MQ(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=Kt(e.slice(5));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(!(o.score<n)){var s=640-o.x,u=o.y;DQ(r,o.score.toFixed(2),s*a,u*a,10,"red")}}}catch($Q){i.e($Q)}finally{i.f()}}function PQ(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.3,a=arguments.length>4?arguments[4]:void 0,i=t.x,o=t.y,s=t.score,u=n.x,c=n.y,l=n.score;s>r&&l>r&&(e.strokeStyle=a,e.beginPath(),e.moveTo(640-i,o),e.lineTo(640-u,c),e.lineWidth=5,e.stroke())}function LQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3,r=arguments.length>3?arguments[3]:void 0;PQ(t,e[FQ.left_shoulder],e[FQ.left_elbow],n,r),PQ(t,e[FQ.left_wrist],e[FQ.left_elbow],n,r),PQ(t,e[FQ.left_shoulder],e[FQ.left_hip],n,r),PQ(t,e[FQ.left_hip],e[FQ.left_knee],n,r),PQ(t,e[FQ.left_knee],e[FQ.left_ankle],n,r),PQ(t,e[FQ.right_shoulder],e[FQ.right_elbow],n,r),PQ(t,e[FQ.right_wrist],e[FQ.right_elbow],n,r),PQ(t,e[FQ.right_shoulder],e[FQ.right_hip],n,r),PQ(t,e[FQ.right_hip],e[FQ.right_knee],n,r),PQ(t,e[FQ.right_knee],e[FQ.right_ankle],n,r)}function zQ(e){for(var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,a=5;a<17;a++)a%2===0?t+=e[a].score:n+=e[a].score;var i=t>n?1:0,o=e[FQ.left_ankle+i].score,s=e[FQ.left_knee+i].score,u=e[FQ.left_hip+i].score,c=e[FQ.left_shoulder+i].score;return o<=r||s<=r||u<=r||c<=r?{far:!1}:{right:i,far:!0}}function BQ(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function UQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=function(e,t,n){var r=BQ(e,t),a=BQ(t,n),i=BQ(e,n);return Math.round(180*Math.acos((r*r+a*a-i*i)/(2*r*a))/3.1415)}(e[FQ.left_wrist+r],e[FQ.left_elbow+r],e[FQ.left_shoulder]);return t-n<=a&&a<=t+n}function WQ(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e[FQ.left_ankle+n],a=r.x,i=r.y,o=e[FQ.left_knee+n],s=o.x,u=o.y,c=e[FQ.left_hip+n],l=c.x,h=c.y,p=e[FQ.left_shoulder+n],d=p.x,f=(u-i)/(s-a),m=(h-u)/(l-s),v=(p.y-h)/(d-l),g=Math.abs(f-m),y=Math.abs(m-v);return g<=t&&y<=t}var VQ=n(2025);function GQ(e){var t=(0,S.useState)(""),n=(0,E.Z)(t,2),r=n[0],a=n[1],i=(0,S.useContext)(Dt).authState,o=(0,VQ.k6)();return(0,j.jsx)("div",{className:"postPage",children:(0,j.jsxs)("div",{className:"containerInput",children:[(0,j.jsx)("h1",{className:"pushup-count",children:e.pushups}),(0,j.jsx)("input",{style:{height:"200px",width:"400px"},type:"text",placeholder:"Any Thoughts?",autoComplete:"off",value:r,onChange:function(e){a(e.target.value)}}),(0,j.jsxs)("h3",{children:["Well done, ",i.username]}),(0,j.jsx)("button",{onClick:function(){Ft.post("".concat("https://begym.azurewebsites.net","/posts"),{title:e.pushups,text:r,user:i.username}).then((function(e){alert("Post Uploaded"),o.push("/home")}))},children:"Submit Post"})]})})}var jQ=!1,HQ=!1,ZQ=!1;function KQ(){var e=.25,t=10,n=(0,S.useState)(!0),r=(0,E.Z)(n,2),a=r[0],i=r[1],o=(0,S.useState)(!1),s=(0,E.Z)(o,2),u=s[0],c=s[1],l=(0,S.useState)(!1),h=(0,E.Z)(l,2),p=(h[0],h[1],(0,S.useState)(!1)),d=(0,E.Z)(p,2),f=d[0],m=d[1],v=(0,S.useState)(-1),g=(0,E.Z)(v,2),y=g[0],b=g[1],x=(0,S.useState)(!0),k=(0,E.Z)(x,2),w=k[0],I=k[1],C=(0,S.useState)("black"),T=(0,E.Z)(C,2),N=(T[0],T[1]),R=(0,S.useState)(0),A=(0,E.Z)(R,2),_=A[0],O=A[1],F=(0,S.useState)(0),D=(0,E.Z)(F,2),M=D[0],P=D[1],L=(0,S.useState)(0),z=(0,E.Z)(L,2),B=z[0],U=z[1],W=(0,S.useState)(0),V=(0,E.Z)(W,2),G=V[0],H=V[1],Z=function(){jQ=!1,b(0),O(0),P(0),U(0),c(!0),i(!0),m(!1)};(0,S.useEffect)((function(){Z()}),[]),(0,S.useEffect)((function(){var e=(M-_)/1e3;B>60?ZQ=!0:jQ&&(HQ?H(e-B):U(e-G))}),[M,_]),(0,S.useEffect)((function(){console.log("Pushup Down: "+f),f||(w&&b((function(e){return e+1})),I(!0))}),[f,w]);var K=(0,S.useRef)(null),q=(0,S.useRef)(null),X=function(){var e=Ht(Gt().mark((function e(){var t,n;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r="webgl",xs.setBackend(r);case 2:return e.next=4,xs.ready();case 4:return t=QG.MoveNet,e.next=7,OQ(t);case 7:n=e.sent,setInterval((function(){Y(n)}),100);case 9:case"end":return e.stop()}var r}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var n=Ht(Gt().mark((function n(r){var a,o,s,l,h,p,d,v;return Gt().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("undefined"===typeof K.current||null===K.current||4!==K.current.video.readyState||ZQ){n.next=10;break}return a=K.current.video,o=K.current.video.videoWidth,s=K.current.video.videoHeight,K.current.video.width=o,K.current.video.height=s,n.next=8,r.estimatePoses(a);case 8:l=n.sent;try{l&&l.length>0&&(i(!1),h=zQ(l[0].keypoints,.1875),p=h.right,d="black",t>0?h.far!==u?t--:t=10:c(h.far),P(new Date(Date()).getTime()),h.far?(HQ=!1,jQ||(O(new Date(Date()).getTime()),jQ=!0),v=WQ(l[0].keypoints,e,.4,p),Q(l,a,o,s,q,d=v?"green":"red"),UQ(l[0].keypoints,100,20,p)?m(!0):UQ(l[0].keypoints,180,20,p)&&f&&(m(!1),I(!0))):(N("black"),Q(l,a,o,s,q,d),HQ=!0))}catch($Q){console.log($Q)}case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Q=function(){var t=Ht(Gt().mark((function t(n,r,a,i,o,s){var u;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==o.current){t.next=10;break}(u=o.current.getContext("2d")).translate(a,0),u.scale(-1,1),o.current.width=a,o.current.height=i,MQ(n[0].keypoints,e,u),LQ(n[0].keypoints,u,e,s),t.next=11;break;case 10:return t.abrupt("return");case 11:case"end":return t.stop()}}),t)})));return function(e,n,r,a,i,o){return t.apply(this,arguments)}}();return X(),(0,j.jsx)("div",{className:"App",children:B<=60?(0,j.jsxs)("header",{className:"App-header",style:{position:"relative"},children:[a&&(0,j.jsx)("div",{className:"loading-overlay",children:"Loading Detector.."}),!u&&!a&&(0,j.jsx)("div",{className:"loading-overlay",children:"Please Move Back 2 Metres"}),u&&!a&&(0,j.jsx)("div",{className:"loading-overlay",children:y}),u&&!a&&(0,j.jsxs)("div",{className:"loading-overlay",children:["Pose Time: ",B]}),(0,j.jsx)(NV(),{ref:K,muted:!0,mirrored:!0,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:9,width:640,height:480}}),(0,j.jsx)("canvas",{ref:q,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:8,width:640,height:480}})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("h1",{children:"Time's Up!"}),(0,j.jsx)(GQ,{pushups:y}),(0,j.jsx)("button",{onClick:function(){Z()},children:"Try Again"})]})})}var qQ=function(){return(0,j.jsx)("div",{children:(0,j.jsx)(KQ,{})})};function XQ(){var e="https://begym.azurewebsites.net",t=(0,R.useParams)().id,n=(0,S.useState)({}),r=(0,E.Z)(n,2),a=r[0],i=r[1],o=(0,S.useState)([]),s=(0,E.Z)(o,2),u=s[0],c=s[1],l=(0,S.useState)(""),h=(0,E.Z)(l,2),p=h[0],d=h[1],f=(0,S.useContext)(Dt).authState;(0,S.useEffect)((function(){Ft.get("".concat(e,"/posts/postID/").concat(t)).then((function(e){i(e.data)}))}),[]),(0,S.useEffect)((function(){Ft.get("".concat(e,"/comments/").concat(t)).then((function(e){c(e.data),console.log(e.data)}))}),[]);return(0,j.jsxs)("div",{className:"postPage",children:[(0,j.jsx)("div",{className:"leftSide",children:(0,j.jsxs)("div",{className:"posts",style:{position:"absolute",top:"70px"},children:[(0,j.jsxs)("div",{className:"title",children:[" ",a.title," "]}),(0,j.jsxs)("div",{className:"text",children:[" ",a.text," "]}),(0,j.jsxs)("div",{className:"user",children:[" ",a.user," "]})]})}),(0,j.jsxs)("div",{className:"rightSide",children:[(0,j.jsxs)("div",{className:"containerInput",children:[(0,j.jsx)("input",{type:"text",placeholder:"Write a comment!",autoComplete:"off",value:p,onChange:function(e){d(e.target.value)}}),(0,j.jsx)("button",{onClick:function(){Ft.post("".concat(e,"/comments"),{commentBody:p,PostId:t},{headers:{accessToken:localStorage.getItem("accessToken")}}).then((function(e){if(e.data.error)console.log(e.data.error);else{var t={commentBody:p,username:e.data.username};c([].concat((0,Lt.Z)(u),[t])),d("")}}))},children:"Submit Comment"})]}),(0,j.jsx)("div",{className:"commentsList",children:u.map((function(e,t){return(0,j.jsxs)("div",{className:"comment",children:[e.commentBody,(0,j.jsxs)("div",{children:[" By: ",e.username]}),(f.username===e.username||f.username===a.user)&&(0,j.jsx)("button",{onClick:function(){!function(e){console.log("Trying to delete comment"),Ft.delete("http://localhost:8080/comments/".concat(e),{headers:{accessToken:localStorage.getItem("accessToken")}}).then((function(){u.filter((function(t){return t.id!=e}))}))}(e.id)},children:"Delete"})]},t)}))})]})]})}var YQ=n.p+"static/media/chopper.e52e7d37c9a3ff2ee2a1.png";var QQ=function(){(0,R.useHistory)();var e=(0,S.useState)({username:"",id:0,status:!1}),t=(0,E.Z)(e,2),n=t[0],r=t[1];return(0,S.useEffect)((function(){Ft.get("".concat("https://begym.azurewebsites.net","/auth/auth")).then((function(e){e.data.error?r(N(N({},n),{},{status:!1})):r({username:e.data.username,id:e.data.id,status:!0})}))}),[]),(0,j.jsx)("div",{className:"App",children:(0,j.jsx)(Dt.Provider,{value:{authState:n,setAuthState:r},children:(0,j.jsxs)(M,{children:[(0,j.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:[(0,j.jsx)("img",{src:YQ,width:"70",height:"70",className:"headerPhoto"}),n.status?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(W,{to:"/home",className:"nav-link",children:[" ",(0,j.jsx)("button",{children:"Post Feed"})," "]}),(0,j.jsxs)(W,{to:"/video",className:"nav-link",children:[" ",(0,j.jsx)("button",{children:"My Gym"})," "]}),(0,j.jsxs)("div",{className:"logout",children:[(0,j.jsx)("button",{onClick:function(){return localStorage.removeItem("accessToken"),void r({username:"",id:0,status:!1})},children:"Log Out"}),(0,j.jsx)("label",{children:n.username})]})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(W,{to:"/login",className:"nav-link",children:[" ",(0,j.jsx)("button",{children:"Login Page"})," "]}),(0,j.jsxs)(W,{to:"/video",className:"nav-link",children:[" ",(0,j.jsx)("button",{children:"TEST"})," "]})]})]}),(0,j.jsxs)(R.Switch,{children:[(0,j.jsx)(R.Route,{exact:!0,path:"/login",component:Pt}),(0,j.jsx)(R.Route,{exact:!0,path:"/home",component:Wt}),(0,j.jsx)(R.Route,{exact:!0,path:"/post/:id",component:XQ}),(0,j.jsx)(R.Route,{exact:!0,path:"/video",component:qQ})]})]})})})},JQ=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};I.render((0,j.jsx)(S.StrictMode,{children:(0,j.jsx)(QQ,{})}),document.getElementById("root")),JQ()}()}();
//# sourceMappingURL=main.43bc250a.js.map